```js
var fs = require('fs'),
    xml2js = require('xml2js');

var parser = new xml2js.Parser();
fs.readFile(__dirname + '/game.xml', function(err, data) {
    parser.parseString(data, function (err, result) {
        var stream = fs.createWriteStream("game.json");
		stream.once('open', function(fd) {
			stream.write(JSON.stringify(result));
			stream.end();
		});
    });
});
```

---
This produces:

```
{"asl":{"$":{"version":"550"},"implied":[{"$":{"element":"object","property":"alt","type":"simplestringlist"}},{"$":{"element":"command","property":"pattern","type":"simplepattern"}},{"$":{"element":"command","property":"script","type":"script"}},{"$":{"element":"command","property":"multiple","type":"AssociatedScope"}},{"$":{"element":"object","property":"displayverbs","type":"simplestringlist"}},{"$":{"element":"object","property":"inventoryverbs","type":"simplestringlist"}},{"$":{"element":"walkthrough","property":"steps","type":"simplestringlist"}},{"$":{"element":"timer","property":"interval","type":"int"}},{"$":{"element":"timer","property":"script","type":"script"}},{"$":{"element":"turnscript","property":"script","type":"script"}}],"template":[{"_":"en","$":{"name":"LanguageId"}},{"_":"again","$":{"name":"Again1"}},{"_":"g","$":{"name":"Again2"}},{"_":"There is nothing to repeat.","$":{"name":"NothingToRepeat"}},{"_":"I can't see that.","$":{"name":"UnresolvedObject"}},{"_":"You can't go there.","$":{"name":"UnresolvedLocation"}},{"_":"Nothing out of the ordinary.","$":{"name":"DefaultObjectDescription"}},{"_":"Looking good.","$":{"name":"DefaultSelfDescription"}},{"_":"You can see","$":{"name":"SeeListHeader"}},{"_":"You can go","$":{"name":"GoListHeader"}},{"_":"and","$":{"name":"And"}},{"_":"nothing","$":{"name":"Nothing"}},{"_":"or","$":{"name":"Or"}},{"_":"Nothing to undo!","$":{"name":"NothingToUndo"}},{"_":"You are not carrying anything.","$":{"name":"NotCarryingAnything"}},{"_":"You are carrying","$":{"name":"CarryingListHeader"}},{"_":"I don't understand your command.","$":{"name":"UnrecognisedCommand"}},{"_":"You are in","$":{"name":"YouAreIn"}},{"_":"Look at","$":{"name":"LookAt"}},{"_":"Take","$":{"name":"Take"}},{"_":"Speak to","$":{"name":"SpeakTo"}},{"_":"Use","$":{"name":"Use"}},{"_":"Drop","$":{"name":"Drop"}},{"_":"Go to","$":{"name":"GoTo"}},{"_":"Go","$":{"name":"Go"}},{"_":"Switch on","$":{"name":"SwitchOn"}},{"_":"Switch off","$":{"name":"SwitchOff"}},{"_":"Open","$":{"name":"Open"}},{"_":"Close","$":{"name":"Close"}},{"_":"Eat","$":{"name":"Eat"}},{"_":"it","$":{"name":"NeutralGender"}},{"_":"he","$":{"name":"MaleGender"}},{"_":"she","$":{"name":"FemaleGender"}},{"_":"you","$":{"name":"SelfGender"}},{"_":"they","$":{"name":"NeutralPluralGender"}},{"_":"they","$":{"name":"MalePluralGender"}},{"_":"they","$":{"name":"FemalePluralGender"}},{"_":"it","$":{"name":"NeutralArticle"}},{"_":"him","$":{"name":"MaleArticle"}},{"_":"her","$":{"name":"FemaleArticle"}},{"_":"yourself","$":{"name":"SelfArticle"}},{"_":"them","$":{"name":"NeutralPluralArticle"}},{"_":"them","$":{"name":"MalePluralArticle"}},{"_":"them","$":{"name":"FemalePluralArticle"}},{"_":"its","$":{"name":"NeutralPossessive"}},{"_":"his","$":{"name":"MalePossessive"}},{"_":"her","$":{"name":"FemalePossessive"}},{"_":"your","$":{"name":"SelfPossessive"}},{"_":"their","$":{"name":"NeutralPluralPossessive"}},{"_":"their","$":{"name":"MalePluralPossessive"}},{"_":"their","$":{"name":"FemalePluralPossessive"}},{"_":"me","$":{"name":"SelfAlias"}},{"_":"me; myself; self","$":{"name":"SelfAlt"}},{"_":"all; everything","$":{"name":"AllObjects"}},{"_":"the; a; an","$":{"name":"ParserIgnorePrefixes"}},{"_":"Score","$":{"name":"Score"}},{"_":"Health","$":{"name":"Health"}},{"_":"Money","$":{"name":"Money"}},{"_":"You can't do that.","$":{"name":"CannotDoThat"}},{"_":"Done.","$":{"name":"Done"}},{"_":"containing","$":{"name":"ContainerContentsPrefix"}},{"_":"on which there is","$":{"name":"SurfaceContentsPrefix"}},{"_":"That way is locked.","$":{"name":"LockedExit"}},{"_":"You do not have the key.","$":{"name":"NoKey"}},{"_":"Unlocked.","$":{"name":"UnlockMessage"}},{"_":"Locked.","$":{"name":"LockMessage"}},{"_":"There is nothing to correct.","$":{"name":"DefaultOops"}},{"_":"with; using","$":{"name":"VerbObjectSeparator"}},{"_":"That doesn't work.","$":{"name":"DefaultMultiObjectVerb"}},{"_":"With which object?","$":{"name":"MultiObjectVerbMenu"}},{"_":"On which object?","$":{"name":"UseOnMenu"}},{"_":"To which object?","$":{"name":"GiveToMenu"}},{"_":"There are no objects available to do that with.","$":{"name":"NoObjectsAvailable"}},{"_":"Yes","$":{"name":"Yes"}},{"_":"No","$":{"name":"No"}},{"_":"by","$":{"name":"By"}},{"_":"Nothing here to take.","$":{"name":"NothingToTake"}},{"_":"You've nothing to drop.","$":{"name":"NothingToDrop"}},{"_":"You've nothing to wear.","$":{"name":"NothingToWear"}},{"_":"You've nothing to take off.","$":{"name":"NothingToRemove"}},{"_":"worn","$":{"name":"wornmodifier"}},{"_":"Wear","$":{"name":"Wear"}},{"_":"put #object# on; wear; put on; don; wear","$":{"name":"wear"}},{"_":"Remove","$":{"name":"Remove"}},{"_":"take #object# off; remove; take off; doff","$":{"name":"remove"}},{"_":"northwest","$":{"name":"CompassNW"}},{"_":"north","$":{"name":"CompassN"}},{"_":"northeast","$":{"name":"CompassNE"}},{"_":"west","$":{"name":"CompassW"}},{"_":"east","$":{"name":"CompassE"}},{"_":"southwest","$":{"name":"CompassSW"}},{"_":"south","$":{"name":"CompassS"}},{"_":"southeast","$":{"name":"CompassSE"}},{"_":"up","$":{"name":"CompassUp"}},{"_":"down","$":{"name":"CompassDown"}},{"_":"in","$":{"name":"CompassIn"}},{"_":"out","$":{"name":"CompassOut"}},{"$":{"name":"CompassDirectionPrefix"}},{"$":{"name":"CompassDirectionSuffix"}},{"$":{"name":"UpDownDirectionPrefix"}},{"$":{"name":"UpDownDirectionSuffix"}},{"$":{"name":"InOutDirectionPrefix"}},{"$":{"name":"InOutDirectionSuffix"}},{"_":"nw","$":{"name":"CompassNWShort"}},{"_":"n","$":{"name":"CompassNShort"}},{"_":"ne","$":{"name":"CompassNEShort"}},{"_":"w","$":{"name":"CompassWShort"}},{"_":"e","$":{"name":"CompassEShort"}},{"_":"sw","$":{"name":"CompassSWShort"}},{"_":"s","$":{"name":"CompassSShort"}},{"_":"se","$":{"name":"CompassSEShort"}},{"_":"u","$":{"name":"CompassUpShort"}},{"_":"d","$":{"name":"CompassDownShort"}},{"$":{"name":"CompassInShort"}},{"_":"o","$":{"name":"CompassOutShort"}},{"_":"Inventory","$":{"name":"InventoryLabel"}},{"_":"Status","$":{"name":"StatusLabel"}},{"_":"Places and Objects","$":{"name":"PlacesObjectsLabel"}},{"_":"Compass","$":{"name":"CompassLabel"}},{"_":"in","$":{"name":"InButtonLabel"}},{"_":"out","$":{"name":"OutButtonLabel"}},{"_":"(empty)","$":{"name":"EmptyListLabel"}},{"_":"(nothing selected)","$":{"name":"NothingSelectedLabel"}},{"_":"Type here...","$":{"name":"TypeHereLabel"}},{"_":"Continue...","$":{"name":"ContinueLabel"}},{"_":"^go to (?<exit>.*)$|^go (?<exit>.*)$|^(?<exit>north|east|south|west|northeast|northwest|southeast|southwest|in|out|up|down|n|e|s|w|ne|nw|se|sw|o|u|d)$","$":{"name":"go"}},{"_":"^look (?<exit>north|east|south|west|northeast|northwest|southeast|southwest|out|up|down|n|e|s|w|ne|nw|se|sw|o|u|d)$","$":{"name":"lookdir"}},{"_":"^look$|^l$","$":{"name":"look"}},{"_":"look at; look; x; examine; exam; ex","$":{"name":"lookat"}},{"_":"take; get; pick up","$":{"name":"take"}},{"_":"^undo$","$":{"name":"undo"}},{"_":"^i$|^inv$|^inventory$","$":{"name":"inventory"}},{"_":"^quit$","$":{"name":"quit"}},{"_":"drop","$":{"name":"drop"}},{"_":"use","$":{"name":"use"}},{"_":"speak to; speak; talk to; talk","$":{"name":"speakto"}},{"_":"open","$":{"name":"open"}},{"_":"close","$":{"name":"close"}},{"_":"^put (?<object1>.*) (on|in) (?<object2>.*)$","$":{"name":"put"}},{"_":"^(remove|take) (?<object1>.*) (from|out of|off) (?<object2>.*)$","$":{"name":"removefrom"}},{"_":"^ask (?<object>.*) about (?<text>.*)$","$":{"name":"ask"}},{"_":"^tell (?<object>.*) about (?<text>.*)$","$":{"name":"tell"}},{"_":"^(tell|ask) (?<object>.*) to (?<text>.*)$","$":{"name":"tellto"}},{"_":"^(?<object>.*), (?<text>.*)$","$":{"name":"alttellto"}},{"_":"^oops (?<text>.*)$","$":{"name":"oops"}},{"_":"buy; purchase","$":{"name":"buy"}},{"_":"climb","$":{"name":"climb"}},{"_":"drink","$":{"name":"drink"}},{"_":"eat","$":{"name":"eat"}},{"_":"give","$":{"name":"givesingle"}},{"_":"^give (?<object1>.*) to (?<object2>.*)$","$":{"name":"give"}},{"_":"hit","$":{"name":"hit"}},{"_":"kill","$":{"name":"kill"}},{"_":"kiss","$":{"name":"kiss"}},{"_":"knock","$":{"name":"knock"}},{"_":"lick","$":{"name":"lick"}},{"_":"lie on; lie upon; lie down on; lie down upon","$":{"name":"lie"}},{"_":"listen to","$":{"name":"listento"}},{"_":"lock","$":{"name":"lock"}},{"_":"move","$":{"name":"move"}},{"_":"pull","$":{"name":"pull"}},{"_":"push","$":{"name":"push"}},{"_":"read","$":{"name":"read"}},{"_":"search","$":{"name":"search"}},{"_":"show","$":{"name":"show"}},{"_":"sit on; sit upon; sit down on; sit down upon","$":{"name":"sit"}},{"_":"smell; sniff","$":{"name":"smell"}},{"_":"taste","$":{"name":"taste"}},{"_":"throw","$":{"name":"throw"}},{"_":"tie","$":{"name":"tie"}},{"_":"touch","$":{"name":"touch"}},{"_":"turn on; turn #object# on; switch on; switch #object# on","$":{"name":"turnon"}},{"_":"turn off; turn #object# off; switch off; switch #object# off","$":{"name":"turnoff"}},{"_":"turn","$":{"name":"turn"}},{"_":"unlock","$":{"name":"unlock"}},{"_":"untie","$":{"name":"untie"}},{"_":"^use (?<object1>.*) (on|with) (?<object2>.*)$","$":{"name":"useon"}},{"_":"^listen$","$":{"name":"listen"}},{"_":"You can't hear much.","$":{"name":"DefaultListen"}},{"_":"^jump$","$":{"name":"jump"}},{"_":"You jump, but nothing happens.","$":{"name":"DefaultJump"}},{"_":"^sit$|^sit down$","$":{"name":"sitdown"}},{"_":"No time for lounging about now.","$":{"name":"DefaultSitDown"}},{"_":"^lie$|^lie down$","$":{"name":"liedown"}},{"_":"No time for lounging about now.","$":{"name":"DefaultLieDown"}},{"_":"^sleep$|^rest$","$":{"name":"sleep"}},{"_":"No time for lounging about now.","$":{"name":"DefaultSleep"}},{"_":"^wait$|^z$","$":{"name":"wait"}},{"_":"Time passes.","$":{"name":"DefaultWait"}},{"_":"^xyzzy$","$":{"name":"xyzzy"}},{"_":"Surprisingly, absolutely nothing happens.","$":{"name":"DefaultXyzzy"}},{"_":"^help$|^\\?$","$":{"name":"help"}},{"_":"^save$","$":{"name":"save"}},{"_":"<u>Quick Help</u><br/><br/>\r\n<b>- Objects:</b>  Try LOOK AT..., SPEAK TO..., TAKE..., DROP..., OPEN..., GIVE... TO..., USE... ON/WITH...<br/>\r\n<b>- Inventory:</b>  See which items you are carrying by typing I, INV or INVENTORY.<br/>\r\n<b>- Moving around:</b>  Press the compass buttons, or type GO NORTH, SOUTH, E, GO TO...<br/>\r\n<b>- Shortcuts:</b>  Press the up arrow and down arrow to scroll through commands you have already typed in. Try X... as a shortcut for LOOK AT...","$":{"name":"DefaultHelp"}},{"$":{"name":"LanguageSpecificObjectTypes"}},{"_":"\"You can't #verb# \" + object.article + \".\"","$":{"name":"EditorVerbDefaultExpression"}}],"dynamictemplate":[{"_":"\"You pick \" + object.article + \" up.\"","$":{"name":"TakeSuccessful"}},{"_":"\"You can't take \" + object.article + \".\"","$":{"name":"TakeUnsuccessful"}},{"_":"WriteVerb(object, \"be\") + \" too heavy to be taken.\"","$":{"name":"FullInventory"}},{"_":"\"You can't carry any more items.\"","$":{"name":"MaxObjectsInInventory"}},{"_":"\"You can't put more items in \" + object.article + \".\"","$":{"name":"MaxObjectsInContainer"}},{"_":"\"You drop \" + object.article + \".\"","$":{"name":"DropSuccessful"}},{"_":"\"You can't drop \" + object.article + \".\"","$":{"name":"DropUnsuccessful"}},{"_":"\"You can't put \" + object.article + \" there.\"","$":{"name":"ObjectCannotBeStored"}},{"_":"\"You are already carrying \" + object.article + \".\"","$":{"name":"AlreadyTaken"}},{"_":"\"You are not carrying \" + object.article + \".\"","$":{"name":"NotCarrying"}},{"_":"\"You can't use \" + object.article + \".\"","$":{"name":"CantUse"}},{"_":"\"You can't give \" + object.article + \".\"","$":{"name":"CantGive"}},{"_":"WriteVerb(object, \"say\") + \" nothing.\"","$":{"name":"DefaultSpeakTo"}},{"_":"CapFirst(GetDisplayAlias(object)) + \" \" + Conjugate(object, \"be\") + \" not open.\"","$":{"name":"ObjectNotOpen"}},{"_":"WriteVerb(object, \"be\") + \" already open.\"","$":{"name":"AlreadyOpen"}},{"_":"WriteVerb(object, \"be\") + \" already closed.\"","$":{"name":"AlreadyClosed"}},{"_":"\"You can't open \" + object.article + \".\"","$":{"name":"CantOpen"}},{"_":"\"You can't close \" + object.article + \".\"","$":{"name":"CantClose"}},{"_":"\"You open \" + object.article + \".\"","$":{"name":"OpenSuccessful"}},{"_":"\"You close \" + object.article + \".\"","$":{"name":"CloseSuccessful"}},{"_":"WriteVerb(object, \"be\") + \" already there.\"","$":{"name":"AlreadyThere"}},{"_":"WriteVerb(object, \"contain\")","$":{"name":"ObjectContains"}},{"_":"WriteVerb(object, \"be\") + \" full.\"","$":{"name":"ContainerFull"}},{"_":"\"Please choose which '\" + text + \"' you mean:\"","$":{"name":"DisambiguateMenu"}},{"_":"\"Undo: \" + text","$":{"name":"UndoTurn"}},{"_":"WriteVerb(object, \"do\") + \" not reply.\"","$":{"name":"DefaultAsk"}},{"_":"WriteVerb(object, \"do\") + \" not reply.\"","$":{"name":"DefaultTell"}},{"_":"WriteVerb(object, \"be\") + \" locked.\"","$":{"name":"LockedObject"}},{"_":"WriteVerb(object, \"be\") + \" already locked.\"","$":{"name":"AlreadyLocked"}},{"_":"WriteVerb(object, \"be\") + \" already unlocked.\"","$":{"name":"AlreadyUnlocked"}},{"_":"\"You cannot lock \" + object.article + \" when \" + object.gender + \" \" + Conjugate(object, \"be\") + \" open.\"","$":{"name":"CannotLockOpen"}},{"_":"WriteVerb(object, \"be\") + \" already switched on.\"","$":{"name":"AlreadySwitchedOn"}},{"_":"WriteVerb(object, \"be\") + \" already switched off.\"","$":{"name":"AlreadySwitchedOff"}},{"_":"\"You switch \" + object.article + \" on.\"","$":{"name":"SwitchedOn"}},{"_":"\"You switch \" + object.article + \" off.\"","$":{"name":"SwitchedOff"}},{"_":"\"You eat \" + object.article + \".\"","$":{"name":"Eaten"}},{"_":"CapFirst(GetDisplayAlias(object1)) + \" \" + Conjugate(object1, \"do\") + \" not contain \" + GetDisplayAlias(object2) + \".\"","$":{"name":"ObjectDoesNotContain"}},{"_":"\"You are looking \" + text +\".\"","$":{"name":"YouLooking"}},{"_":"\"It is too dark to make anything out.\"","$":{"name":"LookAtDarkness"}},{"_":"\"You put \" + object.article + \" on.\"","$":{"name":"WearSuccessful"}},{"_":"\"You can't wear \" + object.article + \".\"","$":{"name":"WearUnsuccessful"}},{"_":"\"You would need to get \" + object.article + \" before you can put \" + object.article + \" on.\"","$":{"name":"CannotWearIfNotHeld"}},{"_":"\"You would need to get \" + object.article + \" before you can take \" + object.article + \" off.\"","$":{"name":"CannotRemoveIfNotHeld"}},{"_":"\"You are already wearing \" + object.article + \".\"","$":{"name":"AlreadyWearing"}},{"_":"\"You are not wearing \" + object.article + \".\"","$":{"name":"CannotRemoveIfNotWearing"}},{"_":"\"You cannot remove \" + object.article + \"!\"","$":{"name":"NotRemovable"}},{"_":"\"You cannot wear that over \" + GetDisplayGarment(object) + \".\"","$":{"name":"CannotWearOver"}},{"_":"\"You cannot wear that while wearing \" + GetDisplayGarment(object) + \".\"","$":{"name":"CannotWearWith"}},{"_":"\"You take \" + object.article + \" off.\"","$":{"name":"RemoveSuccessful"}},{"_":"\"You can't remove that while wearing \" + GetDisplayGarment(object) + \".\"","$":{"name":"RemoveFirst"}},{"_":"\"You can't buy \" + object.article + \".\"","$":{"name":"DefaultBuy"}},{"_":"\"You can't climb \" + object.article + \".\"","$":{"name":"DefaultClimb"}},{"_":"\"You can't drink \" + object.article + \".\"","$":{"name":"DefaultDrink"}},{"_":"\"You can't eat \" + object.article + \".\"","$":{"name":"DefaultEat"}},{"_":"WriteVerb(object1, \"do\") + \" not want \" + object2.article + \".\"","$":{"name":"DefaultGive"}},{"_":"\"You can't hit \" + object.article + \".\"","$":{"name":"DefaultHit"}},{"_":"\"You can't kill \" + object.article + \".\"","$":{"name":"DefaultKill"}},{"_":"\"You can't kiss \" + object.article + \".\"","$":{"name":"DefaultKiss"}},{"_":"\"You can't knock \" + object.article + \".\"","$":{"name":"DefaultKnock"}},{"_":"\"You can't lick \" + object.article + \".\"","$":{"name":"DefaultLick"}},{"_":"\"You can't lie on \" + object.article + \".\"","$":{"name":"DefaultLie"}},{"_":"\"You listen, but \" + object.gender + \" makes no sound.\"","$":{"name":"DefaultListenTo"}},{"_":"\"You can't lock \" + object.article + \".\"","$":{"name":"DefaultLock"}},{"_":"\"You can't move \" + object.article + \".\"","$":{"name":"DefaultMove"}},{"_":"\"You can't pull \" + object.article + \".\"","$":{"name":"DefaultPull"}},{"_":"\"You can't push \" + object.article + \".\"","$":{"name":"DefaultPush"}},{"_":"\"You can't read \" + object.article + \".\"","$":{"name":"DefaultRead"}},{"_":"\"You can't search \" + object.article + \".\"","$":{"name":"DefaultSearch"}},{"_":"\"You can't show \" + object.article + \".\"","$":{"name":"DefaultShow"}},{"_":"\"You can't sit on \" + object.article + \".\"","$":{"name":"DefaultSit"}},{"_":"\"You sniff, but \" + object.gender + \" doesn't smell of much.\"","$":{"name":"DefaultSmell"}},{"_":"\"You can't taste \" + object.article + \".\"","$":{"name":"DefaultTaste"}},{"_":"\"You can't throw \" + object.article + \".\"","$":{"name":"DefaultThrow"}},{"_":"\"You can't tie \" + object.article + \".\"","$":{"name":"DefaultTie"}},{"_":"\"You can't touch \" + object.article + \".\"","$":{"name":"DefaultTouch"}},{"_":"\"You can't turn \" + object.article + \" on.\"","$":{"name":"DefaultTurnOn"}},{"_":"\"You can't turn \" + object.article + \" off.\"","$":{"name":"DefaultTurnOff"}},{"_":"\"You can't turn \" + object.article + \".\"","$":{"name":"DefaultTurn"}},{"_":"\"You can't unlock \" + object.article + \".\"","$":{"name":"DefaultUnlock"}},{"_":"\"You can't untie \" + object.article + \".\"","$":{"name":"DefaultUntie"}},{"_":"\"You can't use \" + object2.article + \" that way.\"","$":{"name":"DefaultUseOn"}},{"_":"\"You can't wear \" + object.article + \".\"","$":{"name":"DefaultWear"}}],"delegate":[{"$":{"name":"AddScript","parameters":"object","type":""}},{"$":{"name":"AssociatedScope","parameters":"","type":"objectlist"}}],"game":[{"$":{"name":"Drumsticks"},"inherit":[{"$":{"name":"theme_typewriter"}}],"gameid":["f63650f4-5d2c-4525-857f-79d3c1faf7ee"],"version":["1.1"],"firstpublished":["2018"],"feature_lightdark":[""],"feature_asktell":[""],"feature_advancedwearables":[""],"feature_advancedscripts":[""],"feature_limitinventory":[""],"enablehyperlinks":[{"_":"false","$":{"type":"boolean"}}],"showpanes":[{"_":"false","$":{"type":"boolean"}}],"category":["Puzzle"],"author":["Luke A. Jones"],"showtitle":[""],"autodescription_youarein_newline":[""],"command_newline":[""],"autodisplayverbs":[""],"showdescriptiononenter":[{"_":"false","$":{"type":"boolean"}}],"multiplecommands":[""],"autodescription_youcansee_newline":[""],"autodescription_youcango_newline":[""],"autodescription_description_newline":[""],"clearscreenonroomenter":[{"_":"false","$":{"type":"boolean"}}],"bordercolour":["DarkGray"],"marginscolour":["White"],"defaultfontsize":[{"_":"11","$":{"type":"int"}}],"gridmap":[{"_":"false","$":{"type":"boolean"}}],"respondtogridclicks":[{"_":"false","$":{"type":"boolean"}}],"showcommandbar":[""],"borderlesscursor":[{"_":"false","$":{"type":"boolean"}}],"defaultfont":["Georgia, serif"],"cover":["drumstickartwork512.png"],"roomenter":[{"_":"\r\n      if (not GetBoolean(Jonny, \"jon_go\")) {\r\n        MoveObjectHere (Jonny)\r\n        ShowRoomDescription\r\n      }\r\n      else {\r\n        ShowRoomDescription\r\n      }\r\n    ","$":{"type":"script"}}],"start":[{"_":"\r\n      WearGarment (Shoes)\r\n    ","$":{"type":"script"}}],"object":[{"$":{"name":"Handfull of Gravel"},"inherit":[{"$":{"name":"plural"}}],"look":["A handful of white gravel."],"feature_usegive":[""],"alias":["Handful of Gravel"],"take":[""],"use":[{"_":"\r\n        msg (\"You need to be more specific.\")\r\n      ","$":{"type":"script"}}],"throw":[{"_":"\r\n        if (game.pov.parent = Outside Spiders House) {\r\n          if (not GetBoolean(Spider Jones, \"spider_awake\")) {\r\n            msg (\"You throw a handful of gravel at the bedroom window, it rains down on the window with a gentle patter.<br/><br/>\\\"Yeah, that's it boss, give the window a gentle tickle, that will do the job\\\" says Jonny sarcastically. \\\"Here, let me have a go\\\".<br/><br/>He picks up a huge handful of gravel and throws it at the window with such force that you are suprised it doesn't shatter! <br/><br/>After a few seconds Spider's blearly eyed face appears at the window. He spots you both and in a mere ten minutes he appears at the front door. \")\r\n            MoveObjectHere (Spider Jones)\r\n            RemoveObject (Handfull of Gravel)\r\n            SetObjectFlagOn (Spider Jones, \"spider_awake\")\r\n          }\r\n          else {\r\n            msg (\"You have already woken Spider up!\")\r\n          }\r\n        }\r\n        else {\r\n          msg (\"That probably wouldn't achieve much, at least not here anyway.\")\r\n        }\r\n      ","$":{"type":"script"}}]},{"$":{"name":"Spider Jones"},"inherit":[{"$":{"name":"namedmale"}}],"look":["The bass player of the band. 6 foot tall and barely a foot wide. He has long gangly arms and legs, and a rough mess of long brown hair. He has a permanent sleepy look about him. "],"kiss":["Good looking as he is, it's not that kind of game."],"fuck":["It's not that kind of game."],"speak":[{"_":"\r\n        firsttime {\r\n          msg (\"\\\"Alright Spider!\\\" You say. <br/><br/>\\\"Yeah  thanks for coming to the door so fucking quickly\\\" growls Jonny.<br/><br/> You proceed to tell Spider about the gig, he wakes up a bit more and says. \\\"Wicked, I'll meet you at the Blackfriars Inn later, but all my equipment is at the rehearsal rooms.\\\"<br/><br/> \\\"Yeah I know\\\", you reply, \\\"We'll pick it up\\\". <br/><br/>\\\"Oh yes,\\\" says Jonny, \\\"I just love humping all that gear around, my favourite fucking hobby.\\\" <br/><br/>Spider laughs and says, \\\"Well you need another one apart from being a grumpy sod!\\\", \\\"I'm off, see you later.\\\"<br/><br/>Spider disappears up the road.\")\r\n          MoveObject (Pub Spider, Backstage)\r\n          MakeObjectInvisible (Spider Jones)\r\n          IncreaseObjectCounter (Blackfriars Inn, \"tasks\")\r\n        }\r\n        otherwise {\r\n        }\r\n      ","$":{"type":"script"}}],"tell":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n          firsttime {\r\n            msg (\"\\\"Alright Spider!\\\" You say.<br/><br/>\\\"Yeah  thanks for coming to the door so fucking quickly\\\" growls Jonny.<br/><br/> You proceed to tell Spider about the gig, he wakes up a bit more and says. \\\"Wicked, I'll meet you at the Blackfriars Inn later, but all my equipment is at the rehearsal rooms.\\\"<br/><br/> \\\"Yeah I know\\\", you reply, \\\"We'll pick it up.\\\"<br/><br/>\\\"Oh yes,\\\" says Jonny, \\\"I just love humping all that gear around, my favourite fucking hobby.\\\"<br/><br/> Spider laughs and says, \\\"Well you need another one apart from being a grumpy sod!\\\", \\\"I'm off, see you later.\\\"<br/><br/> Spider disappears up the road.\")\r\n            MoveObject (Pub Spider, Backstage)\r\n            MakeObjectInvisible (Spider Jones)\r\n            IncreaseObjectCounter (Blackfriars Inn, \"tasks\")\r\n          }\r\n          otherwise {\r\n          }\r\n        ","$":{"key":"gig"}}]}]},{"$":{"name":"pub gerald"},"alias":["Jerry 'the mouse' "],"kiss":["It's not that kind of game. Perhaps a twine game would be more up your street."],"fuck":["It's not that kind of game. Perhaps a twine game would be more up your street."],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"look":[{"_":"\r\n        if (GetBoolean(Blackfriars Inn, \"gigover\")) {\r\n          msg (\"Local DJ and record store owner, Jerry 'the mouse'. So called due to his diminutive stature and his love of cheesy music. He is wearing a deafeningly loud blue and orange Hawaiian shirt, white chinos, and a cream jumper tied around his shoulders.<br/><br/>He's currently packing up his DJ equipment.\")\r\n        }\r\n        else {\r\n          msg (\"Local DJ and record store owner, Jerry 'the mouse'. So called due to his diminutive stature and his love of cheesy music. He is wearing a deafeningly loud blue and orange Hawaiian shirt, white chinos, and a cream jumper tied around his shoulders. He peers over his counterfeit ray ban sunglasses at you and smiles.<br/><br/> He's currently setting up his DJ equipment.\")\r\n        }\r\n      ","$":{"type":"script"}}],"speak":[{"_":"\r\n        if (GetBoolean(Blackfriars Inn, \"gigover\")) {\r\n          msg (\"\\\"Well met Sir!\\\" says Jerry,\\\"What a delightful crowd. A most pleasing turn out and reaction\\\". He carries on packing up his DJ equipment.\")\r\n        }\r\n        else {\r\n          msg (\"\\\"Hello good squire!\\\" says Jerry, \\\"I'm looking foward to the gig, got some early 90's bubblegum pop that I think will go down a treat!\\\" \")\r\n        }\r\n      ","$":{"type":"script"}}]},{"$":{"name":"Pub Mac"},"inherit":[{"$":{"name":"namedmale"}}],"alias":["Mac Attack"],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"kiss":["It's not that kind of game. "],"fuck":["It's not that kind of game."],"look":[{"_":"\r\n        if (GetBoolean(Backstage, \"gear_loaded\")) {\r\n          if (GetBoolean(Blackfriars Inn, \"gigover\")) {\r\n            msg (\"The band's drummer. He's average height, pale skin and a shaved head (when it grows out it is a fiery ginger colour and the rest of the band remorselessly take the piss). He's dressed in blue jeans, white hi-top trainers, and a red Superdry<sup><font size=\\\"1\\\">TM</sup></font> hoodie. He dripping with sweat and wiping himself down with a towel.\")\r\n          }\r\n          else {\r\n            msg (\"The band's drummer. He's average height, pale skin and a shaved head (when it grows out it is a fiery ginger colour and the rest of the band remorselessly take the piss). He's dressed in blue jeans, white hi-top trainers, and a red Superdry<sup><font size=\\\"1\\\">TM</sup></font> hoodie.  He is currently tensioning the skin on his snare drum.\")\r\n          }\r\n        }\r\n        else {\r\n          msg (\"The band's drummer. He's average height, pale skin and a shaved head (when it grows out it is a fiery ginger colour and the rest of the band remorselessly take the piss). He's dressed in blue jeans, white hi-top trainers, and a red Superdry<sup><font size=\\\"1\\\">TM</sup></font> hoodie. He looks bored and says, \\\"Are you picking the band's gear up soon? I need to do some work on my snare drum before the gig.\\\"\")\r\n        }\r\n      ","$":{"type":"script"}}],"speak":[{"_":"\r\n        if (GetBoolean(Backstage, \"gear_loaded\")) {\r\n          if (GetBoolean(Blackfriars Inn, \"gigover\")) {\r\n            msg (\"\\\"That was one hell of a gig!\\\" says Mac, still attempting to catch his breath.\")\r\n          }\r\n          else {\r\n            msg (\"\\\"Yo!\\\" says Mac, \\\"this gig is going to be killer!\\\" He continues tensioning the skin on his snare drum.\")\r\n          }\r\n        }\r\n        else {\r\n          msg (\"\\\"Hey\\\" says Mac, \\\"are you picking the band's gear up soon? I need to do some work on my snare drum before the gig.\\\"\")\r\n        }\r\n      ","$":{"type":"script"}}]},{"$":{"name":"Small Key"},"look":["A small brass key."],"feature_usegive":[""],"take":[{"_":"\r\n        if (Small Key.parent=Jonny) {\r\n          msg (\"Jonny hands it over.\")\r\n          AddToInventory (Small Key)\r\n        }\r\n        else {\r\n          msg (\"You pick it up.\")\r\n          AddToInventory (Small Key)\r\n        }\r\n      ","$":{"type":"script"}}],"giveto":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n          msg (\"You give the small key to Jonny. \\\"Oh you found the key to my toolbox\\\" says Jonny, \\\"nice one boss.\\\"\")\r\n          MoveObject (Small Key, Jonny)\r\n        ","$":{"key":"Jonny"}}]}]},{"$":{"name":"Alternator"},"feature_usegive":[""],"look":["An alternator for a Ford Transit van. It is cylindrical in shape, with terminals at one end and a pulley wheel at the other."],"take":[{"_":"\r\n        if (Alternator.parent=Jonny) {\r\n          msg (\"Jonny hands it over.\")\r\n          AddToInventory (Alternator)\r\n        }\r\n        else {\r\n          msg (\"You pick it up.\")\r\n        }\r\n        AddToInventory (Alternator)\r\n      ","$":{"type":"script"}}],"giveto":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n          if (game.pov.parent = Jons Lockup) {\r\n            SetObjectFlagOn (Jonny, \"van_fixed\")\r\n            msg (\"\\\"Right\\\" says Jon, \\\"Let's give this bitch what it needs!\\\" Jonny opens the engine compartment and with some further cursing and grunting proceeds to replace the alternator. \\\"There,\\\" he says, \\\"the fucker is fixed!\\\" He starts the van, guns the engine and says, \\\"Get in then Boss!\\\"\")\r\n            RemoveObject (Alternator)\r\n          }\r\n          else {\r\n            msg (\"You give the alternator to Jonny\")\r\n            MoveObject (Alternator, Jonny)\r\n          }\r\n        ","$":{"key":"Jonny"}}]}],"selfuseon":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n          msg (\"You attempt to fit the new alternator to the van, much to the bemusement of Jonny. After a few minutes struggling Jonny says, \\\"Hey boss, why not give it to me and I'll fix the fucker!\\\"\")\r\n        ","$":{"key":"Van"}}]}]},{"$":{"name":"Guitar Case"},"inherit":[{"$":{"name":"container_closed"}}],"feature_container":[""],"feature_usegive":[""],"hidechildren":[""],"listchildren":[""],"take":[""],"drop":[{"_":"false","$":{"type":"boolean"}}],"dropmsg":["You're tired of carrying the case and drop it, but then you decide you had better hang on to it so you pick it up again."],"giveto":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n          if (Contains (Guitar Case,Eds Guitar)) {\r\n            msg (\"Ed opens the case, examines the guitar and says, \\\"It's no good, you need to get it fixed for me.\\\" He hands it back to you.<br/>\")\r\n          }\r\n          else if (Contains (Guitar Case,Eds fixed guitar)) {\r\n            msg (\"Ed opens the case and examines the guitar. \\\"Ah Lucy! What fine shape you are in, and how lucky you are to be played by me!\\\"<br/><br/> He heads upstairs and comes down dressed in his gig outfit.  \\\"Right he says, I'll see you down at the Blackfriars Inn.\\\" He shows you out of the house and disappears up the road.<br/><br/>\")\r\n            RemoveObject (Guitar Case)\r\n            MoveObject (player, Outside Ed Cases House)\r\n            LockExit (eds_door)\r\n            SetObjectFlagOn (Ed Case, \"ed_gone\")\r\n            MoveObject (Pub Ed Case, Backstage)\r\n            IncreaseObjectCounter (Blackfriars Inn, \"tasks\")\r\n          }\r\n        ","$":{"key":"Ed Case"}}]}],"displayverbs":[{"$":{"type":"stringlist"},"value":["Look at","Take","Open","Close"]}],"inventoryverbs":[{"$":{"type":"stringlist"},"value":["Look at","Use","Drop","Open","Close"]}],"object":[{"$":{"name":"Eds Guitar"},"alias":["Fender thundergrunt"],"take":[""],"feature_usegive":[""],"visible":[""],"alt":[{"$":{"type":"stringlist"},"value":["guitar"]}],"look":["A seven string Fender Thudergrunt with a swirl fire finish, equiped with floyd rose bridge and  firebreather pickups. The body is made from mahogany with a flame maple cap, ebony fretboard with steel jumbo frets. Ed calls it 'Lucy'."],"play":[{"_":"\r\n          if (Ed Case.parent = game.pov.parent) {\r\n            msg (\"You attempt to play Ed's guitar, but Ed shouts, \\\"No! Only I get to play with Lucy!\\\"\")\r\n          }\r\n          else {\r\n            msg (\"As Ed isn't watching you strum a few chords on the guitar, but the tone doesn't sound right.\")\r\n          }\r\n        ","$":{"type":"script"}}],"giveto":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n            RemoveObject (Eds Guitar)\r\n            msg (\"Helen takes the guitar from you and says, \\\"Oh no, not this thing again, do you know how many times I've adjusted this for that idiot Ed?!\\\". <br/><br/>Helen holds up the guitar up flat and looks down the length of the fretboard, sighs and says, \\\"Hell the truss rod needs tensioning and the intonation needs adjustment, on this monstrosity it's a fiddly pain in the butt. I'll do it for you but you need to do me a favour, go over to the No Smoke Inn off Brunswick Street and pick me up some vape fluid, I've run out again. I want something sweet, smoky and creamy. Helps me concentrate.\\\" <br/>\")\r\n            SetObjectFlagOn (Helen Key, \"helen_gotguitar\")\r\n          ","$":{"key":"Helen Key"}},{"_":"\r\n            msg (\"\\\"What the hell!\\\" says Ed, \\\"What's it doing out of its case! Put it back immediately!\\\" he hands it back to you.\")\r\n          ","$":{"key":"Ed Case"}}]}]}]},{"$":{"name":"Ponky"},"inherit":[{"$":{"name":"namedmale"}}],"feature_usegive":[""],"drop":[{"_":"false","$":{"type":"boolean"}}],"dropmsg":["After all the hassle of finding him you decode against letting him go again!"],"stroke":["You stroke Ponky, he purrs and licks your hand."],"kiss":["You plant a small kiss on the top of Ponky's head. His fur tickles your top lip."],"pet":["You stroke Ponky, he purrs and licks your hand."],"fuck":["It's not that kind of game!"],"take":[{"_":"\r\n        if (Ponky.parent=Jonny) {\r\n          msg (\"Jonny reluctantly hands him over.\")\r\n          AddToInventory (Ponky)\r\n        }\r\n        else {\r\n          msg (\"You pick him up.\")\r\n        }\r\n      ","$":{"type":"script"}}],"look":[{"_":"\r\n        if (Contains (Jonny,Ponky)) {\r\n          msg (\"An adorable black kitten with white paws, and a touch of blood around his tiny mouth. Jon is stroking him behind his ears, they seem to get on well.\")\r\n        }\r\n        else {\r\n          msg (\"An adorable black kitten with white paws, and a touch of blood around his tiny mouth. He stares up at you and you stroke his head, he mews approvingly.\")\r\n        }\r\n      ","$":{"type":"script"}}],"giveto":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n          msg (\"You hand Ponky over to Jonny.\")\r\n          MoveObject (Ponky, Jonny)\r\n        ","$":{"key":"Jonny"}}]}]},{"$":{"name":"Pub Mike"},"alias":["Mike Smith"],"kiss":["It's not that kind of game."],"fuck":["It's not that kind of game."],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"speak":[{"_":"\r\n        if (GetBoolean(Backstage, \"gear_loaded\")) {\r\n          if (GetBoolean(Blackfriars Inn, \"gigover\")) {\r\n            msg (\"\\\"Wow! What a buzz, the crowd were amazing!\\\" says Mike.\")\r\n          }\r\n          else {\r\n            msg (\"\\\"Hey!\\\" says Mike, \\\"this gig is going to be great, a full house again at last!\\\"\")\r\n          }\r\n        }\r\n        else {\r\n          msg (\"\\\"Hey!\\\" says Mike, \\\"Have you managed to pick up the band equipment yet? Tony Def will have a stroke if we're not ready for the soundcheck\\\".\")\r\n        }\r\n      ","$":{"type":"script"}}],"look":[{"_":"\r\n        if (GetBoolean(Blackfriars Inn, \"gigover\")) {\r\n          msg (\"He is wearing black combat trousers, black highly polished boots, a black t-shirt with a Jack Daniels logo on, and a black denim jacket. He is dripping with sweat and talking excitedly with Spider.\")\r\n        }\r\n        else {\r\n          msg (\"He is wearing black combat trousers, black highly polished boots, a black t-shirt with a Jack Daniels logo on, and a black denim jacket. His short dark hair is gelled into small spikes.\")\r\n        }\r\n      ","$":{"type":"script"}}]},{"$":{"name":"Pub Spider"},"alias":["Spider Jones"],"kiss":["He's a good looking chap, but it's not that sort of game."],"fuck":["He's a good looking chap, but it's not that sort of game."],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"look":[{"_":"\r\n        if (GetBoolean(Backstage, \"gear_loaded\")) {\r\n          if (GetBoolean(Blackfriars Inn, \"gigover\")) {\r\n            msg (\"The bass player of the band. 6 foot tall and barely a foot wide. He has long gangly arms and legs, and a rough mess of long brown hair. Unusually he looks wide awake and wired from the gig..\")\r\n          }\r\n          else {\r\n            msg (\"The bass player of the band. 6 foot tall and barely a foot wide. He has long gangly arms and legs, and a rough mess of long brown hair. He has a permanent sleepy look about him. He is currently tuning is bass guitar, he has his tongue stuck out and a pained look of concentration on his face.\")\r\n          }\r\n        }\r\n        else {\r\n          msg (\"The bass player of the band. 6 foot tall and barely a foot wide. He has long gangly arms and legs, and a rough mess of long brown hair. He has a permanent sleepy look about him.\")\r\n        }\r\n      ","$":{"type":"script"}}],"speak":[{"_":"\r\n        if (GetBoolean(Backstage, \"gear_loaded\")) {\r\n          if (GetBoolean(Blackfriars Inn, \"gigover\")) {\r\n            msg (\"\\\"That was awesome!\\\" says Spider. He looks more awake than you've seen him in months.\")\r\n          }\r\n          else {\r\n            msg (\"\\\"Hi\\\" says Spider, \\\"Just tuning my bass, have you seen the coach outside?!\\\"\")\r\n          }\r\n        }\r\n        else {\r\n          msg (\"\\\"Hi\\\" says Spider, \\\"Are you picking up the band equipment soon? Won't be long till the soundcheck\\\".\")\r\n        }\r\n      ","$":{"type":"script"}}]},{"$":{"name":"KFC takeaway"},"take":[""],"feature_usegive":[""],"look":["A greasy brown bag containing a Mighty Bucket for One, Boneless Dippers and Fries. <br/><br/>It smells both wonderful and slightly disgusting at the same time."],"alt":[{"$":{"type":"stringlist"},"value":["chicken"]}],"giveto":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n          SetObjectFlagOff (Tony Def, \"hungry\")\r\n          msg (\"Tony takes the bucket of KFC from you and mutters a \\\"thanks\\\". He takes a bite of chicken and starts sorting out the soundcheck. <br/><br/>\\\"Oh hang on!\\\" Tony says, \\\"The damn stage monitors aren't plugged in!\\\" he points at a jumble of cables next to the stage.<br/><br/> \\\"Go and fix the cables\\\" he says to you, \\\"I don't want to cover it all in chicken grease, and I don't want Jon anywhere near my equipment.\\\"<br/><br/> \\\"You're an arsehole Tony\\\" says Jon.<br/><br/>\\\"Up to you, my sound system, my rules\\\" replies Tony. <br/><br/>\\\"OK, I'll do it\\\" you say to avoid any further escalation between these two.<br/><br/>\\\"Right,\\\" says Tony, \\\"here's the instructions for connecting the cables properly before flicking the switch, easy as pie. \\\"<br/><br/>He scribbles on a piece of paper and hand it to you, “That should give me enough time to finish my KFC” he says with smirk.\")\r\n          RemoveObject (KFC takeaway)\r\n          MakeObjectVisible (machine)\r\n          MakeObjectVisible (socket 1)\r\n          MakeObjectVisible (socket 2)\r\n          MakeObjectVisible (socket 3)\r\n          MakeObjectVisible (socket 4)\r\n          MakeObjectVisible (socket 5)\r\n          MakeObjectVisible (sockets)\r\n          MakeObjectVisible (jumble of cables)\r\n          MakeObjectVisible (switch1)\r\n          MakeObjectVisible (red cable)\r\n          MakeObjectVisible (blue cable)\r\n          MakeObjectVisible (white cable)\r\n          MakeObjectVisible (yellow cable)\r\n          MakeObjectVisible (green cable)\r\n          AddToInventory (Instructions From Tony)\r\n        ","$":{"key":"Tony Def"}}]}]},{"$":{"name":"Kate"},"inherit":[{"$":{"name":"namedfemale"}}],"look":["Kate, the drummer from Get Lamp. Tall with long dyed black hair. She is wearing denim hot pants and a Burzum t-shirt tied into a knot just above her waist. She has a bored look on her face as Ed tries to chat her up."],"speak":[{"_":"\r\n        msg (\"\\\"Oh hi!\\\" Kate says, clearly relived to be taken out of the conversation with Ed. <br><br> Your roadie Jon sure likes our van, speaking of which I must and catch up with the rest of the band, see you!\\\" She dashes off out of the door.\")\r\n        RemoveObject (Kate)\r\n      ","$":{"type":"script"}}]}]}],"command":[{"$":{"name":"lookat"},"pattern":["look at #object#; look #object#; x #object#; examine #object#; exam #object#; ex #object#"],"script":["\r\n      if (GetBoolean(object, \"hidechildren\")) {\r\n        object.hidechildren = false\r\n      }\r\n      if (TypeOf(object, \"look\") = \"script\") {\r\n        do (object, \"look\")\r\n      }\r\n      else {\r\n        lookdesc = \"\"\r\n        if (HasString(object, \"look\")) {\r\n          lookdesc = object.look\r\n        }\r\n        if (LengthOf(lookdesc) = 0) {\r\n          lookdesc = Template(\"DefaultObjectDescription\")\r\n        }\r\n        if (GetBoolean(object, \"switchedon\")) {\r\n          if (HasString(object, \"switchedondesc\")) {\r\n            lookdesc = lookdesc + \" \" + object.switchedondesc\r\n          }\r\n        }\r\n        else {\r\n          if (HasString(object, \"switchedoffdesc\")) {\r\n            lookdesc = lookdesc + \" \" + object.switchedoffdesc\r\n          }\r\n        }\r\n        isDark = CheckDarkness()\r\n        if (isDark and not GetBoolean(object, \"lightsource\")) {\r\n          lookdesc = DynamicTemplate(\"LookAtDarkness\", object)\r\n        }\r\n        msg (lookdesc)\r\n      }\r\n      ListObjectContents (object)\r\n    "]},{"$":{"name":"take"},"pattern":["take #object#; get #object#; pick up #object#"],"multiple":["\r\n      takeList = NewObjectList()\r\n      foreach (obj, ListExclude(ScopeVisibleNotHeldNotScenery(), game.pov)) {\r\n        if (obj.parent = game.pov.parent) {\r\n          list add (takeList, obj)\r\n        }\r\n      }\r\n      return (takeList)\r\n    "],"scope":["notheld"],"multipleobjects":[{"_":"\r\n      game.pov.currentcommandpendingobjectscope = NewObjectList()\r\n      foreach (obj, ListExclude(ScopeVisibleNotHeldNotScenery(), game.pov)) {\r\n        if (obj.parent = game.pov.parent and not DoesInherit(obj, \"npc_type\")) {\r\n          list add (game.pov.currentcommandpendingobjectscope, obj)\r\n        }\r\n      }\r\n    ","$":{"type":"script"}}],"script":["\r\n      if (multiple and ListCount(object) = 0) {\r\n        msg (\"Nothing here to take.\")\r\n      }\r\n      else {\r\n        foreach (obj, object) {\r\n          DoTake (obj, multiple)\r\n        }\r\n      }\r\n    "]},{"$":{"name":"drop"},"pattern":["drop #object#"],"multiple":["\r\n      return (GetDirectChildren(game.pov))\r\n    "],"scope":["inventory"],"multipleobjects":[{"_":"\r\n      game.pov.currentcommandpendingobjectscope = GetDirectChildren(game.pov)\r\n    ","$":{"type":"script"}}],"script":["\r\n      if (multiple and ListCount(object) = 0) {\r\n        msg (\"Nothing here to take.\")\r\n      }\r\n      else {\r\n        foreach (obj, object) {\r\n          DoDrop (obj, multiple)\r\n        }\r\n      }\r\n    "]},{"$":{"name":"use"},"pattern":["use #object#"],"script":["\r\n      if (HasScript(object, \"use\")) {\r\n        do (object, \"use\")\r\n      }\r\n      else {\r\n        if (GetBoolean(object, \"use\")) {\r\n          candidates = CreateUseMenuList (object)\r\n          if (ListCount(candidates) = 0) {\r\n            msg (Template(\"NoObjectsAvailable\"))\r\n          }\r\n          else {\r\n            game.pov.usemenuobject = object\r\n            if (HasString(object, \"usemenuprompt\")) {\r\n              menucaption = object.usemenuprompt\r\n            }\r\n            else {\r\n              menucaption = Template(\"UseOnMenu\")\r\n            }\r\n            ShowMenu (menucaption, candidates, true) {\r\n              if (result <> null) {\r\n                HandleUseOn (game.pov.usemenuobject, GetObject(result))\r\n                game.pov.usemenuobject = null\r\n              }\r\n            }\r\n          }\r\n        }\r\n        else {\r\n          msg (DynamicTemplate(\"CantUse\", object))\r\n        }\r\n      }\r\n    "]},{"$":{"name":"undo"},"pattern":[{"_":"^undo$","$":{"type":"string"}}],"isundo":[""],"script":["\r\n      undo\r\n    "]},{"$":{"name":"inventory"},"pattern":[{"_":"^i$|^inv$|^inventory$","$":{"type":"string"}}],"script":["\r\n      list = FormatObjectList(Template(\"CarryingListHeader\"), game.pov, Template(\"And\"), \".\")\r\n      if (list = \"\") {\r\n        msg (Template(\"NotCarryingAnything\"))\r\n      }\r\n      else {\r\n        msg (list)\r\n      }\r\n    "]},{"$":{"name":"look"},"pattern":[{"_":"^look$|^l$","$":{"type":"string"}}],"script":["\r\n      ShowRoomDescription\r\n    "]},{"$":{"name":"lookdir"},"pattern":[{"_":"^look (?<exit>north|east|south|west|northeast|northwest|southeast|southwest|out|up|down|n|e|s|w|ne|nw|se|sw|o|u|d)$","$":{"type":"string"}}],"script":["\r\n      if (HasScript(exit, \"look\")) {\r\n        do (exit, \"look\")\r\n      }\r\n      else {\r\n        message = DynamicTemplate(\"YouLooking\",exit.alias)\r\n        if (HasString(exit, \"look\")) {\r\n          if (exit.look <> \"\") {\r\n            message = exit.look\r\n          }\r\n        }\r\n        if (exit.locked) {\r\n          if (HasString(exit,\"lockmessage\")) {\r\n            lockmessage = exit.lockmessage\r\n          }\r\n          else {\r\n            lockmessage = Template(\"LockedExit\")\r\n          }\r\n          msg (message+\" \"+lockmessage)\r\n        }\r\n        else {\r\n          msg (message)\r\n        }\r\n      }\r\n    "]},{"$":{"name":"quit"},"pattern":[{"_":"^quit$","$":{"type":"string"}}],"script":["\r\n      request (Quit, \"\")\r\n    "]},{"$":{"name":"go"},"pattern":[{"_":"^go to (?<exit>.*)$|^go (?<exit>.*)$|^(?<exit>north|east|south|west|northeast|northwest|southeast|southwest|in|out|up|down|n|e|s|w|ne|nw|se|sw|o|u|d)$","$":{"type":"string"}}],"unresolved":["You can't go there."],"script":["\r\n      if (exit.visible) {\r\n        if (exit.locked) {\r\n          msg (exit.lockmessage)\r\n        }\r\n        else if (exit.runscript) {\r\n          if (HasScript(exit, \"script\")) {\r\n            do (exit, \"script\")\r\n          }\r\n        }\r\n        else if (exit.lookonly) {\r\n          msg (\"You can't go there.\")\r\n        }\r\n        else {\r\n          if (HasString(exit, \"message\")) {\r\n            if (not exit.message = \"\") {\r\n              if (game.clearscreenonroomenter) {\r\n                game.currentexitmessage = exit.message\r\n              }\r\n              else {\r\n                msg (exit.message)\r\n              }\r\n            }\r\n          }\r\n          game.pov.parent = exit.to\r\n        }\r\n      }\r\n      else {\r\n        msg (\"You can't go there.\")\r\n      }\r\n    "]},{"$":{"name":"open"},"pattern":["open #object#"],"script":["\r\n      TryOpenClose (true, object)\r\n    "]},{"$":{"name":"close"},"pattern":["close #object#"],"script":["\r\n      TryOpenClose (false, object)\r\n    "]},{"$":{"name":"put"},"pattern":[{"_":"^put (?<object1>.*) (on|in) (?<object2>.*)$","$":{"type":"string"}}],"scope":["object1=inventory|object2=container"],"script":["\r\n      // put object1 in/on object 2\r\n      canbedropped = true\r\n      if (HasBoolean(object1, \"drop\")) {\r\n        if (not object1.drop) {\r\n          canbedropped = false\r\n        }\r\n      }\r\n      if (object1.parent = object2) {\r\n        msg (DynamicTemplate(\"AlreadyThere\", object1))\r\n      }\r\n      else if (not ListContains(ScopeInventory(), object1)) {\r\n        msg (DynamicTemplate(\"NotCarrying\", object1))\r\n      }\r\n      else if (not canbedropped) {\r\n        msg (DynamicTemplate(\"ObjectCannotBeStored\", object1))\r\n      }\r\n      else if (not ListContains(ScopeReachable(), object1)) {\r\n        msg (DynamicTemplate(\"ObjectNotOpen\", GetBlockingObject(object1)))\r\n      }\r\n      else if (not ListContains(ScopeReachable(), object2)) {\r\n        msg (DynamicTemplate(\"ObjectNotOpen\", GetBlockingObject(object2)))\r\n      }\r\n      else if (not object2.container) {\r\n        msg (Template(\"CannotDoThat\"))\r\n      }\r\n      else if (not object2.isopen) {\r\n        msg (DynamicTemplate(\"ObjectNotOpen\", object2))\r\n      }\r\n      else {\r\n        if (GetBoolean(object2, \"hidechildren\")) {\r\n          object2.hidechildren = false\r\n        }\r\n        params = NewDictionary()\r\n        dictionary add (params, \"object\", object1)\r\n        dictionary add (params, \"destination\", object2)\r\n        if (HasScript(object2, \"addscript\")) {\r\n          do (object2, \"addscript\", params)\r\n        }\r\n        else if (HasScript(object1, \"drop\")) {\r\n          do (object1, \"drop\", params)\r\n        }\r\n        else {\r\n          object1.parent = object2\r\n          msg (Template(\"Done\"))\r\n        }\r\n      }\r\n      // must be carrying object1\r\n      // item cannot be dropped\r\n      // object1 must not be inside a closed container\r\n      // object2 must not be inside a closed container\r\n      // object2 must be an open container or surface\r\n    "]},{"$":{"name":"removefrom"},"pattern":[{"_":"^(remove|take) (?<object1>.*) (from|out of|off) (?<object2>.*)$","$":{"type":"string"}}],"scope":["object1=contents|object2=container"],"script":["\r\n      // remove object1 from object2\r\n      // if object2 does indeed contain object1, this is a synonym for \"take object1\"\r\n      if (not Contains(object2, object1)) {\r\n        msg (DynamicTemplate(\"ObjectDoesNotContain\", object2, object1))\r\n      }\r\n      else {\r\n        DoTake (object1, false)\r\n      }\r\n    "]},{"$":{"name":"givesingle"},"pattern":["give #object#"],"script":["\r\n      if (HasScript(object, \"givesingle\")) {\r\n        do (object, \"givesingle\")\r\n      }\r\n      else {\r\n        if (GetBoolean(object, \"givesingle\")) {\r\n          candidates = CreateGiveMenuList (object)\r\n          if (ListCount(candidates) = 0) {\r\n            msg (Template(\"NoObjectsAvailable\"))\r\n          }\r\n          else {\r\n            game.pov.givemenuobject = object\r\n            if (HasString(object, \"givemenuprompt\")) {\r\n              menucaption = object.givemenuprompt\r\n            }\r\n            else {\r\n              menucaption = Template(\"GiveToMenu\")\r\n            }\r\n            ShowMenu (menucaption, candidates, true) {\r\n              if (result <> null) {\r\n                HandleGiveTo (game.pov.givemenuobject, GetObject(result))\r\n                game.pov.givemenuobject = null\r\n              }\r\n            }\r\n          }\r\n        }\r\n        else {\r\n          msg (DynamicTemplate(\"CantGive\", object))\r\n        }\r\n      }\r\n    "]},{"$":{"name":"give"},"pattern":[{"_":"^give (?<object1>.*) to (?<object2>.*)$","$":{"type":"string"}}],"script":["\r\n      HandleGiveTo (object1, object2)\r\n    "]},{"$":{"name":"useon"},"pattern":[{"_":"^use (?<object1>.*) (on|with) (?<object2>.*)$","$":{"type":"string"}}],"script":["\r\n      HandleUseOn (object1, object2)\r\n    "]},{"$":{"name":"ask"},"pattern":[{"_":"^ask (?<object>.*) about (?<text>.*)$","$":{"type":"string"}}],"script":["\r\n      DoAskTell (object, text, \"ask\", \"askdefault\", \"DefaultAsk\")\r\n    "]},{"$":{"name":"tell"},"pattern":[{"_":"^tell (?<object>.*) about (?<text>.*)$","$":{"type":"string"}}],"script":["\r\n      DoAskTell (object, text, \"tell\", \"telldefault\", \"DefaultTell\")\r\n    "]},{"$":{"name":"tellto"},"pattern":[{"_":"^(tell|ask) (?<object>.*) to (?<text>.*)$","$":{"type":"string"}}],"script":["\r\n      DoAskTell (object, text, \"tellto\", \"telltodefault\", \"DefaultTellTo\")\r\n    "]},{"$":{"name":"alttellto"},"pattern":[{"_":"^(?<object>.*), (?<text>.*)$","$":{"type":"string"}}],"script":["\r\n      DoAskTell (object, text, \"tellto\", \"telltodefault\", \"DefaultTellTo\")\r\n    "]},{"$":{"name":"oops"},"pattern":[{"_":"^oops (?<text>.*)$","$":{"type":"string"}}],"isoops":[""],"script":["\r\n      hasoops = false\r\n      if (HasAttribute(game, \"unresolvedcommand\")) {\r\n        if (game.unresolvedcommand <> null) {\r\n          hasoops = true\r\n        }\r\n      }\r\n      if (not hasoops) {\r\n        msg (Template(\"DefaultOops\"))\r\n      }\r\n      else {\r\n        dictionary remove (game.unresolvedcommandvarlist, game.unresolvedcommandkey)\r\n        dictionary add (game.unresolvedcommandvarlist, game.unresolvedcommandkey, text)\r\n        HandleSingleCommandPattern (\"\", game.unresolvedcommand, game.unresolvedcommandvarlist)\r\n      }\r\n    "]},{"$":{"name":"listen"},"pattern":[{"_":"^listen$","$":{"type":"string"}}],"script":["\r\n      msg (Template(\"DefaultListen\"))\r\n    "]},{"$":{"name":"jump"},"pattern":[{"_":"^jump$","$":{"type":"string"}}],"script":["\r\n      msg (Template(\"DefaultJump\"))\r\n    "]},{"$":{"name":"sit"},"pattern":[{"_":"^sit$|^sit down$","$":{"type":"string"}}],"script":["\r\n      msg (Template(\"DefaultSitDown\"))\r\n    "]},{"$":{"name":"lie"},"pattern":[{"_":"^lie$|^lie down$","$":{"type":"string"}}],"script":["\r\n      msg (Template(\"DefaultLieDown\"))\r\n    "]},{"$":{"name":"sleep"},"pattern":[{"_":"^sleep$|^rest$","$":{"type":"string"}}],"script":["\r\n      msg (Template(\"DefaultSleep\"))\r\n    "]},{"$":{"name":"wait"},"pattern":[{"_":"^wait$|^z$","$":{"type":"string"}}],"script":["\r\n      msg (Template(\"DefaultWait\"))\r\n    "]},{"$":{"name":"xyzzy"},"pattern":[{"_":"^xyzzy$","$":{"type":"string"}}],"script":["\r\n      msg (Template(\"DefaultXyzzy\"))\r\n    "]},{"$":{"name":"help"},"pattern":[{"_":"^help$|^\\?$","$":{"type":"string"}}],"script":["\r\n      msg (Template(\"DefaultHelp\"))\r\n    "]},{"$":{"name":"save"},"pattern":[{"_":"^save$","$":{"type":"string"}}],"script":["\r\n      request (RequestSave, \"\")\r\n    "]},{"$":{"name":"wear"},"pattern":["put #object# on; wear #object#; put on #object#; don #object#; wear #object#"],"scope":["inventory"],"multipleobjects":[{"_":"\r\n      game.pov.currentcommandpendingobjectscope = ScopeInventory()\r\n    ","$":{"type":"script"}}],"script":["\r\n      if (multiple and ListCount(object) = 0) {\r\n        msg (\"You've nothing to wear.\")\r\n      }\r\n      else {\r\n        foreach (obj, object) {\r\n          f = _DoWear(obj)\r\n        }\r\n        UpdateArmour\r\n      }\r\n    "]},{"$":{"name":"remove"},"pattern":["take #object# off; remove #object#; take off #object#; doff #object#"],"scope":["inventory"],"multipleobjects":[{"_":"\r\n      game.pov.currentcommandpendingobjectscope = ScopeInventory()\r\n    ","$":{"type":"script"}}],"script":["\r\n      if (multiple and ListCount(object) = 0) {\r\n        msg (\"You've nothing to take off.\")\r\n      }\r\n      else {\r\n        foreach (obj, object) {\r\n          f = _DoRemove(obj)\r\n        }\r\n      }\r\n      UpdateArmour\r\n    "]},{"pattern":["hints"],"script":["\r\n      msg (\"<br/>Greetings adventurer, and thank you for giving this game a go.<br/><br/>OK, let's try and point you in the right direction.<br/><br/>The object of the game is explore the world, its objects and its characters through typing in commands. <br/><br/>The basic commands you can use are listed below, but there are many others you can use, part of the fun of a text adventure is finding new actions that you can perform, some are crucial to solving puzzles:<br/><br/><b>'Look'</b> Returns a description of the room you are in (which will sometimes change if you have done an action so worth checking often). Room descriptions often contain items that can be taken, (use 'take', or 'get'), normally you need to take an object before you can use it. You can also try using your other senses.<br/><br/><b>'Examine'</b> and <b>'Look at' </b> perform the same action (or you can just type <b>x</b> as a shortcut) and should return a description for example 'examine toolbox' or 'x toolbox' would both return a description of the item. People can be examined as well as objects.<br/><br/><b>'Open'</b> some objects are containers and need to be opened to reveal the contents.<br/><br/><b>'Use'</b>: some items can be used, e.g. use lamp, other items need a specific verb, for example 'eat biscuit' might work where 'use biscuit' will not as it's too vague.<br/><br/><b>'Ask'</b> you can ask characters about objects or people, e.g. 'Ask Jonny about van', sometimes they will have something to say about it, other times not. <br/><br/><b>'Give'</b> you can try giving objects to people who might want them. To do this name the object before the person, e.g. give object X to person Y (give person Y object X won't work for tedious logic reasons.)<br/><br/><b>'Inventory'</b> or <b>'Inv'</b> or just <b> 'i' </b> show what you are carrying, you can examine objects whether you are carrying them or not.<br/><br/>Some responses and descriptions in the game contain clues to solve the game, others are simply there to add atmosphere or humour. If you are stuck try performing an action that you would do if you were really in the situation described.<br/><br/>Lastly I have designed this game so you can't die, also it's not possible for you to perform an action which makes the game unsolvable. However if you want to undo an action just type <b>'undo'</b>.<br/><br/>If you are stuck for a long time and need a hint email me: <b>luke.jones@gmail.com</b><br/><br/>Good Luck!\")\r\n    "]}],"verb":[{"$":{"name":"speak"},"pattern":["speak to #object#; speak #object#; talk to #object#; talk #object#"],"property":["speak"],"defaulttemplate":["DefaultSpeakTo"]},{"$":{"name":"buy"},"pattern":["buy #object#; purchase #object#"],"property":["buy"],"defaulttemplate":["DefaultBuy"]},{"$":{"name":"climb"},"pattern":["climb #object#"],"property":["climb"],"defaulttemplate":["DefaultClimb"]},{"$":{"name":"drink"},"pattern":["drink #object#"],"property":["drink"],"defaulttemplate":["DefaultDrink"]},{"$":{"name":"eat"},"pattern":["eat #object#"],"property":["eat"],"defaulttemplate":["DefaultEat"]},{"$":{"name":"hit"},"pattern":["hit #object#"],"property":["hit"],"defaulttemplate":["DefaultHit"]},{"$":{"name":"kill"},"pattern":["kill #object#"],"property":["kill"],"defaulttemplate":["DefaultKill"]},{"$":{"name":"kiss"},"pattern":["kiss #object#"],"property":["kiss"],"defaulttemplate":["DefaultKiss"]},{"$":{"name":"knock"},"pattern":["knock #object#"],"property":["knock"],"defaulttemplate":["DefaultKnock"]},{"$":{"name":"lick"},"pattern":["lick #object#"],"property":["lick"],"defaulttemplate":["DefaultLick"]},{"$":{"name":"lieon"},"pattern":["lie on #object#; lie upon #object#; lie down on #object#; lie down upon #object#"],"property":["lie"],"defaulttemplate":["DefaultLie"]},{"$":{"name":"listento"},"pattern":["listen to #object#"],"property":["listen"],"defaulttemplate":["DefaultListenTo"]},{"$":{"name":"lock"},"pattern":["lock #object#"],"property":["lock"],"defaulttemplate":["DefaultLock"]},{"$":{"name":"move"},"pattern":["move #object#"],"property":["move"],"defaulttemplate":["DefaultMove"]},{"$":{"name":"pull"},"pattern":["pull #object#"],"property":["pull"],"defaulttemplate":["DefaultPull"]},{"$":{"name":"push"},"pattern":["push #object#"],"property":["push"],"defaulttemplate":["DefaultPush"]},{"$":{"name":"read"},"pattern":["read #object#"],"property":["read"],"defaulttemplate":["DefaultRead"]},{"$":{"name":"search"},"pattern":["search #object#"],"property":["search"],"defaulttemplate":["DefaultSearch"]},{"$":{"name":"show"},"pattern":["show #object#"],"property":["show"],"defaulttemplate":["DefaultShow"]},{"$":{"name":"siton"},"pattern":["sit on #object#; sit upon #object#; sit down on #object#; sit down upon #object#"],"property":["sit"],"defaulttemplate":["DefaultSit"]},{"$":{"name":"smell"},"pattern":["smell #object#; sniff #object#"],"property":["smell"],"defaulttemplate":["DefaultSmell"]},{"$":{"name":"taste"},"pattern":["taste #object#"],"property":["taste"],"defaulttemplate":["DefaultTaste"]},{"$":{"name":"throw"},"pattern":["throw #object#"],"property":["throw"],"defaulttemplate":["DefaultThrow"]},{"$":{"name":"tie"},"pattern":["tie #object#"],"property":["tie"],"defaulttemplate":["DefaultTie"]},{"$":{"name":"touch"},"pattern":["touch #object#"],"property":["touch"],"defaulttemplate":["DefaultTouch"]},{"$":{"name":"turnon"},"pattern":["turn on #object#; turn #object# on; switch on #object#; switch #object# on"],"property":["turnon"],"defaulttemplate":["DefaultTurnOn"]},{"$":{"name":"turnoff"},"pattern":["turn off #object#; turn #object# off; switch off #object#; switch #object# off"],"property":["turnoff"],"defaulttemplate":["DefaultTurnOff"]},{"$":{"name":"turn"},"pattern":["turn #object#"],"property":["turn"],"defaulttemplate":["DefaultTurn"]},{"$":{"name":"unlock"},"pattern":["unlock #object#"],"property":["unlock"],"defaulttemplate":["DefaultUnlock"]},{"$":{"name":"untie"},"pattern":["untie #object#"],"property":["untie"],"defaulttemplate":["DefaultUntie"]},{"property":["press"],"pattern":["press"],"defaultexpression":["\"You can't press \" + object.article + \".\""]},{"property":["feed"],"pattern":["feed"],"defaultexpression":["\"You can't feed \" + object.article + \".\""]},{"property":["knockon"],"pattern":["knock on;knock"],"defaultexpression":["\"You can't knock on \" + object.article + \".\""]},{"property":["kick"],"pattern":["kick"],"defaultexpression":["\"You can't kick \" + object.article + \".\""]},{"property":["drive"],"pattern":["drive"],"defaultexpression":["\"You can't drive \" + object.article + \".\""]},{"property":["getinthe"],"pattern":["get in the;get in"],"defaultexpression":["\"You can't get in \" + object.article + \".\""]},{"property":["start"],"pattern":["start"],"defaultexpression":["\"You can't start \" + object.article + \".\""]},{"property":["fix"],"pattern":["fix"],"defaultexpression":["\"You can't fix \" + object.article + \".\""]},{"property":["stroke"],"pattern":["stroke"],"defaultexpression":["\"You can't stroke \" + object.article + \".\""]},{"property":["pet"],"pattern":["pet"],"defaultexpression":["\"You can't pet \" + object.article + \".\""]},{"property":["shoutat"],"pattern":["shout at"],"defaultexpression":["\"You can't shout at \" + object.article + \".\""]},{"property":["play"],"pattern":["play"],"defaultexpression":["\"You can't play \" + object.article + \".\""]},{"property":["flick"],"pattern":["flick;flick on"],"defaultexpression":["\"You can't flick;flick on \" + object.article + \".\""]},{"property":["stepinto"],"pattern":["step into"],"defaultexpression":["\"You can't step into \" + object.article + \".\""]},{"property":["clean"],"pattern":["clean"],"defaultexpression":["\"You can't clean \" + object.article + \".\""]},{"property":["fuck"],"pattern":["fuck"],"defaultexpression":["\"You can't fuck \" + object.article + \".\""]},{"property":["punch"],"pattern":["punch"],"defaultexpression":["\"You can't punch \" + object.article + \".\""]},{"property":["pay"],"pattern":["pay"],"defaultexpression":["\"You can't pay \" + object.article + \".\""]}],"object":[{"$":{"name":"Greasy Spoon Cafe"},"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"alias":["The Greasy Spoon Café"],"description":[{"_":"\r\n      msg (\"<br>The Greasy Spoon Café, a temple of fried pork products and eggs. The food is cheap, and filthy gorgeous. The room contains rickety chairs and tables, with wipe-clean plastic tablecloths. Although when they were last wiped is a mystery lost in the depths of time. </br>\")\r\n    ","$":{"type":"script"}}],"onexit":[{"_":"\r\n      firsttime {\r\n        MoveObject (Small Key, Greasy Spoon Cafe)\r\n      }\r\n    ","$":{"type":"script"}}],"firstenter":[{"_":"\r\n      msg (\"<br/><i>Type 'hints' at any time to get help<br> <br> Press any key to start </i>\")\r\n      wait {\r\n        msg (\"You have just eaten a huge breakfast fry-up, including a couple of rather gristly sausages. The grease sits heavy in your stomach. You are contemplating what to do today when in bursts Robin Lye, the local music promoter.<br/><br/> He dashes over to you and panting for breath he says, \\\"You still managing that band The Bony Kings?\\\"<br/><br/>You nod and say, \\\"Yep, for my sins.\\\"<br/><br/>\\\"Well then\\\" says Robin, \\\"We might be able to do each other a favour. I need a support band for tonight, I've got Get Lamp booked in to play The Blackfriars' Inn tonight, and the support have dropped out. The gig is nearly sold out, a grand in the hand for you and your band if you can fill the slot. What do you say?\\\"<br/><br/> You pause for a moment, the water bill you opened this morning comes to mind and you say. \\\"Alright, I'll get the band and equipmemt together.\\\"<br/><br/>\\\"Nice one\\\" says Robin, \\\"Sound check is at 5pm, don't be late. I'm off, oh Hi Jon.\\\" Jon nods but continues eating his fried egg sandwich. \\\"Right, see you later\\\" says Robin, and dashes out of the café. <br/><br/>A few seconds later he pops his head around the door again and says, \\\"Oh, do me a favour and find me a DJ to warm the crowd up before the support.\\\" \\\"Right, see you later\\\", he says and dissapears.<br/><br/>\\\"Right,\\\" you say to Jonny, \\\"We need to get the band together, find a DJ,  pick up the equipment from the rehearsal rooms with the van and get over to the Blackfriars Inn.\\\" <br/><br/>\\\" OK boss\\\" says Jonny,\\\" but er..there's a small problem, the van is fucked.\\\"\")\r\n      }\r\n    ","$":{"type":"script"}}],"object":[{"$":{"name":"player"},"look":[{"_":"\r\n        if (game.pov.parent = Ed Cases House) {\r\n          msg (\"You are wearing a sheepskin lined camel trench coat, black trousers,  a black poloneck jumper and a burberry flat cap. You are currently without shoes as Ed won't allow them to be worn in the house.\")\r\n        }\r\n        else {\r\n          msg (\"You are wearing a sheepskin lined camel trench coat, black trousers, black brogues, a black poloneck jumper and a burberry flat cap. \")\r\n        }\r\n      ","$":{"type":"script"}}],"attr":[{"_":"\r\n        if (game.pov.parent = Ed Cases House) {\r\n          msg (\"You are wearing a sheepskin lined camel trench coat, black trousers,  a black poloneck jumper and a burberry flat cap. You are currently without shoes as Ed won't allow them to be worn in the house.\")\r\n        }\r\n        else {\r\n          msg (\"You are wearing a sheepskin lined camel trench coat, black trousers, black brogues, a black poloneck jumper and a burberry flat cap. \")\r\n        }\r\n      ","$":{"name":"pov_look","type":"script"}}],"object":[{"$":{"name":"Handful of change"},"take":[""],"alias":["Pocket Change"],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"prefix":["some"],"throw":["You're not rich enough to throw money around!"],"drop":[{"_":"false","$":{"type":"boolean"}}],"dropmsg":["You're not rich enough to be dropping money around."],"look":[{"_":"\r\n          if (GetBoolean(Matt Roch, \"paul_paid\")) {\r\n            if (GetBoolean(PC Gamer Magazine, \"mag_paid\")) {\r\n              msg (\"Thanks to your purchases of the picture disc and the PC Gamer Magazine you have around three pounds and seventy-five pence left. Robin better be telling the truth about the payment for tonight.\")\r\n            }\r\n            else {\r\n              msg (\"Thanks to your purchase of the Picture Disc you now have around four pounds fifty left. \")\r\n            }\r\n          }\r\n          else if (not GetBoolean(Matt Roch, \"paul_paid\")) {\r\n            if (GetBoolean(PC Gamer Magazine, \"mag_paid\")) {\r\n              msg (\"Thanks to your purchase of the PC Gamer Magazine you have around four pounds and twenty-five pence left.\")\r\n            }\r\n            else {\r\n              msg (\"You have around five pounds in loose change. Times are tough. Robin better be telling the truth about the payment for the gig tonight.\")\r\n            }\r\n          }\r\n        ","$":{"type":"script"}}]}]},{"$":{"name":"Jonny"},"inherit":[{"$":{"name":"namedmale"}},{"$":{"name":"surface"}}],"alias":["Jonny Columba"],"scenery":[{"_":"false","$":{"type":"boolean"}}],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"feature_container":[""],"contentsprefix":["who is carrying"],"listchildren":[""],"kiss":["You lean in to give Jonny a kiss, but he recolis back and says, \"You don't pay me enough for that!\""],"look":[{"_":"\r\n        if (game.pov.parent = Greasy Spoon Cafe) {\r\n          firsttime {\r\n            msg (\"<br>Your loyal but cantankerous and foul mouthed roadie. As well as humping around the band equipment he also drives the band's van. Mid 40's, shoulder length  greasy hair. He's wearing grimy blue faded denim jeans, an ancient Motorhead t-shirt peppered with pinhole burns, and a denim jacket covered in patches of various bands (the largest one on the back depicts Eddie from Iron Maiden's debut album). He is currently munching his way through a fried egg sandwich which is dripping yolk down his t-shirt.<br>\")\r\n          }\r\n          otherwise {\r\n            msg (\"<br>Your loyal but cantankerous and foul mouthed roadie. As well as humping around the band equipment he also drives the band's van. Mid 40's, shoulder length  greasy hair. He's wearing grimy blue faded denim jeans, an ancient Motorhead t-shirt peppered with pinhole burns, and a denim jacket covered in patches of various bands (the largest one on the back depicts Eddie from Iron Maiden's debut album).\")\r\n          }\r\n        }\r\n        else {\r\n          msg (\"<br>Your loyal but cantankerous and foul mouthed roadie. As well as humping around the band equipment he also drives the band's van. Mid 40's, shoulder length  greasy hair. He's wearing grimy blue faded denim jeans, an ancient Motorhead t-shirt peppered with pinhole burns, and a denim jacket covered in patches of various bands (the largest one on the back depicts Eddie from Iron Maiden's debut album).\")\r\n        }\r\n      ","$":{"type":"script"}}],"speak":[{"_":"\r\n        msg (\"<br> \\\"Alright boss\\\" says Jonny, \\\"What fuckery are we up to next then?\\\"\")\r\n      ","$":{"type":"script"}}],"ask":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n          if (GetBoolean(Jonny, \"van_fixed\")) {\r\n            if (GetBoolean(Blackfriars Inn, \"gear_loaded\")) {\r\n              if (Contains (Jons Lockup,Van)) {\r\n                msg (\"\\\"It's back in my lock up\\\" says Jonny.\")\r\n              }\r\n              else {\r\n                msg (\"<br> \\\"Yep running like a fucking peach now\\\" says Jonny.\")\r\n              }\r\n            }\r\n            else {\r\n              msg (\"<br> \\\"Yep running like a fucking peach now\\\" says Jonny.\")\r\n            }\r\n          }\r\n          else {\r\n            msg (\"<br> \\\"The fucking thing is kaput\\\", says Jonny, \\\" the alternator's shagged. It's sat in my lock up off Broughton Lane\\\".\")\r\n          }\r\n        ","$":{"key":"van"}},{"_":"\r\n          msg (\"<br>\\\"Up the Irons!\\\" says Jonny, \\\"the dog's bollocks man, the dog's fucking bollocks.\\\"\")\r\n        ","$":{"key":"iron maiden"}},{"_":"\r\n          if (GetBoolean(Toolbox, \"locked\")) {\r\n            if (Contains (Jonny,Small Key)) {\r\n              msg (\"\\\"Here you go boss,\\\" Jonny hands over the key.\")\r\n              AddToInventory (Small Key)\r\n            }\r\n            else {\r\n              msg (\"\\\"You want the key for the toolbox?\\\" says Jonny, \\\"here you go\\\" he reaches into his pockets, fumbles around a bit and says, \\\"Fuck, must have dropped it somewhere, I had it this morning\\\".\")\r\n            }\r\n          }\r\n          else {\r\n            msg (\"\\\"Glad you found the key boss,\\\" says Jonny, \\\"you'd never have been able to pick the lock\\\".\")\r\n          }\r\n        ","$":{"key":"toolbox key"}},{"_":"\r\n          msg (\"\\\"That dozy twat!\\\" say Jonny, \\\"he must sleep for 15 hours of the day!\\\", Jonny grins and adds, \\\"nice bloke though and a hell of a player\\\".\")\r\n        ","$":{"key":"spider jones bass"}},{"_":"\r\n          msg (\"\\\"Damn fine drummer\\\" says Jonny, \\\"the guy's like a machine.\\\"\")\r\n        ","$":{"key":"mac attack"}},{"_":"\r\n          msg (\"\\\"Ed?!\\\" says Jonny, \\\"that clumsy oaf is unhinged!\\\"\")\r\n        ","$":{"key":"ed kayse"}},{"_":"\r\n          msg (\"\\\"He's one dodgy geezer\\\" says Jonny, \\\"but he's never had the cheek or nerve to rip me off!\\\"\")\r\n        ","$":{"key":"Robin Lye"}},{"_":"\r\n          msg (\"\\\"A 24 carat arsehole!\\\" snarls Jonny, \\\"All mouth and no trousers. Likes to talk like he was a big thing in the 80's, but I heard he got sacked from Glastonbury music festival for screwing up the sound for Level 42.\\\"\")\r\n        ","$":{"key":"tony def"}},{"_":"\r\n          if (GetBoolean(Jonny, \"van_fixed\")) {\r\n            msg (\"\\\"Yeah, it was lucky that Sarah had one for us.\\\" says Jonny, \\\"Those damn dogs though!\\\"\")\r\n          }\r\n          else {\r\n            msg (\"\\\"Its had it, we need to get a replacement,\\\" says Jonny.\")\r\n          }\r\n        ","$":{"key":"alternator"}},{"_":"\r\n          msg (\"<br/>\\\"My lock-up?\\\", says Jonny, \\\"still in the same place, south of Brunswick Street. It's a bit of a dump but the rent is cheap as chips.\\\"\")\r\n        ","$":{"key":"lock-up garage"}},{"_":"\r\n          msg (\"<br/>\\\"They're a great group!\\\" says Jonny, \\\"a pain the arse to manage as you know, but they deserve more luck than they've had.\\\"<br/>\")\r\n        ","$":{"key":"band bony kings"}}]}]},{"$":{"name":"Fat Bob"},"inherit":[{"$":{"name":"namedmale"}}],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"look":["<br>The owner and solo chef of the Greasy Spoon Café. He wears his huge belly and title of Fat Bob with pride. Mid 50's, red faced,  bald as a coot. He's currently leafing through the sports section of the The Daily Mirror newspaper.</br>"],"speak":["\"Hadn't you better get out of here and sort your band out?\" says Bob without looking up from his paper."],"kiss":["It's not that sort of game."],"fuck":["It's not that sort of game."],"ask":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n          msg (\"\\\"They're sayin' that United are gonna release Zlatan,\\\" sighs Bob, \\\"must need their bleedin' 'eds seein' to.\\\"\")\r\n        ","$":{"key":"mirror daily news newspaper"}},{"_":"\r\n          msg (\"\\\"They're sayin' that United are gonna release Zlatan,\\\" sighs Bob, \\\"must need their bleedin' 'eds seein' to.\\\"\")\r\n        ","$":{"key":"football united sport pages"}},{"_":"\r\n          msg (\"\\\"you're not moaning are ya?\\\", says Bob, \\\"what d'ya expect at these prices?!\\\"\")\r\n        ","$":{"key":"sausages"}},{"_":"\r\n          msg (\"\\\"I don't like people using the back door!\\\" says Bob.\")\r\n        ","$":{"key":"back door south backdoor"}},{"_":"\r\n          msg (\"\\\"I've run this place for over twenty years now,\\\" says Bob, 'I know it ain't fine dining, but it's honest food for mostly honest people!\\\"\")\r\n        ","$":{"key":"greasy spoon cafe café"}},{"_":"\r\n          msg (\"<br/>\\\"I wouldn't trust that toe-rag as far as I could throw him\\\", says Bob, \\\"and look at me, I'm not exactly the athletic type!\\\"<br/>\")\r\n        ","$":{"key":"robin lye"}},{"_":"\r\n          msg (\"<br/>\\\"Genius player! say Bob. \\\"We're half the team without him.\\\"<br/>\")\r\n        ","$":{"key":"Zlatan"}},{"_":"\r\n          msg (\"<br/>\\\"A red devil till I die mate!\\\" says Bob, \\\"but how I miss the Ferguson days.\\\" Bob stares wistfully into the distance.\")\r\n        ","$":{"key":"manchester united"}},{"_":"\r\n          msg (\"<br/>\\\"The noisy neighbours!\\\" says Bob, \\\"live and let live, can't stand any of the stupid hooligan nonsense.\\\"\")\r\n        ","$":{"key":"city"}}]}],"tell":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n          msg (\"\\\"Should be great if you can get your merry band of muppets together!\\\" says Bob.\")\r\n        ","$":{"key":"gig concert"}}]}]},{"$":{"name":"chair"},"inherit":[{"$":{"name":"plural"}}],"alias":["rickety chairs"],"look":["<br> Old and abused chairs of various vintage and contruction materials. </br>"],"scenery":[""],"takemsg":["You pick up the chair, but Fat Bob shouts over, \"Hey, leave that where it is!\".You oblige and put it down again."]},{"$":{"name":"newspaper"},"alias":["The Daily Mirror"],"look":["The Daily Mirror, a tabloid left-leaning newspaper. The sports section takes up half the pages, and Fat Bob is scrutinising an article about the football transfer season."],"visible":[""],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"prefix":["a copy of "],"takemsg":["\"Oi!\" exclaims Bob, \"I'm reading that!\" You give it back to Bob."],"scenery":[""]},{"$":{"name":"tables"},"scenery":[""],"look":["Square tables with wipe-clean, red and white checkered tablecloths."],"takemsg":["You lift up one of the tables, \"Oi!\" says Bob, \"What on earth are you doing?\" You put it down again."]}],"command":[{"pattern":["sniff; smell"],"script":["\r\n        msg (\"<br> You can smell hot oil, sausages, and sweet, sweet bacon. </br>\")\r\n      "]}],"exit":[{"$":{"alias":"south","to":"Back Yard of The Greasy Spoon"},"inherit":[{"$":{"name":"southdirection"}}],"locked":[""],"lockmessage":["\"Oi!\" shouts Bob, \"you can't go out that way.\""]},{"$":{"alias":"out","to":"Outside Greasy Spoon Café"},"inherit":[{"$":{"name":"outdirection"}}]}]},{"$":{"name":"Oxford Road"},"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"descprefix":["You are on"],"description":["The main arterial road for the town. To the North is Brunswick street, to the East is the Town Square, Blackfriars Road lies to the west, and to the South is the Greasy Spoon Café.<br/><br/>There is a constant rumble of traffic passing."],"prefix":[{"$":{"type":"string"}}],"exit":[{"$":{"alias":"north","to":"Brunswick Street"},"inherit":[{"$":{"name":"northdirection"}}]},{"$":{"alias":"west","to":"Blackfriars Road"},"inherit":[{"$":{"name":"westdirection"}}]},{"$":{"alias":"east","to":"Town Square"},"inherit":[{"$":{"name":"eastdirection"}}]},{"$":{"alias":"south","to":"Outside Greasy Spoon Café"},"inherit":[{"$":{"name":"southdirection"}}]}],"command":[{"pattern":["sniff; smell"],"script":["\r\n        msg (\"You can smell traffic fumes.\")\r\n      "]},{"pattern":["listen"],"script":["\r\n        msg (\"You can hear the rumble of the traffic as it thunders past you.\")\r\n      "]}],"object":[{"$":{"name":"traffic"},"scenery":[""],"look":["Cars, vans, lorries, buses and the odd suicidal cyclist are streaming past. The air is thick with fumes."],"stepinto":["For a moment you consider throwing yourself into the traffic, but you decide on reflection that things aren't that bad...yet."]}]},{"$":{"name":"Brunswick Street"},"descprefix":["You are on"],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"description":["A narrow meandering medieval backstreet."],"exit":[{"$":{"alias":"south","to":"Oxford Road"},"inherit":[{"$":{"name":"southdirection"}}]},{"$":{"alias":"north","to":"Outside Macs House"},"inherit":[{"$":{"name":"northdirection"}}]},{"$":{"alias":"southwest","to":"Blackfriars Road"},"inherit":[{"$":{"name":"southwestdirection"}}]},{"$":{"alias":"northeast","to":"Outside No Smoke Inn"},"inherit":[{"$":{"name":"northeastdirection"}}]},{"$":{"alias":"up","to":"Top of the Tree"},"inherit":[{"$":{"name":"updirection"}}]}],"object":[{"$":{"name":"Tree"},"look":[" A large oak tree, the last surviving one on this road after the council conducted some over zealous pruning."],"climb":[{"_":"\r\n        msg (\"You nervously start shinning up the tree. Jonny loyally follows up behind you even though he hates heights.\\\"Are you sure about this boss?\\\" he says, with a wobble in his voice.\")\r\n        MoveObject (player, Top of the Tree)\r\n      ","$":{"type":"script"}}]}],"command":[{"pattern":["sniff; smell"],"script":["\r\n        msg (\"You can smell a faint scent of traffic fumes.\")\r\n      "]}]},{"$":{"name":"Macs House"},"alias":["Mac Attack's House"],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"description":["<br/>Mac's house is a shrine to the two loves of his life; drums and computer games. The room is dominated by an 80 inch plasma widescreen TV and a sound system that would put the local IMAX theatre to shame. <br/><br/>In the corner of the room is an electronic drum kit and on the walls are posters of Mac's drum heroes; John Bonham, Neil Peart, Mike Portnoy, Keith Moon etc. Mac is glued to the TV playing Dark Souls III, it looks like he hasn't slept properly in days."],"exit":[{"$":{"alias":"out","to":"Outside Macs House"},"inherit":[{"$":{"name":"outdirection"}}]}],"object":[{"$":{"name":"Mac Attack"},"inherit":[{"$":{"name":"namedmale"}}],"shoutat":["\"Chill your boots mate\" Mac says without averting his eyes from the TV, \"I'll be there soon, just got to get past dancer of the boreal valley to the next checkpoint.\""],"speak":["\"This game is doing my head in,\" says Mac, \"I've got to get to the next checkpoint otherwise I lose the last six hours of gameplay, and I'm not going through all that again!\""],"look":[{"_":"\r\n        msg (\"The band's drummer. He's average height, pale skin and a shaved head (when it grows out it is a fiery ginger colour and the rest of the band remorselessly take the piss). He's dressed in blue jeans, white hi-top trainers, and a red Superdry<sup><font size=\\\"1\\\">TM</sup></font> hoodie.  He is deeply engrossed in a computer game.\")\r\n      ","$":{"type":"script"}}],"tell":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n          msg (\"\\\"Cool\\\" says Mac, without taking his eyes off the TV, \\\"I'll be there soon, just got to get past the dancer of the boreal valley to the next checkpoint.\\\"\")\r\n        ","$":{"key":"gig concert support"}}]}],"ask":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n          msg (\"\\\"This game is doing my head in,\\\" says Mac, \\\"I've got to get to the next checkpoint otherwise I lose the last six hours of gameplay, and I'm not going through all that again!\\\"\")\r\n        ","$":{"key":"game dark souls PC"}}]}]},{"$":{"name":"TV"},"scenery":[""],"alt":[{"$":{"type":"stringlist"},"value":["television","widescreen","tv screen","plasma"]}],"look":["A huge 80 inch 4K widescrren plasma television. On screen is a knight fighting what looks like a giant ghost warrior with some epic booty."],"takemsg":["It's far too heavy to carry around, and besides, Mac is using it."],"attr":[{"_":"false","$":{"name":"feature_switchable","type":"boolean"}}],"turnon":["It's already turned on."],"turnoff":[{"_":"\r\n        msg (\"You move to switch off the TV, but Mac's eyes dart towards you and he says, \\\"Don't even thing about it mate! It's taken me housrs to get to this point\\\". You step back.\")\r\n        SwitchOn (TV)\r\n      ","$":{"type":"script"}}]},{"$":{"name":"sound system"},"look":["A 7.1 surround speaker system with KEF R-series speakers and a Rotel RAP 1580 amplifier. You know the details as Mac talked incessantly about the specs when when he got it."]},{"$":{"name":"Russian Doll"},"inherit":[{"$":{"name":"container_closed"}}],"feature_container":[""],"hidechildren":[""],"listchildren":[""],"alias":["Large Russian Doll"],"take":[""],"look":["A large Russian Doll in traditional red and yellow colours with a  floral design."],"displayverbs":[{"$":{"type":"stringlist"},"value":["Look at","Take","Open","Close"]}],"inventoryverbs":[{"$":{"type":"stringlist"},"value":["Look at","Use","Drop","Open","Close"]}],"object":[{"$":{"name":"Russian Doll2"},"inherit":[{"$":{"name":"container_closed"}}],"alias":["slightly smaller russian doll"],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"feature_container":[""],"hidechildren":[""],"listchildren":[""],"take":[""],"look":["A slightly smaller in traditional red and yellow colours with a  floral design."],"displayverbs":[{"$":{"type":"stringlist"},"value":["Look at","Take","Open","Close"]}],"inventoryverbs":[{"$":{"type":"stringlist"},"value":["Look at","Use","Drop","Open","Close"]}],"object":[{"$":{"name":"Russian Doll3"},"inherit":[{"$":{"name":"container_closed"}}],"alias":["even smaller russian doll"],"feature_container":[""],"hidechildren":[""],"listchildren":[""],"take":[""],"look":["An even smaller Russian doll  in traditional red and yellow colours with a  floral design."],"displayverbs":[{"$":{"type":"stringlist"},"value":["Look at","Take","Open","Close"]}],"inventoryverbs":[{"$":{"type":"stringlist"},"value":["Look at","Use","Drop","Open","Close"]}],"object":[{"$":{"name":"Russian Doll4"},"inherit":[{"$":{"name":"container_closed"}}],"alias":["teeny weeny russian doll"],"scenery":[{"_":"false","$":{"type":"boolean"}}],"feature_container":[""],"take":[""],"listchildren":[""],"hidechildren":[""],"look":["A teeny weeny Russian doll in traditional red and yellow colours with a  floral design."],"displayverbs":[{"$":{"type":"stringlist"},"value":["Look at","Take","Open","Close"]}],"inventoryverbs":[{"$":{"type":"stringlist"},"value":["Look at","Use","Drop","Open","Close"]}],"object":[{"$":{"name":"Russian Doll5"},"inherit":[{"$":{"name":"container_closed"}}],"feature_container":[""],"hidechildren":[""],"listchildren":[""],"alias":["itsy bitsy teeny weeny russian doll"],"visible":[""],"take":[""],"look":["An itsy bitsy teeny weeny Russian doll in traditional red and yellow colours with a  floral design."],"displayverbs":[{"$":{"type":"stringlist"},"value":["Look at","Take","Open","Close"]}],"inventoryverbs":[{"$":{"type":"stringlist"},"value":["Look at","Use","Drop","Open","Close"]}],"object":[{"$":{"name":"tiny note"},"look":["A tiny piece of paper with some writing on it."],"take":[""],"read":[{"_":"\r\n                  if (Got(Magnifying Glass)) {\r\n                    msg (\"Using the magnifying glass you can now make out the minute writing.  It reads, 'Russian dolls, they're so full of themselves'.\")\r\n                  }\r\n                  else {\r\n                    msg (\"The writing is too small to make out with the naked eye.\")\r\n                  }\r\n                ","$":{"type":"script"}}]}]}]}]}]}]}],"command":[{"pattern":["sniff; smell"],"script":["\r\n        msg (\"The air smells stale.\")\r\n      "]}]},{"$":{"name":"Blackfriars Road"},"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"descprefix":["You are on"],"description":["The western corridor of the town. To the North lies the Blackfriar's Inn, to the East is Oxford Road, Broughton Lane lies to the South and the band's basist Spider Jones lives to the West."],"exit":[{"$":{"alias":"east","to":"Oxford Road"},"inherit":[{"$":{"name":"eastdirection"}}]},{"$":{"alias":"south","to":"Broughton Lane"},"inherit":[{"$":{"name":"southdirection"}}]},{"$":{"alias":"west","to":"Outside Spiders House"},"inherit":[{"$":{"name":"westdirection"}}]},{"$":{"alias":"northeast","to":"Brunswick Street"},"inherit":[{"$":{"name":"northeastdirection"}}]},{"$":{"alias":"north","to":"Outside Blackfriars Inn"},"inherit":[{"$":{"name":"northdirection"}}]}],"command":[{"pattern":["sniff; smell"],"script":["\r\n        msg (\"You can smell the faint scent of traffic fumes.\")\r\n      "]}]},{"$":{"name":"Blackfriars Inn"},"descprefix":["You are in the"],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"description":["<br/>A large Victorian coaching house, converted to a 1000 capacity music venue in the 1970's. <br/><br/>It's seen better times, and could do with a facelift, but the acoustics are excellent."],"enter":[{"_":"\r\n      if (GetInt(Blackfriars Inn, \"tasks\") = 6) {\r\n        firsttime {\r\n          msg (\"<b><u>You've finally got the whole band here, plus their equipment, and you've managed to hire a DJ.</u></b><br/><br/>Press any key to continue...<br/><br/>\")\r\n          wait {\r\n            msg (\"<br/>Robin Lye rushes up to you and says, \\\"Glad you managed to get the band together, not sure about the DJ's style of music, but I guess it will have to do. We've got a problem though, the sound engineer is being even more awkward than usual and we need to get the soundcheck done. Do me a favour and have a word with him will ya?\\\" At that moment you see Tony enter the Inn.<br/>\")\r\n          }\r\n          MakeObjectVisible (Tony Def)\r\n        }\r\n      }\r\n    ","$":{"type":"script"}}],"object":[{"$":{"name":"machine"},"look":["An electrical unit that takes the input from the sound desk and sends it to the stage monitors. It has a switch, five sockets in a row labelled 1,2,3,4,5 from left to right, and a jumble of coloured cables just beneath the sockets."],"displayverbs":[{"$":{"type":"stringlist"},"value":["Look at"]}],"takemsg":["It is much too heavy."],"visible":[{"_":"false","$":{"type":"boolean"}}],"alias":["Stage Monitor Sender Unit"]},{"$":{"name":"socket 1"},"inherit":[{"$":{"name":"container_limited"}}],"feature_container":[""],"scenery":[""],"listchildren":[""],"takemsg":["The sockets are part of the machine."],"visible":[{"_":"false","$":{"type":"boolean"}}],"look":["An electrical socket labelled number 1."],"displayverbs":[{"$":{"type":"stringlist"},"value":["Look at","Take","Open","Close"]}],"inventoryverbs":[{"$":{"type":"stringlist"},"value":["Look at","Use","Drop","Open","Close"]}]},{"$":{"name":"socket 2"},"inherit":[{"$":{"name":"container_limited"}}],"feature_container":[""],"scenery":[""],"listchildren":[""],"takemsg":["The sockets are part of the machine."],"visible":[{"_":"false","$":{"type":"boolean"}}],"look":[" An electrical socket labelled number 2."],"displayverbs":[{"$":{"type":"stringlist"},"value":["Look at","Take","Open","Close"]}],"inventoryverbs":[{"$":{"type":"stringlist"},"value":["Look at","Use","Drop","Open","Close"]}]},{"$":{"name":"socket 3"},"inherit":[{"$":{"name":"container_limited"}}],"feature_container":[""],"scenery":[""],"listchildren":[""],"takemsg":["The sockets are part of the machine."],"visible":[{"_":"false","$":{"type":"boolean"}}],"look":[" An electrical socket labelled number 3."],"displayverbs":[{"$":{"type":"stringlist"},"value":["Look at","Take","Open","Close"]}],"inventoryverbs":[{"$":{"type":"stringlist"},"value":["Look at","Use","Drop","Open","Close"]}]},{"$":{"name":"socket 4"},"inherit":[{"$":{"name":"container_limited"}}],"feature_container":[""],"scenery":[""],"listchildren":[""],"takemsg":["The sockets are part of the machine."],"visible":[{"_":"false","$":{"type":"boolean"}}],"look":[" An electrical socket labelled number 4."],"displayverbs":[{"$":{"type":"stringlist"},"value":["Look at","Take","Open","Close"]}],"inventoryverbs":[{"$":{"type":"stringlist"},"value":["Look at","Use","Drop","Open","Close"]}]},{"$":{"name":"socket 5"},"inherit":[{"$":{"name":"container_limited"}}],"feature_container":[""],"scenery":[""],"listchildren":[""],"takemsg":["The sockets are part of the machine."],"visible":[{"_":"false","$":{"type":"boolean"}}],"look":[" An electrical socket labelled number 5."],"displayverbs":[{"$":{"type":"stringlist"},"value":["Look at","Take","Open","Close"]}],"inventoryverbs":[{"$":{"type":"stringlist"},"value":["Look at","Use","Drop","Open","Close"]}]},{"$":{"name":"switch1"},"inherit":[{"$":{"name":"switchable"}}],"feature_switchable":[""],"takemsg":["The switch is part of the machine."],"displayverbs":[{"$":{"type":"stringlist"},"value":["Look at","Switch on","Switch off"]}],"alias":["switch"],"visible":[{"_":"false","$":{"type":"boolean"}}],"look":["An electrical switch, it can be turned or flicked on and off."],"onswitchon":[{"_":"\r\n        if (not GetBoolean(jumble of cables, \"fixed\")) {\r\n          correct = true\r\n          if (not green cable.parent = socket 1) {\r\n            correct = false\r\n          }\r\n          if (not red cable.parent = socket 2) {\r\n            correct = false\r\n          }\r\n          if (not yellow cable.parent = socket 3) {\r\n            correct = false\r\n          }\r\n          if (not blue cable.parent = socket 4) {\r\n            correct = false\r\n          }\r\n          if (not white cable.parent = socket 5) {\r\n            correct = false\r\n          }\r\n          if (correct) {\r\n            msg (\"<br/><br/>\\\"That's it!\\\" says Tony, \\\"Right lets get the show on the road\\\". Your band The Bony Kings scramble on to the stage and are set up in a couple of minutes. Despite driving you mad half the time their professionalism on stage makes you proud. They blast through their soundcheck and apart from Ed having his usual moan that his guitar levels aren't high enough all runs smoothly. <br/><br/>The members of Get Lamp stride into the inn, they nod greetings to the room and get on stage. Soon their soundcheck is over too. Robin opens the doors to the public and people start streaming in. Jerry starts his DJ set with the 90's classic 'Trouble' by Shampoo.<br/><br/>Soon it is stage time and both The Bony Kings and Get Lamp thunder through their respective sets, the atmosphere in the room is electric, by far the best you've ever seen your band play, and their biggest gig by far.<br/><br/>The house lights come on and the crowd starts to leave.<br/><br/>You look around for Robin as it's time to get paid. You spot him heading out the door, \\\"Oi Robin!\\\" you shout, but he feigns deafness and disappears.<br/><br/>\\\"Quick Jonny, Robin is doing a runner, let's catch him quick!\\\" you shout, \\\"The thieving bastard!\\\" says Jonny, let's go!\")\r\n            jumble of cables.fixed = true\r\n            MoveObject (Robin Lye, Outside Blackfriars Inn)\r\n            SetObjectFlagOn (Blackfriars Inn, \"gigover\")\r\n            MoveObject (Kate, Backstage)\r\n          }\r\n          else {\r\n            msg (\"<br/><br/>\\\"No!\\\" shouts Tony, looking up from his sound desk,\\\"that's wrong, you need to put the cables in the right sockets!  Can't you follow simple instructions!\\\"\")\r\n          }\r\n        }\r\n        else {\r\n          msg (\"The wires are connected properly.  Something happens.\")\r\n        }\r\n      ","$":{"type":"script"}}],"flick":[{"_":"\r\n        if (ListContains(ScopeReachable(), this)) {\r\n          if (this.switchedon) {\r\n            msg (DynamicTemplate(\"AlreadySwitchedOn\", this))\r\n          }\r\n          else if (not this.cannotswitchon = \"\") {\r\n            msg (this.cannotswitchon)\r\n          }\r\n          else {\r\n            if (HasString(this, \"switchonmsg\")) {\r\n              msg (this.switchonmsg)\r\n            }\r\n            else {\r\n              msg (DynamicTemplate(\"SwitchedOn\", this))\r\n            }\r\n            this.switchedon = true\r\n          }\r\n        }\r\n        else {\r\n          msg (DynamicTemplate(\"DefaultTurnOn\", this))\r\n        }\r\n      ","$":{"type":"script"}}],"inventoryverbs":[{"$":{"type":"stringlist"},"value":["Look at","Use","Drop","Switch on","Switch off"]}]},{"$":{"name":"sockets"},"scenery":[{"_":"false","$":{"type":"boolean"}}],"takemsg":["The sockets are part of the machine."],"displayverbs":[{"$":{"type":"stringlist"},"value":["Look at"]}],"visible":[{"_":"false","$":{"type":"boolean"}}],"look":[{"_":"\r\n        OutputTextNoBr (\"socket 1: \")\r\n        object = socket 1\r\n        lookdesc = \"\"\r\n        if (HasString(object, \"look\")) {\r\n          lookdesc = object.look\r\n        }\r\n        if (LengthOf(lookdesc) = 0) {\r\n          lookdesc = Template(\"DefaultObjectDescription\")\r\n        }\r\n        OutputTextNoBr (lookdesc)\r\n        ListSocketContents (object)\r\n        OutputTextNoBr (\"socket 2: \")\r\n        object = socket 2\r\n        lookdesc = \"\"\r\n        if (HasString(object, \"look\")) {\r\n          lookdesc = object.look\r\n        }\r\n        if (LengthOf(lookdesc) = 0) {\r\n          lookdesc = Template(\"DefaultObjectDescription\")\r\n        }\r\n        OutputTextNoBr (lookdesc)\r\n        ListSocketContents (object)\r\n        OutputTextNoBr (\"socket 3: \")\r\n        object = socket 3\r\n        lookdesc = \"\"\r\n        if (HasString(object, \"look\")) {\r\n          lookdesc = object.look\r\n        }\r\n        if (LengthOf(lookdesc) = 0) {\r\n          lookdesc = Template(\"DefaultObjectDescription\")\r\n        }\r\n        OutputTextNoBr (lookdesc)\r\n        ListSocketContents (object)\r\n        OutputTextNoBr (\"socket 4: \")\r\n        object = socket 4\r\n        lookdesc = \"\"\r\n        if (HasString(object, \"look\")) {\r\n          lookdesc = object.look\r\n        }\r\n        if (LengthOf(lookdesc) = 0) {\r\n          lookdesc = Template(\"DefaultObjectDescription\")\r\n        }\r\n        OutputTextNoBr (lookdesc)\r\n        ListSocketContents (object)\r\n        OutputTextNoBr (\"socket 5: \")\r\n        object = socket 5\r\n        lookdesc = \"\"\r\n        if (HasString(object, \"look\")) {\r\n          lookdesc = object.look\r\n        }\r\n        if (LengthOf(lookdesc) = 0) {\r\n          lookdesc = Template(\"DefaultObjectDescription\")\r\n        }\r\n        OutputTextNoBr (lookdesc)\r\n        ListSocketContents (object)\r\n      ","$":{"type":"script"}}]},{"$":{"name":"jumble of cables"},"inherit":[{"$":{"name":"surface"}}],"feature_container":[""],"takemsg":["The cables are attached to the machine."],"displayverbs":[{"$":{"type":"stringlist"},"value":["Look at"]}],"listchildren":[{"_":"false","$":{"type":"boolean"}}],"contentsprefix":["which consists of"],"listchildrenprefix":["It consists of"],"hidechildren":[""],"visible":[{"_":"false","$":{"type":"boolean"}}],"fix":[{"_":"\r\n        if (not GetBoolean(jumble of cables, \"fixed\")) {\r\n          if (switch1.switchedon) {\r\n            msg (\"(first flipping off the switch)\")\r\n            switch1.switchedon = false\r\n          }\r\n          foreach (o, this.cables) {\r\n            o.parent = this\r\n          }\r\n          game.temp_whichmsg = \"Which cable would you like to insert into\"\r\n          ShowMenu (game.temp_whichmsg + \" socket 1?\", GetDirectChildren(jumble of cables), false) {\r\n            obj = GetObject(result)\r\n            msg (\"You insert \" + Replace(GetDisplayName(obj), \"a \", \"the \") + \" into socket 1.\")\r\n            MoveObject (obj, socket 1)\r\n            ShowMenu (game.temp_whichmsg + \"  socket 2?\", GetDirectChildren(jumble of cables), false) {\r\n              obj = GetObject(result)\r\n              msg (\"You insert \" + Replace(GetDisplayName(obj), \"a \", \"the \") + \" into socket 2.\")\r\n              MoveObject (obj, socket 2)\r\n              ShowMenu (game.temp_whichmsg + \"  socket 3?\", GetDirectChildren(jumble of cables), false) {\r\n                obj = GetObject(result)\r\n                msg (\"You insert \" + Replace(GetDisplayName(obj), \"a \", \"the \") + \" into socket 3.\")\r\n                MoveObject (obj, socket 3)\r\n                ShowMenu (game.temp_whichmsg + \"  socket 4?\", GetDirectChildren(jumble of cables), false) {\r\n                  obj = GetObject(result)\r\n                  msg (\"You insert \" + Replace(GetDisplayName(obj), \"a \", \"the \") + \" into socket 4.\")\r\n                  MoveObject (obj, socket 4)\r\n                  ShowMenu (game.temp_whichmsg + \"  socket 5?\", GetDirectChildren(jumble of cables), false) {\r\n                    obj = GetObject(result)\r\n                    msg (\"You insert \" + Replace(GetDisplayName(obj), \"a \", \"the \") + \" into socket 5.\")\r\n                    MoveObject (obj, socket 5)\r\n                    game.temp_whichmsg = null\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n          this.hidechildren = true\r\n        }\r\n        else {\r\n          msg (\"The wires are connected properly.\")\r\n        }\r\n      ","$":{"type":"script"}}],"look":[{"_":"\r\n        if (not GetBoolean(jumble of cables, \"fixed\")) {\r\n          msg (\"A jumble of red, blue, white, yellow and green cables, Tony needs you to fix them\")\r\n        }\r\n        else {\r\n          msg (\"The wires are connected properly.\")\r\n        }\r\n      ","$":{"type":"script"}}],"addscript":[{"_":"\r\n        msg (\"You can't put things on the jumble of cables.\")\r\n      ","$":{"type":"script"}}],"cables":[{"_":"green cable; yellow cable; red cable; blue cable; white cable","$":{"type":"objectlist"}}],"object":[{"$":{"name":"red cable"},"scenery":[""],"takemsg":["The cables are attached to the machine."],"visible":[{"_":"false","$":{"type":"boolean"}}],"look":["A red electrical cable with a plug on the end."]},{"$":{"name":"blue cable"},"scenery":[""],"takemsg":["The cables are attached to the machine."],"visible":[{"_":"false","$":{"type":"boolean"}}],"look":["A blue electrical cable with a plug on the end."]},{"$":{"name":"white cable"},"scenery":[""],"takemsg":["The cables are attached to the machine."],"visible":[{"_":"false","$":{"type":"boolean"}}],"look":["A white electrical cable with a plug on the end."]},{"$":{"name":"yellow cable"},"scenery":[""],"takemsg":["The cables are attached to the machine."],"visible":[{"_":"false","$":{"type":"boolean"}}],"look":["A yellow electrical cable with a plug on the end."]},{"$":{"name":"green cable"},"scenery":[""],"takemsg":["The cables are attached to the machine."],"visible":[{"_":"false","$":{"type":"boolean"}}],"look":["A green electrical cable with a plug on the end."]}]},{"$":{"name":"Tony Def"},"inherit":[{"$":{"name":"namedmale"}}],"look":["The Blackfriar's resident sound engineer, and awkward, unhelpful know-it-all. You've had dealings with him before. One time you had prevent Jonny from attempting to stick a mike stand where the sun don't shine when Tony questioned his cable coiling technique. Late 50's, gaunt, wears a ridiculous leather cowboy hat to cover his bald patch."],"visible":[{"_":"false","$":{"type":"boolean"}}],"speak":[{"_":"\r\n        firsttime {\r\n          msg (\"With a heavy heart you engage Tony in conversation.<br/><br/> \\\"I hope you've got Jonny on a leash tonight, I don't want any trouble like last time,\\\" says Tony.<br/><br/>Jonny bristles next to you, before he can say anything you say \\\"Never mind him, why isn't the soundcheck happening yet?\\\" <br/><br/>Tony turns red and says \\\"I've been running around all day! Robin promised there would be something to eat, but as usual he was just fobbing me off. I've had enough, if someone doesn't get me something to eat this gig ain't happening\\\". <br/><br/>\\\"OK,\\\" you reply, \\\"I'll sort something out, but at least start sorting the stage out else we'll have no time.\\\"<br/><br/> \\\"Alright fair enough,\\\" says Tony, \\\"The prima-donnas in the starship enterprise outside refuse to come inside till that's done anyway. At least your lads mostly know how to behave, I never had this grief when I worked for Quo!\\\" <br/><br/>You turn to leave and Tony shouts over, \\\"I don't want any of that muck from the Greasy Spoon, his sausages gave me stomach cramps last week! Nothing fancy though, fast food will do.\\\"\")\r\n          SetObjectFlagOn (Tony Def, \"hungry\")\r\n        }\r\n        otherwise {\r\n          if (GetBoolean(Tony Def, \"hungry\")) {\r\n            msg (\"\\\"What you doing here? Go and get me some food before I really lose my rag!\\\"\")\r\n          }\r\n          else {\r\n            if (GetBoolean(Blackfriars Inn, \"gigover\")) {\r\n              msg (\"\\\"Well that was tedious!\\\" says Tony, \\\"but at least the sound mix was right\\\".\")\r\n            }\r\n            else {\r\n              msg (\"\\\"You going to sort those cables out or what?\\\" says Tony.\")\r\n            }\r\n          }\r\n        }\r\n      ","$":{"type":"script"}}],"ask":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n          msg (\"<br/>\\\"Well put it this way, I made sure I got paid in advance for tonight,\\\" says Tony.\")\r\n        ","$":{"key":"robin lye"}}]}]}],"exit":[{"$":{"alias":"north","to":"Backstage"},"inherit":[{"$":{"name":"northdirection"}}]},{"$":{"alias":"out","to":"Outside Blackfriars Inn"},"inherit":[{"$":{"name":"outdirection"}}]}],"command":[{"pattern":["sniff; smell"],"script":["\r\n        msg (\"You can smell stale spilt beer.\")\r\n      "]}]},{"$":{"name":"Backstage"},"alias":["Backstage of The Blackfriars Inn"],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"descprefix":["You are in the"],"description":[{"_":"\r\n      if (GetBoolean(Backstage, \"gear_loaded\")) {\r\n        msg (\"<br/>Backstage area of the Blackfriars Inn. Bits and pieces of band equipment belonging to Get Lamp are stacked up in every spare space, there is barely room to move. Somehow Jonny managed to get all of your bands equipment in here too.<br/><br/>There is a sofa, a couple of chairs, and a shower cubicle of dubious cleanliness in the corner. There is also row of mirrors, two of which are cracked. <br/><br/>On a table in the middle of the room is what must be the remains of the band's rider, consisting of a crate of cheap lager, a family size bag of supermarket value tortilla chips , and a few bottles of water. Robin has been as generous as ever.\")\r\n      }\r\n      else {\r\n        msg (\"<br/>Backstage area of the Blackfriars Inn. Bits and pieces of band equipment belonging to Get Lamp are stacked up in every spare space, there is barely room to move. Jonny is going to have tough time fitting your bands equipment in here too, but you have faith in that particular talent of his.<br/><br/>There is a sofa, a couple of chairs, and a shower cubicle of dubious cleanliness in the corner. There is also row of mirrors, two of which are cracked. <br/><br/>On a table in the middle of the room is what must be the band's rider, consisting of a crate of cheap lager, a family size bag of supermarket value tortilla chips , and a few bottles of water. Robin has been as generous as ever.\")\r\n      }\r\n    ","$":{"type":"script"}}],"exit":[{"$":{"alias":"south","to":"Blackfriars Inn"},"inherit":[{"$":{"name":"southdirection"}}]}],"object":[{"$":{"name":"sofa"},"look":["An old Chesterfield green leather. The leather is cracked and there is  a rip in one of the seats."],"scenery":[""],"sit":["You don't have time to sit around!"]},{"$":{"name":"chairs"},"scenery":[""],"look":["<br/>A couple of old swivel office chairs in plastic fake black leather."],"sit":["You sit on one of the chairs, raise and lower the pump action seat a few times and spin around. \"You OK boss?\" says Jonny. You stand up again."]},{"$":{"name":"shower cubicle"},"scenery":[""],"look":["<br/>Behind a false wall in the room is a shower cubicle. It looks like it has been cleaned but not with any care, there are traces of black mould growing in the corners."],"feature_usegive":[""],"clean":["You don't have time and you really don't want to. Besides,  getting this thing clean would be a soap opera."],"use":[{"_":"\r\n        msg (\"You don't have time for a shower, and anyway it's not very clean.\")\r\n      ","$":{"type":"script"}}]},{"$":{"name":"mirrors"},"alt":[{"$":{"type":"stringlist"},"value":["cracked mirrors"]}],"look":["You see your own tired face staring back at you, and Jonny stood behind you with an amused expression. On reflection you have better things to do."],"scenery":[""]},{"$":{"name":"rip"},"scenery":[""],"look":["<br/>A jagged rip in one of the sofa seats. You investigate the hole but there is nothing inside except the stuffing."]},{"$":{"name":"crate of beer"},"scenery":[""],"look":["A crate of cheap supermarket beer. <br/><br/>Jonny calls this stuff  'sex on the riverbank' (i.e. fucking near water)."],"alt":[{"$":{"type":"stringlist"},"value":["beer","lager"]}],"takemsg":["The band need it more than you do."],"drink":["You decide the band needs the beer more than you do."]},{"$":{"name":"tortilla chips"},"inherit":[{"$":{"name":"edible"}}],"alt":[{"$":{"type":"stringlist"},"value":["crisps"]}],"look":["Cheap supermarket's own brand 'cool flavour' tortilla chips."],"takemsg":["The band need them more than you do."],"feature_edible":[""],"eatmsg":["You steal one of the chips, it tastes stale and bland."],"scenery":[""],"displayverbs":[{"$":{"type":"stringlist"},"value":["Look at","Take","Eat"]}],"inventoryverbs":[{"$":{"type":"stringlist"},"value":["Look at","Use","Drop","Eat"]}]},{"$":{"name":"bottles of water"},"scenery":[""],"look":["A few bottles of supermarket budget brand table water."],"takemsg":["The band need it more than you do."],"drink":["You decide to leave the water for the band, it gets hot on stage."]}],"command":[{"pattern":["smell; sniff"],"script":["\r\n        msg (\"The room smells of stale beer and sweat.\")\r\n      "]}]},{"$":{"name":"Jons Lockup"},"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"alias":["Jonny's Lock-up Garage"],"description":["Jon's lock-up garage where he keeps the van and does amateur maintenance on it; although that doesn't seem to include ever cleaning it."],"enter":[{"_":"\r\n      if (not GetBoolean(Jonny, \"van_fixed\")) {\r\n        if (Contains (Jonny,Alternator)) {\r\n          msg (\"\\\"Right\\\" says Jon, \\\"Let's give this fucker what it needs!\\\" Jonny opens the engine compartment and with some further cursing and grunting proceeds to replace the alternator. \\\"There,\\\" he says, \\\"the fucker is fixed!\\\" He starts the van, guns the engine and says, \\\"Get in then Boss!\\\"\")\r\n          RemoveObject (Alternator)\r\n          SetObjectFlagOn (Jonny, \"van_fixed\")\r\n        }\r\n        else {\r\n          msg (\"\\\"Yep, the van's still there\\\" says Jon, \\\"It's fucked til we get it a new alternator.\\\"\")\r\n        }\r\n      }\r\n    ","$":{"type":"script"}}],"exit":[{"$":{"alias":"north","to":"Broughton Lane"},"inherit":[{"$":{"name":"northdirection"}}],"exit":[{"$":{"alias":"east","to":"Blackfriars Road"},"inherit":[{"$":{"name":"eastdirection"}}]}]}],"object":[{"$":{"name":"Van"},"inherit":[{"$":{"name":"container_open"}}],"kick":["You kick the van, creating yet another dent in it. \"What a genius idea!\" says Jon sarcastically, \"no wonder you're the manager.\""],"feature_container":[""],"punch":["You punch the van, creating yet another dent in it and sending a stab of pain up your arm. \"What a genius idea!\" says Jon sarcastically, \"no wonder you're the manager.\""],"look":[{"_":"\r\n        if (GetBoolean(Jonny, \"van_fixed\")) {\r\n          msg (\"The band's ancient Ford Transit van. Lovingly maintained by Jon, it is white somewhere under all the rusty patches, scrapes and dents. There are several cracks in the windscreen, the interior is falling to pieces and the roof leaks. When Jon is driving it the experience is so terrifying that the band have nicknamed it the Talivan.\")\r\n        }\r\n        else {\r\n          msg (\"The band's ancient Ford Transit van. Lovingly maintained by Jon, it is white somewhere under all the rusty patches, scrapes and dents. There are several cracks in the windscreen, the interior is falling to pieces and the roof leaks. When Jon is driving it the experience is so terrifying that the band have nicknamed it the Talivan. It's current aliment is that it needs a new alternator. \")\r\n        }\r\n      ","$":{"type":"script"}}],"getinthe":[{"_":"\r\n        PickDestination\r\n      ","$":{"type":"script"}}],"start":[{"_":"\r\n        if (GetBoolean(Jonny, \"van_fixed\")) {\r\n          msg (\"\\\"Hey that's my gig!\\\" says Jonny, \\\"Has to be some perks to this fucking job!\\\" \")\r\n          PickDestination\r\n        }\r\n        else {\r\n          msg (\"Clearing a space amongst the empty cans of diet coke, coffee cups, fag ends and oily rags you jump into the driver's seat and start it up, the engine fires into life and the noise from the exhaust is deafening. \\\"No!\\\" shouts Jon, \\\"the alternator's fucked, you'll flatten the battery!\\\" You sigh, turn the engine off and get out again.\")\r\n        }\r\n      ","$":{"type":"script"}}],"drive":[{"_":"\r\n        do (this, \"start\")\r\n      ","$":{"type":"script"}}],"fix":[{"_":"\r\n        if (GetBoolean(Jonny, \"van_fixed\")) {\r\n          msg (\"It's already fixed.\")\r\n        }\r\n        else {\r\n          if (Got(Alternator)) {\r\n            msg (\"You attempt to fit the new alternator to the van, much to the bemusement of Jonny. After a few minutes struggling Jonny says, \\\"Hey boss, why not give it to me and I'll fix the fucker!\\\"\")\r\n          }\r\n          else {\r\n            msg (\"You don't have the part you need in order to fix it.\")\r\n          }\r\n        }\r\n      ","$":{"type":"script"}}],"displayverbs":[{"$":{"type":"stringlist"},"value":["Look at","Take","Open","Close"]}],"inventoryverbs":[{"$":{"type":"stringlist"},"value":["Look at","Use","Drop","Open","Close"]}]},{"$":{"name":"Toolbox"},"inherit":[{"$":{"name":"container_lockable"}},{"$":{"name":"container_closed"}}],"feature_container":[""],"takemsg":["It's too heavy to carry around."],"hidechildren":[""],"listchildren":[""],"look":["A large heavy metal toolbox with a copper keyhole."],"keycount":[{"_":"1","$":{"type":"int"}}],"autounlock":[{"_":"false","$":{"type":"boolean"}}],"unlockmessage":["Using the small key you unlock the toolbox."],"key":[{"_":"Small Key","$":{"type":"object"}}],"displayverbs":[{"$":{"type":"stringlist"},"value":["Look at","Take","Open","Close"]}],"inventoryverbs":[{"$":{"type":"stringlist"},"value":["Look at","Use","Drop","Open","Close"]}],"object":[{"$":{"name":"Tyre Wrench"},"look":["A stainless steel tyre wrench. Around a foot long with a rubber handle and a 1/4 inch socket at one end."],"feature_usegive":[""],"take":[""],"selfuseon":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n            UnlockExit (lift_door)\r\n            msg (\"You jam the tyre wrench on to the lift door, it fits tight and you are able to open it. \\\"genius move boss!\\\" says Jonny.\")\r\n            RemoveObject (Tyre Wrench)\r\n            SetObjectFlagOn (lift door, \"lift_fixed\")\r\n          ","$":{"key":"lift door"}},{"_":"\r\n            msg (\"None of the tyres are flat at the moment so there is no point.\")\r\n          ","$":{"key":"Van"}}]}]}]}],"command":[{"pattern":["smell;sniff"],"script":["\r\n        msg (\"The air smells musty with overtones of oil and stale coffee.\")\r\n      "]}]},{"$":{"name":"Mikes House"},"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"alias":["Mike E. Smith's House"],"description":["<br/>Inside Mike's house is a depressing sight. The house feels and smells damp with black mould growing in the upper corners of the walls. The carpet and furniture are threadbare. Jonny catches your eye and subtly draws your attention to the pile of red bills on the coffee table."],"onexit":[{"$":{"type":"script"}}],"enter":[{"_":"\r\n      if (Got(Ponky)) {\r\n        msg (\"\\\"Hey Mike!\\\" you say, \\\"Look who we found.\\\" Mike beams from ear to ear as you hand over Ponky. \\\"Thanks so much lads, I'll see you out and then head down to the gig, I've left the key for Kate with a neighbour.\\\"<br/><br/> As you turn to leave Jon pulls a tenner out of his pocket and hands it Mike, \\\"Here, have this so you can enjoy the evening.\\\" Mike looks bashful and says, \\\"Thanks Jon, you're a diamond.\\\" \\\"Must be all the fucking pressure,\\\" replies Jon. Mike puts Ponky in the backroom and then shows you out of the house.<br/>\")\r\n        RemoveObject (Ponky)\r\n        MoveObject (player, Outside mikes house)\r\n        LockExit (mikes_door)\r\n        MoveObject (Pub Mike, Backstage)\r\n        IncreaseObjectCounter (Blackfriars Inn, \"tasks\")\r\n      }\r\n      else if (Contains (Jonny,Ponky)) {\r\n        msg (\"\\\"Hey Mike!\\\" Jonny says, \\\"Look who we found.\\\" Mike beams from ear to ear as he hands over Ponky. \\\"Thanks so much lads, I'll see you out and then head down to the gig, I've left the key for Kate with a neighbour.\\\"<br/><br/> As you turn to leave Jon pulls a tenner out of his pocket and hands it Mike, \\\"Here, have this so you can enjoy the evening.\\\" Mike looks bashful and says, \\\"Thanks Jon, you're a diamond.\\\" \\\"Must be all the fucking pressure,\\\" replies Jon. Mike puts Ponky in the backroom and then shows you out of the house.<br/>\")\r\n        RemoveObject (Ponky)\r\n        MoveObject (player, Outside mikes house)\r\n        LockExit (mikes_door)\r\n        MoveObject (Pub Mike, Backstage)\r\n        IncreaseObjectCounter (Blackfriars Inn, \"tasks\")\r\n      }\r\n    ","$":{"type":"script"}}],"exit":[{"$":{"alias":"out","to":"Outside mikes house"},"inherit":[{"$":{"name":"outdirection"}}]}],"object":[{"$":{"name":"Mike Smith"},"inherit":[{"$":{"name":"namedmale"}}],"look":["<br/>Despite not having a bean to his name Mike takes a pride in his appearance and he is dressed ready for the stage at all times. He is wearing black combat trousers, black highly polished boots, a black t-shirt with a Jack Daniels logo on, and a black denim jacket. His short dark hair is gelled into small spikes."],"kiss":["It's not that kind of game."],"fuck":["It's not that kind of game."],"speak":[{"_":"\r\n        if (GetBoolean(Mike Smith, \"mike_told\")) {\r\n          msg (\"\\\"You need to find Ponky before I can leave the house\\\" says Mike.\")\r\n        }\r\n        else {\r\n          msg (\"\\\"Hello lads, what's happening?\\\" says Mike.\")\r\n        }\r\n      ","$":{"type":"script"}}],"tell":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n          if (not GetBoolean(Mike Smith, \"mike_told\")) {\r\n            msg (\"\\\"Fantastic!\\\" says Mike, \\\"It's no secret that I could really do with the money.\\\" \\\"There is a small problem though, our kitten Ponky has gone missing, my girlfriend Kate will be in bits if she gets home and he's not here. I can't go out looking again as she's hasn't got her door keys.\\\" <br/><br/>\\\"Perfect!\\\" says Jonny sarcastically,\\\"Getting this band to a gig is like herding fucking kittens, and now we have to herd a real one.\\\"\")\r\n            SetObjectFlagOn (Mike Smith, \"mike_told\")\r\n          }\r\n          else {\r\n            msg (\"\\\"Yeah it should be amazing if Ed doesn't lose the plot and have some kind of hissy fit about something. Any luck in finding Ponky? Kate will be home soon!\\\" \")\r\n          }\r\n        ","$":{"key":"gig concert support"}}]}],"ask":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n          msg (\"\\\"He's black with white paws and cute as you like\\\" says Mike, \\\"and he loves climbing and hiding behind things. He must have sneaked out when I opened the door to the postman earlier.\\\"\")\r\n        ","$":{"key":"ponky cat kitten"}},{"_":"\r\n          msg (\"\\\"It was yet another Amazon delivery for next door,\\\" says Mike, \\\"honestly it's like running a local post office sometimes!\\\" says Mike.\")\r\n        ","$":{"key":"postman"}},{"_":"\r\n          msg (\"\\\"My girlfriend?\\\" says Mike, \\\"She'll be home any minute and the first thing she'll want to do is see Ponky.\\\"\")\r\n        ","$":{"key":"Kate"}}]}]},{"$":{"name":"bills"},"alias":["bills"],"alt":[{"$":{"type":"stringlist"},"value":["pile of bills"]}],"look":["Red letter demands for Council Tax, Electricity, Gas and Water. "],"pay":["A kind thought, but you don't have enough money, maybe after the gig."]}],"command":[{"pattern":["smell; sniff"],"script":["\r\n        msg (\"The air smells damp.\")\r\n      "]}]},{"$":{"name":"Outside Spiders House"},"alias":["Outside Spider Jones' House"],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"descprefix":["You are "],"description":[{"_":"\r\n      if (not GetBoolean(Spider Jones, \"spider_awake\")) {\r\n        msg (\"You are outside Spider Jones' house, the bass player of the band, and all round dozy waster. He's rarely seen in daylight hours, but you need to get him up and out of the house. You can see that the curtains are still drawn in the upstairs bedroom window.<br/><br/>The gravel driveway crunches underfoot as you approach the front door.\")\r\n      }\r\n      else {\r\n        msg (\"You are outside Spider Jones' house, the bass player of the band, and all round dozy waster. You finally managed to wake him up earlier.<br/><br/>The gravel driveway crunches underfoot as you approach the front door.\")\r\n      }\r\n    ","$":{"type":"script"}}],"object":[{"$":{"name":"Spiders Front Door"},"alias":["A Front Door"],"usedefaultprefix":[""],"look":["A very solid looking dark blue front door."],"scenery":[{"_":"false","$":{"type":"boolean"}}],"knock":[{"_":"\r\n        if (not GetBoolean(Spider Jones, \"spider_awake\")) {\r\n          msg (\"You knock on the door. Nobody answers. \\\"For the love of fuckery\\\", says Jonny, \\\"The lazy twat will be deep asleep as usual\\\".\")\r\n        }\r\n        else {\r\n          msg (\"You already woke up Spider!\")\r\n        }\r\n      ","$":{"type":"script"}}],"knockon":[{"_":"\r\n        if (not GetBoolean(Spider Jones, \"spider_awake\")) {\r\n          msg (\"You knock on the door. Nobody answers. \\\"For the love of fuckery\\\", says Jonny, \\\"The lazy twat will be deep asleep as usual\\\".\")\r\n        }\r\n        else {\r\n          msg (\"You already woke up Spider!\")\r\n        }\r\n      ","$":{"type":"script"}}],"kick":[{"_":"\r\n        if (not GetBoolean(Spider Jones, \"spider_awake\")) {\r\n          msg (\"You give the door a good firm kick, but it is suprisingly solid and you stub your toe painfully and curse a blue streak. Jonny laughs outloud, \\\"Ha ha, that's the spirit boss!\\\" Nobody answers the door.\")\r\n        }\r\n        else {\r\n          msg (\"You already woke up Spider!\")\r\n        }\r\n      ","$":{"type":"script"}}]},{"$":{"name":"Gravel Driveway"},"scenery":[""],"look":["A loose gravel driveway."],"take":[""],"ontake":[{"_":"\r\n        msg (\"You pick up a handful of gravel.\")\r\n        AddToInventory (Handfull of Gravel)\r\n        MoveObjectHere (Gravel Driveway)\r\n      ","$":{"type":"script"}}]}],"command":[{"pattern":["throw gravel"],"script":["\r\n        if (Got(Handfull of Gravel)) {\r\n          if (not GetBoolean(Spider Jones, \"spider_wake\")) {\r\n            do (Handfull of Gravel, \"throw\")\r\n          }\r\n          else {\r\n            msg (\"You have already woken Spider up!\")\r\n          }\r\n        }\r\n        else {\r\n          msg (\"You are not carrying any gravel\")\r\n        }\r\n      "]},{"pattern":["throw gravel at window"],"script":["\r\n        if (Got(Handfull of Gravel)) {\r\n          if (not GetBoolean(Spider Jones, \"spider_wake\")) {\r\n            do (Handfull of Gravel, \"throw\")\r\n          }\r\n          else {\r\n            msg (\"You have already woken Spider up!\")\r\n          }\r\n        }\r\n        else {\r\n          msg (\"You are not carrying any gravel\")\r\n        }\r\n      "]},{"pattern":["throw handful of change at window"],"script":["\r\n        msg (\"Nice idea but you are too poor to be throwing money around!\")\r\n      "]},{"pattern":["throw change at window"],"script":["\r\n        msg (\"Nice idea but you are too poor to be throwing money around!\")\r\n      "]},{"pattern":["smell; sniff"],"script":["\r\n        msg (\"The air is cold and smells fresh.\")\r\n      "]}],"exit":[{"$":{"alias":"east","to":"Blackfriars Road"},"inherit":[{"$":{"name":"eastdirection"}}]}]},{"$":{"name":"Town Square"},"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"descprefix":["You are in the"],"description":["The main town square, at Christmas time there is a market here, but today it is empty."],"exit":[{"$":{"alias":"west","to":"Oxford Road"},"inherit":[{"$":{"name":"westdirection"}}]},{"$":{"alias":"south","to":"Trinity Lane"},"inherit":[{"$":{"name":"southdirection"}}]},{"$":{"alias":"east","to":"Industrial Estate"},"inherit":[{"$":{"name":"eastdirection"}}]},{"$":{"alias":"north","to":"Outside Junk Shop"},"inherit":[{"$":{"name":"northdirection"}}]},{"$":{"alias":"southwest","to":"Outside Discovery Record Store"},"inherit":[{"$":{"name":"southwestdirection"}}]}],"object":[{"$":{"name":"Statue"},"look":["A statue of a thin and gaunt king, nick named The Bony King (and where your band got its name from). The town legend is that he was born here and ruled from the capital in the south in the Dark Ages."]}],"command":[{"pattern":["smell;sniff"],"script":["\r\n        msg (\"You can't make out any particular scent.\")\r\n      "]}]},{"$":{"name":"Trinity Lane"},"descprefix":["You are on"],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"exit":[{"$":{"alias":"north","to":"Town Square"},"inherit":[{"$":{"name":"northdirection"}}]},{"$":{"alias":"northeast","to":"Industrial Estate"},"inherit":[{"$":{"name":"northeastdirection"}}]},{"$":{"alias":"southwest","to":"Back Yard of The Greasy Spoon"},"inherit":[{"$":{"name":"southwestdirection"}}]},{"$":{"alias":"east","to":"Outside Ed Cases House"},"inherit":[{"$":{"name":"eastdirection"}}]},{"$":{"alias":"south","to":"Outside KFC"},"inherit":[{"$":{"name":"southdirection"}}]}],"command":[{"pattern":["smell; sniff"],"script":["\r\n        msg (\"There is the faint smell of grease and bacon on the air.\")\r\n      "]}]},{"$":{"name":"KFC"},"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"exit":[{"$":{"alias":"out","to":"Outside KFC"},"inherit":[{"$":{"name":"outdirection"}}]}]},{"$":{"name":"Junk Shop"},"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"alias":["The Junk 'n' Disorderly Second-hand Emporium"],"description":["A secondhand shop run by Matt Roch, the rumour is that Roch is actually a serial horder and the shop is just a cover so that the council don't evict him. Judging by the state of the shop you can well believe the rumours. Every piece of wall space and most of the floor  is piled high with clutter, kipple and junk."],"object":[{"$":{"name":"Ancient Sofas"},"inherit":[{"$":{"name":"plural"}}],"takemsg":["They are too heavy."],"look":["Sagging sofas, and knackered armchairs. All threadbare with collapsed springs."],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"prefix":[{"$":{"type":"string"}}]},{"$":{"name":"Coffee Tables"},"inherit":[{"$":{"name":"plural"}}],"look":["A collection of coffee tables, bitter and unbrewtiful, made from cheap wood or chipboard. Most have scratched surfaces with peeling paint and varnish. "],"takemsg":["They are too heavy to carry around, and you can't think of a use for them."],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}]},{"$":{"name":"Lamps"},"inherit":[{"$":{"name":"plural"}}],"look":["Lamps, watts and watts of lamps; table lamps, wall lamps, floor lamps, desk lamps, oil lamps, gas lamps, plasma lamps,  lava lamps and street lamps.<br/>"],"takemsg":["So you want to get lamp? An old school player! Nice idea, but you don't need one in this game."],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}]},{"$":{"name":"Newspapers"},"inherit":[{"$":{"name":"plural"}}],"look":["Piles and piles of newspapers. Black and white and read all over."],"read":["You leaf through the newspapers, scanning the headlines, 'Peal Harbour Bombed!', 'Bay of Pigs Invasion', 'Kennedy Dead', 'Man Walks On Moon!',  'Nixon Resigns!', 'Berlin Wall Falls!', 'Celebrity Big Brother Jade's Steamy Romp With Jungle Brian'"],"takemsg":["You can't see any use for them and decide to leave them where they are."],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}]},{"$":{"name":"Books"},"inherit":[{"$":{"name":"plural"}}],"look":["Multiple copies of Dan Brown, Ian Rankin, John Grisham, and Patricia Cornwell novels, collected writings by Jeremy Clarkson (with titles like  'For Crying Out Loud' and 'How Hard Can It Be?!'), and a stack of Mills and Boon novels with lurid covers of anatomically implausible men and horses."],"takemsg":["There is nothing here that ypu want to read."],"read":["You pick up one of the Dan Brown novels and read the first coupld of pages. You can actually feel your IQ dropping like a stone and decide to stop while you stilll have the power of speech, and the ability to walk upright."],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}]},{"$":{"name":"Computer Consoles"},"inherit":[{"$":{"name":"container_closed"}}],"alias":["Box of Computer Stuff"],"visible":[""],"feature_container":[""],"hidechildren":[""],"listchildren":[""],"look":["A cardboard box that according to the writing on the side contains 'Computer games, consoles, controllers, magazines etc.'"],"displayverbs":[{"$":{"type":"stringlist"},"value":["Look at","Take","Open","Close"]}],"inventoryverbs":[{"$":{"type":"stringlist"},"value":["Look at","Use","Drop","Open","Close"]}],"object":[{"$":{"name":"Nintendo 64"},"look":["A classic grey Nintendo 64 game console. Seeing the Goldeneye game next to it in the box you experience a profound Proustian rush and are suddenly transported back to your student days. You remember late, late nights of drunken fierce competition with friends, cheap vodka and Marlboro light cigarettes. Then just as suddenly you are back in the junk shop and it seems a million years ago. You sigh, look at Jonny and wonder where the years went.<br/><br/>"],"takemsg":["You can't think of a use for it right now, and like most retro computer gear it's overpriced anyway."],"alias":["Nintendo 64 and a copy of Goldenye"],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"play":["Sadly you don't have the time."]},{"$":{"name":"PC Gamer Magazine"},"look":["A relatively recent copy of PC gamer magazine. The cover depicts some sort of knight in armour wreathed in flame."],"read":["You leaf through the magazine, the main theme of this edition seems to be the recent release of Dark Souls III, There is a whole section dedicated to hints and tips to defeating particular bosses in the game. Apparently the key to defeating the 'dancer of the boreal valley' is to enchant a sword with'bleed'. "],"takemsg":["You pay Paul Roch the 75p that he want for the magazine and take it."],"feature_usegive":[""],"take":[{"_":"\r\n          firsttime {\r\n            msg (\"You reluctantly pay Matt Roch the 75p that he wants for the magazine and pick it up.\")\r\n            AddToInventory (PC Gamer Magazine)\r\n            SetObjectFlagOn (PC Gamer Magazine, \"mag_paid\")\r\n          }\r\n          otherwise {\r\n            msg (\"You take it.\")\r\n            AddToInventory (PC Gamer Magazine)\r\n          }\r\n        ","$":{"type":"script"}}],"giveto":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n            RemoveObject (PC Gamer Magazine)\r\n            msg (\"\\\"Ah\\\" says Mac, \\\"Hopefully there's some help in here\\\". He scans through the magazine until he finds what he is looking for, \\\"Enchant with bleed!\\\", \\\"I have you now dancer\\\". Mac sits back down picks up his controller and soundly beats the boss and gets to the checkpoint. \\\"Right\\\" says Mac, \\\"sorry about that, I'll head down to the Blackfriars Inn now.\\\" He shows you out of the house and heads off down Brunswick street.\")\r\n            MoveObject (player, Outside Macs House)\r\n            MakeObjectInvisible (Mac Attack)\r\n            MoveObject (Pub Mac, Backstage)\r\n            LockExit (macs_door)\r\n            SetObjectFlagOn (Mac Attack, \"mac_gone\")\r\n            IncreaseObjectCounter (Blackfriars Inn, \"tasks\")\r\n          ","$":{"key":"Mac Attack"}}]}]},{"$":{"name":"goldeneye"},"scenery":[""],"alt":[{"$":{"type":"stringlist"},"value":["game"]}],"look":["<br/>One of the best first person shooters ever created. You read somewhere that it made more money than the film it was based on. Like many people you spent way too much time playing it while a student in the 90's."]}]},{"$":{"name":"TVs"},"inherit":[{"$":{"name":"plural"}}],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"look":["TV's of various vintages from old CRT behemoths, through to fairly recent slimline LCD and plasma units."],"alt":[{"$":{"type":"stringlist"},"value":["TV","television","televisions"]}],"turnon":[{"_":"\r\n        msg (\"With a fair amount of faffing about you manage to find a TV that turns on when you plug it in and isn't missing a remote control. You flick through the channels and it's the usual crap mixture of depressing fly on the wall documentaries, adverts for funeral insurance and instant loans, old reruns of Top Gear, and shopping channels. You switch the TV off.\")\r\n        SwitchOff (TVs)\r\n      ","$":{"type":"script"}}]},{"$":{"name":"Crockery"},"inherit":[{"$":{"name":"plural"}}],"look":["Plates, cups, saucers, dishes, all of various vintage and mostly featuring hideous designs. "],"takemsg":["You have no use for any of it."],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}]},{"$":{"name":"CDs"},"inherit":[{"$":{"name":"plural"}}],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"look":["A pile of CDs, mostly generic dance music compilations."]},{"$":{"name":"Matt Roch"},"inherit":[{"$":{"name":"namedmale"}}],"visible":[""],"scenery":[{"_":"false","$":{"type":"boolean"}}],"look":["Matthew Roch, owner of the shop. Late 50's with a mop of grey hair and grey stubble. His clothes are a similar chaotic mix as the contents of his shop;   grey flannel flared trousers, a red and black plaid shirt and a brown blazer with leather elbow patches. He's sat on a tall bar stool drinking tea and reading an old edition of Catch 22."],"speak":["\"Hello!\" says Matt, \"The council are increasing the rents again, not sure how much longer I'm going to be able to stay open. Anyway browse away.\""],"tell":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n          msg (\"\\\"Sounds good\\\" says Matt, \\\"I might come down.\\\"\")\r\n        ","$":{"key":"gig concert"}}]}],"ask":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n          msg (\"\\\"The damn council are up the wall\\\", says Matt.  \\\"I'm sure they're increasing the rents just so they can force us out and sell the land for yet more flats.\\\"\")\r\n        ","$":{"key":"council rent rents"}},{"_":"\r\n          msg (\"\\\"The premises have been in my family for a couple of generations\\\", says Matt, \\\"it used to just be a bookshop when my Dad owned it. When he passed away I struggled to throw away a lot of his stuff, so I thought I'd open a second-hand shop instead.\\\"\")\r\n        ","$":{"key":"shop junk emporium"}}]}]},{"$":{"name":"vinyl"},"inherit":[{"$":{"name":"container_closed"}}],"scenery":[{"_":"false","$":{"type":"boolean"}}],"alt":[{"$":{"type":"stringlist"},"value":["records"]}],"alias":["Box of Vinyl Records"],"visible":[""],"feature_container":[""],"listchildren":[""],"hidechildren":[""],"takemsg":["You don't need a whole box full of crap vinyl."],"look":[{"_":"\r\n        if (not vinyl.isopen) {\r\n          msg (\"A closed  box which according to the writing on the side contains vinyl records, all 50p each.\")\r\n        }\r\n        else {\r\n          msg (\"An open box of vinyl records\")\r\n        }\r\n      ","$":{"type":"script"}}],"onopen":[{"_":"\r\n        firsttime {\r\n          msg (\"You pull out a box of vinyl records and start rifling through. Amongst the 70's easy listening with garish covers, and umpteen classical albums, one record catches your eye. It is a picture disk in the shape of a some sort of white cocktail with a piece of pinapple on the rim of the glass, \")\r\n        }\r\n        otherwise {\r\n        }\r\n      ","$":{"type":"script"}}],"displayverbs":[{"$":{"type":"stringlist"},"value":["Look at","Take","Open","Close"]}],"inventoryverbs":[{"$":{"type":"stringlist"},"value":["Look at","Use","Drop","Open","Close"]}],"object":[{"$":{"name":"Picture Disk"},"look":["A 12 inch picture disk in the shape of a some sort of white cocktail with a piece of pinapple on the rim of the glass. Inspection of the label reveals that it is 'Escape (the pina colada song') by Rupert Holmes.<br/>"],"feature_usegive":[""],"alt":[{"$":{"type":"stringlist"},"value":["record","picture disc","disc"]}],"usedefaultprefix":[""],"take":[{"_":"\r\n          firsttime {\r\n            msg (\"You reluctantly pay Matt Roch the 50p that he wants for the picture disk and pick it up.\")\r\n            AddToInventory (Picture Disk)\r\n            SetObjectFlagOn (Matt Roch, \"paul_paid\")\r\n          }\r\n          otherwise {\r\n            msg (\"You take it.\")\r\n            AddToInventory (PC Gamer Magazine)\r\n          }\r\n        ","$":{"type":"script"}}],"giveto":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n            if (GetBoolean(Gerald, \"told_about_gig\")) {\r\n              msg (\"You give the picture disc to Jerry and his eyes light up. \\\"Good gracious me\\\" says Jerry, \\\"the legends are true!\\\" \\\"OK I'll do the warm-up slot for you at the gig\\\". Jerry picks up a box of records and heads out of the door, \\\"See you at the Blackfrairs Inn, and remember..\\\" says Jerry, \\\"Yes I know\\\" you reply, \\\"Keep it easy, keep it cheesy!\\\" you say, \\\"Nice\\\" says Jerry and disappears out of the door.\")\r\n              MakeObjectInvisible (Gerald)\r\n              MoveObject (pub gerald, Blackfriars Inn)\r\n              RemoveObject (Picture Disk)\r\n              IncreaseObjectCounter (Blackfriars Inn, \"tasks\")\r\n            }\r\n            else {\r\n              SetObjectFlagOn (Gerald, \"gerry_got_disc\")\r\n              msg (\"You give the picture disc to Jerry and his eyes light up. \\\"Good gracious me\\\" says Jerry, \\\"the legends are true!\\\" \\\"It's a generous gift indeed, if you ever need a favour just let me know.\\\"\")\r\n              RemoveObject (Picture Disk)\r\n            }\r\n          ","$":{"key":"Gerald"}}]}]}]},{"$":{"name":"Curtains"},"inherit":[{"$":{"name":"plural"}}],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"look":["<br/>The curtains are drawn, everything else is real though."],"takemsg":["You don't want them enough to buy them."]},{"$":{"name":"Bedding"},"inherit":[{"$":{"name":"plural"}}],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"look":["Sheets, duvet covers, pillow cases, valance sheets and skirts. All of various age and design, including a faded Masters of the Universe duvet cover."]},{"$":{"name":"DVDs"},"inherit":[{"$":{"name":"plural"}}],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"look":["An assortment of excercise videos, straight to video horror films you 've never heard of, and a copy of Planet of the Apes (sadly it's the dreadful Tim Burton remake)."],"takemsg":["There is nothing here that you want to watch."]},{"$":{"name":"Clothes"},"inherit":[{"$":{"name":"plural"}}],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"look":["A jumble of jumpers, trousers, coats, jackets, t-shirts, scarfs, hats and shoes. Judging by Matt's appearance he uses it as his wardrobe."],"takemsg":["There are no clothes here that you want."]},{"$":{"name":"plates"},"scenery":[""],"look":["Plates in a variety of different shapes, sizes and garish designs."],"takemsg":["You have no interest in spending your last remaining money on grotesque tableware. "]},{"$":{"name":"saucers"},"inherit":[{"$":{"name":"plural"}}],"scenery":[""],"look":["Saucers in a variety of different shapes, sizes and garish designs but sadly no flying ones."],"takemsg":["You have no interest in spending your last remaining money on grotesque tableware. "]},{"$":{"name":"dishes"},"scenery":[""],"look":["Dishes  in a variety of different shapes, sizes and garish designs."],"takemsg":["You have no interest in spending your last remaining money on grotesque tableware. "]},{"$":{"name":"Magnifying Glass"},"look":["An old magnifying glass with a bakelite handle and a surprisingly heavy lens."],"feature_usegive":[""],"take":[""],"takemsg":["\"You can have that for free\" says Matt, glancing up from his book."],"selfuseon":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n          msg (\"Using the magnifying glass you can now make out the minute writing.  It reads, 'Russian dolls, they're so full of themselves'.\")\r\n        ","$":{"key":"tiny note"}}]}]},{"$":{"name":"bar stool"},"scenery":[""],"look":["A tall wooden bar stool, Matt is seating on it."],"takemsg":["Matt is using it!"],"alt":[{"$":{"type":"stringlist"},"value":["tall bar stool"]}]}],"command":[{"pattern":["sniff;smell"],"script":["\r\n        msg (\"It smells musty, dusty and slightly damp.\")\r\n      "]}],"exit":[{"$":{"alias":"out","to":"Outside Junk Shop"},"inherit":[{"$":{"name":"outdirection"}}]}]},{"$":{"name":"No Smoke Inn"},"alias":["No Smoke Inn: Vape Store"],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"descprefix":["You are in the"],"description":["<br/>Recently opened, the No Smoke Inn sells vaping equipment and liquids. Displayed in glass cabinets are complicated looking vaping machines with various tubes, tanks and charging systems. On the walls are posters advertising bizarre and baffling flavours, 'Baked Beans on Toast', 'Dinner Lady (the old school taste of rice pudding!)', 'Ocean Lime'', 'Cornflake Tart, 'Twisted Ice-cream'. <br/><br/>"],"object":[{"$":{"name":"vending_machine"},"inherit":[{"$":{"name":"container_open"}}],"feature_container":[""],"open":[{"_":"false","$":{"type":"boolean"}}],"close":[{"_":"false","$":{"type":"boolean"}}],"displayverbs":[{"$":{"type":"stringlist"},"value":["Look at","Take"]}],"takemsg":["It's much too big."],"alias":["Vap-O-Mix Machine"],"credit":[{"_":"5","$":{"type":"int"}}],"isopen":[""],"transparent":[{"_":"false","$":{"type":"boolean"}}],"hidechildren":[""],"listchildren":[""],"look":[{"_":"\r\n        msg (\"A sign attached to the machine says 'Mix your own flavours! Free trial!' On the machine itself you can see {object:buttons} to select the flavors to mix, a {object:Vend Button}, and there is a {object:tray} at the bottom.\")\r\n      ","$":{"type":"script"}}],"addscript":[{"_":"\r\n        msg (\"You can't do that.\")\r\n      ","$":{"type":"script"}}],"inventoryverbs":[{"$":{"type":"stringlist"},"value":["Look at","Use","Drop","Open","Close"]}]},{"$":{"name":"buttons"},"inherit":[{"$":{"name":"surface"}}],"takemsg":["They are part of the machine."],"scenery":[""],"displayverbs":[{"$":{"type":"stringlist"},"value":["Look at"]}],"press":["You can only press one button at a time."],"push":["You can only push one button at a time."],"look":[{"_":"\r\n        if (not HasAttribute(this, \"flavors_to_mix\")) {\r\n          msg (\"There are no flavors currently selected.<br/>\")\r\n        }\r\n        else {\r\n          msg (\"Currently selected: \"+FormatList(buttons.flavors_to_mix, \",\", \"and\",\"\")+\".<br/>\")\r\n        }\r\n        msg (FormatVapeList(\"The choices are \",this,\"and\",\".\"))\r\n      ","$":{"type":"script"}}],"object":[{"$":{"name":"Strawberry Explosion"},"inherit":[{"$":{"name":"vape_button"}}],"alias":["Strawberry Explosion"],"flavor":["sweet"],"scenery":[""],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"feature_startscript":[""],"look":["A plastic button with the image of an exploding jar of strawberry jam."],"attr":[{"_":"\r\n          this.alt = Split(this.alias + \" button\",\";\")\r\n        ","$":{"name":"_initialise_","type":"script"}}]},{"$":{"name":"Scrumpy Cider"},"inherit":[{"$":{"name":"vape_button"}}],"alias":["Scrumpy Cider"],"flavor":["sour"],"scenery":[""],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"look":["A plastic button with an image depiciting a jug of cider with XXX printed on the label."]},{"$":{"name":"Gin Fizz"},"inherit":[{"$":{"name":"vape_button"}}],"alias":["Gin Fizz"],"flavor":["bitter"],"scenery":[""],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"look":["A plastic button with an image depicting a cocktail glass containing pale yellow liquid and a slice of lemon on the rim."]},{"$":{"name":"Baked Beans on Toast"},"inherit":[{"$":{"name":"vape_button"}}],"alias":["Baked Beans on Toast"],"flavor":["smokey"],"scenery":[{"_":"false","$":{"type":"boolean"}}],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"look":["A plastic button with an image depicting baked beans on top of a slice of toast."]},{"$":{"name":"Chorizo Sausage"},"inherit":[{"$":{"name":"vape_button"}}],"alias":["Chorizo Sausage"],"flavor":["spicy"],"scenery":[""],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"look":["A plastic button with an image depicting a u-shaped red sausage with white blobs of fat inside."]},{"$":{"name":"Mash Potato"},"inherit":[{"$":{"name":"vape_button"}}],"alias":["Mash Potato"],"flavor":["ummami"],"scenery":[""],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"look":["A plastic button with an image depicting a saucepan of potatoes being mashed."]},{"$":{"name":"French Fries with Mayonnaise"},"inherit":[{"$":{"name":"vape_button"}}],"alias":["French Fries with Mayonnaise"],"flavor":["creamy"],"scenery":[""],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"visible":[""],"look":["A plastic button with an image depicting french fries covered in mayonnaise."]},{"$":{"name":"Mint Choc Chip Ice Cream"},"inherit":[{"$":{"name":"vape_button"}}],"alias":["Mint Choc Chip Ice Cream"],"flavor":["menthol"],"scenery":[{"_":"false","$":{"type":"boolean"}}],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"look":["A plastic button with an image depicting a bowl of ice-cream."]},{"$":{"name":"Cornflakes"},"inherit":[{"$":{"name":"vape_button"}}],"alias":["Cornflakes"],"flavor":["salty"],"scenery":[""],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"look":["A plastic button with an image depicting a box of cornfalkes being poured into a bowl."]}]},{"$":{"name":"tray"},"inherit":[{"$":{"name":"container_closed"}}],"scenery":[""],"feature_container":[""],"takemsg":["It's part of the machine."],"close":[{"_":"false","$":{"type":"boolean"}}],"displayverbs":[{"$":{"type":"stringlist"},"value":["Look at","Open"]}],"look":["A black tray {either tray.isopen:(currently open)|that swivels in when you push it.<br/><br/>It reads: \"PUSH TO OPEN\"}."],"listchildren":[""],"onopen":[{"_":"\r\n        SetTurnTimeout (4) {\r\n          tray.isopen = false\r\n          if (tray.parent = game.pov.parent) {\r\n            msg (\"<br/>The tray just closed.\")\r\n          }\r\n        }\r\n      ","$":{"type":"script"}}],"addscript":[{"_":"\r\n        msg (\"Putting anything in there would be pointless.\")\r\n      ","$":{"type":"script"}}],"push":[{"_":"\r\n        invoke (tray.press)\r\n      ","$":{"type":"script"}}],"press":[{"_":"\r\n        if (not tray.isopen) {\r\n          msg (\"The tray opens.\")\r\n          tray.isopen = true\r\n          // invoke (tray.onopen)\r\n        }\r\n        else {\r\n          msg (\"It's already open.\")\r\n        }\r\n      ","$":{"type":"script"}}],"inventoryverbs":[{"$":{"type":"stringlist"},"value":["Look at","Use","Drop","Open","Close"]}]},{"$":{"name":"Vend Button"},"inherit":[{"$":{"name":"vape_button"}}],"scenery":[""],"press":[{"_":"\r\n        if (vending_machine.credit>0) {\r\n          msg (\"You press it.\")\r\n          DoVendVape\r\n          vending_machine.credit = vending_machine.credit - 1\r\n        }\r\n        else {\r\n          msg (\"The machine doesn't have any credits.\")\r\n        }\r\n      ","$":{"type":"script"}}],"look":[{"_":"\r\n        msg (\"It's the button you press once you've selected three flavors for the mixture.\")\r\n      ","$":{"type":"script"}}]},{"$":{"name":"KV"},"inherit":[{"$":{"name":"namedmale"}}],"look":["The hipster owner of the No Smoke Inn vape shop. In his late twenties, he has a large but perfectly manicured beard and walrus moustache oiled into fine points at the end that curl upwards; Sebastian is constantly twiddling the ends of it."],"speak":["\"Good afternoon\" says Sebastian, \"Have you tried our new machine?\" He points at the Vap-O-Mix Machine in the corner of the shop."],"alias":["Sebastian Barley"],"askdefault":[{"_":"\r\n        msg (\"\\\"I don't know anything about that\\\" says Sebastian.\")\r\n      ","$":{"type":"script"}}],"telldefault":[{"_":"\r\n        msg (\"\\\"OK\\\" says Sebastian.\")\r\n      ","$":{"type":"script"}}],"telltodefault":[{"$":{"type":"script"}}],"ask":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n          msg (\"\\\"It's just come in,\\\" says Sebastian, \\\"It's free to use today, new company trying to get some publicity, it's a cut throat business.\\\"\")\r\n        ","$":{"key":"machine vending vap-o-matic Vap-O-Mix Machine"}},{"_":"\r\n          msg (\"\\\"Why not give the Vap-O-Mix Machine a go,\\\" says Sebastian, \\\"If you come up with an interesting combination let me have it, and I'll give you some tasting notes.\\\"\")\r\n        ","$":{"key":"vape"}}]}],"tell":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n          msg (\"\\\"Thanks but its not really my scene,\\\" says Sebastian, \\\"I'm off out to see this new electronica, calypso, metal fusion band called Rebel Frying Pan.\\\" \")\r\n        ","$":{"key":"gig concert"}}]}]},{"$":{"name":"glass cabinets"},"scenery":[""],"look":["Glass display cabinets containing complicated looking vaping machines with various tubes, tanks and charging systems."]},{"$":{"name":"posters"},"inherit":[{"$":{"name":"plural"}}],"look":["Posters advertising bizarre and baffling flavours; 'Baked Beans on Toast', 'Dinner Lady (the old school taste of rice pudding!)', 'Boiled Egg and Soldiers'', 'Pepperoni Pizza', 'Brandy and Cigars'. <br/><br/>"],"scenery":[""]}],"exit":[{"$":{"alias":"out","to":"Outside No Smoke Inn"},"inherit":[{"$":{"name":"outdirection"}}]}],"command":[{"pattern":["smell; sniff"],"script":["\r\n        msg (\"A riot of different scents, all at war with each other, from sweet and sickly to smokey and bitter.\")\r\n      "]}]},{"$":{"name":"Industrial Estate"},"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"descprefix":["You are on an"],"exit":[{"$":{"alias":"west","to":"Town Square"},"inherit":[{"$":{"name":"westdirection"}}]},{"$":{"alias":"southwest","to":"Trinity Lane"},"inherit":[{"$":{"name":"southwestdirection"}}]},{"$":{"alias":"southeast","to":"Outside Scrap Yard"},"inherit":[{"$":{"name":"southeastdirection"}}]},{"$":{"alias":"south","to":"Outside Ed Cases House"},"inherit":[{"$":{"name":"southdirection"}}]},{"$":{"alias":"north","to":"Outside PMT Music Supplies"},"inherit":[{"$":{"name":"northdirection"}}]},{"$":{"alias":"east","to":"Outside Vernon Mill Rehearsal Rooms"},"inherit":[{"$":{"name":"eastdirection"}}]}],"command":[{"pattern":["smell; sniff"],"script":["\r\n        msg (\"You can't make out any particular scent.\")\r\n      "]}]},{"$":{"name":"PMT Music Supplies"},"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"description":["Professional Music Technology (PMT) store. One of the biggest music equipment stores in the country. <br/><br/>It's best not to linger here to long unless you want to hear the opening riff of 'Sweet Child O' Mine played over and over again, incorrectly.<br/><br/> You can currently hear someone playing 'Smoke on the Water' on a bass guitar at half tempo. <br/><br/>You only come in here because the basement houses an excellent repair shop; Buzz Stop."],"exit":[{"$":{"alias":"down","to":"Buzz Stop"},"inherit":[{"$":{"name":"downdirection"}}]},{"$":{"alias":"out","to":"Outside PMT Music Supplies"},"inherit":[{"$":{"name":"outdirection"}}]}],"command":[{"pattern":["listen"],"script":["\r\n        msg (\"You can hear the distant sound of someone playing bass, badly.\")\r\n      "]}]},{"$":{"name":"Buzz Stop"},"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"alias":["Buzz Stop Guitar Workshop"],"description":["Guitar and bass repair shop, run by Helen Key. Helen is a wizard at repairs and people come from miles around for her services. On the workbench in the middle of the room and hanging on the walls are tools, boxes of parts, and guitars in a variety of different states of dismatlement and repair."],"exit":[{"$":{"alias":"up","to":"PMT Music Supplies"},"inherit":[{"$":{"name":"updirection"}}]}],"object":[{"$":{"name":"Helen Key"},"inherit":[{"$":{"name":"namedfemale"}}],"look":["Her bookish demeanour belies her absolute mastery of all things to do with guitar maintenance, set up and electronics. "],"speak":[{"_":"\r\n        if (not GetBoolean(Helen Key, \"helen_gotguitar\")) {\r\n          msg (\"\\\"Hello again, what have your boys broken this time then?\\\"\")\r\n        }\r\n        else if (GetBoolean(Helen Key, \"helen_gotguitar\")) {\r\n          if (GetBoolean(Helen Key, \"helen_gotvape\")) {\r\n            msg (\"\\\"For heaven sake tell Ed to be more careful, I don't want to see any of his guitars again for a while,\\\" says Helen.\")\r\n          }\r\n          else {\r\n            msg (\"\\\"Haven't you picked up my vape fluid yet?\\\" says Helen, \\\"I want something that's sweet, sour and smoky\\\".\")\r\n          }\r\n        }\r\n      ","$":{"type":"script"}}],"askdefault":[{"_":"\r\n        msg (\"\\\"I don't know anything about that.\\\" says Helen.\")\r\n      ","$":{"type":"script"}}],"tell":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n          msg (\"\\\"Yes I might come down,\\\" says Helen, \\\"just keep that fool Ed away from me, he seems to think that all women find him irresistible.\\\"\")\r\n        ","$":{"key":"gig concert"}}]}],"ask":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n          msg (\"\\\"Ed's guitar?\\\" she replies, \\\"It's vulgar, over-engineered and pretentious. Just like its owner. Quite a nice action and tone though, I have to admit.\\\"\")\r\n        ","$":{"key":"guitar fender thundergrunt"}}]}]}],"command":[{"pattern":["sniff;smell"],"script":["\r\n        msg (\"It smell of lemon oil, used to clean and condition fretboards.\")\r\n      "]}]},{"$":{"name":"Vernon Mill Rehearsal Rooms"},"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"description":["A 19th century cotton mill, now home to artist studios, a martial arts club and band reheasal rooms (including your band's room)."],"exit":[{"$":{"name":"lift_door","alias":"up","to":"Band Rehearsal Room"},"inherit":[{"$":{"name":"updirection"}}],"locked":[""],"lockmessage":["The only way up to the band rehearsal room is via the goods lift, and some dimwit has broken the lever to open and close the doors. \"Fuck sake\" says Jon, \"I bet it was that fuckwit Ed Case, the heavy handed twat.\""]},{"$":{"alias":"out","to":"Outside Vernon Mill Rehearsal Rooms"},"inherit":[{"$":{"name":"outdirection"}}]}],"object":[{"$":{"name":"lift door"},"scenery":[""],"look":[{"_":"\r\n        if (GetBoolean(lift door, \"lift_fixed\")) {\r\n          msg (\"A scissor gate goods lift with an improvised door lever that you made out of a tyre wrench.\")\r\n        }\r\n        else {\r\n          msg (\"A scissor gate goods lift. The door is jammed shut as someone has broken the lever.\")\r\n        }\r\n      ","$":{"type":"script"}}],"fix":[{"_":"\r\n        if (GetBoolean(lift door, \"lift_fixed\")) {\r\n          msg (\"You already fixed it.\")\r\n        }\r\n        else {\r\n          if (Got(Tyre Wrench)) {\r\n            UnlockExit (lift_door)\r\n            msg (\"You jam the tyre wrench on to the lift door, it fits tight and you are able to open it. \\\"genius move boss!\\\" says Jonny.\")\r\n            RemoveObject (Tyre Wrench)\r\n            SetObjectFlagOn (lift door, \"lift_fixed\")\r\n          }\r\n          else {\r\n            msg (\"You don't have anything to fix it with.\")\r\n          }\r\n        }\r\n      ","$":{"type":"script"}}]}],"command":[{"pattern":["fix lift with wrench; fix lift with tyre wrench"],"script":["\r\n        if (GetBoolean(lift door, \"lift_fixed\")) {\r\n          msg (\"You already fixed it.\")\r\n        }\r\n        else {\r\n          if (Got(Tyre Wrench)) {\r\n            UnlockExit (lift_door)\r\n            msg (\"You jam the tyre wrench on to the lift door, it fits tight and you are able to open it. \\\"genius move boss!\\\" says Jonny.\")\r\n            RemoveObject (Tyre Wrench)\r\n            SetObjectFlagOn (lift door, \"lift_fixed\")\r\n          }\r\n          else {\r\n            msg (\"You're not carying that.\")\r\n          }\r\n        }\r\n      "]},{"pattern":["smell; sniff"],"script":["\r\n        msg (\"You can't make out any particular scent.\")\r\n      "]}]},{"$":{"name":"Ed Cases House"},"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"alias":["Ed Kayce's House"],"description":["More show home than home. Ed's house is so immaculately clean, organised and tidy that it's hard to believe that anyone actually lives here. The thick shag pile cream carpet is spotless. The air  in the room catches your breath. There are plug in air freshers in every power socket, they are set to maximum so there is a constant background 'psst' 'pssst' rhythm as they dispense 'sweet pea and lilac' scent into the room.  <br/><br/>On the walls are photos from gigs showing Ed in his many 'power poses' with everyone else in the band cropped out or blurred.<br/><br/>"],"enter":[{"$":{"type":"script"}}],"onexit":[{"_":"\r\n      msg (\"You and Jonny put on your shoes again and leave the house.\")\r\n      WearGarment (Shoes)\r\n    ","$":{"type":"script"}}],"beforeenter":[{"$":{"type":"script"}}],"exit":[{"$":{"alias":"out","to":"Outside Ed Cases House"},"inherit":[{"$":{"name":"outdirection"}}]}],"object":[{"$":{"name":"Ed Case"},"inherit":[{"$":{"name":"namedmale"}}],"look":["The self appointed leader and guitarist of the band. A man so narcissistic he makes Donald Trump look modest. Obsessed with his appearance and image and will never concede an argument. The group has nearly split up several times, and Ed's behaviour is the common denominator.  Though everyone has to admit that he's a damn good musician. He's 6 foot 6 with big muscles; he works out down the gym every other day and never tires of telling you how much he can currently bench press.<br/><br/>He is currently wearing a bright yellow silk boxing gown with two large Chinese dragons on the back. He has a feather duster tucked into the belt and he is holding a cloth and bottle of polish in his hands."],"alias":["Ed Kayce"],"speak":[{"_":"\r\n        firsttime {\r\n          this.spokentocount = 0\r\n          this.responses = NewStringList()\r\n          list add (Ed Case.responses, \"\\\"Have I told you about my new gym circuit? It's a beast,\\\" says Ed.\")\r\n          list add (Ed Case.responses, \"\\\"I've got some amazing new riffs, don't worry I'll show them to you later\\\" says Ed.\")\r\n          list add (Ed Case.responses, \"\\\"We really need to get some new band photos taken. My biceps are much bigger these days,\\\" says Ed.\")\r\n        }\r\n        msg (this.responses[this.spokentocount])\r\n        this.spokentocount = this.spokentocount + 1\r\n        if (this.spokentocount > ListCount(this.responses)-1) {\r\n          this.spokentocount = 0\r\n        }\r\n      ","$":{"type":"script"}}],"tell":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n          SetObjectFlagOn (Ed Case, \"ed_told\")\r\n          msg (\"\\\"About time we got a decent gig. The punters at half the venues we play don't appreciate my blatant genius\\\" says Ed. \\\"Bit of a problem though, one of my essential seven guitars needs some attention, the trus rod needs some adjustment. I can't possibly play without it.\\\" He disappears out of the room and comes back with a guitar case and hand it to you. \\\"Look after my baby!\\\" he says.\")\r\n          AddToInventory (Guitar Case)\r\n        ","$":{"key":"gig concert blackfriars"}}]}],"ask":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n          msg (\"\\\"Oh this?\\\" Ed says brandishing the feather duster, \\\"it's my tickling stick\\\". Ed makes to tickle Jon with it, Jon steps back out of the way and gives Ed a look that could melt metal. \\\"Only joking pal!\\\" says Ed. \")\r\n        ","$":{"key":"feather duster"}}]}]}],"command":[{"pattern":["smell;sniff"],"script":["\r\n        msg (\"You take a big sniff of the air and instantly regret it. The scent of the air fresheners is overpowering, sickly and cloying.\")\r\n      "]}]},{"$":{"name":"Record Store"},"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"alias":["Discovery Record Store"],"description":["Discovery record store.  Specialising in vinyl it somehow survived the digital revolution, and is now enjoying a renaissance as a popular hangout for the local hipster community.    <br/><br/>There are racks and racks of vinyl records, arranged by genre and alphabetical order. On the walls are special picture discs and limited edition coloured vinyl records. Some cheesy music is drifting out of the store hi-fi system."],"object":[{"$":{"name":"Gerald"},"inherit":[{"$":{"name":"namedmale"}}],"alias":["Jerry 'the mouse' "],"look":["Local DJ and record store owner, Jerry 'the mouse'. So called due to his diminutive stature and his love of cheesy music. He is wearing a deafeningly loud blue and orange Hawaiian shirt, white chinos, and a cream jumper tied around his shoulders. He peers over his counterfeit ray ban sunglasses at you and smiles."],"speak":["\"Good day to you!\" says Jerry, \"Browse as much as you want and remember...\" Gerald clicks his fingers and points them in a gun shape at you and in his best radio voice says, \"Keep it easy, keep it cheesy!\" You smile awkwardly back at him."],"tell":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n          if (GetBoolean(Gerald, \"gerry_got_disc\")) {\r\n            msg (\"\\\"Sure I'll do the warm-up slot for you at the gig\\\". \\\"Least I can do in exchange for the pictiure disc\\\" Jerry picks up a box of records and heads out of the door, \\\"See you at the Blackfrairs Inn, and remember..\\\" says Jerry, \\\"Yes I know\\\" you reply, \\\"Keep it easy, keep it cheesy!\\\" you say in unison, \\\"Nice\\\" says Jerry and disappears out of the door.\")\r\n            MakeObjectInvisible (Gerald)\r\n            MoveObject (pub gerald, Blackfriars Inn)\r\n            IncreaseObjectCounter (Blackfriars Inn, \"tasks\")\r\n          }\r\n          else {\r\n            SetObjectFlagOn (Gerald, \"told_about_gig\")\r\n            msg (\"\\\"Sorry Sir, I'm not doing any gigs for Robin Lye\\\", \\\"He is a scoundrel who doesn't pay what he promises\\\".\")\r\n          }\r\n        ","$":{"key":"gig dj concert warm-up"}}]}],"ask":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n          if (GetBoolean(Gerald, \"gerry_got_disc\")) {\r\n            msg (\"\\\"Sure I'll do the warm-up slot for you at the gig\\\". \\\"Least I can do in exchange for the pictiure disc\\\" Jerry picks up a box of records and heads out of the door, \\\"See you at the Blackfrairs Inn, and remember..\\\" says Jerry, \\\"Yes I know\\\" you reply, \\\"Keep it easy, keep it cheesy!\\\" you say in unison, \\\"Nice\\\" says Jerry and disappears out of the door.\")\r\n            MakeObjectInvisible (Gerald)\r\n            MoveObject (pub gerald, Blackfriars Inn)\r\n          }\r\n          else {\r\n            SetObjectFlagOn (Gerald, \"told_about_gig\")\r\n            msg (\"\\\"Sorry Sir, I'm not doing any gigs for Robin Lye\\\", \\\"He is a scoundrel who doesn't pay what he promises\\\".\")\r\n          }\r\n        ","$":{"key":"gig dj concert tonight"}},{"_":"\r\n          msg (\"\\\"A shining example of nominative determinism, the man is a scoundrel and a cad\\\" sighs Jerry. \\\"I did a warm up slot for him at the Green Man Festival. He promised me 'a grand in the hand' as he so coarsely put it.\\\" \\\"When I came off stage Robin had disappeared and the grand or lesser failed to appear in either dexter or sinister appendage.\\\"\")\r\n        ","$":{"key":"robin lye"}},{"_":"\r\n          msg (\"A family friendly festival out in the picturesque Brecon Beacons\\\" says Jerry with a far away look in his eye, \\\"last time I was there Los Del Rio were playing on the Black Lace stage,.\\\" \\\"7000 people dancing the Macarena! What a time to be alive.\\\"\")\r\n        ","$":{"key":"green man festival"}}]}]}],"command":[{"pattern":["listen"],"script":["\r\n        msg (\"You can hear 'Escape (the pina colda song)' by Rupert Holmes drifting out over the store hi-fi system.\")\r\n      "]},{"pattern":["smell; sniff"],"script":["\r\n        msg (\"You can't make out any particular scent.\")\r\n      "]}],"exit":[{"$":{"alias":"out","to":"Outside Discovery Record Store"},"inherit":[{"$":{"name":"outdirection"}}]}]},{"$":{"name":"Band Rehearsal Room"},"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"descprefix":["You are in the"],"description":[{"_":"\r\n      if (GetBoolean(Jonny, \"van_fixed\")) {\r\n        firsttime {\r\n          msg (\"<br/>Your band's flea pit of a rehearsal room. The walls are made from cinder blocks and it is perpetually cold and draughty. The floor is covered in various scraps of carpet. Blue tacked to the walls are old set lists and band posters advertising past gigs. <br/><br/>Taking up most of one wall is a a large mirror installed by the band narcissistic guitarist Ed Kayce so that he can stare lovingly at his own reflection or 'practise my stage presence' as he would put it. Amplifiers, speaker cabinets, guitar and bass cases, stands and a full drumkit are stacked up against the wall.<br/><br/>\\\"Right\\\" says Jonny, \\\"time to earn my keep.\\\"<br/><br/> You watch as Jonny whistling the theme to Tetris loads up the goods lift with the band equipment and then somehow manages to fit it all inside the van.<br/><br/> \\\"There, all fucking done\\\" says Jonny, \\\"but no room for you in the van I'm afraid boss.I'll drop this lot off at the Blackfriars Inn then come and find you\\\".<br/><br/> Jonny jumps into the van and disappears up the road in a cloud of diesel smoke and screeching tyres.\")\r\n          SetObjectFlagOn (Jonny, \"jon_go\")\r\n          MoveObject (Jonny, Backstage)\r\n          MoveObject (Van, Jons Lockup)\r\n          SetTurnTimeout (5) {\r\n            SetObjectFlagOff (Jonny, \"jon_go\")\r\n          }\r\n          SetObjectFlagOn (Backstage, \"gear_loaded\")\r\n          MoveObject (Band Equipment, Backstage)\r\n          IncreaseObjectCounter (Blackfriars Inn, \"tasks\")\r\n        }\r\n        otherwise {\r\n          msg (\"Your band's flea pit of a rehearsal room. The walls are made from cinder blocks and it is perpetually cold and draughty. The floor is covered in various scraps of carpet. Blue tacked to the walls are old set lists and band posters advertising past gigs. <br/><br/>Taking up most of one wall is a a large mirror installed by the band narcissistic guitarist Ed Kayce so that he can stare lovingly at his own reflection or 'practise my stage presence' as he would put it. <br/><br/>The room is empty of band equipment now that Jonny has loaded it all into the van and taken it to the Blackfriars Inn.<br/>\")\r\n        }\r\n      }\r\n      else {\r\n        msg (\"<br/>Your band's flea pit of a rehearsal room. The walls are made from cinder blocks and it is perpetually cold and draughty. The floor is covered in various scraps of carpet. Blue tacked to the walls are old set lists and band posters advertising past gigs. <br/><br/>Taking up most of one wall is a a large mirror installed by the band narcissistic guitarist Ed Kayce so that he can stare lovingly at his own reflection or 'practise my stage presence' as he would put it. Amplifiers, speaker cabinets, guitar and bass cases, stands and a full drumkit are stacked up. <br/><br/>\\\"There's no fucking way I'm moving all this gear without the van, we'll have to get it fixed boss\\\" says Jonny.<br/>\")\r\n      }\r\n    ","$":{"type":"script"}}],"exit":[{"$":{"alias":"down","to":"Vernon Mill Rehearsal Rooms"},"inherit":[{"$":{"name":"downdirection"}}]}],"object":[{"$":{"name":"Band Equipment"},"look":["Amplifiers, speaker cabinets, guitar and bass cases, leads, stands and a full drumkit. All awkward to carry and heavy as hell.<br/>"],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"take":[{"_":"\r\n        if (Contains (Backstage,Band Equipment)) {\r\n          msg (\"Probaby best to leave it here, the band will need it, besides it all weighs a tonne.\")\r\n        }\r\n        else {\r\n          msg (\"It's too heavy, and besides that's what roadies are for.\")\r\n        }\r\n      ","$":{"type":"script"}}]},{"$":{"name":"posters1"},"alias":["posters"],"scenery":[""],"look":["<br/>Posters advertising previous The Bony King's gigs. The gigs have become more sparse and at smaller venues in recent years. <br/><br/>This gig tonight is a real boost to the bands fortunes."]},{"$":{"name":"mirror"},"scenery":[""],"look":["A large miror installed by Ed. He looks at himself in it more than the other members of the band during rehearsals."]}],"command":[{"pattern":["smell; sniff"],"script":["\r\n        msg (\"It smells both rank and dank in here.\")\r\n      "]}]},{"$":{"name":"Outside Scrap Yard"},"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"descprefix":["You are"],"alias":["Outside Jackson's Scrap Yard"],"description":[{"_":"\r\n      if (GetBoolean(Dogs, \"dogs_fed\")) {\r\n        msg (\"<br/>Outside the local scrap yard, in a distinctly shady part of town. The entrance to the scrap yard is guarded by two enormous rottweiler dogs chained to the gate, but they are calm and lying on the floor. \")\r\n      }\r\n      else {\r\n        firsttime {\r\n          msg (\"<br/>Outside the local scrap yard, in a distinctly shady part of town. The entrance to the scrap yard is guarded by two enormous rottweiler dogs chained to the gate. Jon says, \\\"Fuck this for a game of soldiers, I'm not going past them!\\\". \")\r\n        }\r\n        otherwise {\r\n          msg (\"<br/>Outside the local scrap yard, in a distinctly shady part of town. The entrance to the scrap yard is guarded by two enormous rottweiler dogs chained to the gate. Jon is standing way back with you between him and the dogs.\")\r\n        }\r\n      }\r\n    ","$":{"type":"script"}}],"object":[{"$":{"name":"Dogs"},"inherit":[{"$":{"name":"plural"}}],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"alias":["Two Ferocious Dogs"],"feed":[{"_":"\r\n        if (Got(Sausages)) {\r\n          msg (\"You chuck the sausages to the dogs. They wolf them down and it seems to calm them. You gingerly pet them and they lie down. \\\"Come on Jon\\\", you say, \\\"let's get in here\\\". \\\"O fucking K then\\\" says Jon.\")\r\n          UnlockExit (scrapdoor)\r\n          SetObjectFlagOn (Dogs, \"dogs_fed\")\r\n          RemoveObject (Sausages)\r\n        }\r\n        else {\r\n          msg (\"You don't have anything to feed them with..except Jon, but that's not the way you roll.\")\r\n        }\r\n      ","$":{"type":"script"}}],"look":[{"_":"\r\n        if (GetBoolean(Dogs, \"dogs_fed\")) {\r\n          msg (\"Now you've fed them the dogs are chilled out and lounging on the ground. You can see from their collar tags that they are called Snowflake and Twinkle Toes.\")\r\n        }\r\n        else {\r\n          msg (\"Two huge ferocious rottweiler dogs, black with tan maws and shanks. They are growling and snarling, bearing their teeth as they jump up and and strain at their chains. You can see that they have name tags on their collars but the dogs are moving too much for you to work out what they say.\")\r\n        }\r\n      ","$":{"type":"script"}}],"stroke":[{"_":"\r\n        if (GetBoolean(Dogs, \"dogs_fed\")) {\r\n          msg (\"You stroke the dogs, now that you have fed them they are docile and affectionate.\")\r\n        }\r\n        else {\r\n          msg (\"You move to stroke one of the dogs and it lunges for you, its jaws clamp shut millimetres from your hand. \\\"Fuckin' hell Boss\\\" says Jonny, \\\"You got a death wish or what?!\\\"\")\r\n        }\r\n      ","$":{"type":"script"}}],"pet":[{"_":"\r\n        if (GetBoolean(Dogs, \"dogs_fed\")) {\r\n          msg (\"You stroke the dogs, now that you have fed them they are docile and affectionate.\")\r\n        }\r\n        else {\r\n          msg (\"You move to stroke one of the dogs and it lunges for you, its jaws clamp shut millimetres from your hand. \\\"Fuckin' hell Boss\\\" says Jonny, \\\"You got a death wish or what?!\\\"\")\r\n        }\r\n      ","$":{"type":"script"}}]}],"exit":[{"$":{"name":"scrapdoor","alias":"in","to":"Scrap Yard"},"inherit":[{"$":{"name":"indirection"}}],"locked":[""],"runscript":[{"_":"false","$":{"type":"boolean"}}],"lockmessage":["You step towards the gate, and the dogs start barking, snarling and foaming at the mouth. You decide that Jon might have a point and step back."],"script":[{"_":"\r\n        if (GetBoolean(Dogs, \"dogs_fed\")) {\r\n        }\r\n      ","$":{"type":"script"}}]},{"$":{"alias":"northwest","to":"Industrial Estate"},"inherit":[{"$":{"name":"northwestdirection"}}]}],"command":[{"pattern":["smell; sniff"],"script":["\r\n        msg (\"Unsurprisingly the air has a distinct whiff of dog about it.\")\r\n      "]}]},{"$":{"name":"Broughton Lane"},"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"descprefix":["You are on"],"exit":[{"$":{"alias":"north","to":"Blackfriars Road"},"inherit":[{"$":{"name":"northdirection"}}]},{"$":{"alias":"south","to":"Jons Lockup"},"inherit":[{"$":{"name":"southdirection"}}]},{"$":{"alias":"west","to":"Outside mikes house"},"inherit":[{"$":{"name":"westdirection"}}]}],"verb":[""],"command":[{"pattern":["sniff; smell"],"script":["\r\n        msg (\"There is nothing interesting to smell.\")\r\n      "]}]},{"$":{"name":"Outside Ed Cases House"},"alias":["Outside Ed Kayce's House"],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"descprefix":["You are"],"exit":[{"$":{"alias":"north","to":"Industrial Estate"},"inherit":[{"$":{"name":"northdirection"}}]},{"$":{"alias":"west","to":"Trinity Lane"},"inherit":[{"$":{"name":"westdirection"}}]},{"$":{"name":"eds_door","alias":"in","to":"Ed Cases House"},"inherit":[{"$":{"name":"indirection"}}],"locked":[""],"lockmessage":["Ed's front door is closed."],"runscript":[""],"script":[{"_":"\r\n        if (Shoes.worn) {\r\n          msg (\"\\\"No!\\\" shouts Ed, \\\"you can't come in like that you'll make a mess!\\\"\")\r\n        }\r\n        else {\r\n          msg (\"Jonny struggles to take off his Doc Martin boots, cursing under his breath you both enter Ed's house.\")\r\n          MoveObject (player, Ed Cases House)\r\n        }\r\n      ","$":{"type":"script"}}]}],"object":[{"$":{"name":"Eds Front Door"},"alias":["Front Door"],"look":["An immaculately painted blue navy door, with shiny polished brass fittings."],"knockon":[{"_":"\r\n        if (not GetBoolean(Ed Case, \"ed_gone\")) {\r\n          firsttime {\r\n            msg (\"You knock on Ed's front door. \\\"Hell\\\" says Jonny, \\\"I wonder what mood the deranged git is in today.\\\" After a few seconds the door opens and standing in the doorway dressed in a bright yellow boxing gown and carrying a feather duster is Ed. He immediately cleans the spot where you knocked on the door and says, \\\"mi casa es su casa, but don't make a mess, I've just had the carpets shampooed.\\\" \\\"Fuck sake\\\" mumbles Jonny. Ed disappears inside.\")\r\n            UnlockExit (eds_door)\r\n          }\r\n          otherwise {\r\n            msg (\"You knock on the door, Ed shouts from inside \\\"it's open!\\\".\")\r\n          }\r\n        }\r\n        else {\r\n          msg (\"You knock on the door, but there is nobody home.\")\r\n        }\r\n      ","$":{"type":"script"}}]}],"command":[{"pattern":["smell; sniff"],"script":["\r\n        msg (\"The faint smell of sickly sweet air fresher emanates from Ed's House.\")\r\n      "]}]},{"$":{"name":"Outside Macs House"},"alias":["Outside Mac Attack's House"],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"descprefix":["You are"],"exit":[{"$":{"alias":"south","to":"Brunswick Street"},"inherit":[{"$":{"name":"southdirection"}}]},{"$":{"name":"macs_door","alias":"in","to":"Macs House"},"inherit":[{"$":{"name":"indirection"}}],"locked":[""],"lockmessage":["Mac's front door is closed."]}],"object":[{"$":{"name":"Macs Front Door"},"alias":["Mac's Front Door"],"scenery":[{"_":"false","$":{"type":"boolean"}}],"look":["A solid looking white front door."],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"knockon":[{"_":"\r\n        if (not GetBoolean(Mac Attack, \"mac_gone\")) {\r\n          firsttime {\r\n            msg (\"You knock on Mac's front door. After a few seconds the door opens and standing in the doorway is Mac. \\\"Yo\\\" says Mac, \\\"come on in\\\". He puts the front door on the latch and dissapears inside the house.\")\r\n            UnlockExit (macs_door)\r\n          }\r\n          otherwise {\r\n            msg (\"You knock on the door, Mac shouts from inside the house, \\\"It's open! Come on in.\\\"\")\r\n          }\r\n        }\r\n        else {\r\n          msg (\"You knock on the door, but there is nobody home.\")\r\n        }\r\n      ","$":{"type":"script"}}]}],"command":[{"pattern":["smell; sniff"],"script":["\r\n        msg (\"You can't make out any particular smell.\")\r\n      "]}]},{"$":{"name":"Outside mikes house"},"alias":["Outside Mike E. Smith's House"],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"descprefix":["You are"],"description":["A rough end of town. Mike's current home is a run down house, he's on hard times and the rent is cheap. The driveway is covered in potholes, the front door is shabby, the gutter appears to be leaking and there is a big crack in one of the upstairs windows."],"firstenter":[{"_":"\r\n      msg (\"\\\"Poor Mike\\\" says Jonny, \\\"He's really on his uppers.\\\"\")\r\n    ","$":{"type":"script"}}],"exit":[{"$":{"name":"mikes_door","alias":"in","to":"Mikes House"},"inherit":[{"$":{"name":"indirection"}}],"locked":[""],"lockmessage":["Mike's front door is closed."]},{"$":{"alias":"east","to":"Broughton Lane"},"inherit":[{"$":{"name":"eastdirection"}}]}],"object":[{"$":{"name":"Mikes Front Door"},"alias":["Mike's Front Door"],"look":["A rather sad looking front door with peeling white paint."],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"knockon":[{"_":"\r\n        firsttime {\r\n          msg (\"You knock on the door an doing so dislodges more flaking paint from its surface. After a few moments the door opens and Mike greets you with a broad smile, \\\"Hey guys, what's going on, er, come on in, excuse the mess.\\\" He disappears inside.\")\r\n          UnlockExit (mikes_door)\r\n          SetObjectFlagOn (Mikes Front Door, \"unlocked\")\r\n        }\r\n        otherwise {\r\n          if (GetBoolean(Mikes Front Door, \"unlocked\")) {\r\n            msg (\"You knock on the door, \\\"It's open!\\\" shouts Mike from inside the house.\")\r\n          }\r\n          else {\r\n            msg (\"You knock onthe door, but there is nobody home.\")\r\n          }\r\n        }\r\n      ","$":{"type":"script"}}]}],"command":[{"pattern":["smell; sniff"],"script":["\r\n        msg (\"You can't make out any particular smell.\")\r\n      "]}]},{"$":{"name":"Back Yard of The Greasy Spoon"},"description":["The back yard of the Greasy Spoon Café. A hard-standing area of concrete with wheelie bins lined up on one side. There is a door into the café on the north side."],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"descprefix":["You are in the"],"object":[{"$":{"name":"Pink Wheelie Bin"},"inherit":[{"$":{"name":"container_closed"}}],"feature_container":[""],"hidechildren":[""],"listchildren":[""],"push":["You move the pink wheelie bin around the yard. Jon says, \"Er, you OK boss?\". You put the bin back where it was."],"pull":["You move the pink wheelie bin around the yard. Jon says, \"Er, you OK boss?\". You put the bin back where it was."],"move":["You move the pink wheelie bin around the yard. Jon says, \"Er, you OK boss?\". You put the bin back where it was."],"look":[{"_":"\r\n        if (not GetBoolean(Pink Wheelie Bin, \"pigeon_gone\")) {\r\n          msg (\"A pink wheelie bin, according to the council colour scheme it should contain food waste, and judging by the fat pigeon sat on top it probably does.\")\r\n        }\r\n        else {\r\n          msg (\"A pink wheelie bin for food waste.\")\r\n        }\r\n      ","$":{"type":"script"}}],"onopen":[{"_":"\r\n        firsttime {\r\n          msg (\"<br> You shout and shoo the pigeon away from the wheelie bin, the pigeon coos in complaint and flies off. \\\"damn winged rat!\\\" you exclaim. \\\"Fuck sake boss, what the pigeon ever do to you?\\\"\")\r\n          MakeObjectInvisible (pigeon)\r\n          SetObjectFlagOn (Pink Wheelie Bin, \"pigeon_gone\")\r\n        }\r\n      ","$":{"type":"script"}}],"displayverbs":[{"$":{"type":"stringlist"},"value":["Look at","Take","Open","Close"]}],"inventoryverbs":[{"$":{"type":"stringlist"},"value":["Look at","Use","Drop","Open","Close"]}],"object":[{"$":{"name":"Sausages"},"inherit":[{"$":{"name":"plural"}}],"take":[""],"look":["A handful of sausages, they don't seem to be going down very well with the customer, too much gristle. You suspect that Fat Bob has money worries and has been trying to reduce his costs."],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"prefix":["some"],"feature_usegive":[""],"giveto":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n            SetObjectFlagOn (Dogs, \"dogs_fed\")\r\n            msg (\"You chuck the sausages to the dogs. They wolf them down and it seems to calm them. You gingerly pet them and they lie down. \\\"Come on Jon\\\", you say, \\\"let's get in here\\\". \\\"O fucking K then\\\" says Jon.\")\r\n            UnlockExit (scrapdoor)\r\n            RemoveObject (Sausages)\r\n          ","$":{"key":"Dogs"}}]}]}]},{"$":{"name":"Blue Wheelie Bin"},"inherit":[{"$":{"name":"container_closed"}}],"feature_container":[""],"hidechildren":[""],"listchildren":[""],"look":["A blue wheelie bin, according to the council colour scheme it should be used for paper recycling."],"push":[{"_":"\r\n        if (GetBoolean(Mike Smith, \"mike_told\")) {\r\n          if (not GetBoolean(Ponky, \"found\")) {\r\n            msg (\"You move the blue wheelie bin, and there behind it is Mike's kitten Ponky, he jumps up into Jonny's arms. \\\"Woah!\\\" says Jonny, \\\"What else do I have to deal with today”, but then his face cracks a smile, he strokes the kitten and says, \\\"Cute little fucker ain't he.\\\"\")\r\n            MoveObject (Ponky, Jonny)\r\n            SetObjectFlagOn (Ponky, \"found\")\r\n          }\r\n          else {\r\n            msg (\"You move the blue wheelie bin around the yard. \\\"Er, you OK boss?\\\" says Jonny, \\\"Hoping to find some more kittens?! Ha ha ha!\\\"\")\r\n          }\r\n        }\r\n        else {\r\n          msg (\"You move the blue wheelie bin around the yard. \\\"You OK boss?!\\\" says Jonny.\")\r\n        }\r\n      ","$":{"type":"script"}}],"pull":[{"_":"\r\n        if (GetBoolean(Mike Smith, \"mike_told\")) {\r\n          if (not GetBoolean(Ponky, \"found\")) {\r\n            msg (\"You move the blue wheelie bin, and there behind it is Mike's kitten Ponky, he jumps up into Jonny's arms. \\\"Woah!\\\" says Jonny, \\\"What else do I have to deal with today”, but then his face cracks a smile, he strokes the kitten and says, \\\"Cute little fucker ain't he.\\\"\")\r\n            MoveObject (Ponky, Jonny)\r\n            SetObjectFlagOn (Ponky, \"found\")\r\n          }\r\n          else {\r\n            msg (\"You move the blue wheelie bin around the yard. \\\"Er, you OK boss?\\\" says Jonny, \\\"Hoping to find some more kittens?! Ha ha ha!\\\"\")\r\n          }\r\n        }\r\n        else {\r\n          msg (\"You move the blue wheelie bin around the yard. \\\"You OK boss?!\\\" says Jonny.\")\r\n        }\r\n      ","$":{"type":"script"}}],"move":[{"_":"\r\n        if (GetBoolean(Mike Smith, \"mike_told\")) {\r\n          if (not GetBoolean(Ponky, \"found\")) {\r\n            msg (\"You move the blue wheelie bin, and there behind it is Mike's kitten Ponky, he jumps up into Jonny's arms. \\\"Woah!\\\" says Jonny, \\\"What else do I have to deal with today”, but then his face cracks a smile, he strokes the kitten and says, \\\"Cute little fucker ain't he.\\\"\")\r\n            MoveObject (Ponky, Jonny)\r\n            SetObjectFlagOn (Ponky, \"found\")\r\n          }\r\n          else {\r\n            msg (\"You move the blue wheelie bin around the yard. \\\"Er, you OK boss?\\\" says Jonny, \\\"Hoping to find some more kittens?! Ha ha ha!\\\"\")\r\n          }\r\n        }\r\n        else {\r\n          msg (\"You move the blue wheelie bin around the yard. \\\"You OK boss?!\\\" says Jonny.\")\r\n        }\r\n      ","$":{"type":"script"}}],"displayverbs":[{"$":{"type":"stringlist"},"value":["Look at","Take","Open","Close"]}],"inventoryverbs":[{"$":{"type":"stringlist"},"value":["Look at","Use","Drop","Open","Close"]}],"object":[{"$":{"name":"A collapsed cardboard box"},"look":["A cardboard box that has been flattened down. According to the label it once contained '200 budget value 'pork style' sausages'."],"take":[""],"attr":[{"_":"false","$":{"name":"feature_container","type":"boolean"}}]}]},{"$":{"name":"Brown Wheelie Bin"},"inherit":[{"$":{"name":"container_closed"}}],"feature_container":[""],"hidechildren":[""],"listchildren":[""],"look":["A brown wheelie bin. According to the council colour scheme it should be used for glass, plastic and metal recycling."],"pull":["You move the brown wheelie bin around the yard. Jon says, \"Er, you OK boss?\". You put the bin back where it was."],"push":["You move the brown wheelie bin around the yard. Jon says, \"Er, you OK boss?\". You put the bin back where it was."],"move":["You move the brown wheelie bin around the yard. Jon says, \"Er, you OK boss?\". You put the bin back where it was."],"displayverbs":[{"$":{"type":"stringlist"},"value":["Look at","Take","Open","Close"]}],"inventoryverbs":[{"$":{"type":"stringlist"},"value":["Look at","Use","Drop","Open","Close"]}],"object":[{"$":{"name":"Empty Baked Bean Tin"},"inherit":[{"$":{"name":"container_open"}}],"look":["An empty can of baked beans (the beans have been and gone)."],"take":[""],"feature_container":[""],"open":[""],"close":[{"_":"false","$":{"type":"boolean"}}],"listchildren":[""],"hidechildren":[""],"displayverbs":[{"$":{"type":"stringlist"},"value":["Look at","Take","Open","Close"]}],"inventoryverbs":[{"$":{"type":"stringlist"},"value":["Look at","Use","Drop","Open","Close"]}]}]},{"$":{"name":"pigeon"},"look":["A fat and filthy grey city pigeon, its sat on top of the pink wheelie bin."],"takemsg":["You try to grab the pigeon, it flaps out of reach and then lands back on top of the wheelie bin. \"Leave the poor fucker alone!\" says Jonny."],"speak":["The pigeon stares back at you dumbly. You feel like an idiot. \"Ha ha\" says Jonny, \"Not exactly Dr fucking Doolittle are ya!\""]}],"exit":[{"$":{"alias":"northeast","to":"Trinity Lane"},"inherit":[{"$":{"name":"northeastdirection"}}]},{"$":{"alias":"north","to":"Greasy Spoon Cafe"},"inherit":[{"$":{"name":"northdirection"}}]}],"command":[{"pattern":["listen"],"script":["\r\n        if (GetBoolean(Mike Smith, \"mike_told\")) {\r\n          if (not GetBoolean(Ponky, \"found\")) {\r\n            msg (\"You can hear a faint mewing coming from somewhere, and the distant sound of traffic on Oxford Road\")\r\n          }\r\n          else {\r\n            msg (\"You can hear the faint sound of traffic on Oxford Road.\")\r\n          }\r\n        }\r\n        else {\r\n          msg (\"You can hear the faint sound of traffic on Oxford Road.\")\r\n        }\r\n      "]},{"pattern":["smell; sniff"],"script":["\r\n        msg (\"A strong smell of cooking oil hangs in the air.\")\r\n      "]}]},{"$":{"name":"Scrap Yard"},"description":["An old school breakers yard that has been here for decades. Wrecks of cars and vans in various states of decay are stacked up in piles in the yard. The ground is filthy and polluted with years of oil, fuel and other automotive fluid spillages. The place is run by Roy Jackson and his daughter Sarah."],"alias":["Jackson's Scrap Yard"],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"exit":[{"$":{"alias":"out","to":"Outside Scrap Yard"},"inherit":[{"$":{"name":"outdirection"}}]}],"object":[{"$":{"name":"Sarah Jackson"},"inherit":[{"$":{"name":"namedfemale"}}],"look":["Sarah is in her mid twenties and has been a grease monkey since she was a child. She is wearing blue denim dungarees, steel capped boots and a faded Nirvana t-shirt. Her friendly face is typically streaked with grime and her blond hair is tied into two plaited pony tails. She is currently removing the gearbox from a smashed up Ford Mondeo."],"speak":["Sarah looks up from the gearbox she is working on, \"Oh hi! You after more parts for that wreck of a van?\""],"ask":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n          if (GetBoolean(Sarah Jackson, \"given_alt\")) {\r\n            msg (\"\\\"The one I gave you earlier should last a while, the van it came out of was practically new before some clot wrapped it round a lampost!\\\"<br/>\")\r\n          }\r\n          else {\r\n            msg (\"\\\"Yeah I should be able to sort you out. Hang on a sec,\\\" says Sarah.<br/><br/>She disappears amongst the piles of wrecked cars carrying a ratchet wrench and comes back a few minutes later carrying an alternator, she hands it to Jonny and says, \\\"Here you go Jonny, you know how to fix it don't you? Righty tighty, lefty loosy!\\\"<br/><br/> \\\"Ya Cheeky sod!\\\" say Jonny with a grin, \\\"Cheers!\\\".<br/><br/>\\\"No worries\\\" says Sarah, \\\"you can pay my Dad next time you see him, he's away at the races with that reprobate Cliff from the auction house.\\\"<br/>\")\r\n            MoveObject (Alternator, Jonny)\r\n            SetObjectFlagOn (Sarah Jackson, \"given_alt\")\r\n          }\r\n        ","$":{"key":"alternator"}},{"_":"\r\n          msg (\"\\\"You know what FORD stands for don't you?\\\", says Sarah,\\\"No? It's Fix Or Repair Daily! Ha ha! Seriously though they're terrible get yourself some thing Korean or Japanese.\\\"\")\r\n        ","$":{"key":"ford modeo"}},{"_":"\r\n          msg (\"\\\"It's in mint condition\\\" says Sarah, \\\"unlike the rest of the car which is overdue for the crusher.\\\"\")\r\n        ","$":{"key":"gearbox"}},{"_":"\r\n          msg (\"\\\"Oh no, have they been terrorising people for food again?\\\" says Sarah, \\\"Sorry about that, we've had a lot of trouble with break-ins and I feel safer with them there when I'm working alone.\")\r\n        ","$":{"key":"dogs snowflake twinkle toes twinkle-toes"}},{"_":"\r\n          msg (\"\\\"He's at the racecourse again with Cliff,\\\" replies Sarah, \\\"leaving me to man the fort on my own.\\\"\")\r\n        ","$":{"key":"roy dad father"}},{"_":"\r\n          msg (\"\\\"He's always leading Dad into mischief,\\\" says Sarah.<br/><br/>\\\"Sounds familar!\\\" replies Jon, glancing at you.\")\r\n        ","$":{"key":"cliff"}}]}],"tell":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n          if (GetBoolean(Sarah Jackson, \"given_alt\")) {\r\n            msg (\"\\\"The alternator I gave you earlier should last a while, the van it came out of was practically new before some clot wrapped it round a lampost!\\\" says Sarah\")\r\n          }\r\n          else {\r\n            msg (\"\\\"Yeah I should be able to sort you out. Hang on a sec\\\".<br/><br/> Sarah disappears amongst the piles of wrecked cars carrying a ratchet wrench, she comes back a few minutes later carrying an alternator.<br/><br/>She hands it to Jonny and says, \\\"Here you go Jonny, you know how to fix it don't you? Righty tighty, lefty loosy!\\\"<br/><br/>\\\"Ya Cheeky sod!\\\" say Jonny with a grin,<br/><br/> \\\"Cheers!\\\". \\\"No worries\\\" says Sarah, \\\"you can pay my Dad next time you see him, he's away at the races with that reprobate Cliff from the auction house.\\\"\")\r\n            MoveObject (Alternator, Jonny)\r\n            SetObjectFlagOn (Sarah Jackson, \"given_alt\")\r\n          }\r\n        ","$":{"key":"van alternator"}},{"_":"\r\n          msg (\"<br/>\\\"Yeah I already heard about it. I'll be there, I'm a  big fan of Get Lamp and it's always fun to see your boys play. Even that idiot Ed.\\\"\")\r\n        ","$":{"key":"gig concert"}}]}]},{"$":{"name":"ford mondeo"},"look":["A crumpled mess of what was once a silver Ford Mondeo. Sarah is in the process of removing its gearbox."],"scenery":[""]},{"$":{"name":"wrecks"},"scenery":[""],"look":["Wrecks of cars and vans, all in various states of being stripped down for parts."]},{"$":{"name":"cars"},"scenery":[""],"look":["Wrecks of cars all in various states of being stripped down for parts."]},{"$":{"name":"vans"},"scenery":[""],"look":["Wrecks of vans, all in various states of being stripped down for parts."]}],"command":[{"pattern":["sniff; smell"],"script":["\r\n        msg (\"The air is heavy with the smell of spilt fuel and oil.\")\r\n      "]}]},{"$":{"name":"Shoes"},"inherit":[{"$":{"name":"wearable"}},{"$":{"name":"plural"}}],"feature_wearable":[""],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"prefix":[{"$":{"type":"string"}}],"alias":["a pair of shoes"],"inventoryverbs":[{"$":{"type":"stringlist"},"value":["Look at","Use","Drop","Wear","Remove"]}]},{"$":{"name":"Outside Greasy Spoon Café"},"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"descprefix":["You are"],"exit":[{"$":{"alias":"in","to":"Greasy Spoon Cafe"},"inherit":[{"$":{"name":"indirection"}}]},{"$":{"alias":"north","to":"Oxford Road"},"inherit":[{"$":{"name":"northdirection"}}]}],"command":[{"pattern":["smell; sniff"],"script":["\r\n        msg (\"A strong smell of cooking oil hangs in the air.\")\r\n      "]}]},{"$":{"name":"Outside Junk Shop"},"alias":["Outside The Junk 'n' Disorderly Second-hand Emporium"],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"descprefix":["You are"],"exit":[{"$":{"alias":"in","to":"Junk Shop"},"inherit":[{"$":{"name":"indirection"}}]},{"$":{"alias":"south","to":"Town Square"},"inherit":[{"$":{"name":"southdirection"}}]}],"command":[{"pattern":["smell; sniff"],"script":["\r\n        msg (\"There is no particular scent in the air.\")\r\n      "]}]},{"$":{"name":"Outside Discovery Record Store"},"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"descprefix":["You are"],"exit":[{"$":{"alias":"in","to":"Record Store"},"inherit":[{"$":{"name":"indirection"}}]},{"$":{"alias":"northeast","to":"Town Square"},"inherit":[{"$":{"name":"northeastdirection"}}]}],"command":[{"pattern":["smell; sniff"],"script":["\r\n        msg (\"There is no particular scent in the air.\")\r\n      "]}]},{"$":{"name":"Outside Blackfriars Inn"},"alias":["Outside Blackfriar's Inn"],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"descprefix":["You are"],"enter":[{"_":"\r\n      if (Contains (Outside Blackfriars Inn,Robin Lye)) {\r\n        msg (\"You spot Robin and Jonny dashes over to him, grabbing him by the throat. You hear Jonny explode a stream of obscenities and threats at Robin with such venom that you can see Robin visibly shaking from the shock, but suddenly Jonny releases his grip, clutches his chest and falls to the ground.<br/><br/>Sarah Jackson is here, she dashes over and cradles Jonny's head, his breathing is shallow, \\\"Robin go and phone an ambulance!\\\" Robin dashes back into the pub.<br/><br/>\")\r\n        SetTimeout (8) {\r\n          msg (\"\\\"Jonny, you hang in my lad,\\\"says Sarah \\\"Feels like a fuckin elephants sat on my chest\\\" says Jonny. \\\"Hold on Jon, ambulance will be here soon\\\", you can see Jonny turning pale as the blood drains from his face, \\\"It's no use boss\\\" whispers Jonny, \\\"I'm cold, he weakly grips your hand and with an effort says, \\\"thanks for keeping me in a job boss, I know I'm a moaning git but I enjoyed it really.\\\" \\\"Hold on Jon\\\", but Jon has fallen silent and his lips have turned blue. You shake him but he doesn't stir.<br/><br/>In the distance you can hear approaching sirens. You stare at the weird pendant hanging around Jon's neck, a pattern of three interlocked spirals.<br/><br/>\")\r\n          JS.scrollToEnd ()\r\n        }\r\n        SetTimeout (17) {\r\n          msg (\"**********************************************************************************<br/>Game Over. Thanks for playing. <br/><br/>Press any key for credits.\")\r\n          JS.scrollToEnd ()\r\n          wait {\r\n            msg (\"Credits:<br/><br/>Written and coded by Luke A. Jones (luke.jones@gmail.com), using the Quest text adventure engine (www.textadeventures.co.uk).<br/><br/>Thank you to K.V. for coding help, and answering endless daft questions with patience and politeness.<br/><br/>Thank you to Alex Dimmer for creating the artwork.<br/><br/>Thanks you to Jennifer Thompson, for alpa and beta testing, suggestions for improvements, correcting my grammar, helping with font choices and putting up with the puns.<br/><br/>Thanks also to the excellent support from the Quest forum members.<br/><br/>Thank you to Arun Kamath for providing help with describing Ed's Fender Thundergrunt guitar (originally called something far more profane).<br/><br/>I was in a heavy metal band for 7 years, the characters in this game are inspired by people I met, but not based on anyone in particular.<br/><br/>I have authored four other games which you can find here: http://textadventures.co.uk/user/view/miyjcc_ft0kagw7ynwd4jw/necrodeath<br/><br/>I welcome all (polite) feedback!<br/><br/>Be excellent to each other.<br/><br/>Luke xx<br/>\")\r\n            JS.scrollToEnd ()\r\n            finish\r\n          }\r\n        }\r\n      }\r\n    ","$":{"type":"script"}}],"exit":[{"$":{"alias":"in","to":"Blackfriars Inn"},"inherit":[{"$":{"name":"indirection"}}]},{"$":{"alias":"south","to":"Blackfriars Road"},"inherit":[{"$":{"name":"southdirection"}}]}],"object":[{"$":{"name":"Huge Tour Coach"},"visible":[{"_":"false","$":{"type":"boolean"}}],"look":["A luxury double decker tour coach. It is midnight blue with glitter flaked paint and blacked out windows. It is at least 45 foot in length and dominates the the outside of the inn."],"knockon":[{"_":"\r\n        firsttime {\r\n          msg (\"<br/><br/>You knock on the door of the coach. After a few seconds the door hisses and clunks open and standing there is the drummer from Get Lamp, she introduces herself as Kate. \\\"Would you like to have a look around the coach?\\\" she says, \\\"Hell yeah!\\\" says Jonny.<br/><br/>You are given a tour of the coach and introduced to the rest of the band. The coach has a fully equipped kitchen, bathroom with a shower and toilet, luxurious lounge seating, widescreen TVs, surround sound system, game consoles and Wi-Fi.<br/><br/> On the upper level are a series of separated bedrooms with double beds. You come downstairs again to find Jonny sat in the drivers seat talking to Get Lamp's driver. Jonny looks like a 5 year old who been allowed to stay up late. \\\"We've got to get one of these one day boss!\\\" says Jonny, \\\"Yeah I'll see what I can do\\\" you reply, \\\"Come on, we need to get on\\\". You thank the band and wish them a good gig.<br/><br/>You are Outside the Blackfriar's Inn. \")\r\n        }\r\n        otherwise {\r\n          msg (\"<br/>You contemplate knocking ion the tour bus again, but you've already been given a tour of it and it seems rude to distrub them again.\")\r\n        }\r\n      ","$":{"type":"script"}}],"getinthe":[{"_":"\r\n        firsttime {\r\n          msg (\"<br/><br/>You knock on the door of the coach. After a few seconds the door hisses and clunks open and standing there is the drummer from Get Lamp, she introduces herself as Kate. \\\"Would you like to have a look around the coach?\\\" she says, \\\"Hell yeah!\\\" says Jonny.<br/><br/>You are given a tour of the coach and introduced to the rest of the band. The coach has a fully equipped kitchen, bathroom with a shower and toilet, luxurious lounge seating, widescreen TVs, surround sound system, game consoles and Wi-Fi.<br/><br/> On the upper level are a series of separated bedrooms with double beds. You come downstairs again to find Jonny sat in the drivers seat talking to Get Lamp's driver. Jonny looks like a 5 year old who been allowed to stay up late. \\\"We've got to get one of these one day boss!\\\" says Jonny, \\\"Yeah I'll see what I can do\\\" you reply, \\\"Come on, we need to get on\\\". You thank the band and wish them a good gig.<br/><br/>You are Outside the Blackfriar's Inn. \")\r\n        }\r\n        otherwise {\r\n          msg (\"<br/>You contemplate knocking ion the tour bus again, but you've already been given a tour of it and it seems rude to distrub them again.\")\r\n        }\r\n      ","$":{"type":"script"}}]}],"command":[{"pattern":["smell; sniff"],"script":["\r\n        msg (\"There is no particular scent in the air.\")\r\n      "]}]},{"$":{"name":"vape_holder"},"alias":["vape_holder"],"object":[{"$":{"name":"vape_cartridge"},"take":[""],"feature_usegive":[""],"giveto":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n          msg (\"Sebastian attaches the cartridge to his e-stick and takes a puff.<br/>\")\r\n          mix = NewStringList()\r\n          foreach (f, this.flavors) {\r\n            o = GetObject(f)\r\n            list add (mix, o.flavor)\r\n          }\r\n          flavors = FormatList(mix, \",\",\"and\",\"\")\r\n          msg (\"\\\"Hmm\\\"  says Sebastian, exhaling a huge cloud of vapour.  \\\"An interesting blend. That tastes \"+flavors+\"!\")\r\n          RemoveObject (this)\r\n        ","$":{"key":"KV"}},{"_":"\r\n          RemoveObject (this)\r\n          msg (\"Helen attaches the cartridge to her e-stick and takes a puff.<br/>\")\r\n          if (GetBoolean(this,\"correct_mix\")) {\r\n            if (GetBoolean(Helen Key, \"helen_gotguitar\")) {\r\n              msg (\"\\\"Smooth!!\\\"  Helen takes another puff.  \\\"That hits the spot, thanks!\\\" \\\"Right let's sort out Ed's ego stick then\\\". Helen sets to work on the guitar and it's a joy to watch. Her precision, care and expertise are clear to see. Eventually she is satisfied and hands the guitar back to you and says, \\\"tell Ed he can settle up with me later, I fear it wont be long before I see him in here again.\\\"\")\r\n              AddToInventory (Eds fixed guitar)\r\n              SetObjectFlagOn (Helen Key, \"fixed_guitar\")\r\n            }\r\n            else {\r\n              msg (\"\\\"Smooth!!\\\"  Helen takes another puff.  \\\"That hits the spot, thanks!\\\"\")\r\n            }\r\n          }\r\n          else {\r\n            mix = NewStringList()\r\n            foreach (f, this.flavors) {\r\n              o = GetObject(f)\r\n              list add (mix, o.flavor)\r\n            }\r\n            flavors = FormatList(mix, \",\",\"and\",\"\")\r\n            msg (\"\\\"Yuck!\\\"  she spits.  \\\"What was that?!?  It sure wasn't the mixture I like! That tastes \"+flavors+\"!  I'm looking for something sweet, smokey, and creamy!\")\r\n          }\r\n        ","$":{"key":"Helen Key"}}]}]}]},{"$":{"name":"Eds fixed guitar"},"alias":["Fender thundercunt"],"feature_usegive":[""],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"scenery":[{"_":"false","$":{"type":"boolean"}}],"alt":[{"$":{"type":"stringlist"},"value":["guitar"]}],"look":["A seven string Fender Thudergrunt with a swirl fire finish, equiped with floyd rose bridge and  firebreather pickups. The body is made from mahogany with a flame maple cap, ebony fretboard with steel jumbo frets. Ed calls it 'Lucy'."],"play":[{"_":"\r\n      if (Ed Case.parent = game.pov.parent) {\r\n        msg (\"You attempt to play Ed's guitar, but Ed shouts, \\\"No! Only I get to play with Lucy!\\\"\")\r\n      }\r\n      else {\r\n        msg (\"As Ed isn't watching you strum a few chords on the guitar, it resonates beautifully.\")\r\n      }\r\n    ","$":{"type":"script"}}],"giveto":[{"$":{"type":"scriptdictionary"},"item":[{"_":"\r\n        msg (\"\\\"What the hell!\\\" says Ed, \\\"What's it doing out of its case! Put it back immediately!\\\" he hands it back to you.\")\r\n      ","$":{"key":"Ed Case"}},{"_":"\r\n        msg (\"\\\"I already fixed it!\\\" says Helen.\")\r\n      ","$":{"key":"Helen Key"}}]}]},{"$":{"name":"Pub Ed Case"},"inherit":[{"$":{"name":"namedmale"}}],"alias":["Ed Kayce"],"scenery":[{"_":"false","$":{"type":"boolean"}}],"look":[{"_":"\r\n      if (GetBoolean(Blackfriars Inn, \"gigover\")) {\r\n        if (Contains (Backstage,Kate)) {\r\n          msg (\"The self appointed leader and guitarist of the band. A man so narcissistic he makes Donald Trump look modest. Obsessed with his appearance and image and will never concede an argument. The group has nearly split up several times, and Ed's behaviour is the common denominator.  Though everyone has to admit that he's a damn good musician. He's 6 foot 6 with big muscles; he works out down the gym every other day and never tires of telling you how much he can currently bench press.<br/><br/>He currently appears to be trying to chat up Kate (the drummer from Get Lamp), judging by the look on her face it's not going well.\")\r\n        }\r\n        else {\r\n          msg (\"The self appointed leader and guitarist of the band. A man so narcissistic he makes Donald Trump look modest. Obsessed with his appearance and image and will never concede an argument. The group has nearly split up several times, and Ed's behaviour is the common denominator.  Though everyone has to admit that he's a damn good musician. He's 6 foot 6 with big muscles; he works out down the gym every other day and never tires of telling you how much he can currently bench press.<br/><br/>He's currently doing sit-ups to 'warm down'.\")\r\n        }\r\n      }\r\n      else {\r\n        msg (\"The self appointed leader and guitarist of the band. A man so narcissistic he makes Donald Trump look modest. Obsessed with his appearance and image and will never concede an argument. The group has nearly split up several times, and Ed's behaviour is the common denominator.  Though everyone has to admit that he's a damn good musician. He's 6 foot 6 with big muscles; he works out down the gym every other day and never tires of telling you how much he can currently bench press.<br/><br/>He is currently tuning up one of his seven guitars, and appears to be whispering to it.\")\r\n      }\r\n    ","$":{"type":"script"}}],"speak":[{"_":"\r\n      firsttime {\r\n        this.spokentocount = 0\r\n        this.responses = NewStringList()\r\n        list add (Pub Ed Case.responses, \"\\\"Did you see that amazing solo I pulled off in the last song?\\\" says Ed.\")\r\n        list add (Pub Ed Case.responses, \"\\\"Great gig!\\\" says Ed, \\\"well I was great anyway. Spider and Mac need to get tighter with their playing.\\\"\")\r\n        list add (Pub Ed Case.responses, \"\\\"We really need to get some new band photos taken. My biceps are much bigger these days,\\\" says Ed.\")\r\n      }\r\n      msg (this.responses[this.spokentocount])\r\n      this.spokentocount = this.spokentocount + 1\r\n      if (this.spokentocount > ListCount(this.responses)-1) {\r\n        this.spokentocount = 0\r\n      }\r\n    ","$":{"type":"script"}}]},{"$":{"name":"Outside No Smoke Inn"},"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"descprefix":["You are"],"exit":[{"$":{"alias":"in","to":"No Smoke Inn"},"inherit":[{"$":{"name":"indirection"}}]},{"$":{"alias":"southwest","to":"Brunswick Street"},"inherit":[{"$":{"name":"southwestdirection"}}]}],"command":[{"pattern":["smell; sniff"],"script":["\r\n        msg (\"There is a weird mix of fruit and smokey scents coming fom inside the shop.\")\r\n      "]}]},{"$":{"name":"Outside PMT Music Supplies"},"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"descprefix":["You are"],"exit":[{"$":{"alias":"in","to":"PMT Music Supplies"},"inherit":[{"$":{"name":"indirection"}}]},{"$":{"alias":"south","to":"Industrial Estate"},"inherit":[{"$":{"name":"southdirection"}}]}],"command":[{"pattern":["smell; sniff"],"script":["\r\n        msg (\"There is no particular scent in the air.\")\r\n      "]}]},{"$":{"name":"Outside Vernon Mill Rehearsal Rooms"},"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"descprefix":["You are"],"exit":[{"$":{"alias":"in","to":"Vernon Mill Rehearsal Rooms"},"inherit":[{"$":{"name":"indirection"}}]},{"$":{"alias":"west","to":"Industrial Estate"},"inherit":[{"$":{"name":"westdirection"}}]}],"command":[{"pattern":["smell; sniff"],"script":["\r\n        msg (\"There is no particular scent in the air.\")\r\n      "]}]},{"$":{"name":"Top of the Tree"},"descprefix":["You are in the"],"description":[{"$":{"type":"string"}}],"enter":[{"_":"\r\n      if (not GetBoolean(Jonny, \"bitten\")) {\r\n        if (GetBoolean(Mike Smith, \"mike_told\")) {\r\n          msg (\"You pull yourself up to the top of the tree and wait for Jonny to follow. As he huffs and puffs and pulls himself up he disturbs a squirrel on a lower branch, it jumps up and bites Jonny viciously on the nose and dashes off. \\\"For the love of fuckery!\\\" shouts Jon, \\\"Who'd be me?! And let me guess, no sign of the kitten?\\\" You shake your head.\")\r\n          SetObjectFlagOn (Jonny, \"bitten\")\r\n        }\r\n        else {\r\n          msg (\"You pull yourself up to the top of the tree and wait for Jonny to follow. As he huffs and puffs and pulls himself up he disturbs a squirrel on a lower branch, it jumps up and bites Jonny viciously on the nose and dashes off. \\\"For the love of fuckery!\\\" shouts Jon, \\\"Who'd be me?!\\\" Clutching his nose Jonny stands up on a branch and says, \\\"Well it's a lovey view boss, burt what are we doing up here?\\\"\")\r\n          SetObjectFlagOn (Jonny, \"bitten\")\r\n        }\r\n      }\r\n      else {\r\n        msg (\"You pull yourself up to the top of the tree and wait for Jonny to follow. He huffs and puffs and pulls himself up and looks around,\\\"Well boss, much as I love climbing up and down this tree like a fucking monkey, there's bugger all up here!\\\"\")\r\n      }\r\n    ","$":{"type":"script"}}],"exit":[{"$":{"alias":"down","to":"Brunswick Street"},"inherit":[{"$":{"name":"downdirection"}}]}],"command":[{"pattern":["smell; sniff"],"script":["\r\n        msg (\"There is faint sweet and woody scent coming from the tree.\")\r\n      "]}]},{"$":{"name":"Robin Lye"},"inherit":[{"$":{"name":"namedmale"}}],"scenery":[""]},{"$":{"name":"Outside KFC"},"descprefix":["You are"],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"exit":[{"$":{"alias":"north","to":"Trinity Lane"},"inherit":[{"$":{"name":"northdirection"}}]},{"$":{"alias":"in","to":"KFC"},"inherit":[{"$":{"name":"indirection"}}],"runscript":[""],"script":[{"_":"\r\n        if (Contains (Outside KFC,Van)) {\r\n          DriveThruKFC\r\n        }\r\n        else {\r\n          msg (\"It's drive through only, they won't serve you on foot.\")\r\n        }\r\n      ","$":{"type":"script"}}]}],"command":[{"pattern":["smell; sniff"],"script":["\r\n        msg (\"A very strong smell of fried chicken hangs in the air.\")\r\n      "]}]},{"$":{"name":"Outside Warehouse"},"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"alias":["Outside Cluck You! Warehouse"],"description":["You are outside an enormous industrial warehouse. The stench of ammonia is heavy in the air and you can faintly hear the sound of squawking poultry from within."],"descprefix":["You are"],"firstenter":[{"_":"\r\n      SetObjectFlagOn (Outside Warehouse, \"visited\")\r\n    ","$":{"type":"script"}}],"exit":[{"$":{"alias":"in","to":"Inside Warehouse"},"inherit":[{"$":{"name":"indirection"}}]}],"command":[{"pattern":["smell; sniff"],"script":["\r\n        msg (\"There is a strong smell of amonia in the air, it catches the back of your throat.\")\r\n      "]}]},{"$":{"name":"Inside Warehouse"},"alias":["Inside the Cluck You! Warehouse"],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}],"descprefix":["You are"],"description":["Inside the Cluck You! Warehouse smells even more strongly of ammonia. You are in a reception area. There seems to be a complicated series of metal pipes passing through the ceiling. You can't see where the chickens are, but you can hear the faint sound of the their clucking and squawking."],"exit":[{"$":{"alias":"out","to":"Outside Warehouse"},"inherit":[{"$":{"name":"outdirection"}}]}],"object":[{"$":{"name":"Cluck You Employee"},"inherit":[{"$":{"name":"female"}}],"look":["The Cluck You! employee is wearing a white lab coat, with white trousers tucked into white wellington rubber boots. She is also wearing a white wide brimmed hat with a hairnet underneath.<br/><br/>"],"alias":["Cluck You! Employee"],"speak":[{"_":"\r\n        firsttime {\r\n          msg (\"\\\"Welcome to Cluck You\\\"! says the employee, my name is Rachael. \\\"Hi\\\" says Jonny and hands her the order form from KFC. \\\"Ah\\\" says Rachael, \\\"Hang on a second\\\".<br/><br/>Rachael picks up a phone and talks for a few moments, she interrupts the conversation to say to Jonny, \\\"that your van outside?\\\" Jon nods. Rachael finishes her phone call and says, \\\"Couple of my lads are loading up your van now.\\\" \\\"While you're waiting would you like to feed the chickens?\\\" Jon says, \\\"Yes please!\\\" <br/><br/>Rachael walks you both over to a lever in the back wall and says,\\\"there you go, enjoy! Your van will be loaded now, I've got to get back to the warehouse.\\\" She disappears out the door.\")\r\n          MakeObjectVisible (Huge Lever)\r\n          MoveObject (Box of Chicken, Van)\r\n        }\r\n      ","$":{"type":"script"}}]},{"$":{"name":"Huge Lever"},"visible":[{"_":"false","$":{"type":"boolean"}}],"pull":[{"_":"\r\n        firsttime {\r\n          msg (\"You pull the lever. It makes a loud clunk and resets itself. You hear a gritty whooshing sound pass through the pipes in the ceiling and in the distance an increase in the squawking noise. Jonny looks disappointed. “Come on Jon, let's get out of here.” you say. “Yeah,” says Jonny, “let's split.”<br/>\")\r\n        }\r\n        otherwise {\r\n          msg (\"You pull the lever but nothing happens.\")\r\n        }\r\n      ","$":{"type":"script"}}]}],"command":[{"pattern":["sniff; smell"],"script":["\r\n        msg (\"There is the scent of bleach attempting to cover up the smell of amonia, and its not doing a very god job.\")\r\n      "]}]},{"$":{"name":"Box of Chicken"},"take":[{"_":"false","$":{"type":"boolean"}}],"look":["A large box of chicken pieces. The label on the box reads 144 pieces of prime chicken. Product of  Cluck You! Farms."],"takemsg":["The box is heavy, you decide to leave it in the van."],"drop":[{"_":"false","$":{"type":"boolean"}}]},{"$":{"name":"Instructions From Tony"},"look":["Intructions from Tony, scrawled on the back of a flyer it reads;<br/><br/><i>The Yellow cable belongs in an odd numbered socket.<br/>The Blue cable goes in the socket numbered two higher than where the red cable belongs.<br/>The Red cable belongs in a socket adjacent to where the yellow cable belongs.<br/>The Green cable belongs in one of the sockets on the left where the red cable goes.<br/>The White cable belongs in the socket as far away from the green cable socket as possible</i>.<br/>"],"alias":["Stage Monitor Instructions"],"take":[""],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}]}],"turnscript":[{"enabled":[""],"script":["\r\n      if (GetInt(Blackfriars Inn, \"tasks\") = 6) {\r\n        MakeObjectVisible (Huge Tour Coach)\r\n      }\r\n    "]}],"type":[{"$":{"name":"defaultgame"},"enablehyperlinks":[""],"echocommand":[""],"echohyperlinks":[""],"showdescriptiononenter":[""],"autodescription":[""],"defaultfont":["Georgia, serif"],"defaultfontsize":[{"_":"12","$":{"type":"int"}}],"defaultbackground":["White"],"defaultforeground":["Black"],"defaultlinkforeground":["Blue"],"backgroundimage":[{"$":{"type":"string"}}],"setbackgroundopacity":[{"_":"false","$":{"type":"boolean"}}],"backgroundopacity":[{"_":"0.5","$":{"type":"double"}}],"menufont":["Arial"],"menufontsize":[{"_":"9","$":{"type":"int"}}],"menubackground":["White"],"menuforeground":["Black"],"menuhoverbackground":["LightGrey"],"menuhoverforeground":["Black"],"underlinehyperlinks":[""],"compassdirections":[{"$":{"type":"stringlist"},"value":["northwest","north","northeast","west","east","southwest","south","southeast","up","down","in","out"]}],"clearframe":[""],"timeelapsed":[{"_":"0","$":{"type":"int"}}],"appendobjectdescription":[{"_":"false","$":{"type":"boolean"}}],"allobjects":[{"$":{"type":"stringlist"},"value":["all","everything"]}],"parserignoreprefixes":[{"$":{"type":"stringlist"},"value":["the","a","an"]}],"displayroomdescriptiononstart":[""],"showpanes":[""],"showcommandbar":[""],"showlocation":[""],"statusandcompassattop":[{"_":"false","$":{"type":"boolean"}}],"turnoffcompass":[{"_":"false","$":{"type":"boolean"}}],"turnoffinventory":[{"_":"false","$":{"type":"boolean"}}],"turnoffplacesandobjects":[{"_":"false","$":{"type":"boolean"}}],"borderlesscursor":[{"_":"false","$":{"type":"boolean"}}],"colourblend":[{"_":"false","$":{"type":"boolean"}}],"commandpane":[{"_":"false","$":{"type":"boolean"}}],"customstatuspane":[{"_":"false","$":{"type":"boolean"}}],"panestheme":["Classic"],"shadowbox":[{"_":"false","$":{"type":"boolean"}}],"respondtogridclicks":[{"_":"false","$":{"type":"boolean"}}],"commandcursor":[">"],"moneyformat":["$!"],"classiclocation":[""],"turnoffsavebutton":[{"_":"false","$":{"type":"boolean"}}],"mapexitwidth":[{"_":"1","$":{"type":"int"}}],"mapexitcolour":["Black"],"setcustomwidth":[{"_":"false","$":{"type":"boolean"}}],"customwidth":[{"_":"950","$":{"type":"int"}}],"setcustompadding":[{"_":"false","$":{"type":"boolean"}}],"custompaddingtop":[{"_":"30","$":{"type":"int"}}],"custompaddingbottom":[{"_":"0","$":{"type":"int"}}],"custompaddingleft":[{"_":"20","$":{"type":"int"}}],"custompaddingright":[{"_":"20","$":{"type":"int"}}],"showborder":[""],"showscore":[{"_":"false","$":{"type":"boolean"}}],"showhealth":[{"_":"false","$":{"type":"boolean"}}],"showmoney":[{"_":"false","$":{"type":"boolean"}}],"showtitle":[""],"autodisplayverbs":[""],"clearscreenonroomenter":[{"_":"false","$":{"type":"boolean"}}],"attr":[{"_":"1","$":{"name":"autodescription_youarein","type":"int"}},{"_":"2","$":{"name":"autodescription_youcansee","type":"int"}},{"_":"3","$":{"name":"autodescription_youcango","type":"int"}},{"_":"4","$":{"name":"autodescription_description","type":"int"}},{"_":"false","$":{"name":"autodescription_youarein_newline","type":"boolean"}},{"_":"false","$":{"name":"autodescription_youcansee_newline","type":"boolean"}},{"_":"false","$":{"name":"autodescription_youcango_newline","type":"boolean"}},{"_":"false","$":{"name":"autodescription_description_newline","type":"boolean"}},{"_":"false","$":{"name":"command_newline","type":"boolean"}},{"_":"false","$":{"name":"feature_lightdark","type":"boolean"}},{"_":"false","$":{"name":"feature_pictureframe","type":"boolean"}},{"_":"false","$":{"name":"feature_limitinventory","type":"boolean"}},{"_":"false","$":{"name":"feature_asktell","type":"boolean"}},{"_":"false","$":{"name":"feature_annotations","type":"boolean"}},{"_":"false","$":{"name":"feature_advancedwearables","type":"boolean"}},{"_":"false","$":{"name":"feature_advancedscripts","type":"boolean"}}],"autodescription_youarein_useprefix":[""],"changeroom_newline":[""],"description":[{"$":{"type":"string"}}],"languageid":["en"],"gridmap":[{"_":"false","$":{"type":"boolean"}}],"mapscale":[{"_":"30","$":{"type":"int"}}],"mapsize":[{"_":"300","$":{"type":"int"}}],"deactivatecommandlinks":[{"_":"false","$":{"type":"boolean"}}],"multiplecommands":[{"_":"false","$":{"type":"boolean"}}],"publishfileextensions":["*.jpg;*.jpeg;*.png;*.gif;*.js;*.wav;*.mp3;*.htm;*.html;*.svg"],"changedpov":[{"_":"\r\n      InitPOV (oldvalue, game.pov)\r\n    ","$":{"type":"script"}}]},{"$":{"name":"theme_novella"},"setcustompadding":[""],"showborder":[{"_":"false","$":{"type":"boolean"}}],"showpanes":[{"_":"false","$":{"type":"boolean"}}],"showlocation":[{"_":"false","$":{"type":"boolean"}}],"setcustomwidth":[""],"customwidth":[{"_":"650","$":{"type":"int"}}],"custompaddingtop":[{"_":"60","$":{"type":"int"}}]},{"$":{"name":"theme_retro"},"defaultbackground":["Black"],"defaultforeground":["White"],"defaultlinkforeground":["White"],"defaultfont":["'Lucida Console', Monaco, monospace"],"defaultwebfont":["Press Start 2P"],"menufontsize":[{"_":"14","$":{"type":"int"}}],"menufont":["'Lucida Console', Monaco, monospace"],"menubackground":["Black"],"menuforeground":["White"],"menuhoverbackground":["GreenYellow"]},{"$":{"name":"theme_typewriter"},"setcustompadding":[""],"showborder":[{"_":"false","$":{"type":"boolean"}}],"showpanes":[{"_":"false","$":{"type":"boolean"}}],"showlocation":[{"_":"false","$":{"type":"boolean"}}],"setcustomwidth":[""],"customwidth":[{"_":"650","$":{"type":"int"}}],"custompaddingtop":[{"_":"60","$":{"type":"int"}}],"defaultfont":["'Courier New', Courier, monospace"],"defaultwebfont":["Special Elite"]},{"$":{"name":"theme_hotdogstand"},"defaultbackground":["Red"],"defaultforeground":["Yellow"],"defaultlinkforeground":["Yellow"],"defaultfont":["'Comic Sans MS', cursive, sans-serif"],"menufontsize":[{"_":"14","$":{"type":"int"}}],"menufont":["Impact, Charcoal, sans-serif"],"menubackground":["Red"],"menuforeground":["Yellow"],"menuhoverbackground":["Black"],"menuhoverforeground":["Yellow"]},{"$":{"name":"defaultobject"},"visible":[""],"displayverbs":[{"$":{"type":"stringlist"},"value":["Look at","Take"]}],"inventoryverbs":[{"$":{"type":"stringlist"},"value":["Look at","Use","Drop"]}],"take":[{"_":"false","$":{"type":"boolean"}}],"use":[{"_":"false","$":{"type":"boolean"}}],"givesingle":[{"_":"false","$":{"type":"boolean"}}],"drop":[""],"gender":["it"],"article":["it"],"possessive":["its"],"isopen":[{"_":"false","$":{"type":"boolean"}}],"open":[{"_":"false","$":{"type":"boolean"}}],"close":[{"_":"false","$":{"type":"boolean"}}],"container":[{"_":"false","$":{"type":"boolean"}}],"descprefix":["You are in"],"objectslistprefix":["You can see"],"exitslistprefix":["You can go"],"contentsprefix":["containing"],"description":[{"$":{"type":"string"}}],"attr":[{"$":{"name":"implementation_notes","type":"string"}},{"_":"1","$":{"name":"grid_width","type":"int"}},{"_":"1","$":{"name":"grid_length","type":"int"}},{"_":"White","$":{"name":"grid_fill"}},{"_":"Black","$":{"name":"grid_border"}},{"_":"1","$":{"name":"grid_borderwidth","type":"int"}},{"_":"15","$":{"name":"grid_bordersides","type":"int"}},{"_":"false","$":{"name":"grid_render","type":"boolean"}},{"$":{"name":"grid_label","type":"string"}},{"_":"Black","$":{"name":"grid_label_colour"}},{"_":"0","$":{"name":"grid_parent_offset_x","type":"int"}},{"_":"0","$":{"name":"grid_parent_offset_y","type":"int"}},{"_":"me","$":{"name":"pov_alias"}},{"_":"Looking good.","$":{"name":"pov_look"}},{"_":"you","$":{"name":"pov_gender"}},{"_":"yourself","$":{"name":"pov_article"}},{"_":"your","$":{"name":"pov_possessive"}},{"_":"false","$":{"name":"feature_usegive","type":"boolean"}},{"_":"false","$":{"name":"feature_container","type":"boolean"}},{"_":"false","$":{"name":"feature_switchable","type":"boolean"}},{"_":"false","$":{"name":"feature_edible","type":"boolean"}},{"_":"false","$":{"name":"feature_player","type":"boolean"}},{"_":"false","$":{"name":"feature_lightdark","type":"boolean"}}],"scenery":[{"_":"false","$":{"type":"boolean"}}],"hidechildren":[{"_":"false","$":{"type":"boolean"}}],"listchildren":[{"_":"false","$":{"type":"boolean"}}],"usedefaultprefix":[""],"volume":[{"_":"0","$":{"type":"int"}}],"price":[{"_":"0","$":{"type":"int"}}],"dark":[{"_":"false","$":{"type":"boolean"}}],"lightstrength":[{"$":{"type":"string"}}],"darklevel":[{"_":"false","$":{"type":"boolean"}}],"grid_parent_offset_auto":[""],"pov_alt":[{"$":{"type":"stringlist"},"value":["me","myself","self"]}],"visited":[{"_":"false","$":{"type":"boolean"}}],"hasbeenmoved":[{"_":"false","$":{"type":"boolean"}}],"changedparent":[{"_":"\r\n      if (game.pov = this) {\r\n        if (IsDefined(\"oldvalue\")) {\r\n          OnEnterRoom (oldvalue)\r\n        }\r\n        else {\r\n          OnEnterRoom (null)\r\n        }\r\n        if (game.gridmap) {\r\n          MergePOVCoordinates\r\n        }\r\n      }\r\n      this.hasbeenmoved = true\r\n    ","$":{"type":"script"}}],"changedisopen":[{"_":"\r\n      if (this.isopen and HasScript(this, \"onopen\")) {\r\n        do (this, \"onopen\")\r\n      }\r\n      if (not this.isopen and HasScript(this, \"onclose\")) {\r\n        do (this, \"onclose\")\r\n      }\r\n    ","$":{"type":"script"}}],"changedlocked":[{"_":"\r\n      if (this.locked and HasScript(this, \"onlock\")) {\r\n        do (this, \"onlock\")\r\n      }\r\n      if (not this.locked and HasScript(this, \"onunlock\")) {\r\n        do (this, \"onunlock\")\r\n      }\r\n    ","$":{"type":"script"}}],"changedswitchedon":[{"_":"\r\n      if (this.switchedon and HasScript(this, \"onswitchon\")) {\r\n        do (this, \"onswitchon\")\r\n      }\r\n      if (not this.switchedon and HasScript(this, \"onswitchoff\")) {\r\n        do (this, \"onswitchoff\")\r\n      }\r\n    ","$":{"type":"script"}}]},{"$":{"name":"defaultexit"},"displayverbs":[{"$":{"type":"stringlist"},"value":["Go to"]}],"visible":[""],"scenery":[{"_":"false","$":{"type":"boolean"}}],"locked":[{"_":"false","$":{"type":"boolean"}}],"lockmessage":["That way is locked."],"lookonly":[{"_":"false","$":{"type":"boolean"}}],"runscript":[{"_":"false","$":{"type":"boolean"}}],"lightstrength":[{"$":{"type":"string"}}],"attr":[{"_":"1","$":{"name":"grid_length","type":"int"}},{"_":"false","$":{"name":"grid_render","type":"boolean"}},{"_":"0","$":{"name":"grid_offset_x","type":"int"}},{"_":"0","$":{"name":"grid_offset_y","type":"int"}}]},{"$":{"name":"direction"},"displayverbs":[{"$":{"type":"stringlist"},"value":["Go"]}]},{"$":{"name":"compassdirection"},"inherit":[{"$":{"name":"direction"}}],"prefix":[{"$":{"type":"string"}}],"suffix":[{"$":{"type":"string"}}]},{"$":{"name":"updowndirection"},"inherit":[{"$":{"name":"direction"}}],"prefix":[{"$":{"type":"string"}}],"suffix":[{"$":{"type":"string"}}]},{"$":{"name":"inoutdirection"},"inherit":[{"$":{"name":"direction"}}],"prefix":[{"$":{"type":"string"}}],"suffix":[{"$":{"type":"string"}}]},{"$":{"name":"northwestdirection"},"inherit":[{"$":{"name":"compassdirection"}}],"alias":["northwest"],"alt":[{"$":{"type":"stringlist"},"value":["nw"]}]},{"$":{"name":"northdirection"},"inherit":[{"$":{"name":"compassdirection"}}],"alias":["north"],"alt":[{"$":{"type":"stringlist"},"value":["n"]}]},{"$":{"name":"northeastdirection"},"inherit":[{"$":{"name":"compassdirection"}}],"alias":["northeast"],"alt":[{"$":{"type":"stringlist"},"value":["ne"]}]},{"$":{"name":"westdirection"},"inherit":[{"$":{"name":"compassdirection"}}],"alias":["west"],"alt":[{"$":{"type":"stringlist"},"value":["w"]}]},{"$":{"name":"eastdirection"},"inherit":[{"$":{"name":"compassdirection"}}],"alias":["east"],"alt":[{"$":{"type":"stringlist"},"value":["e"]}]},{"$":{"name":"southwestdirection"},"inherit":[{"$":{"name":"compassdirection"}}],"alias":["southwest"],"alt":[{"$":{"type":"stringlist"},"value":["sw"]}]},{"$":{"name":"southdirection"},"inherit":[{"$":{"name":"compassdirection"}}],"alias":["south"],"alt":[{"$":{"type":"stringlist"},"value":["s"]}]},{"$":{"name":"southeastdirection"},"inherit":[{"$":{"name":"compassdirection"}}],"alias":["southeast"],"alt":[{"$":{"type":"stringlist"},"value":["se"]}]},{"$":{"name":"updirection"},"inherit":[{"$":{"name":"updowndirection"}}],"alias":["up"],"alt":[{"$":{"type":"stringlist"},"value":["u"]}]},{"$":{"name":"downdirection"},"inherit":[{"$":{"name":"updowndirection"}}],"alias":["down"],"alt":[{"$":{"type":"stringlist"},"value":["d"]}]},{"$":{"name":"indirection"},"inherit":[{"$":{"name":"inoutdirection"}}],"alias":["in"],"alt":[{"$":{"type":"stringlist"},"value":[""]}]},{"$":{"name":"outdirection"},"inherit":[{"$":{"name":"inoutdirection"}}],"alias":["out"],"alt":[{"$":{"type":"stringlist"},"value":["o"]}]},{"$":{"name":"defaultcommand"},"pattern":[{"$":{"type":"simplepattern"}}]},{"$":{"name":"defaultverb"},"separator":["with; using"],"multiobjectmenu":["With which object?"],"multiobjectdefault":["That doesn't work."],"multiobjectmenuempty":["There are no objects available to do that with."],"script":[{"_":"\r\n      if (not IsDefined(\"object2\")) {\r\n        object2 = null\r\n      }\r\n      switch (TypeOf(object, this.property)) {\r\n        case (\"script\") {\r\n          if (object2 = null) {\r\n            do (object, this.property)\r\n          }\r\n          else {\r\n            msg (this.multiobjectdefault)\r\n          }\r\n        }\r\n        case (\"string\") {\r\n          if (object2 = null) {\r\n            msg (GetString(object, this.property))\r\n          }\r\n          else {\r\n            msg (this.multiobjectdefault)\r\n          }\r\n        }\r\n        case (\"scriptdictionary\") {\r\n          if (object2 <> null) {\r\n            HandleMultiVerb (object, this.property, object2, this.multiobjectdefault)\r\n          }\r\n          else {\r\n            objectlist = ListCombine (ScopeReachableInventory(), ScopeReachableNotHeld())\r\n            excludelist = NewObjectList()\r\n            list add (excludelist, game.pov)\r\n            list add (excludelist, object)\r\n            candidates = ListExclude(RemoveSceneryObjects(objectlist), excludelist)\r\n            if (ListCount(candidates) = 0) {\r\n              msg (this.multiobjectmenuempty)\r\n            }\r\n            else {\r\n              game.pov.multiverb = this.property\r\n              game.pov.multiverbobject = object\r\n              game.pov.multiverbobjectdefault = this.multiobjectdefault\r\n              ShowMenu (this.multiobjectmenu, candidates, true) {\r\n                if (result <> null) {\r\n                  HandleMultiVerb (game.pov.multiverbobject, game.pov.multiverb, GetObject(result), game.pov.multiverbobjectdefault)\r\n                  game.pov.multiverb = null\r\n                  game.pov.multiverbobject = null\r\n                  game.pov.multiverbobjectdefault = null\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n        case (\"null\") {\r\n          if (this.defaulttext <> null) {\r\n            msg (this.defaulttext)\r\n          }\r\n          else if (this.defaulttemplate <> null) {\r\n            msg (DynamicTemplate(this.defaulttemplate, object))\r\n          }\r\n          else if (this.defaultexpression <> null) {\r\n            params = NewDictionary()\r\n            dictionary add (params, \"object\", object)\r\n            msg (Eval(this.defaultexpression, params))\r\n          }\r\n          else {\r\n            error (\"No verb response defined\")\r\n          }\r\n        }\r\n        default {\r\n          error (\"No verb response defined\")\r\n        }\r\n      }\r\n    ","$":{"type":"script"}}]},{"$":{"name":"npc_type"},"displayverbs":[{"$":{"type":"stringlist"},"value":["Look at","Speak to"]}]},{"$":{"name":"male"},"inherit":[{"$":{"name":"npc_type"}}],"gender":["he"],"article":["him"],"possessive":["his"]},{"$":{"name":"namedmale"},"inherit":[{"$":{"name":"male"}}],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}]},{"$":{"name":"female"},"inherit":[{"$":{"name":"npc_type"}}],"displayverbs":[{"$":{"type":"stringlist"},"value":["Look at","Speak to"]}],"gender":["she"],"article":["her"],"possessive":["her"]},{"$":{"name":"namedfemale"},"inherit":[{"$":{"name":"female"}}],"usedefaultprefix":[{"_":"false","$":{"type":"boolean"}}]},{"$":{"name":"plural"},"gender":["they"],"article":["them"],"possessive":["their"]},{"$":{"name":"maleplural"},"displayverbs":[{"$":{"type":"stringlist"},"value":["Look at","Speak to"]}],"gender":["they"],"article":["them"],"possessive":["their"]},{"$":{"name":"femaleplural"},"displayverbs":[{"$":{"type":"stringlist"},"value":["Look at","Speak to"]}],"gender":["they"],"article":["them"],"possessive":["their"]},{"$":{"name":"openable"},"open":[""],"close":[""],"displayverbs":[{"$":{"type":"stringlist"},"value":["Open","Close"]}],"inventoryverbs":[{"$":{"type":"stringlist"},"value":["Open","Close"]}]},{"$":{"name":"container_base"},"container":[""]},{"$":{"name":"container_closed"},"inherit":[{"$":{"name":"container_base"}}],"open":[""],"close":[""],"displayverbs":[{"$":{"type":"stringlist"},"value":["Open","Close"]}],"inventoryverbs":[{"$":{"type":"stringlist"},"value":["Open","Close"]}]},{"$":{"name":"container_open"},"inherit":[{"$":{"name":"container_base"}}],"isopen":[""],"open":[""],"close":[""],"displayverbs":[{"$":{"type":"stringlist"},"value":["Open","Close"]}],"inventoryverbs":[{"$":{"type":"stringlist"},"value":["Open","Close"]}]},{"$":{"name":"surface"},"inherit":[{"$":{"name":"container_base"}}],"isopen":[""],"transparent":[""],"contentsprefix":["on which there is"]},{"$":{"name":"container"},"inherit":[{"$":{"name":"container_open"}}],"displayverbs":[{"$":{"type":"stringlist"},"value":["Open","Close"]}],"inventoryverbs":[{"$":{"type":"stringlist"},"value":["Open","Close"]}]},{"$":{"name":"container_limited"},"inherit":[{"$":{"name":"container"}}],"maxobjects":[{"_":"1","$":{"type":"int"}}],"maxvolume":[{"_":"100","$":{"type":"int"}}],"addscript":[{"_":"\r\n      activecontainer = this\r\n      correct = true\r\n      while (DoesInherit(activecontainer, \"container_base\")) {\r\n        if (HasInt(activecontainer, \"maxvolume\")) {\r\n          if (GetVolume(object, true) + GetVolume(activecontainer, false) > activecontainer.maxvolume) {\r\n            correct = false\r\n            if (HasString(this, \"containerfullmessage\")) {\r\n              message = this.containerfullmessage\r\n            }\r\n            else {\r\n              message = DynamicTemplate(\"ContainerFull\", this)\r\n            }\r\n          }\r\n        }\r\n        activecontainer = activecontainer.parent\r\n      }\r\n      children = GetDirectChildren(this)\r\n      if (listcount(children) >= this.maxobjects) {\r\n        correct = false\r\n        if (HasString(this, \"containermaxobjects\")) {\r\n          message = this.containermaxobjects\r\n        }\r\n        else {\r\n          message = DynamicTemplate(\"MaxObjectsInContainer\", this)\r\n        }\r\n      }\r\n      if (correct = false) {\r\n        msg (message)\r\n      }\r\n      else {\r\n        if (HasScript(object, \"drop\")) {\r\n          params = NewDictionary()\r\n          dictionary add (params, \"destination\", this)\r\n          do (object, \"drop\", params)\r\n        }\r\n        else {\r\n          object.parent = this\r\n          msg (Template(\"Done\"))\r\n        }\r\n      }\r\n    ","$":{"type":"script"}}],"displayverbs":[{"$":{"type":"stringlist"},"value":["Open","Close"]}],"inventoryverbs":[{"$":{"type":"stringlist"},"value":["Open","Close"]}]},{"$":{"name":"container_lockable"},"locked":[""],"nokeymessage":["You do not have the key."],"unlockmessage":["Unlocked."],"lockmessage":["Locked."],"canlockopen":[{"_":"false","$":{"type":"boolean"}}],"autoopen":[""],"autounlock":[""],"openscript":[{"_":"\r\n      if (this.locked) {\r\n        if (this.autounlock and AllKeysAvailable(this)) {\r\n          do (this, \"unlock\")\r\n          if (not this.isopen) {\r\n            OpenObject (this)\r\n          }\r\n        }\r\n        else {\r\n          msg (DynamicTemplate(\"LockedObject\", this))\r\n        }\r\n      }\r\n      else {\r\n        OpenObject (this)\r\n      }\r\n    ","$":{"type":"script"}}],"closescript":[{"_":"\r\n      if (this.locked) {\r\n        msg (DynamicTemplate(\"LockedObject\", this))\r\n      }\r\n      else {\r\n        CloseObject (this)\r\n      }\r\n    ","$":{"type":"script"}}],"lock":[{"_":"\r\n      if (this.locked) {\r\n        msg (DynamicTemplate(\"AlreadyLocked\", this))\r\n      }\r\n      else if (this.isopen and not this.canlockopen) {\r\n        msg (DynamicTemplate(\"CannotLockOpen\", this))\r\n      }\r\n      else {\r\n        if (AllKeysAvailable(this)) {\r\n          msg (this.lockmessage)\r\n          this.locked = true\r\n        }\r\n        else {\r\n          msg (this.nokeymessage)\r\n        }\r\n      }\r\n    ","$":{"type":"script"}}],"unlock":[{"_":"\r\n      if (not this.locked) {\r\n        msg (DynamicTemplate(\"AlreadyUnlocked\", this))\r\n      }\r\n      else {\r\n        if (AllKeysAvailable(this)) {\r\n          msg (this.unlockmessage)\r\n          this.locked = false\r\n          if (this.autoopen and not this.isopen) {\r\n            TryOpenClose (true, this)\r\n          }\r\n        }\r\n        else {\r\n          msg (this.nokeymessage)\r\n        }\r\n      }\r\n    ","$":{"type":"script"}}]},{"$":{"name":"defaultplayer"},"money":[{"_":"0","$":{"type":"int"}}]},{"$":{"name":"switchable"},"switchedon":[{"_":"false","$":{"type":"boolean"}}],"cannotswitchon":[{"$":{"type":"string"}}],"turnon":[{"_":"\r\n      if (ListContains(ScopeReachable(), this)) {\r\n        if (this.switchedon) {\r\n          msg (DynamicTemplate(\"AlreadySwitchedOn\", this))\r\n        }\r\n        else if (not this.cannotswitchon = \"\") {\r\n          msg (this.cannotswitchon)\r\n        }\r\n        else {\r\n          if (HasString(this, \"switchonmsg\")) {\r\n            msg (this.switchonmsg)\r\n          }\r\n          else {\r\n            msg (DynamicTemplate(\"SwitchedOn\", this))\r\n          }\r\n          this.switchedon = true\r\n        }\r\n      }\r\n      else {\r\n        msg (DynamicTemplate(\"DefaultTurnOn\", this))\r\n      }\r\n    ","$":{"type":"script"}}],"turnoff":[{"_":"\r\n      if (ListContains(ScopeReachable(), this)) {\r\n        if (not this.switchedon) {\r\n          msg (DynamicTemplate(\"AlreadySwitchedOff\", this))\r\n        }\r\n        else {\r\n          if (HasString(this, \"switchoffmsg\")) {\r\n            msg (this.switchoffmsg)\r\n          }\r\n          else {\r\n            msg (DynamicTemplate(\"SwitchedOff\", this))\r\n          }\r\n          this.switchedon = false\r\n        }\r\n      }\r\n      else {\r\n        msg (DynamicTemplate(\"DefaultTurnOff\", this))\r\n      }\r\n    ","$":{"type":"script"}}],"displayverbs":[{"$":{"type":"stringlist"},"value":["Switch on","Switch off"]}],"inventoryverbs":[{"$":{"type":"stringlist"},"value":["Switch on","Switch off"]}]},{"$":{"name":"edible"},"eathealth":[{"_":"0","$":{"type":"int"}}],"eat":[{"_":"\r\n      if (HasString(this, \"eatmsg\")) {\r\n        msg (this.eatmsg)\r\n      }\r\n      else {\r\n        msg (DynamicTemplate(\"Eaten\", this))\r\n      }\r\n      if (HasInt(game.pov, \"health\")) {\r\n        game.pov.health = game.pov.health + this.eathealth\r\n      }\r\n      destroy (this.name)\r\n    ","$":{"type":"script"}}],"displayverbs":[{"$":{"type":"stringlist"},"value":["Eat"]}],"inventoryverbs":[{"$":{"type":"stringlist"},"value":["Eat"]}]},{"$":{"name":"gridborder_path_ew"},"attr":[{"_":"10","$":{"name":"grid_bordersides","type":"int"}}]},{"$":{"name":"gridborder_path_e"},"attr":[{"_":"11","$":{"name":"grid_bordersides","type":"int"}}]},{"$":{"name":"gridborder_path_w"},"attr":[{"_":"14","$":{"name":"grid_bordersides","type":"int"}}]},{"$":{"name":"gridborder_path_ns"},"attr":[{"_":"5","$":{"name":"grid_bordersides","type":"int"}}]},{"$":{"name":"gridborder_path_n"},"attr":[{"_":"7","$":{"name":"grid_bordersides","type":"int"}}]},{"$":{"name":"gridborder_path_s"},"attr":[{"_":"13","$":{"name":"grid_bordersides","type":"int"}}]},{"$":{"name":"wearable"},"usestandardverblist":[""],"worn":[{"_":"false","$":{"type":"boolean"}}],"armour":[{"_":"0","$":{"type":"int"}}],"attr":[{"_":"0","$":{"name":"multistate_status","type":"int"}},{"_":"2","$":{"name":"wear_layer","type":"int"}}],"invverbs":[{"$":{"type":"string"}}],"wornverbs":[{"$":{"type":"string"}}],"removeable":[""],"wear_slots":[{"$":{"type":"stringlist"}}],"take":[{"_":"\r\n      msg (DynamicTemplate(\"TakeSuccessful\", this))\r\n      this.parent = game.pov\r\n      SetVerbs\r\n    ","$":{"type":"script"}}],"colourmylistalias":[{"_":"\r\n      if (HasString(this, \"alias\")) {\r\n        s = CapFirst(this.alias)\r\n      }\r\n      else {\r\n        s = CapFirst(this.name)\r\n      }\r\n      if (HasString(this, \"listalias\")) {\r\n        s = this.listalias\r\n      }\r\n      this.listalias = \"<span style=\\\"color:blue\\\">\" + s + \"</span>\"\r\n    ","$":{"type":"script"}}],"inventoryverbs":[{"$":{"type":"stringlist"},"value":["Wear","Remove"]}]},{"$":{"name":"vape_button"},"takemsg":["It's part of the machine."],"scenery":[""],"displayverbs":[{"$":{"type":"stringlist"},"value":["Look at","Press"]}],"feature_startscript":[""],"press":[{"_":"\r\n      msg (\"You have selected \"+this.alias+\".\")\r\n      SelectFlavor (this.alias)\r\n    ","$":{"type":"script"}}],"push":[{"_":"\r\n      do (this, \"press\")\r\n    ","$":{"type":"script"}}],"look":[{"_":"\r\n      msg (\"Flavor Type: \"+this.flavor)\r\n    ","$":{"type":"script"}}],"attr":[{"_":"\r\n      this.alt = Split(this.alias + \" button\",\";\")\r\n    ","$":{"name":"_initialise_","type":"script"}}]}],"function":[{"_":"\r\n    if (Instr(\"aeiou\", LCase(Left(GetDisplayAlias(obj), 1))) > 0) {\r\n      return (\"an\")\r\n    }\r\n    else {\r\n      return (\"a\")\r\n    }\r\n  ","$":{"name":"GetDefaultPrefix","parameters":"obj","type":"string"}},{"_":"\r\n    return (CapFirst(obj.gender) + \" \" + Conjugate(obj, verb))\r\n  ","$":{"name":"WriteVerb","parameters":"obj, verb","type":"string"}},{"_":"\r\n    gender = obj.gender\r\n    if (gender = \"he\" or gender = \"she\") {\r\n      gender = \"it\"\r\n    }\r\n    switch (verb) {\r\n      case (\"be\") {\r\n        switch (gender) {\r\n          case (\"i\") {\r\n            return (\"am\")\r\n          }\r\n          case (\"you\") {\r\n            return (\"are\")\r\n          }\r\n          case (\"it\") {\r\n            return (\"is\")\r\n          }\r\n          case (\"we\") {\r\n            return (\"are\")\r\n          }\r\n          case (\"they\") {\r\n            return (\"are\")\r\n          }\r\n          default {\r\n            return (\"is\")\r\n          }\r\n        }\r\n      }\r\n      case (\"do\") {\r\n        switch (gender) {\r\n          case (\"i\") {\r\n            return (\"do\")\r\n          }\r\n          case (\"you\") {\r\n            return (\"do\")\r\n          }\r\n          case (\"it\") {\r\n            return (\"does\")\r\n          }\r\n          case (\"we\") {\r\n            return (\"do\")\r\n          }\r\n          case (\"they\") {\r\n            return (\"do\")\r\n          }\r\n          default {\r\n            return (\"do\")\r\n          }\r\n        }\r\n      }\r\n      default {\r\n        if (gender = \"it\") {\r\n          return (verb + \"s\")\r\n        }\r\n        else {\r\n          return (verb)\r\n        }\r\n      }\r\n    }\r\n  ","$":{"name":"Conjugate","parameters":"obj, verb","type":"string"}},{"_":"\r\n    if (not TypeOf(number) = \"int\") {\r\n      error (\"ToWords can only handle ints\")\r\n    }\r\n    number_units = Split(\"zero;one;two;three;four;five;six;seven;eight;nine;ten;eleven;twelve;thirteen;fourteen;fifteen;sixteen;seventeen;eighteen;nineteen;twenty\", \";\")\r\n    number_tens = Split(\"twenty;thirty;forty;fifty;sixty;seventy;eighty;ninety\", \";\")\r\n    s = \"\"\r\n    if (number < 0) {\r\n      s = \"minus \"\r\n      number = -number\r\n    }\r\n    if (number < 2000) {\r\n      hundreds = number / 100\r\n      number = number % 100\r\n      if (hundreds > 0) {\r\n        s = s + StringListItem(number_units, hundreds) + \" hundred \"\r\n        if (number > 0) {\r\n          s = s + \"and \"\r\n        }\r\n      }\r\n      if (number < 20) {\r\n        if (not number = 0 or s = \"\") {\r\n          s = s + StringListItem(number_units, number)\r\n        }\r\n      }\r\n      else {\r\n        units = number % 10\r\n        tens = (number / 10) % 10\r\n        s = s + StringListItem(number_tens, tens - 2)\r\n        if (not units = 0) {\r\n          s = s + StringListItem(number_units, units)\r\n        }\r\n      }\r\n    }\r\n    else {\r\n      s = ToString(number)\r\n    }\r\n    return (Trim(s))\r\n  ","$":{"name":"ToWords","parameters":"number","type":"string"}},{"_":"\r\n    if ((GetBoolean(object, \"isopen\") or GetBoolean(object, \"transparent\")) and GetBoolean(object, \"listchildren\")) {\r\n      if (GetBoolean(object, \"hidechildren\")) {\r\n        object.hidechildren = false\r\n      }\r\n      if (HasString(object, \"listchildrenprefix\")) {\r\n        listprefix = object.listchildrenprefix\r\n      }\r\n      else {\r\n        listprefix = DynamicTemplate(\"ObjectContains\", object)\r\n      }\r\n      list = FormatObjectList(listprefix, object, Template(\"And\"), \".\")\r\n      if (list <> \"\") {\r\n        msg (list)\r\n      }\r\n    }\r\n  ","$":{"name":"ListObjectContents","parameters":"object"}},{"_":"\r\n    prefix = \"\"\r\n    if (ismultiple) {\r\n      prefix = GetDisplayAlias(object) + \": \"\r\n    }\r\n    if (object.parent = game.pov) {\r\n      msg (prefix + DynamicTemplate(\"AlreadyTaken\", object))\r\n    }\r\n    else if (not ListContains(ScopeReachable(), object)) {\r\n      msg (prefix + DynamicTemplate(\"ObjectNotOpen\", GetBlockingObject(object)))\r\n    }\r\n    else {\r\n      volume = 0\r\n      continue = true\r\n      foreach (obj, GetAllChildObjects(game.pov)) {\r\n        if (HasInt(obj, \"volume\")) {\r\n          volume = volume + obj.volume\r\n        }\r\n      }\r\n      if (not Contains(game.pov, object)) {\r\n        volume = volume + GetVolume(object,true)\r\n      }\r\n      if (HasInt(game.pov, \"maxvolume\")) {\r\n        if (volume > game.pov.maxvolume) {\r\n          continue = false\r\n          if (HasString(game.pov, \"containerfullmessage\")) {\r\n            message = prefix + game.pov.containerfullmessage\r\n          }\r\n          else {\r\n            message = prefix + DynamicTemplate(\"FullInventory\", object)\r\n          }\r\n        }\r\n      }\r\n      children = GetDirectChildren(game.pov)\r\n      if (HasInt(game.pov, \"maxobjects\")) {\r\n        if (game.pov.maxobjects > 0) {\r\n          if (ListCount(children) >= game.pov.maxobjects) {\r\n            continue = false\r\n            if (HasString(game.pov, \"containermaxobjects\")) {\r\n              message = prefix + game.pov.containermaxobjects\r\n            }\r\n            else {\r\n              message = prefix + DynamicTemplate(\"MaxObjectsInInventory\", object)\r\n            }\r\n          }\r\n        }\r\n      }\r\n      if (continue = false) {\r\n        msg (message)\r\n      }\r\n      else {\r\n        found = true\r\n        takemsg = object.takemsg\r\n        switch (TypeOf(object, \"take\")) {\r\n          case (\"script\") {\r\n            if (ismultiple) {\r\n              OutputTextNoBr (prefix)\r\n            }\r\n            do (object, \"take\")\r\n            takemsg = \"\"\r\n          }\r\n          case (\"boolean\") {\r\n            if (object.take = true) {\r\n              object.parent = game.pov\r\n              if (takemsg = null) {\r\n                takemsg = DynamicTemplate(\"TakeSuccessful\", object)\r\n              }\r\n            }\r\n            else {\r\n              found = false\r\n            }\r\n          }\r\n          case (\"string\") {\r\n            object.parent = game.pov\r\n            takemsg = object.take\r\n          }\r\n          default {\r\n            found = false\r\n          }\r\n        }\r\n        if (not found and takemsg = null) {\r\n          takemsg = DynamicTemplate(\"TakeUnsuccessful\", object)\r\n        }\r\n        if (LengthOf(takemsg) > 0) {\r\n          msg (prefix + takemsg)\r\n        }\r\n        if (HasScript(object, \"ontake\")) {\r\n          do (object, \"ontake\")\r\n        }\r\n        if (found and GetBoolean (object, \"scenery\") and object.parent = game.pov) {\r\n          object.scenery = false\r\n        }\r\n      }\r\n    }\r\n  ","$":{"name":"DoTake","parameters":"object, ismultiple"}},{"_":"\r\n    prefix = \"\"\r\n    if (ismultiple) {\r\n      prefix = GetDisplayAlias(object) + \": \"\r\n    }\r\n    if (not ListContains(ScopeInventory(), object)) {\r\n      msg (prefix + DynamicTemplate(\"NotCarrying\", object))\r\n    }\r\n    else if (not ListContains(ScopeReachable(), object)) {\r\n      msg (prefix + DynamicTemplate(\"ObjectNotOpen\", GetBlockingObject(object)))\r\n    }\r\n    else {\r\n      found = true\r\n      dropmsg = object.dropmsg\r\n      if (HasObject(game.pov.parent, \"dropdestination\")) {\r\n        destination = game.pov.parent.dropdestination\r\n      }\r\n      else {\r\n        destination = game.pov.parent\r\n      }\r\n      switch (TypeOf(object, \"drop\")) {\r\n        case (\"script\") {\r\n          if (ismultiple) {\r\n            OutputTextNoBr (prefix)\r\n          }\r\n          d = NewDictionary()\r\n          dictionary add (d, \"destination\", destination)\r\n          do (object, \"drop\", d)\r\n          dropmsg = \"\"\r\n        }\r\n        case (\"boolean\") {\r\n          if (object.drop = true) {\r\n            object.parent = destination\r\n            if (dropmsg = null) {\r\n              dropmsg = DynamicTemplate(\"DropSuccessful\", object)\r\n            }\r\n          }\r\n          else {\r\n            found = false\r\n          }\r\n        }\r\n        case (\"string\") {\r\n          object.parent = game.pov.parent\r\n          dropmsg = object.drop\r\n        }\r\n        default {\r\n          found = false\r\n        }\r\n      }\r\n      if (not found and dropmsg = null) {\r\n        dropmsg = DynamicTemplate(\"DropUnsuccessful\", object)\r\n      }\r\n      if (LengthOf(dropmsg) > 0) {\r\n        msg (prefix + dropmsg)\r\n      }\r\n      if (HasScript(object, \"ondrop\")) {\r\n        do (object, \"ondrop\")\r\n      }\r\n    }\r\n  ","$":{"name":"DoDrop","parameters":"object, ismultiple"}},{"_":"\r\n    objectlist = NewObjectList()\r\n    objectlist = ScopeReachableInventory()\r\n    objectlist = ListCombine (objectlist, ScopeReachableNotHeld())\r\n    excludelist = NewObjectList()\r\n    list add (excludelist, game.pov)\r\n    list add (excludelist, object)\r\n    candidates = NewObjectList()\r\n    candidates = ListExclude(RemoveSceneryObjects(objectlist), excludelist)\r\n    return (candidates)\r\n  ","$":{"name":"CreateUseMenuList","parameters":"object","type":"objectlist"}},{"_":"\r\n    if (doopen) {\r\n      action = \"open\"\r\n      scriptaction = \"openscript\"\r\n    }\r\n    else {\r\n      action = \"close\"\r\n      scriptaction = \"closescript\"\r\n    }\r\n    if (not ListContains(ScopeReachable(), object)) {\r\n      msg (DynamicTemplate(\"ObjectNotOpen\", GetBlockingObject(object)))\r\n    }\r\n    else {\r\n      found = false\r\n      if (GetBoolean(object, action)) {\r\n        if (doopen) {\r\n          if (object.isopen) {\r\n            msg (DynamicTemplate(\"AlreadyOpen\", object))\r\n          }\r\n          else {\r\n            if (HasScript(object, scriptaction)) {\r\n              do (object, scriptaction)\r\n            }\r\n            else {\r\n              OpenObject (object)\r\n            }\r\n          }\r\n        }\r\n        else {\r\n          if (not object.isopen) {\r\n            msg (DynamicTemplate(\"AlreadyClosed\", object))\r\n          }\r\n          else {\r\n            if (HasScript(object, scriptaction)) {\r\n              do (object, scriptaction)\r\n            }\r\n            else {\r\n              CloseObject (object)\r\n            }\r\n          }\r\n        }\r\n      }\r\n      else {\r\n        if (doopen) {\r\n          msg (DynamicTemplate(\"CantOpen\", object))\r\n        }\r\n        else {\r\n          msg (DynamicTemplate(\"CantClose\", object))\r\n        }\r\n      }\r\n    }\r\n  ","$":{"name":"TryOpenClose","parameters":"doopen, object"}},{"_":"\r\n    if (HasString(object, \"openmsg\")) {\r\n      msg (object.openmsg)\r\n    }\r\n    else {\r\n      msg (DynamicTemplate(\"OpenSuccessful\", object))\r\n    }\r\n    object.isopen = true\r\n    ListObjectContents (object)\r\n  ","$":{"name":"OpenObject","parameters":"object"}},{"_":"\r\n    if (HasString(object, \"closemsg\")) {\r\n      msg (object.closemsg)\r\n    }\r\n    else {\r\n      msg (DynamicTemplate(\"CloseSuccessful\", object))\r\n    }\r\n    object.isopen = false\r\n  ","$":{"name":"CloseObject","parameters":"object"}},{"_":"\r\n    objectlist = NewObjectList()\r\n    objectlist = ScopeReachableInventory()\r\n    objectlist = ListCombine (objectlist, ScopeReachableNotHeld())\r\n    excludelist = NewObjectList()\r\n    list add (excludelist, game.pov)\r\n    list add (excludelist, object)\r\n    candidates = NewObjectList()\r\n    candidates = ListExclude(RemoveSceneryObjects(objectlist), excludelist)\r\n    return (candidates)\r\n  ","$":{"name":"CreateGiveMenuList","parameters":"object","type":"objectlist"}},{"_":"\r\n    handled = false\r\n    if (HasString(object2, \"give\")) {\r\n      msg (object2.give)\r\n      handled = true\r\n    }\r\n    else if (TypeOf(object2, \"give\") = \"scriptdictionary\") {\r\n      if (DictionaryContains(object2.give, object1.name)) {\r\n        parameters = NewObjectDictionary()\r\n        dictionary add (parameters, \"this\", object2)\r\n        dictionary add (parameters, \"object\", object1)\r\n        invoke (ScriptDictionaryItem(object2.give, object1.name), parameters)\r\n        handled = true\r\n      }\r\n      if (not handled) {\r\n        if (HasScript(object2, \"giveanything\")) {\r\n          // TO DO: Would be better to use a delegate for giveanything, but need to implement Editor support first\r\n          parameters = NewObjectDictionary()\r\n          dictionary add (parameters, \"object\", object1)\r\n          do (object2, \"giveanything\", parameters)\r\n          handled = true\r\n        }\r\n      }\r\n    }\r\n    if (not handled) {\r\n      if (HasString(object1, \"giveto\")) {\r\n        msg (object1.giveto)\r\n        handled = true\r\n      }\r\n      else if (TypeOf(object1, \"giveto\") = \"scriptdictionary\") {\r\n        if (DictionaryContains(object1.giveto, object2.name)) {\r\n          parameters = NewObjectDictionary()\r\n          dictionary add (parameters, \"this\", object1)\r\n          dictionary add (parameters, \"object\", object2)\r\n          invoke (ScriptDictionaryItem(object1.giveto, object2.name), parameters)\r\n          handled = true\r\n        }\r\n        else {\r\n          if (HasScript(object1, \"givetoanything\")) {\r\n            // TO DO: Would be better to use a delegate for givetoanything, but need to implement Editor support first\r\n            parameters = NewObjectDictionary()\r\n            dictionary add (parameters, \"object\", object2)\r\n            do (object1, \"givetoanything\", parameters)\r\n            handled = true\r\n          }\r\n        }\r\n      }\r\n    }\r\n    if (not handled) {\r\n      msg (DynamicTemplate(\"DefaultGive\", object2, object1))\r\n    }\r\n  ","$":{"name":"HandleGiveTo","parameters":"object1, object2"}},{"_":"\r\n    handled = false\r\n    if (HasString(object2, \"useon\")) {\r\n      msg (object2.useon)\r\n      handled = true\r\n    }\r\n    else if (TypeOf(object2, \"useon\") = \"scriptdictionary\") {\r\n      if (DictionaryContains(object2.useon, object1.name)) {\r\n        parameters = NewObjectDictionary()\r\n        dictionary add (parameters, \"this\", object2)\r\n        dictionary add (parameters, \"object\", object1)\r\n        invoke (ScriptDictionaryItem(object2.useon, object1.name), parameters)\r\n        handled = true\r\n      }\r\n      else {\r\n        if (HasScript(object2, \"useanything\")) {\r\n          // TO DO: Would be better to use a delegate for useanything, but need to implement Editor support first\r\n          parameters = NewObjectDictionary()\r\n          dictionary add (parameters, \"object\", object1)\r\n          do (object2, \"useanything\", parameters)\r\n          handled = true\r\n        }\r\n      }\r\n    }\r\n    if (not handled) {\r\n      if (HasString(object1, \"selfuseon\")) {\r\n        msg (object1.selfuseon)\r\n        handled = true\r\n      }\r\n      else if (TypeOf(object1, \"selfuseon\") = \"scriptdictionary\") {\r\n        if (DictionaryContains(object1.selfuseon, object2.name)) {\r\n          parameters = NewObjectDictionary()\r\n          dictionary add (parameters, \"this\", object1)\r\n          dictionary add (parameters, \"object\", object2)\r\n          invoke (ScriptDictionaryItem(object1.selfuseon, object2.name), parameters)\r\n          handled = true\r\n        }\r\n        else {\r\n          if (HasScript(object1, \"selfuseanything\")) {\r\n            // TO DO: Would be better to use a delegate for selfuseanything, but need to implement Editor support first\r\n            parameters = NewObjectDictionary()\r\n            dictionary add (parameters, \"object\", object2)\r\n            do (object1, \"selfuseanything\", parameters)\r\n            handled = true\r\n          }\r\n        }\r\n      }\r\n    }\r\n    if (not handled) {\r\n      msg (DynamicTemplate(\"DefaultUseOn\", object2, object1))\r\n    }\r\n  ","$":{"name":"HandleUseOn","parameters":"object1, object2"}},{"_":"\r\n    handled = false\r\n    maxstrength = 0\r\n    match = null\r\n    text = LCase(text)\r\n    if (TypeOf(object, property) = \"scriptdictionary\") {\r\n      dictionary = GetAttribute(object, property)\r\n      foreach (keywords, dictionary) {\r\n        strength = GetKeywordsMatchStrength(LCase(keywords), text)\r\n        if (strength >= maxstrength and strength>0) {\r\n          match = ScriptDictionaryItem(dictionary, keywords)\r\n          maxstrength = strength\r\n        }\r\n      }\r\n      if (match <> null) {\r\n        parameters = NewObjectDictionary()\r\n        dictionary add (parameters, \"this\", object)\r\n        invoke (match, parameters)\r\n        handled = true\r\n      }\r\n    }\r\n    if (not handled) {\r\n      if (HasScript(object, defaultscript)) {\r\n        d = NewDictionary()\r\n        dictionary add (d, \"text\", text)\r\n        do (object, defaultscript, d)\r\n      }\r\n      else {\r\n        msg (DynamicTemplate(defaulttemplate, object))\r\n      }\r\n    }\r\n  ","$":{"name":"DoAskTell","parameters":"object, text, property, defaultscript, defaulttemplate"}},{"_":"\r\n    // Keywords is the subject. We split it into individual words, and then see how well\r\n    // the words in the input match the keywords.\r\n    keywordlist = Split(keywords, \" \")\r\n    inputlist = Split(input, \" \")\r\n    strength = 0\r\n    foreach (word, inputlist) {\r\n      foreach (keyword, keywordlist) {\r\n        if (StartsWith(word, keyword)) {\r\n          strength = strength + LengthOf(keyword)\r\n        }\r\n      }\r\n    }\r\n    return (strength)\r\n  ","$":{"name":"GetKeywordsMatchStrength","parameters":"keywords, input","type":"int"}},{"_":"\r\n    return (GetRandomInt(1,100) <= percentile)\r\n  ","$":{"name":"RandomChance","parameters":"percentile","type":"boolean"}},{"_":"\r\n    set (object, flag, true)\r\n  ","$":{"name":"SetObjectFlagOn","parameters":"object, flag"}},{"_":"\r\n    set (object, flag, false)\r\n  ","$":{"name":"SetObjectFlagOff","parameters":"object, flag"}},{"_":"\r\n    if (not HasInt(object, counter)) {\r\n      set (object, counter, 0)\r\n    }\r\n    set (object, counter, GetInt(object, counter) + 1)\r\n  ","$":{"name":"IncreaseObjectCounter","parameters":"object, counter"}},{"_":"\r\n    if (not HasInt(object, counter)) {\r\n      set (object, counter, 0)\r\n    }\r\n    set (object, counter, GetInt(object, counter) - 1)\r\n  ","$":{"name":"DecreaseObjectCounter","parameters":"object, counter"}},{"_":"\r\n    return (GetBoolean(object, \"switchedon\"))\r\n  ","$":{"name":"IsSwitchedOn","parameters":"object","type":"boolean"}},{"_":"\r\n    object.parent = game.pov\r\n  ","$":{"name":"AddToInventory","parameters":"object"}},{"_":"\r\n    object.parent = parent\r\n  ","$":{"name":"MoveObject","parameters":"object, parent"}},{"_":"\r\n    object.parent = game.pov.parent\r\n  ","$":{"name":"MoveObjectHere","parameters":"object"}},{"_":"\r\n    object.parent = null\r\n  ","$":{"name":"RemoveObject","parameters":"object"}},{"_":"\r\n    object.visible = true\r\n  ","$":{"name":"MakeObjectVisible","parameters":"object"}},{"_":"\r\n    object.visible = false\r\n  ","$":{"name":"MakeObjectInvisible","parameters":"object"}},{"_":"\r\n    object.visible = true\r\n  ","$":{"name":"MakeExitVisible","parameters":"object"}},{"_":"\r\n    object.visible = false\r\n  ","$":{"name":"MakeExitInvisible","parameters":"object"}},{"_":"\r\n    object.isopen = true\r\n  ","$":{"name":"HelperOpenObject","parameters":"object"}},{"_":"\r\n    object.isopen = false\r\n  ","$":{"name":"HelperCloseObject","parameters":"object"}},{"_":"\r\n    newobject = Clone(object)\r\n    if (not HasString(object, \"alias\")) {\r\n      newobject.alias = object.name\r\n    }\r\n    if (not HasAttribute(object, \"prototype\")) {\r\n      newobject.prototype = object\r\n    }\r\n    return (newobject)\r\n  ","$":{"name":"CloneObject","parameters":"object","type":"object"}},{"_":"\r\n    newobject = CloneObject(object)\r\n    newobject.parent = newparent\r\n    return (newobject)\r\n  ","$":{"name":"CloneObjectAndMove","parameters":"object, newparent","type":"object"}},{"_":"\r\n    newobject = CloneObject(object)\r\n    if (HasScript(newobject, \"_initialise_\")) {\r\n      do (newobject, \"_initialise_\")\r\n    }\r\n    return (newobject)\r\n  ","$":{"name":"CloneObjectAndInitialise","parameters":"object","type":"object"}},{"_":"\r\n    newobject = CloneObject(object)\r\n    newobject.parent = game.pov.parent\r\n    return (newobject)\r\n  ","$":{"name":"CloneObjectAndMoveHere","parameters":"object","type":"object"}},{"_":"\r\n    exit.locked = true\r\n  ","$":{"name":"LockExit","parameters":"exit"}},{"_":"\r\n    exit.locked = false\r\n  ","$":{"name":"UnlockExit","parameters":"exit"}},{"_":"\r\n    object.switchedon = true\r\n  ","$":{"name":"SwitchOn","parameters":"object"}},{"_":"\r\n    object.switchedon = false\r\n  ","$":{"name":"SwitchOff","parameters":"object"}},{"_":"\r\n    object.dark = true\r\n  ","$":{"name":"SetDark","parameters":"object"}},{"_":"\r\n    object.dark = false\r\n  ","$":{"name":"SetLight","parameters":"object"}},{"_":"\r\n    if (LengthOf(strength) = 0) {\r\n      object.lightsource = false\r\n    }\r\n    else {\r\n      object.lightsource = true\r\n    }\r\n    object.lightstrength = strength\r\n  ","$":{"name":"SetObjectLightstrength","parameters":"object, strength"}},{"_":"\r\n    if (LengthOf(strength) = 0) {\r\n      exit.lightsource = false\r\n    }\r\n    else {\r\n      exit.lightsource = true\r\n    }\r\n    exit.lightstrength = strength\r\n  ","$":{"name":"SetExitLightstrength","parameters":"exit, strength"}},{"_":"\r\n    if (game.pov <> object) {\r\n      game.pov = object\r\n      if (game.gridmap) {\r\n        JS.Grid_ClearAllLayers ()\r\n        Grid_Redraw\r\n      }\r\n      OnEnterRoom (null)\r\n    }\r\n  ","$":{"name":"ChangePOV","parameters":"object"}},{"_":"\r\n    request (RequestSave, \"\")\r\n  ","$":{"name":"RequestSave"}},{"_":"\r\n    request (Speak, s)\r\n  ","$":{"name":"RequestSpeak","parameters":"s"}},{"_":"\r\n    outputsection = StartNewOutputSection()\r\n    msg (caption)\r\n    count = 0\r\n    game.menuoptionskeys = NewStringList()\r\n    foreach (option, options) {\r\n      count = count + 1\r\n      if (TypeOf(options) = \"stringdictionary\") {\r\n        optionText = StringDictionaryItem(options, option)\r\n        optiontag = option\r\n        style = GetCurrentLinkTextFormat()\r\n        list add (game.menuoptionskeys, option)\r\n      }\r\n      else if (TypeOf(option) = \"string\") {\r\n        optionText = option\r\n        optiontag = option\r\n        style = GetCurrentLinkTextFormat()\r\n        list add (game.menuoptionskeys, option)\r\n      }\r\n      else if (TypeOf(option) = \"object\") {\r\n        optionText = GetDisplayAlias(option)\r\n        optiontag = option.name\r\n        colour = \"\"\r\n        if (HasString(option, \"linkcolour\") and GetUIOption(\"UseGameColours\") = \"true\") {\r\n          colour = option.linkcolour\r\n        }\r\n        else {\r\n          colour = GetLinkTextColour()\r\n        }\r\n        style = GetCurrentTextFormat(colour)\r\n        list add (game.menuoptionskeys, option.name)\r\n      }\r\n      else {\r\n        error (\"ShowMenu cannot handle a \" + TypeOf(option))\r\n      }\r\n      msg (count + \": <a class=\\\"cmdlink\\\" style=\\\"\" + style + \"\\\" onclick=\\\"ASLEvent('ShowMenuResponse','\" + EscapeQuotes(optiontag) + \"')\\\">\" + optionText + \"</a>\")\r\n    }\r\n    EndOutputSection (outputsection)\r\n    game.menuoptions = options\r\n    game.menuallowcancel = allowCancel\r\n    game.menucallback = callback\r\n    game.menuoutputsection = outputsection\r\n  ","$":{"name":"ShowMenu","parameters":"caption, options, allowCancel, callback"}},{"_":"\r\n    if (game.menucallback = null) {\r\n      error (\"Unexpected menu response\")\r\n    }\r\n    else {\r\n      parameters = NewStringDictionary()\r\n      dictionary add (parameters, \"result\", UnescapeQuotes(option))\r\n      script = game.menucallback\r\n      ClearMenu\r\n      invoke (script, parameters)\r\n    }\r\n  ","$":{"name":"ShowMenuResponse","parameters":"option"}},{"_":"\r\n    s = Replace(s, \"\\\"\", \"@@@doublequote@@@\")\r\n    s = Replace(s, \"\\'\", \"@@@singlequote@@@\")\r\n    return (s)\r\n  ","$":{"name":"EscapeQuotes","parameters":"s","type":"string"}},{"_":"\r\n    s = Replace(s, \"@@@doublequote@@@\", \"\\\"\")\r\n    s = Replace(s, \"@@@singlequote@@@\", \"\\'\")\r\n    return (s)\r\n  ","$":{"name":"UnescapeQuotes","parameters":"s","type":"string"}},{"_":"\r\n    s = Replace(s, \"\\\"\", \"\")\r\n    s = Replace(s, \"\\'\", \"\")\r\n    s = Replace(s, \" \", \"\")\r\n    s = Replace(s, \".\", \"\")\r\n    s = Replace(s, \",\", \"\")\r\n    s = Replace(s, \"!\", \"\")\r\n    s = Replace(s, \"?\", \"\")\r\n    s = Replace(s, \"-\", \"\")\r\n    s = Replace(s, \"/\", \"\")\r\n    s = Replace(s, \"(\", \"\")\r\n    s = Replace(s, \")\", \"\")\r\n    s = Replace(s, \"$\", \"\")\r\n    s = Replace(s, \"%\", \"\")\r\n    s = Replace(s, \"&\", \"\")\r\n    s = Replace(s, \"*\", \"\")\r\n    s = Replace(s, \"@\", \"\")\r\n    return (s)\r\n  ","$":{"name":"JSSafe","parameters":"s","type":"string"}},{"_":"\r\n    handled = false\r\n    if (IsInt(input)) {\r\n      number = ToInt(input)\r\n      if (number > 0 and number <= ListCount(game.menuoptionskeys)) {\r\n        handled = true\r\n        ShowMenuResponse (StringListItem(game.menuoptionskeys, number - 1))\r\n      }\r\n    }\r\n    return (handled)\r\n  ","$":{"name":"HandleMenuTextResponse","parameters":"input","type":"boolean"}},{"_":"\r\n    HideOutputSection (game.menuoutputsection)\r\n    game.menuoutputsection = null\r\n    game.menuoptions = null\r\n    game.menucallback = null\r\n  ","$":{"name":"ClearMenu"}},{"_":"\r\n    if (not HasInt(game, \"lastoutputsection\")) {\r\n      game.lastoutputsection = 0\r\n    }\r\n    game.lastoutputsection = game.lastoutputsection + 1\r\n    name = \"section\" + game.lastoutputsection\r\n    JS.StartOutputSection (name)\r\n    return (name)\r\n  ","$":{"name":"StartNewOutputSection","type":"string"}},{"_":"\r\n    JS.EndOutputSection (name)\r\n  ","$":{"name":"EndOutputSection","parameters":"name"}},{"_":"\r\n    JS.HideOutputSection (name)\r\n  ","$":{"name":"HideOutputSection","parameters":"name"}},{"_":"\r\n    if (HasString(game, \"currentturnoutputsection\")) {\r\n      game.lastturnoutputsection = game.currentturnoutputsection\r\n      EndOutputSection (game.currentturnoutputsection)\r\n    }\r\n    game.currentturnoutputsection = StartNewOutputSection()\r\n  ","$":{"name":"StartTurnOutputSection"}},{"_":"\r\n    if (HasString(game, \"lastturnoutputsection\")) {\r\n      HideOutputSection (game.lastturnoutputsection)\r\n    }\r\n  ","$":{"name":"HidePreviousTurnOutput"}},{"_":"\r\n    options = NewStringList()\r\n    list add (options, \"Yes\")\r\n    list add (options, \"No\")\r\n    game.askcallback = callback\r\n    ShowMenu (question, options, false) {\r\n      parameters = NewDictionary()\r\n      if (result = \"Yes\") {\r\n        boolresult = true\r\n      }\r\n      else {\r\n        boolresult = false\r\n      }\r\n      dictionary add (parameters, \"result\", boolresult)\r\n      callback = game.askcallback\r\n      game.askcallback = null\r\n      invoke (callback, parameters)\r\n    }\r\n  ","$":{"name":"Ask","parameters":"question, callback"}},{"_":"\r\n    if (HasObject(object, \"key\")) {\r\n      if (not HasInt(object,\"keycount\")) {\r\n        object.keycount = 1\r\n        object.key1 = object.key\r\n      }\r\n      if (not HasObject(object, \"key1\")) {\r\n        object.key1 = object.key\r\n      }\r\n    }\r\n    for (x, 1, object.keycount) {\r\n      keyname = \"key\" + ToString(x)\r\n      if (HasObject(object, keyname)) {\r\n        if (not ListContains(ScopeInventory(), GetAttribute(object, keyname))) {\r\n          return (false)\r\n        }\r\n      }\r\n    }\r\n    return (true)\r\n  ","$":{"name":"AllKeysAvailable","parameters":"object","type":"boolean"}},{"_":"\r\n    create exit (dir, from, to)\r\n    create exit (ReverseDirection(dir), to, from)\r\n  ","$":{"name":"CreateBiExits","parameters":"dir, from, to"}},{"_":"\r\n    if (not TypeOf(value1) = TypeOf(value2)) {\r\n      return (false)\r\n    }\r\n    if (not value1 = value2) {\r\n      return (false)\r\n    }\r\n    return (true)\r\n  ","$":{"name":"Equal","parameters":"value1, value2","type":"boolean"}},{"_":"\r\n    list1 = Split(\"north;northeast;east;southeast;south;southwest;west;northwest;up;down;in;out\", \";\")\r\n    list2 = Split(\"south;southwest;west;northwest;north;northeast;east;southeast;down;up;out;in\", \";\")\r\n    n = IndexOf(list1, dir)\r\n    if (not n = -1) {\r\n      return (StringListItem(list2, n))\r\n    }\r\n    return (dir)\r\n  ","$":{"name":"ReverseDirection","parameters":"dir","type":"string"}},{"_":"\r\n    s = \"\"\r\n    str = \"\" + str\r\n    pad = \"\" + pad\r\n    step = LengthOf(pad)\r\n    if (step = 0) {\r\n      error (\"Zero length pad in PadString\")\r\n    }\r\n    if (pad = \" \") {\r\n      pad = \"&nbsp;\"\r\n    }\r\n    for (i, 1, n - LengthOf(str), step) {\r\n      s = s + pad\r\n    }\r\n    return (s + str)\r\n  ","$":{"name":"PadString","parameters":"str, n, pad","type":"string"}},{"_":"\r\n    negative = (n < 0)\r\n    n = abs(n)\r\n    if (places = 0) {\r\n      return (\"\" + n)\r\n    }\r\n    factor = pow (10, places)\r\n    pounds = floor(n / factor)\r\n    pennies = n % factor\r\n    result = pounds + \".\" + PadString(pennies, places, 0)\r\n    if (negative) {\r\n      result = \"-\" + result\r\n    }\r\n    return (result)\r\n  ","$":{"name":"Decimalise","parameters":"n, places","type":"string"}},{"_":"\r\n    n = abs(n)\r\n    regex = \"^(?<before>\\\\D*)(?<padding>\\\\d+)(?<sep>\\\\D)(?<places>\\\\d*)(?<after>\\\\D*)$\"\r\n    if (not IsRegexMatch(regex, control, \"DisplayNumber\")) {\r\n      error (\"Unexpected format in DisplayNumber (\" + control + \"). Should be a number, followed by a single character separator, followed by a number.\")\r\n    }\r\n    options = Populate(regex, control, \"DisplayNumber\")\r\n    places = ToInt(StringDictionaryItem(options, \"places\"))\r\n    padding = ToInt(StringDictionaryItem(options, \"padding\"))\r\n    if (places > 0) {\r\n      padding = padding + 1 + places\r\n    }\r\n    decimal = Replace(Decimalise(n, places), \".\", StringDictionaryItem(options, \"sep\"))\r\n    return (StringDictionaryItem(options, \"before\") + PadString(decimal, padding, 0) + StringDictionaryItem(options, \"after\"))\r\n  ","$":{"name":"DisplayNumber","parameters":"n, control","type":"string"}},{"_":"\r\n    // Returns the given number formatted according to game.moneyformat\r\n    if (not HasString(game, \"moneyformat\")) {\r\n      error (\"No format for money set in game.moneyformat.\")\r\n    }\r\n    ary = Split(game.moneyformat, \"!\")\r\n    if (ListCount(ary) = 2) {\r\n      return (Replace(game.moneyformat, \"!\", \"\" + n))\r\n    }\r\n    else if (ListCount(ary) = 3) {\r\n      negative = (n < 0)\r\n      n = abs(n)\r\n      options = StringListItem(ary, 1)\r\n      showsign = StartsWith(options, \"+\")\r\n      if (showsign) {\r\n        options = Mid(options, 2)\r\n      }\r\n      number = DisplayNumber(n, options)\r\n      if (negative) {\r\n        number = \"-\" + number\r\n      }\r\n      else if (not n = 0 and showsign) {\r\n        number = \"+\" + number\r\n      }\r\n      return (StringListItem(ary, 0) + number + StringListItem(ary, 2))\r\n    }\r\n    else if (ListCount(ary) = 4) {\r\n      if (n < 0) {\r\n        options = StringListItem(ary, 2)\r\n      }\r\n      else {\r\n        options = StringListItem(ary, 1)\r\n      }\r\n      number = DisplayNumber(n, options)\r\n      return (StringListItem(ary, 0) + number + StringListItem(ary, 3))\r\n    }\r\n    else {\r\n      error (\"game.moneyformat expected to have either 1, 2 or 3 exclamation marks.\")\r\n    }\r\n  ","$":{"name":"DisplayMoney","parameters":"n","type":"string"}},{"_":"\r\n    for (i, 0, ListCount(lst) - 1) {\r\n      x = ListItem(lst, i)\r\n      if (x = item) {\r\n        return (i)\r\n      }\r\n    }\r\n    return (-1)\r\n  ","$":{"name":"IndexOf","parameters":"lst, item","type":"int"}},{"_":"\r\n    l = NewStringList()\r\n    foreach (o, list) {\r\n      if (HasString(o, att)) {\r\n        list add (l, GetString(o, att))\r\n      }\r\n    }\r\n    return (l)\r\n  ","$":{"name":"ObjectListToStringList","parameters":"list, att","type":"stringlist"}},{"_":"\r\n    l = NewObjectList()\r\n    foreach (o, lst) {\r\n      if (DoesInherit(o, t)) {\r\n        list add (l, o)\r\n      }\r\n    }\r\n    return (l)\r\n  ","$":{"name":"FilterByType","parameters":"lst, t","type":"objectlist"}},{"_":"\r\n    l = NewObjectList()\r\n    foreach (o, lst) {\r\n      val = GetAttribute(o, name)\r\n      if (Equal(val, value)) {\r\n        list add (l, o)\r\n      }\r\n    }\r\n    return (l)\r\n  ","$":{"name":"FilterByAttribute","parameters":"lst, name, value","type":"objectlist"}},{"_":"\r\n    l = NewObjectList()\r\n    foreach (o, lst) {\r\n      val = GetAttribute(o, name)\r\n      if (not Equal(val, value)) {\r\n        list add (l, o)\r\n      }\r\n    }\r\n    return (l)\r\n  ","$":{"name":"FilterByNotAttribute","parameters":"lst, name, value","type":"objectlist"}},{"_":"\r\n    l = NewList()\r\n    foreach (o, lst) {\r\n      if (not Equal(o, null)) {\r\n        if (IndexOf(l, o) = -1) {\r\n          list add (l, o)\r\n        }\r\n      }\r\n    }\r\n    return (l)\r\n  ","$":{"name":"ListCompact","parameters":"lst","type":"list"}},{"_":"\r\n    handled = false\r\n    if (game.menucallback <> null) {\r\n      if (HandleMenuTextResponse(command)) {\r\n        handled = true\r\n      }\r\n      else {\r\n        if (game.menuallowcancel) {\r\n          ClearMenu\r\n        }\r\n        else {\r\n          handled = true\r\n        }\r\n      }\r\n    }\r\n    if (not handled) {\r\n      StartTurnOutputSection\r\n      if (StartsWith (command, \"*\")) {\r\n        msg (\"\")\r\n        msg (SafeXML (command))\r\n      }\r\n      else {\r\n        shownlink = false\r\n        if (game.echocommand) {\r\n          if (metadata <> null and game.enablehyperlinks and game.echohyperlinks) {\r\n            foreach (key, metadata) {\r\n              if (EndsWith(command, key)) {\r\n                objectname = StringDictionaryItem(metadata, key)\r\n                object = GetObject(objectname)\r\n                if (object <> null) {\r\n                  msg (\"\")\r\n                  msg (\"&gt; \" + Left(command, LengthOf(command) - LengthOf(key)) + \"{object:\" + object.name + \"}\")\r\n                  shownlink = true\r\n                }\r\n              }\r\n            }\r\n          }\r\n          if (not shownlink) {\r\n            msg (\"\")\r\n            OutputTextRaw (\"&gt; \" + SafeXML(command))\r\n          }\r\n        }\r\n        if (game.command_newline) {\r\n          msg (\"\")\r\n        }\r\n        game.pov.commandmetadata = metadata\r\n        if (game.multiplecommands) {\r\n          commands = Split(command, \".\")\r\n          if (ListCount(commands) = 1) {\r\n            game.pov.commandqueue = null\r\n            HandleSingleCommand (Trim(command))\r\n          }\r\n          else {\r\n            game.pov.commandqueue = commands\r\n            HandleNextCommandQueueItem\r\n          }\r\n        }\r\n        else {\r\n          game.pov.commandqueue = null\r\n          HandleSingleCommand (Trim(command))\r\n        }\r\n      }\r\n    }\r\n  ","$":{"name":"HandleCommand","parameters":"command, metadata"}},{"_":"\r\n    if (TypeOf(game.pov, \"commandqueue\") = \"stringlist\") {\r\n      queuelength = ListCount(game.pov.commandqueue)\r\n      if (queuelength > 0) {\r\n        thiscommand = Trim(StringListItem(game.pov.commandqueue, 0))\r\n        if (queuelength = 1) {\r\n          game.pov.commandqueue = null\r\n        }\r\n        else {\r\n          newqueue = NewStringList()\r\n          for (i, 1, queuelength - 1) {\r\n            list add (newqueue, StringListItem(game.pov.commandqueue, i))\r\n          }\r\n          game.pov.commandqueue = newqueue\r\n        }\r\n        if (LengthOf(thiscommand) > 0) {\r\n          HandleSingleCommand (thiscommand)\r\n        }\r\n        else {\r\n          HandleNextCommandQueueItem\r\n        }\r\n      }\r\n    }\r\n  ","$":{"name":"HandleNextCommandQueueItem"}},{"_":"\r\n    if (LCase(command) = \"again\" or LCase(command) = \"g\") {\r\n      // First handle AGAIN\r\n      if (not game.pov.currentcommand = null) {\r\n        HandleSingleCommand (game.pov.currentcommand)\r\n      }\r\n      else {\r\n        msg (\"There is nothing to repeat.\")\r\n      }\r\n    }\r\n    else {\r\n      // Check through all commands for any that match\r\n      candidates = NewObjectList()\r\n      foreach (cmd, ScopeCommands()) {\r\n        if (IsRegexMatch(cmd.pattern, command, cmd.name)) {\r\n          list add (candidates, cmd)\r\n        }\r\n      }\r\n      maxstrength = -1\r\n      thiscommand = null\r\n      // Pick the best match\r\n      foreach (candidate, candidates) {\r\n        strength = GetMatchStrength(candidate.pattern, command, candidate.name)\r\n        // favour commands defined later, so an author can override a library command...\r\n        if (strength >= maxstrength) {\r\n          // ... except if the command defined later (candidate) has no parent, and the current best\r\n          // match (thiscommand) does have a parent. We want to favour any commands defined in rooms\r\n          // over global candidates.\r\n          skip = false\r\n          if (thiscommand <> null) {\r\n            if (thiscommand.parent <> null and candidate.parent = null) {\r\n              skip = true\r\n            }\r\n          }\r\n          if (not skip) {\r\n            thiscommand = candidate\r\n            maxstrength = strength\r\n          }\r\n        }\r\n      }\r\n      if (thiscommand = null) {\r\n        if (HasScript(game, \"unresolvedcommandhandler\")) {\r\n          params = NewDictionary()\r\n          dictionary add (params, \"command\", command)\r\n          do (game, \"unresolvedcommandhandler\", params)\r\n        }\r\n        else {\r\n          msg (Template(\"UnrecognisedCommand\"))\r\n        }\r\n        HandleNextCommandQueueItem\r\n      }\r\n      else {\r\n        varlist = Populate(thiscommand.pattern, command, thiscommand.name)\r\n        HandleSingleCommandPattern (command, thiscommand, varlist)\r\n      }\r\n    }\r\n  ","$":{"name":"HandleSingleCommand","parameters":"command"}},{"_":"\r\n    // current command string\r\n    game.pov.currentcommand = command\r\n    // current command object\r\n    game.pov.currentcommandpattern = thiscommand\r\n    // string dictionary of variables, e.g. object1=\"book\"; object2=\"table\"\r\n    game.pov.currentcommandvarlist = varlist\r\n    // string list of variables left to resolve\r\n    game.pov.currentcommandvarlistqueue = NewStringList()\r\n    foreach (key, varlist) {\r\n      list add (game.pov.currentcommandvarlistqueue, key)\r\n    }\r\n    // dictionary of resolved elements, e.g. object1=book_object; object2=table_object\r\n    game.pov.currentcommandresolvedelements = NewDictionary()\r\n    // list of resolved elements, e.g. book_object; table_object\r\n    game.pov.currentcommandresolvedobjects = NewObjectList()\r\n    game.pov.currentcommandunresolvedobject = null\r\n    game.pov.currentcommandpendingvariable = null\r\n    ResolveNextName\r\n  ","$":{"name":"HandleSingleCommandPattern","parameters":"command, thiscommand, varlist"}},{"_":"\r\n    resolvedall = false\r\n    queuetype = TypeOf(game.pov, \"currentcommandvarlistqueue\")\r\n    if (queuetype = \"stringlist\") {\r\n      queuelength = ListCount(game.pov.currentcommandvarlistqueue)\r\n      if (queuelength > 0) {\r\n        // Pop next variable off the queue\r\n        var = StringListItem(game.pov.currentcommandvarlistqueue, 0)\r\n        if (queuelength = 1) {\r\n          game.pov.currentcommandvarlistqueue = null\r\n        }\r\n        else {\r\n          newqueue = NewStringList()\r\n          for (i, 1, queuelength - 1) {\r\n            list add (newqueue, StringListItem(game.pov.currentcommandvarlistqueue, i))\r\n          }\r\n          game.pov.currentcommandvarlistqueue = newqueue\r\n        }\r\n        // Resolve variable\r\n        value = StringDictionaryItem(game.pov.currentcommandvarlist, var)\r\n        if (value <> \"\") {\r\n          result = null\r\n          resolvinglist = false\r\n          // This is to resolve issue 626\r\n          if (StartsWith(var, \"objectexit\")) {\r\n            result = ResolveName(var, value, \"exit\")\r\n          }\r\n          if (result = null) {\r\n            if (StartsWith(var, \"object\")) {\r\n              if (HasScript(game.pov.currentcommandpattern, \"multipleobjects\")) {\r\n                game.pov.currentcommandpendingobjectlist = NewObjectList()\r\n                game.pov.currentcommandpendingvariable = var\r\n                do (game.pov.currentcommandpattern, \"multipleobjects\")\r\n                ResolveNameList (value, \"object\")\r\n                resolvinglist = true\r\n              }\r\n              else {\r\n                result = ResolveName(var, value, \"object\")\r\n              }\r\n            }\r\n            else if (StartsWith(var, \"exit\")) {\r\n              result = ResolveName(var, value, \"exit\")\r\n            }\r\n            else if (StartsWith(var, \"text\")) {\r\n              result = StringDictionaryItem(game.pov.currentcommandvarlist, var)\r\n            }\r\n            else {\r\n              error (\"Unhandled command variable '\" + var + \"' - command variable names must begin with 'object', 'exit' or 'text'\")\r\n            }\r\n          }\r\n          // at this point, ResolveName has returned - either an object name, unresolved, or pending\r\n          if (result = null) {\r\n            if ((not resolvinglist) and LengthOf(GetString(game.pov, \"currentcommandpendingvariable\")) = 0) {\r\n              UnresolvedCommand (value, var)\r\n            }\r\n          }\r\n          else {\r\n            AddToResolvedNames (var, result)\r\n          }\r\n        }\r\n        else {\r\n          ResolveNextName\r\n        }\r\n      }\r\n      else {\r\n        resolvedall = true\r\n      }\r\n    }\r\n    else if (queuetype = \"null\") {\r\n      resolvedall = true\r\n    }\r\n    else {\r\n      error (\"Invalid queue type\")\r\n    }\r\n    if (resolvedall) {\r\n      // All the objects have been resolved, so now we can actually do the command\r\n      // TO DO: game.lastobjects should be game.pov.lastobjects\r\n      game.lastobjects = game.pov.currentcommandresolvedobjects\r\n      if (not DictionaryContains(game.pov.currentcommandresolvedelements, \"multiple\")) {\r\n        dictionary add (game.pov.currentcommandresolvedelements, \"multiple\", false)\r\n      }\r\n      if (not GetBoolean(game.pov.currentcommandpattern, \"isundo\")) {\r\n        if (LengthOf(game.pov.currentcommand) > 0) {\r\n          start transaction (game.pov.currentcommand)\r\n        }\r\n      }\r\n      if (not GetBoolean(game.pov.currentcommandpattern, \"isoops\")) {\r\n        // TO DO: game.unresolved* should be game.pov.unresolved*\r\n        game.unresolvedcommand = null\r\n        game.unresolvedcommandvarlist = null\r\n        game.unresolvedcommandkey = null\r\n      }\r\n      if (HasScript(game.pov.currentcommandpattern, \"script\")) {\r\n        // This is the bit that actually runs the commands\r\n        do (game.pov.currentcommandpattern, \"script\", game.pov.currentcommandresolvedelements)\r\n      }\r\n      HandleNextCommandQueueItem\r\n    }\r\n  ","$":{"name":"ResolveNextName"}},{"_":"\r\n    if (TypeOf(result) = \"object\") {\r\n      if (result.type = \"object\") {\r\n        list add (game.pov.currentcommandresolvedobjects, result)\r\n      }\r\n    }\r\n    else if (TypeOf(result) = \"objectlist\") {\r\n      foreach (obj, result) {\r\n        if (obj.type = \"object\") {\r\n          list add (game.pov.currentcommandresolvedobjects, obj)\r\n        }\r\n      }\r\n    }\r\n    dictionary add (game.pov.currentcommandresolvedelements, var, result)\r\n    ResolveNextName\r\n  ","$":{"name":"AddToResolvedNames","parameters":"var, result"}},{"_":"\r\n    found = false\r\n    if (game.pov.commandmetadata <> null) {\r\n      if (DictionaryContains(game.pov.commandmetadata, value)) {\r\n        result = GetObject(StringDictionaryItem(game.pov.commandmetadata, value))\r\n        if (result <> null) {\r\n          if (ListContains(ScopeVisible(), result)) {\r\n            found = true\r\n            return (result)\r\n          }\r\n        }\r\n      }\r\n    }\r\n    if (not found) {\r\n      value = LCase(value)\r\n      result = ResolveNameInternal(variable, value, objtype)\r\n      if (result <> null) {\r\n        return (result)\r\n      }\r\n      else {\r\n        // TO DO: Check this behaviour. We only want to try ignoring prefixes if we have definitely got an unresolved name.\r\n        foreach (prefix, game.parserignoreprefixes) {\r\n          if (StartsWith(value, prefix + \" \")) {\r\n            result = ResolveNameInternal(variable, Mid(value, LengthOf(prefix) + 1), objtype)\r\n          }\r\n        }\r\n        if (result = null and LengthOf(variable) = 0 and not GetBoolean(game.pov, \"currentcommandmultiobjectpending\")) {\r\n          UnresolvedCommand (value, game.pov.currentcommandpendingvariable)\r\n        }\r\n        return (result)\r\n      }\r\n    }\r\n  ","$":{"name":"ResolveName","parameters":"variable, value, objtype","type":"object"}},{"_":"\r\n    game.pov.currentcommandmultiobjectpending = false\r\n    scope = GetScope(variable, value, objtype)\r\n    if (HasString(game.pov.currentcommandpattern, \"scope\")) {\r\n      secondaryscope = ScopeVisible()\r\n    }\r\n    else {\r\n      secondaryscope = null\r\n    }\r\n    return (ResolveNameFromList(variable, value, objtype, scope, secondaryscope))\r\n  ","$":{"name":"ResolveNameInternal","parameters":"variable, value, objtype","type":"object"}},{"_":"\r\n    value = Trim(LCase(value))\r\n    fullmatches = NewObjectList()\r\n    partialmatches = NewObjectList()\r\n    foreach (obj, scope) {\r\n      name = LCase(GetDisplayAlias(obj))\r\n      CompareNames (name, value, obj, fullmatches, partialmatches)\r\n      if (obj.alt <> null) {\r\n        foreach (altname, obj.alt) {\r\n          CompareNames (LCase(altname), value, obj, fullmatches, partialmatches)\r\n        }\r\n      }\r\n    }\r\n    // allow referring to objects from the previous command by gender or article\r\n    if (objtype = \"object\" and game.lastobjects <> null) {\r\n      foreach (obj, game.lastobjects) {\r\n        CompareNames (LCase(obj.article), value, obj, fullmatches, partialmatches)\r\n        CompareNames (LCase(obj.gender), value, obj, fullmatches, partialmatches)\r\n      }\r\n    }\r\n    // Also check the secondary scope, but only if we have not found anything yet\r\n    if (ListCount(fullmatches) = 0 and ListCount(partialmatches) = 0 and not secondaryscope = null) {\r\n      foreach (obj, secondaryscope) {\r\n        name = LCase(GetDisplayAlias(obj))\r\n        CompareNames (name, value, obj, fullmatches, partialmatches)\r\n        if (obj.alt <> null) {\r\n          foreach (altname, obj.alt) {\r\n            CompareNames (LCase(altname), value, obj, fullmatches, partialmatches)\r\n          }\r\n        }\r\n      }\r\n    }\r\n    if (ListCount(fullmatches) = 1) {\r\n      return (ListItem(fullmatches, 0))\r\n    }\r\n    else if (ListCount(fullmatches) = 0 and ListCount(partialmatches) = 1) {\r\n      return (ListItem(partialmatches, 0))\r\n    }\r\n    else if (ListCount(fullmatches) + ListCount(partialmatches) = 0) {\r\n      return (null)\r\n    }\r\n    else {\r\n      candidates = ListCompact(fullmatches + partialmatches)\r\n      if (LengthOf(variable) > 0) {\r\n        // single object command, so after showing the menu, add the object to game.pov.currentcommandresolvedelements\r\n        game.pov.currentcommandpendingvariable = variable\r\n        ShowMenu (DynamicTemplate(\"DisambiguateMenu\", value), candidates, true) {\r\n          varname = game.pov.currentcommandpendingvariable\r\n          game.pov.currentcommandpendingvariable = null\r\n          if (result <> null) {\r\n            AddToResolvedNames (varname, GetObject(result))\r\n          }\r\n        }\r\n      }\r\n      else {\r\n        // multi-object command, so after showing the menu, add the object to the list\r\n        game.pov.currentcommandmultiobjectpending = true\r\n        ShowMenu (DynamicTemplate(\"DisambiguateMenu\", value), candidates, true) {\r\n          if (result <> null) {\r\n            list add (game.pov.currentcommandpendingobjectlist, GetObject(result))\r\n            ResolveNextNameListItem\r\n          }\r\n        }\r\n      }\r\n      return (null)\r\n    }\r\n  ","$":{"name":"ResolveNameFromList","parameters":"variable, value, objtype, scope, secondaryscope","type":"object"}},{"_":"\r\n    game.pov.currentcommandpendingobjectlist = NewObjectList()\r\n    game.pov.currentcommandpendingobjectlistunresolved = NewStringList()\r\n    game.pov.currentcommandpendingobjecttype = objtype\r\n    inputlist = Split(value, \",\")\r\n    foreach (inputbase, inputlist) {\r\n      inputlist2 = Split(inputbase, \" \" + Template(\"And\") + \" \")\r\n      foreach (input, inputlist2) {\r\n        list add (game.pov.currentcommandpendingobjectlistunresolved, input)\r\n      }\r\n    }\r\n    ResolveNextNameListItem\r\n  ","$":{"name":"ResolveNameList","parameters":"value, objtype"}},{"_":"\r\n    resolvedall = false\r\n    if (TypeOf(game.pov, \"currentcommandpendingobjectlistunresolved\") = \"stringlist\") {\r\n      queuelength = ListCount(game.pov.currentcommandpendingobjectlistunresolved)\r\n      if (queuelength > 0) {\r\n        thisitem = Trim(StringListItem(game.pov.currentcommandpendingobjectlistunresolved, 0))\r\n        if (queuelength = 1) {\r\n          game.pov.currentcommandpendingobjectlistunresolved = null\r\n        }\r\n        else {\r\n          newqueue = NewStringList()\r\n          for (i, 1, queuelength - 1) {\r\n            list add (newqueue, StringListItem(game.pov.currentcommandpendingobjectlistunresolved, i))\r\n          }\r\n          game.pov.currentcommandpendingobjectlistunresolved = newqueue\r\n        }\r\n        ResolveNameListItem (Trim(thisitem))\r\n      }\r\n      else {\r\n        resolvedall = true\r\n      }\r\n    }\r\n    else {\r\n      resolvedall = true\r\n    }\r\n    if (resolvedall) {\r\n      ResolveNameListItemFinished (game.pov.currentcommandpendingobjectlist)\r\n    }\r\n  ","$":{"name":"ResolveNextNameListItem"}},{"_":"\r\n    if (ListContains(game.allobjects, value)) {\r\n      // value is \"all\"\r\n      if (not DictionaryContains(game.pov.currentcommandresolvedelements, \"multiple\")) {\r\n        dictionary add (game.pov.currentcommandresolvedelements, \"multiple\", true)\r\n      }\r\n      ResolveNameListItemFinished (game.pov.currentcommandpendingobjectscope)\r\n    }\r\n    else {\r\n      object = ResolveName(\"\", value, game.pov.currentcommandpendingobjecttype)\r\n      if (object <> null) {\r\n        if (not ListContains(game.pov.currentcommandpendingobjectlist, object)) {\r\n          list add (game.pov.currentcommandpendingobjectlist, object)\r\n        }\r\n        ResolveNextNameListItem\r\n      }\r\n    }\r\n  ","$":{"name":"ResolveNameListItem","parameters":"value"}},{"_":"\r\n    if (ListCount(result) > 1) {\r\n      if (not DictionaryContains(game.pov.currentcommandresolvedelements, \"multiple\")) {\r\n        dictionary add (game.pov.currentcommandresolvedelements, \"multiple\", true)\r\n      }\r\n    }\r\n    AddToResolvedNames (game.pov.currentcommandpendingvariable, result)\r\n  ","$":{"name":"ResolveNameListItemFinished","parameters":"result"}},{"_":"\r\n    // TO DO: Update names below, we don't need these two variables\r\n    unresolvedobject = objectname\r\n    unresolvedkey = varname\r\n    if (HasString(game.pov.currentcommandpattern, \"unresolved\")) {\r\n      if (ListCount(game.pov.currentcommandvarlist) > 1) {\r\n        msg (game.pov.currentcommandpattern.unresolved + \" (\" + unresolvedobject + \")\")\r\n      }\r\n      else {\r\n        msg (game.pov.currentcommandpattern.unresolved)\r\n      }\r\n    }\r\n    else {\r\n      if (ListCount(game.pov.currentcommandvarlist) > 1) {\r\n        msg (Template(\"UnresolvedObject\") + \" (\" + unresolvedobject + \")\")\r\n      }\r\n      else {\r\n        msg (Template(\"UnresolvedObject\"))\r\n      }\r\n    }\r\n    game.unresolvedcommand = game.pov.currentcommandpattern\r\n    game.unresolvedcommandvarlist = game.pov.currentcommandvarlist\r\n    game.unresolvedcommandkey = unresolvedkey\r\n  ","$":{"name":"UnresolvedCommand","parameters":"objectname, varname"}},{"_":"\r\n    dictionary = GetAttribute(object, property)\r\n    if (DictionaryContains(dictionary, object2.name)) {\r\n      parameters = NewDictionary()\r\n      dictionary add (parameters, \"this\", object)\r\n      dictionary add (parameters, \"object\", object2)\r\n      invoke (ScriptDictionaryItem(dictionary, object2.name), parameters)\r\n    }\r\n    else {\r\n      parameters = NewDictionary()\r\n      dictionary add (parameters, \"this\", object)\r\n      dictionary add (parameters, \"object\", object2)\r\n      if (DictionaryContains(dictionary, \"default\")) {\r\n        invoke (ScriptDictionaryItem(dictionary, \"default\"), parameters)\r\n      }\r\n      else {\r\n        msg (default)\r\n      }\r\n    }\r\n  ","$":{"name":"HandleMultiVerb","parameters":"object, property, object2, default"}},{"_":"\r\n    // CHANGE PIX: Returns a list, not an objectlist because that is what ListCombine gives us\r\n    // msg(\"In GetScope\")\r\n    // msg(\"variable=\" + variable)\r\n    // msg(\"value=\" + value)\r\n    // msg(\"objtype=\" + objtype)\r\n    items = NewObjectList()\r\n    if (HasString(game.pov.currentcommandpattern, \"scope\")) {\r\n      scoping = GetScoping(game.pov.currentcommandpattern.scope, variable)\r\n      // CHANGE: the \"scope\" for a command can now be a comma-separated list of the accepted values\r\n      foreach (partscope, Split(scoping, \";\")) {\r\n        switch (partscope) {\r\n          case (\"inventory\") {\r\n            items = ListCombine(items, ScopeInventory())\r\n          }\r\n          case (\"notheld\", \"room\") {\r\n            items = ListCombine(items, ScopeVisibleNotHeld()) - game.pov\r\n          }\r\n          case (\"all\") {\r\n            items = ListCombine(items, ScopeVisible()) - game.pov\r\n          }\r\n          case (\"container\") {\r\n            items = ListCombine(items, FilterByType(ScopeVisible(), \"container_base\"))\r\n          }\r\n          case (\"contents\") {\r\n            foreach (cont, FilterByType(ScopeVisible(), \"container_base\")) {\r\n              items = ListCombine(items, GetAllChildObjects(cont))\r\n            }\r\n          }\r\n          case (\"world\") {\r\n            items = ListCombine(items, AllObjects())\r\n          }\r\n          case (\"none\") {\r\n          }\r\n          default {\r\n            // The command's \"scope\" can be the name of an object, or an attribute of the player's parent\r\n            obj = GetObject(partscope)\r\n            if (not obj = null) {\r\n              items = ListCombine(items, GetAllChildObjects(obj))\r\n            }\r\n            if (HasObject(game.pov.parent, partscope)) {\r\n              obj = GetAttribute(game.pov.parent, partscope)\r\n              items = ListCombine(items, GetAllChildObjects(obj))\r\n            }\r\n            else if (HasAttribute(game.pov.parent, partscope)) {\r\n              attr = GetAttribute(game.pov.parent, partscope)\r\n              if (TypeOf(attr) = \"objectlist\") {\r\n                items = ListCombine (items, attr)\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    else if (objtype = \"object\") {\r\n      items = ScopeVisible()\r\n    }\r\n    else if (objtype = \"exit\") {\r\n      items = ScopeExits()\r\n    }\r\n    else {\r\n      // Should never get here!\r\n      // CHANGE: Should still never get here, but we don't return null.\r\n      // If we get here somehow, trust user's scripts to define scope.\r\n    }\r\n    items = ListCompact(items)\r\n    // CHANGE: Run the script 'changecommandscope' (if it exists) for the game object, the player's room and\r\n    // containing rooms, and the current command. This allows the user to change command scope on a per-location\r\n    // or per-command basis\r\n    // This script gets an \"items\" list parameter, like `scopebackdrop` script does; but also has parameters\r\n    // 'command', 'variable', and 'objtype', so the user can adjust their script to give different item lists\r\n    // for different commands, or different variables within a command.\r\n    objectswithscripts = NewObjectList()\r\n    if (HasScript(game.pov.currentcommandpattern, \"changecommandscope\")) {\r\n      list add (objectswithscripts, game.pov.currentcommandpattern)\r\n    }\r\n    room = game.pov\r\n    while (not room = null) {\r\n      if (HasScript(room, \"changecommandscope\")) {\r\n        list add (objectswithscripts, room)\r\n      }\r\n      room = room.parent\r\n    }\r\n    if (HasScript(game, \"changecommandscope\")) {\r\n      list add (objectswithscripts, game)\r\n    }\r\n    if (ListCount(objectswithscripts) > 0) {\r\n      params = NewDictionary()\r\n      dictionary add (params, \"items\", items)\r\n      dictionary add (params, \"command\", game.pov.currentcommandpattern)\r\n      dictionary add (params, \"variable\", variable)\r\n      dictionary add (params, \"objtype\", objtype)\r\n      dictionary add (params, \"matched\", game.pov.currentcommandresolvedelements)\r\n      foreach (o, objectswithscripts) {\r\n        do (o, \"changecommandscope\", params)\r\n      }\r\n      items = ListCompact(items)\r\n    }\r\n    return (items)\r\n  ","$":{"name":"GetScope","parameters":"variable, value, objtype","type":"list"}},{"_":"\r\n    lst = Split(scopestring, \"|\")\r\n    if (ListCount(lst) = 1) {\r\n      return (scopestring)\r\n    }\r\n    foreach (s, lst) {\r\n      if (StartsWith(s, variable + \"=\")) {\r\n        return (Mid(s, LengthOf(variable) + 2))\r\n      }\r\n    }\r\n    return (\"all\")\r\n  ","$":{"name":"GetScoping","parameters":"scopestring, variable","type":"string"}},{"_":"\r\n    if (name = value) {\r\n      if (not ListContains(fullmatches, obj)) {\r\n        list add (fullmatches, obj)\r\n      }\r\n    }\r\n    else {\r\n      if (StartsWith(name, value)) {\r\n        if (not ListContains(partialmatches, obj)) {\r\n          list add (partialmatches, obj)\r\n        }\r\n      }\r\n      else {\r\n        // check if input matches the start of any word in the name\r\n        if (Instr(name, \" \" + value) > 0) {\r\n          if (not ListContains(partialmatches, obj)) {\r\n            list add (partialmatches, obj)\r\n          }\r\n        }\r\n      }\r\n    }\r\n  ","$":{"name":"CompareNames","parameters":"name, value, obj, fullmatches, partialmatches"}},{"_":"\r\n    msg (\"WARNING: GenerateMenuChoices is deprecated as ShowMenu can handle lists with objects\")\r\n    foreach (obj, objects) {\r\n      if (not DictionaryContains(dictionary, obj.name)) {\r\n        dictionary add (dictionary, obj.name, GetDisplayAlias(obj))\r\n      }\r\n    }\r\n  ","$":{"name":"GenerateMenuChoices","parameters":"dictionary, objects"}},{"_":"\r\n    return (ListExclude(ScopeVisibleNotHeldNotScenery(), game.pov))\r\n  ","$":{"name":"GetPlacesObjectsList","type":"objectlist"}},{"_":"\r\n    return (RemoveLookOnlyExits(RemoveSceneryObjects(ScopeExits())))\r\n  ","$":{"name":"GetExitsList","type":"objectlist"}},{"_":"\r\n    result = NewObjectList()\r\n    foreach (obj, GetAllChildObjects(game.pov)) {\r\n      if (ContainsVisible(game.pov, obj)) {\r\n        list add (result, obj)\r\n      }\r\n    }\r\n    return (result)\r\n  ","$":{"name":"ScopeInventory","type":"objectlist"}},{"_":"\r\n    result = NewObjectList()\r\n    foreach (obj, GetAllChildObjects(game.pov)) {\r\n      if (ContainsReachable(game.pov, obj)) {\r\n        list add (result, obj)\r\n      }\r\n    }\r\n    return (result)\r\n  ","$":{"name":"ScopeReachableInventory","type":"objectlist"}},{"_":"\r\n    return (ScopeVisibleNotHeldForRoom(game.pov.parent))\r\n  ","$":{"name":"ScopeVisibleNotHeld","type":"objectlist"}},{"_":"\r\n    if (room = game.pov.parent) {\r\n      result = ListCombine(ScopeReachableNotHeldForRoom(room), ScopeVisibleNotReachableForRoom(room))\r\n      list add (result, game.pov)\r\n      return (result)\r\n    }\r\n    else {\r\n      return (ListCombine(ScopeReachableNotHeldForRoom(room), ScopeVisibleNotReachableForRoom(room)))\r\n    }\r\n  ","$":{"name":"ScopeVisibleNotHeldForRoom","parameters":"room","type":"objectlist"}},{"_":"\r\n    return (ScopeVisibleNotHeldNotSceneryForRoom(game.pov.parent))\r\n  ","$":{"name":"ScopeVisibleNotHeldNotScenery","type":"objectlist"}},{"_":"\r\n    return (RemoveSceneryObjects(ScopeVisibleNotHeldForRoom(room)))\r\n  ","$":{"name":"ScopeVisibleNotHeldNotSceneryForRoom","parameters":"room","type":"objectlist"}},{"_":"\r\n    return (ScopeReachableForRoom(game.pov.parent))\r\n  ","$":{"name":"ScopeReachable","type":"objectlist"}},{"_":"\r\n    if (room = game.pov.parent) {\r\n      result = ListCombine(ScopeReachableNotHeldForRoom(room), ScopeReachableInventory())\r\n      list add (result, game.pov)\r\n    }\r\n    else {\r\n      result = ScopeReachableNotHeldForRoom(room)\r\n    }\r\n    return (result)\r\n  ","$":{"name":"ScopeReachableForRoom","parameters":"room","type":"objectlist"}},{"_":"\r\n    return (ScopeVisibleNotReachableForRoom(game.pov.parent))\r\n  ","$":{"name":"ScopeVisibleNotReachable","type":"objectlist"}},{"_":"\r\n    result = NewObjectList()\r\n    exclude = ScopeReachableForRoom(room)\r\n    list add (exclude, game.pov)\r\n    newParent = GetNonTransparentParent(room)\r\n    foreach (obj, GetAllChildObjects(newParent)) {\r\n      if (ContainsVisible(newParent, obj) and not ListContains(exclude, obj)) {\r\n        list add (result, obj)\r\n      }\r\n    }\r\n    return (result)\r\n  ","$":{"name":"ScopeVisibleNotReachableForRoom","parameters":"room","type":"objectlist"}},{"_":"\r\n    if (GetBoolean(room, \"transparent\")) {\r\n      if (room.parent = null) {\r\n        return (room)\r\n      }\r\n      else {\r\n        return (GetNonTransparentParent(room.parent))\r\n      }\r\n    }\r\n    else {\r\n      return (room)\r\n    }\r\n  ","$":{"name":"GetNonTransparentParent","parameters":"room","type":"object"}},{"_":"\r\n    return (ScopeReachableNotHeldForRoom(game.pov.parent))\r\n  ","$":{"name":"ScopeReachableNotHeld","type":"objectlist"}},{"_":"\r\n    result = ScopeVisible()\r\n    lightobjects = NewObjectList()\r\n    foreach (obj, result) {\r\n      if (GetBoolean(obj, \"lightsource\") and GetString(obj, \"lightstrength\") = lightstrength) {\r\n        list add (lightobjects, obj)\r\n      }\r\n    }\r\n    exits = ScopeExits()\r\n    foreach (obj, exits) {\r\n      if (GetBoolean(obj, \"lightsource\") and GetString(obj, \"lightstrength\") = lightstrength) {\r\n        list add (lightobjects, obj)\r\n      }\r\n    }\r\n    return (lightobjects)\r\n  ","$":{"name":"ScopeVisibleLightsource","parameters":"lightstrength","type":"objectlist"}},{"_":"\r\n    result = NewObjectList()\r\n    foreach (obj, GetAllChildObjects(room)) {\r\n      if (ContainsReachable(room, obj) and obj <> game.pov and not Contains(game.pov, obj)) {\r\n        list add (result, obj)\r\n      }\r\n    }\r\n    if (HasScript(game, \"scopebackdrop\")) {\r\n      dict = NewDictionary()\r\n      dictionary add (dict, \"items\", result)\r\n      do (game, \"scopebackdrop\", dict)\r\n    }\r\n    return (result)\r\n  ","$":{"name":"ScopeReachableNotHeldForRoom","parameters":"room","type":"objectlist"}},{"_":"\r\n    return (ScopeVisibleForRoom(game.pov.parent))\r\n  ","$":{"name":"ScopeVisible","type":"objectlist"}},{"_":"\r\n    if (room = game.pov.parent) {\r\n      return (ListCombine(ScopeVisibleNotHeldForRoom(room), ScopeInventory()))\r\n    }\r\n    else {\r\n      return (ScopeVisibleNotHeldForRoom(room))\r\n    }\r\n  ","$":{"name":"ScopeVisibleForRoom","parameters":"room","type":"objectlist"}},{"_":"\r\n    return (ScopeExitsForRoom(game.pov.parent))\r\n  ","$":{"name":"ScopeExits","type":"objectlist"}},{"_":"\r\n    result = NewObjectList()\r\n    foreach (exit, AllExits()) {\r\n      if (exit.parent = room) {\r\n        if (exit.visible) {\r\n          if (GetBoolean(room, \"darklevel\")) {\r\n            if (GetBoolean(exit, \"lightsource\")) {\r\n              list add (result, exit)\r\n            }\r\n          }\r\n          else {\r\n            list add (result, exit)\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return (result)\r\n  ","$":{"name":"ScopeExitsForRoom","parameters":"room","type":"objectlist"}},{"_":"\r\n    result = NewObjectList()\r\n    foreach (exit, AllExits()) {\r\n      if (exit.parent = room) {\r\n        if (exit.visible and not exit.locked) {\r\n          if (GetBoolean(room, \"darklevel\")) {\r\n            if (GetBoolean(exit, \"lightsource\")) {\r\n              list add (result, exit)\r\n            }\r\n          }\r\n          else {\r\n            list add (result, exit)\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return (result)\r\n  ","$":{"name":"ScopeUnlockedExitsForRoom","parameters":"room","type":"objectlist"}},{"_":"\r\n    result = NewObjectList()\r\n    foreach (command, AllCommands()) {\r\n      if (command.parent = null or command.parent = game.pov.parent) {\r\n        list add (result, command)\r\n      }\r\n      if (not game.pov.parent.parent = null) {\r\n        if (command.parent = game.pov.parent.parent) {\r\n          list add (result, command)\r\n        }\r\n      }\r\n    }\r\n    return (result)\r\n  ","$":{"name":"ScopeCommands","type":"objectlist"}},{"_":"\r\n    result = null\r\n    foreach (obj, ListParents(obj)) {\r\n      if (result = null and not CanReachThrough(obj)) {\r\n        result = obj\r\n      }\r\n    }\r\n    return (result)\r\n  ","$":{"name":"GetBlockingObject","parameters":"obj","type":"object"}},{"_":"\r\n    result = NewObjectList()\r\n    if (obj.parent <> null) {\r\n      parent_as_list = NewObjectList()\r\n      list add (parent_as_list, obj.parent)\r\n      result = ListCombine(parent_as_list, ListParents(obj.parent))\r\n    }\r\n    return (result)\r\n  ","$":{"name":"ListParents","parameters":"obj","type":"objectlist"}},{"_":"\r\n    return (ContainsAccessible(parentObj, searchObj, false))\r\n  ","$":{"name":"ContainsVisible","parameters":"parentObj, searchObj","type":"boolean"}},{"_":"\r\n    return (ContainsAccessible(parentObj, searchObj, true))\r\n  ","$":{"name":"ContainsReachable","parameters":"parentObj, searchObj","type":"boolean"}},{"_":"\r\n    if (not HasObject(searchObj, \"parent\")) {\r\n      return (false)\r\n    }\r\n    else if (not searchObj.visible) {\r\n      return (false)\r\n    }\r\n    else if (GetBoolean(parentObj, \"darklevel\") and not GetBoolean(searchObj, \"lightsource\")) {\r\n      return (false)\r\n    }\r\n    else {\r\n      if (searchObj.parent = null) {\r\n        return (false)\r\n      }\r\n      else if (searchObj.parent = parentObj) {\r\n        return (true)\r\n      }\r\n      else {\r\n        if (onlyReachable) {\r\n          canAdd = CanReachThrough(searchObj.parent)\r\n        }\r\n        else {\r\n          canAdd = CanSeeThrough(searchObj.parent)\r\n        }\r\n        if (canAdd) {\r\n          return (ContainsAccessible(parentObj, searchObj.parent, onlyReachable))\r\n        }\r\n        else {\r\n          return (false)\r\n        }\r\n      }\r\n    }\r\n  ","$":{"name":"ContainsAccessible","parameters":"parentObj, searchObj, onlyReachable","type":"boolean"}},{"_":"\r\n    result = 0\r\n    foreach (object, GetAllChildObjects ( obj )) {\r\n      if (HasInt(object, \"volume\")) {\r\n        result = result + object.volume\r\n      }\r\n    }\r\n    if (allinclusive and HasInt(obj, \"volume\")) {\r\n      result = result + obj.volume\r\n    }\r\n    return (result)\r\n  ","$":{"name":"GetVolume","parameters":"obj, allinclusive","type":"int"}},{"_":"\r\n    return ((GetBoolean(obj, \"transparent\") or CanReachThrough(obj)) and not GetBoolean(obj, \"hidechildren\"))\r\n  ","$":{"name":"CanSeeThrough","parameters":"obj","type":"boolean"}},{"_":"\r\n    return (GetBoolean(obj, \"isopen\") and not GetBoolean(obj, \"hidechildren\"))\r\n  ","$":{"name":"CanReachThrough","parameters":"obj","type":"boolean"}},{"_":"\r\n    return (ListContains(ScopeInventory(), obj))\r\n  ","$":{"name":"Got","parameters":"obj","type":"boolean"}},{"_":"\r\n    if (game.enablehyperlinks) {\r\n      data = NewStringDictionary()\r\n      foreach (object, ScopeVisible()) {\r\n        dictionary add (data, object.name, Join(GetDisplayVerbs(object), \"/\"))\r\n      }\r\n      JS.updateObjectLinks (data)\r\n      exits = NewStringList()\r\n      foreach (exit, ScopeExits()) {\r\n        list add (exits, exit.name)\r\n      }\r\n      JS.updateExitLinks (exits)\r\n      commands = NewStringList()\r\n      foreach (cmd, ScopeCommands()) {\r\n        list add (commands, cmd.name)\r\n      }\r\n      JS.updateCommandLinks (commands)\r\n    }\r\n  ","$":{"name":"UpdateObjectLinks"}},{"_":"\r\n    return (NewObjectList())\r\n  ","$":{"name":"SecondaryScopeReachableForRoom","parameters":"room","type":"objectlist"}},{"_":"\r\n    isDark = CheckDarkness()\r\n    if (isDark) {\r\n      descriptionfield = \"darkroomdescription\"\r\n    }\r\n    else {\r\n      descriptionfield = \"description\"\r\n    }\r\n    if (game.autodescription) {\r\n      desc = \"\"\r\n      for (i, 1, 4) {\r\n        if (i = game.autodescription_youarein) {\r\n          if (game.autodescription_youarein_useprefix) {\r\n            youarein = game.pov.parent.descprefix\r\n            desc = AddDescriptionLine (desc, youarein + \" \" + GetDisplayName(game.pov.parent) + \".\")\r\n          }\r\n          else {\r\n            desc = AddDescriptionLine (desc, \"<b>\" + CapFirst(GetDisplayName(game.pov.parent)) + \"</b>\")\r\n          }\r\n          if (game.autodescription_youarein_newline) {\r\n            msg (desc + \"<br/>\")\r\n            desc = \"\"\r\n          }\r\n        }\r\n        if (i = game.autodescription_youcansee) {\r\n          objects = FormatObjectList(game.pov.parent.objectslistprefix, GetNonTransparentParent(game.pov.parent), Template(\"And\"), \".\")\r\n          desc = AddDescriptionLine(desc, objects)\r\n          if (game.autodescription_youcansee_newline) {\r\n            msg (desc + \"<br/>\")\r\n            desc = \"\"\r\n          }\r\n        }\r\n        if (i = game.autodescription_youcango) {\r\n          exits = FormatExitList(game.pov.parent.exitslistprefix, GetExitsList(), Template(\"Or\"), \".\")\r\n          desc = AddDescriptionLine(desc, exits)\r\n          if (game.autodescription_youcango_newline) {\r\n            msg (desc + \"<br/>\")\r\n            desc = \"\"\r\n          }\r\n        }\r\n        if (i = game.autodescription_description) {\r\n          if (HasScript(game.pov.parent, descriptionfield)) {\r\n            if (LengthOf(desc) > 0) {\r\n              msg (desc)\r\n              desc = \"\"\r\n            }\r\n            do (game.pov.parent, descriptionfield)\r\n            if (game.autodescription_description_newline) {\r\n              msg (\"\")\r\n            }\r\n          }\r\n          else {\r\n            desc = AddDescriptionLine(desc, GetRoomDescription())\r\n            if (game.autodescription_description_newline) {\r\n              msg (desc + \"<br/>\")\r\n              desc = \"\"\r\n            }\r\n          }\r\n        }\r\n      }\r\n      if (LengthOf(desc) > 0) {\r\n        msg (desc)\r\n      }\r\n    }\r\n    else {\r\n      if (HasScript(game.pov.parent, descriptionfield)) {\r\n        do (game.pov.parent, descriptionfield)\r\n      }\r\n      else {\r\n        fulldesc = GetRoomDescription()\r\n        if (LengthOf(fulldesc) > 0) {\r\n          msg (fulldesc)\r\n        }\r\n      }\r\n    }\r\n  ","$":{"name":"ShowRoomDescription"}},{"_":"\r\n    if (LengthOf(line) > 0) {\r\n      if (LengthOf(desc) > 0) {\r\n        msg (desc)\r\n        desc = \"\"\r\n      }\r\n      desc = desc + line\r\n    }\r\n    return (desc)\r\n  ","$":{"name":"AddDescriptionLine","parameters":"desc, line","type":"string"}},{"_":"\r\n    fulldesc = \"\"\r\n    if (CheckDarkness()) {\r\n      if (HasString(game.pov.parent, \"darkroomdescription\")) {\r\n        if (LengthOf(game.pov.parent.darkroomdescription) > 0) {\r\n          fulldesc = game.pov.parent.darkroomdescription\r\n        }\r\n      }\r\n      // Added by The Pixie to correct what appears to be a bug\r\n      if (fulldesc = \"\") {\r\n        fulldesc = DynamicTemplate(\"LookAtDarkness\", game.pov.parent)\r\n      }\r\n    }\r\n    else {\r\n      if (HasString(game.pov.parent, \"description\")) {\r\n        if (LengthOf(game.pov.parent.description) > 0) {\r\n          fulldesc = game.pov.parent.description\r\n        }\r\n      }\r\n    }\r\n    if (game.appendobjectdescription) {\r\n      foreach (val, ScopeVisibleNotHeld()) {\r\n        if (HasString(val, \"inroomdescription\")) {\r\n          if (LengthOf(val.inroomdescription) > 0 and val <> game.pov) {\r\n            fulldesc = fulldesc + \" \" + val.inroomdescription\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return (Trim(fulldesc))\r\n  ","$":{"name":"GetRoomDescription","type":"string"}},{"_":"\r\n    game.displayroomdescriptiononstart = false\r\n    if (IsDefined(\"oldRoom\")) {\r\n      if (oldRoom <> null) {\r\n        if (game.clearscreenonroomenter) {\r\n          ClearScreen\r\n          if (not game.currentexitmessage = null) {\r\n            msg (game.currentexitmessage)\r\n            game.currentexitmessage = null\r\n          }\r\n        }\r\n        if (HasScript(oldRoom, \"onexit\")) {\r\n          do (oldRoom, \"onexit\")\r\n        }\r\n      }\r\n    }\r\n    on ready {\r\n      if ((not GetBoolean(game.pov.parent, \"visited\")) and HasScript(game.pov.parent, \"beforefirstenter\")) {\r\n        do (game.pov.parent, \"beforefirstenter\")\r\n      }\r\n      on ready {\r\n        if (HasScript(game.pov.parent, \"beforeenter\")) {\r\n          do (game.pov.parent, \"beforeenter\")\r\n        }\r\n        on ready {\r\n          if (game.gridmap) {\r\n            Grid_CalculateMapCoordinates (game.pov.parent, game.pov)\r\n            Grid_DrawPlayerInRoom (game.pov.parent)\r\n          }\r\n          if (IsDefined(\"oldRoom\")) {\r\n            if (oldRoom <> null and game.changeroom_newline and not game.command_newline) {\r\n              msg (\"\")\r\n            }\r\n          }\r\n          request (UpdateLocation, CapFirst(GetDisplayName(game.pov.parent)))\r\n          roomFrameExists = false\r\n          if (HasString(game.pov.parent, \"picture\")) {\r\n            if (LengthOf(game.pov.parent.picture) > 0) {\r\n              roomFrameExists = true\r\n              SetFramePicture (game.pov.parent.picture)\r\n            }\r\n          }\r\n          if (game.clearframe and not roomFrameExists) {\r\n            ClearFramePicture\r\n          }\r\n          if (game.showdescriptiononenter) {\r\n            ShowRoomDescription\r\n          }\r\n          if (HasScript( game, \"roomenter\")) {\r\n            do (game, \"roomenter\")\r\n          }\r\n          on ready {\r\n            if ((not GetBoolean(game.pov.parent, \"visited\")) and HasScript(game.pov.parent, \"firstenter\")) {\r\n              do (game.pov.parent, \"firstenter\")\r\n            }\r\n            on ready {\r\n              if (HasScript(game.pov.parent, \"enter\")) {\r\n                do (game.pov.parent, \"enter\")\r\n              }\r\n            }\r\n            set (game.pov.parent, \"visited\", true)\r\n          }\r\n        }\r\n      }\r\n    }\r\n  ","$":{"name":"OnEnterRoom","parameters":"oldRoom"}},{"_":"\r\n    result = \"\"\r\n    count = 0\r\n    list = RemoveSceneryObjects(GetDirectChildren(parent))\r\n    if (CheckDarkness()) {\r\n      list = RemoveDarkObjects(list)\r\n    }\r\n    listLength = ListCount(list)\r\n    foreach (item, list) {\r\n      if (LengthOf(result) = 0) {\r\n        result = preList + \" \"\r\n      }\r\n      result = result + GetDisplayNameLink(item, \"object\")\r\n      if (CanSeeThrough(item)) {\r\n        result = result + FormatObjectList(\" (\" + item.contentsprefix, item, preFinal, \")\")\r\n      }\r\n      count = count + 1\r\n      if (count = listLength - 1) {\r\n        result = result + \" \" + preFinal + \" \"\r\n      }\r\n      else if (count < listLength) {\r\n        result = result + \", \"\r\n      }\r\n      else {\r\n        result = result + postList\r\n      }\r\n    }\r\n    return (result)\r\n  ","$":{"name":"FormatObjectList","parameters":"preList, parent, preFinal, postList","type":"string"}},{"_":"\r\n    result = NewObjectList()\r\n    foreach (obj, list) {\r\n      if (not obj.scenery and obj <> game.pov and obj.visible) {\r\n        list add (result, obj)\r\n      }\r\n    }\r\n    return (result)\r\n  ","$":{"name":"RemoveSceneryObjects","parameters":"list","type":"objectlist"}},{"_":"\r\n    result = NewObjectList()\r\n    foreach (obj, list) {\r\n      if (not obj.lookonly) {\r\n        list add (result, obj)\r\n      }\r\n    }\r\n    return (result)\r\n  ","$":{"name":"RemoveLookOnlyExits","parameters":"list","type":"objectlist"}},{"_":"\r\n    result = NewObjectList()\r\n    foreach (obj, list) {\r\n      if (GetBoolean(obj, \"lightsource\") or obj.parent = game.pov) {\r\n        list add (result, obj)\r\n      }\r\n    }\r\n    return (result)\r\n  ","$":{"name":"RemoveDarkObjects","parameters":"list","type":"objectlist"}},{"_":"\r\n    result = \"\"\r\n    listLength = ListCount(list)\r\n    if (listLength > 0) {\r\n      count = 0\r\n      result = preList + \" \"\r\n      foreach (item, list) {\r\n        result = result + GetDisplayNameLink(item, \"exit\")\r\n        count = count + 1\r\n        if (count = listLength - 1) {\r\n          result = result + \" \" + preFinal + \" \"\r\n        }\r\n        else if (count < listLength) {\r\n          result = result + \", \"\r\n        }\r\n      }\r\n      result = result + postList\r\n    }\r\n    return (result)\r\n  ","$":{"name":"FormatExitList","parameters":"preList, list, preFinal, postList","type":"string"}},{"_":"\r\n    if (HasString(obj, \"alias\")) {\r\n      result = obj.alias\r\n    }\r\n    else {\r\n      result = obj.name\r\n    }\r\n    return (result)\r\n  ","$":{"name":"GetDisplayAlias","parameters":"obj","type":"string"}},{"_":"\r\n    return (GetDisplayNameLink(obj, \"\"))\r\n  ","$":{"name":"GetDisplayName","parameters":"obj","type":"string"}},{"_":"\r\n    verbs = GetDisplayVerbs(obj)\r\n    if (verbs <> null) {\r\n      verbCount = ListCount(verbs)\r\n    }\r\n    else {\r\n      verbCount = 0\r\n    }\r\n    if (type = \"exit\" and verbCount = 1) {\r\n      if (not game.enablehyperlinks) {\r\n        result = GetDisplayAlias(obj)\r\n      }\r\n      else {\r\n        result = \"{exit:\" + obj.name + \"}\"\r\n      }\r\n    }\r\n    else if (type = \"\") {\r\n      result = GetDisplayAlias(obj)\r\n    }\r\n    else {\r\n      result = \"{object:\" + obj.name + \"}\"\r\n    }\r\n    if (not GetBoolean(obj, \"usedefaultprefix\")) {\r\n      if (obj.prefix = null) {\r\n        prefix = \"\"\r\n      }\r\n      else {\r\n        prefix = obj.prefix\r\n      }\r\n    }\r\n    else if (type = \"exit\") {\r\n      prefix = \"\"\r\n    }\r\n    else {\r\n      prefix = GetDefaultPrefix(obj)\r\n    }\r\n    if (LengthOf(prefix) > 0) {\r\n      prefix = prefix + \" \"\r\n    }\r\n    result = prefix + result\r\n    if (not GetBoolean(obj, \"usedefaultprefix\") and HasString(obj, \"suffix\")) {\r\n      if (LengthOf(obj.suffix) > 0) {\r\n        result = result + \" \" + obj.suffix\r\n      }\r\n    }\r\n    return (result)\r\n  ","$":{"name":"GetDisplayNameLink","parameters":"obj, type","type":"string"}},{"_":"\r\n    return (\"{object:\" + obj.name + \"}\")\r\n  ","$":{"name":"ObjectLink","parameters":"obj","type":"string"}},{"_":"\r\n    if (HasString(obj, \"listalias\")) {\r\n      result = obj.listalias\r\n    }\r\n    else {\r\n      result = GetDisplayAlias(obj)\r\n    }\r\n    return (result)\r\n  ","$":{"name":"GetListDisplayAlias","parameters":"obj","type":"string"}},{"_":"\r\n    roomCheckDarkness = true\r\n    if (GetBoolean(game.pov.parent, \"dark\")) {\r\n      if (ListCount(ScopeVisibleLightsource(\"strong\")) > 0) {\r\n        roomCheckDarkness = false\r\n      }\r\n    }\r\n    else {\r\n      roomCheckDarkness = false\r\n    }\r\n    game.pov.parent.darklevel = roomCheckDarkness\r\n    return (roomCheckDarkness)\r\n  ","$":{"name":"CheckDarkness","type":"boolean"}},{"_":"\r\n    timer.enabled = true\r\n    timer.trigger = game.timeelapsed + timer.interval\r\n  ","$":{"name":"EnableTimer","parameters":"timer"}},{"_":"\r\n    timer.enabled = false\r\n  ","$":{"name":"DisableTimer","parameters":"timer"}},{"_":"\r\n    timer.interval = interval\r\n  ","$":{"name":"SetTimerInterval","parameters":"timer, interval"}},{"_":"\r\n    timer.script = script\r\n  ","$":{"name":"SetTimerScript","parameters":"timer, script"}},{"_":"\r\n    SetTimeoutID (interval, \"\", script)\r\n  ","$":{"name":"SetTimeout","parameters":"interval, script"}},{"_":"\r\n    timername = \"\"\r\n    if (name = \"\") {\r\n      timername = GetUniqueElementName(\"timeout\")\r\n    }\r\n    else {\r\n      if (GetTimer(name) = null and GetObject(name) = null) {\r\n        timername = name\r\n      }\r\n      else {\r\n        error (\"Error creating timer: There is already an existing object named \" + name)\r\n      }\r\n    }\r\n    if (not timername = \"\") {\r\n      create timer (timername)\r\n      timer = GetTimer(timername)\r\n      SetTimerInterval (timer, interval)\r\n      timer.timeoutscript = script\r\n      SetTimerScript (timer) {\r\n        this.enabled = false\r\n        invoke (this.timeoutscript)\r\n        destroy (this.name)\r\n      }\r\n      EnableTimer (timer)\r\n    }\r\n  ","$":{"name":"SetTimeoutID","parameters":"interval, name, script"}},{"_":"\r\n    request (Pause, ToString(interval * 1000))\r\n  ","$":{"name":"Pause","parameters":"interval"}},{"_":"\r\n    if (IsGameRunning()) {\r\n      if (game.menucallback = null) {\r\n        foreach (turnscript, ObjectListSort(AllTurnScripts(), \"name\")) {\r\n          if (GetBoolean(turnscript, \"enabled\")) {\r\n            inscope = false\r\n            if (turnscript.parent = game or turnscript.parent = null) {\r\n              inscope = true\r\n            }\r\n            else {\r\n              if (Contains(turnscript.parent, game.pov)) {\r\n                inscope = true\r\n              }\r\n            }\r\n            if (inscope) {\r\n              do (turnscript, \"script\")\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  ","$":{"name":"RunTurnScripts"}},{"_":"\r\n    turnscript.enabled = true\r\n  ","$":{"name":"EnableTurnScript","parameters":"turnscript"}},{"_":"\r\n    turnscript.enabled = false\r\n  ","$":{"name":"DisableTurnScript","parameters":"turnscript"}},{"_":"\r\n    turnscript.script = script\r\n  ","$":{"name":"SetTurnScript","parameters":"turnscript, script"}},{"_":"\r\n    SetTurnTimeoutID (turncount, \"\", script)\r\n  ","$":{"name":"SetTurnTimeout","parameters":"turncount, script"}},{"_":"\r\n    turnscriptname = \"\"\r\n    if (name = \"\") {\r\n      turnscriptname = GetUniqueElementName(\"turnscript\")\r\n    }\r\n    else {\r\n      if (GetObject(name) = null and GetTimer(name) = null) {\r\n        turnscriptname = name\r\n      }\r\n      else {\r\n        error (\"Error creating turnscript: There is already an existing object named \" + name)\r\n      }\r\n    }\r\n    if (not turnscriptname=\"\") {\r\n      create turnscript (turnscriptname)\r\n      turnscript = GetObject(turnscriptname)\r\n      turnscript.turncount = 0\r\n      turnscript.triggerturncount = turncount\r\n      turnscript.timeoutscript = script\r\n      SetTurnScript (turnscript) {\r\n        this.turncount = this.turncount + 1\r\n        if (this.turncount >= this.triggerturncount) {\r\n          this.enabled = false\r\n          invoke (this.timeoutscript)\r\n          destroy (this.name)\r\n        }\r\n      }\r\n      EnableTurnScript (turnscript)\r\n    }\r\n  ","$":{"name":"SetTurnTimeoutID","parameters":"turncount, name, script"}},{"_":"\r\n    status = AddStatusAttributesForElement(\"\", game, game.statusattributes)\r\n    status = AddStatusAttributesForElement(status, game.pov, game.povstatusattributes)\r\n    status = AddStatusAttributesForElement(status, game.pov, game.pov.statusattributes)\r\n    request (SetStatus, status)\r\n  ","$":{"name":"UpdateStatusAttributes"}},{"_":"\r\n    if (statusAttributes <> null) {\r\n      foreach (attr, statusAttributes) {\r\n        if (LengthOf(status) > 0) {\r\n          status = status + \"\\n\"\r\n        }\r\n        status = status + FormatStatusAttribute(attr, GetAttribute(element, attr), StringDictionaryItem(statusAttributes, attr))\r\n      }\r\n    }\r\n    return (status)\r\n  ","$":{"name":"AddStatusAttributesForElement","parameters":"status, element, statusAttributes","type":"string"}},{"_":"\r\n    if (LengthOf(format) = 0) {\r\n      return (CapFirst(attr) + \": \" + value)\r\n    }\r\n    else {\r\n      if (TypeOf(value) = \"int\" and attr = \"money\" and HasString(game, \"moneyformat\")) {\r\n        value = DisplayMoney(value)\r\n      }\r\n      else if (TypeOf(value) = \"int\" or TypeOf(value) = \"double\") {\r\n        value = ToString(value)\r\n      }\r\n      else if (TypeOf(value) = \"null\") {\r\n        value = \"\"\r\n      }\r\n      return (Replace(format, \"!\", value))\r\n    }\r\n  ","$":{"name":"FormatStatusAttribute","parameters":"attr, value, format","type":"string"}},{"_":"\r\n    if (game.showscore) {\r\n      game.score = 0\r\n      if (game.statusattributes = null) {\r\n        game.statusattributes = NewStringDictionary()\r\n      }\r\n      dictionary add (game.statusattributes, \"score\", \"Score: !\")\r\n    }\r\n    if (game.showhealth) {\r\n      if (game.povstatusattributes = null) {\r\n        game.povstatusattributes = NewStringDictionary()\r\n      }\r\n      dictionary add (game.povstatusattributes, \"health\", \"Health: !%\")\r\n    }\r\n    if (game.showmoney) {\r\n      if (game.povstatusattributes = null) {\r\n        game.povstatusattributes = NewStringDictionary()\r\n      }\r\n      dictionary add (game.povstatusattributes, \"money\", \"Money: !\")\r\n    }\r\n  ","$":{"name":"InitStatusAttributes"}},{"_":"\r\n    if (not HasInt(game, \"score\")) {\r\n      error (\"Score is not configured. To enable score, go to 'game' and tick 'Show score' on the Player tab.\")\r\n    }\r\n    game.score = game.score + amount\r\n  ","$":{"name":"IncreaseScore","parameters":"amount"}},{"_":"\r\n    if (not HasInt(game, \"score\")) {\r\n      error (\"Score is not configured. To enable score, go to 'game' and tick 'Show score' on the Player tab.\")\r\n    }\r\n    game.score = game.score - amount\r\n  ","$":{"name":"DecreaseScore","parameters":"amount"}},{"_":"\r\n    if (not HasInt(game.pov, \"health\")) {\r\n      error (\"Health is not configured. To enable health, go to 'game' and tick 'Show health' on the Player tab.\")\r\n    }\r\n    game.pov.health = game.pov.health + amount\r\n  ","$":{"name":"IncreaseHealth","parameters":"amount"}},{"_":"\r\n    if (not HasInt(game.pov, \"health\")) {\r\n      error (\"Health is not configured. To enable health, go to 'game' and tick 'Show health' on the Player tab.\")\r\n    }\r\n    game.pov.health = game.pov.health - amount\r\n  ","$":{"name":"DecreaseHealth","parameters":"amount"}},{"_":"\r\n    if (not HasInt(game.pov, \"money\")) {\r\n      error (\"Money is not configured. To enable money, go to 'game' and tick 'Show money' on the Player tab.\")\r\n    }\r\n    game.pov.money = game.pov.money + amount\r\n  ","$":{"name":"IncreaseMoney","parameters":"amount"}},{"_":"\r\n    if (not HasInt(game.pov, \"money\")) {\r\n      error (\"Money is not configured. To enable money, go to 'game' and tick 'Show money' on the Player tab.\")\r\n    }\r\n    game.pov.money = game.pov.money - amount\r\n  ","$":{"name":"DecreaseMoney","parameters":"amount"}},{"_":"\r\n    OutputTextRaw (ProcessText(text))\r\n  ","$":{"name":"OutputText","parameters":"text"}},{"_":"\r\n    format = GetCurrentTextFormat(\"\")\r\n    JS.addText (\"<span style=\\\"\" + format + \"\\\">\" + text + \"</span><br/>\")\r\n    if (GetString(game, \"commandbarformat\") <> format) {\r\n      ResetCommandBarFormat\r\n    }\r\n    request (Speak, text)\r\n  ","$":{"name":"OutputTextRaw","parameters":"text"}},{"_":"\r\n    format = GetCurrentTextFormat(\"\") + \";background:\" + game.defaultbackground\r\n    game.commandbarformat = format\r\n    JS.setCommandBarStyle (format)\r\n  ","$":{"name":"ResetCommandBarFormat"}},{"_":"\r\n    OutputTextRawNoBr (ProcessText(text))\r\n  ","$":{"name":"OutputTextNoBr","parameters":"text"}},{"_":"\r\n    JS.addText (\"<span style=\\\"\" + GetCurrentTextFormat(\"\") + \"\\\">\" + text + \"</span>\")\r\n    request (Speak, text)\r\n  ","$":{"name":"OutputTextRawNoBr","parameters":"text"}},{"_":"\r\n    style = \"\"\r\n    if (UIOptionUseGameFont()) {\r\n      font = GetCurrentFontFamily()\r\n    }\r\n    else {\r\n      font = GetUIOption(\"OverrideFontName\")\r\n    }\r\n    if (LengthOf(font) > 0) {\r\n      style = style + \"font-family:\" + font + \";\"\r\n    }\r\n    if (LengthOf(colour) = 0) {\r\n      if (UIOptionUseGameColours()) {\r\n        colour = game.defaultforeground\r\n      }\r\n      else {\r\n        colour = GetUIOption(\"OverrideForeground\")\r\n      }\r\n    }\r\n    if (LengthOf(colour) > 0) {\r\n      style = style + \"color:\" + colour + \";\"\r\n    }\r\n    if (UIOptionUseGameFont()) {\r\n      size = game.defaultfontsize\r\n    }\r\n    else {\r\n      size = ToDouble(GetUIOption(\"OverrideFontSize\"))\r\n    }\r\n    if (size > 0) {\r\n      style = style + \"font-size:\" + ToString(size) + \"pt;\"\r\n    }\r\n    return (style)\r\n  ","$":{"name":"GetCurrentTextFormat","parameters":"colour","type":"string"}},{"_":"\r\n    return (GetCurrentTextFormat(GetLinkTextColour()))\r\n  ","$":{"name":"GetCurrentLinkTextFormat","type":"string"}},{"_":"\r\n    value = GetUIOption(\"UseGameFont\")\r\n    if (value = null or value = \"true\") {\r\n      return (true)\r\n    }\r\n    else {\r\n      return (false)\r\n    }\r\n  ","$":{"name":"UIOptionUseGameFont","type":"boolean"}},{"_":"\r\n    value = GetUIOption(\"UseGameColours\")\r\n    if (value = null or value = \"true\") {\r\n      return (true)\r\n    }\r\n    else {\r\n      return (false)\r\n    }\r\n  ","$":{"name":"UIOptionUseGameColours","type":"boolean"}},{"_":"\r\n    if (UIOptionUseGameColours()) {\r\n      return (game.defaultlinkforeground)\r\n    }\r\n    else {\r\n      return (GetUIOption(\"OverrideLinkForeground\"))\r\n    }\r\n  ","$":{"name":"GetLinkTextColour","type":"string"}},{"_":"\r\n    data = NewDictionary()\r\n    dictionary add (data, \"fulltext\", text)\r\n    text = ProcessTextSection(text, data)\r\n    return (Replace(Replace(text, \"@@@open@@@\", \"{\"), \"@@@close@@@\", \"}\"))\r\n  ","$":{"name":"ProcessText","parameters":"text","type":"string"}},{"_":"\r\n    containsUnprocessedSection = false\r\n    open = Instr(text, \"{\")\r\n      if (open > 0) {\r\n        nestCount = 1\r\n        searchStart = open + 1\r\n        finished = false\r\n        while (not finished) {\r\n          nextOpen = Instr(searchStart, text, \"{\")\r\n            nextClose = Instr(searchStart, text, \"}\")\r\n          if (nextClose > 0) {\r\n            if (nextOpen > 0 and nextOpen < nextClose) {\r\n              nestCount = nestCount + 1\r\n              searchStart = nextOpen + 1\r\n            }\r\n            else {\r\n              nestCount = nestCount - 1\r\n              searchStart = nextClose + 1\r\n              if (nestCount = 0) {\r\n                close = nextClose\r\n                containsUnprocessedSection = true\r\n                finished = true\r\n              }\r\n            }\r\n          }\r\n          else {\r\n            finished = true\r\n          }\r\n        }\r\n      }\r\n      if (containsUnprocessedSection) {\r\n        section = Mid(text, open + 1, close - open - 1)\r\n        value = ProcessTextCommand(section, data)\r\n        value = ProcessTextSection(value, data)\r\n        text = Left(text, open - 1) + value + ProcessTextSection(Mid(text, close + 1), data)\r\n      }\r\n      return (text)\r\n  ","$":{"name":"ProcessTextSection","parameters":"text, data","type":"string"}},{"_":"\r\n    if (StartsWith(section, \"if \")) {\r\n      return (ProcessTextCommand_If(section, data))\r\n    }\r\n    else if (StartsWith(section, \"either \")) {\r\n      return (ProcessTextCommand_Either(section, data))\r\n    }\r\n    else if (StartsWith(section, \"here \")) {\r\n      return (ProcessTextCommand_Here(section, data, true))\r\n    }\r\n    else if (StartsWith(section, \"nothere \")) {\r\n      return (ProcessTextCommand_Here(section, data, false))\r\n    }\r\n    else if (StartsWith(section, \"popup:\")) {\r\n      return (ProcessTextCommand_Popup(Mid(section, 7), data))\r\n    }\r\n    else if (StartsWith(section, \"i:\")) {\r\n      return (ProcessTextCommand_Format(Mid(section, 3), data, \"i\"))\r\n    }\r\n    else if (StartsWith(section, \"u:\")) {\r\n      return (ProcessTextCommand_Format(Mid(section, 3), data, \"u\"))\r\n    }\r\n    else if (StartsWith(section, \"b:\")) {\r\n      return (ProcessTextCommand_Format(Mid(section, 3), data, \"b\"))\r\n    }\r\n    else if (StartsWith(section, \"s:\")) {\r\n      return (ProcessTextCommand_Format(Mid(section, 3), data, \"s\"))\r\n    }\r\n    else if (StartsWith(section, \"color:\")) {\r\n      return (ProcessTextCommand_Colour(Mid(section, 7), data))\r\n    }\r\n    else if (StartsWith(section, \"colour:\")) {\r\n      return (ProcessTextCommand_Colour(Mid(section, 8), data))\r\n    }\r\n    else if (StartsWith(section, \"back:\")) {\r\n      return (ProcessTextCommand_Background(Mid(section, 6), data))\r\n    }\r\n    else if (StartsWith(section, \"object:\")) {\r\n      return (ProcessTextCommand_Object(section, data))\r\n    }\r\n    else if (StartsWith(section, \"command:\")) {\r\n      return (ProcessTextCommand_Command(Mid(section, 9), data))\r\n    }\r\n    else if (StartsWith(section, \"page:\")) {\r\n      return (ProcessTextCommand_Command(Mid(section, 6), data))\r\n    }\r\n    else if (StartsWith(section, \"exit:\")) {\r\n      return (ProcessTextCommand_Exit(section, data))\r\n    }\r\n    else if (StartsWith(section, \"once:\")) {\r\n      return (ProcessTextCommand_Once(section, data))\r\n    }\r\n    else if (StartsWith(section, \"notfirst:\")) {\r\n      return (ProcessTextCommand_NotFirst(section, data))\r\n    }\r\n    else if (StartsWith(section, \"random:\")) {\r\n      return (ProcessTextCommand_Random(section, data))\r\n    }\r\n    else if (StartsWith(section, \"rndalt:\")) {\r\n      return (ProcessTextCommand_RandomAlias(section, data))\r\n    }\r\n    else if (StartsWith(section, \"img:\")) {\r\n      return (ProcessTextCommand_Img(section, data))\r\n    }\r\n    else if (StartsWith(section, \"counter:\")) {\r\n      return (ProcessTextCommand_Counter(Mid(section, 9), data))\r\n    }\r\n    else if (StartsWith(section, \"select:\")) {\r\n      return (ProcessTextCommand_Select(section, data))\r\n    }\r\n    else if (StartsWith(section, \"eval:\")) {\r\n      return (ProcessTextCommand_Eval(Mid(section, 6), data))\r\n    }\r\n    else if (StartsWith(section, \"=\")) {\r\n      return (ProcessTextCommand_Eval(Mid(section, 2), data))\r\n    }\r\n    else {\r\n      dot = Instr(section, \".\")\r\n      if (dot = 0) {\r\n        return (\"@@@open@@@\" + ProcessTextSection(section, data) + \"@@@close@@@\")\r\n      }\r\n      else {\r\n        objectname = Left(section, dot - 1)\r\n        attributename = Mid(section, dot + 1)\r\n        if (objectname = \"this\") {\r\n          object = game.text_processor_this\r\n        }\r\n        else {\r\n          object = GetObject(objectname)\r\n        }\r\n        if (object = null) {\r\n          return (\"@@@open@@@\" + ProcessTextSection(section, data) + \"@@@close@@@\")\r\n        }\r\n        else {\r\n          if (HasAttribute(object, attributename)) {\r\n            type = TypeOf(object, attributename)\r\n            switch (type) {\r\n              case (\"string\", \"int\", \"double\") {\r\n                return (ToString(GetAttribute(object, attributename)))\r\n              }\r\n              case (\"boolean\") {\r\n                result = GetAttribute(object, attributename)\r\n                if (result) {\r\n                  return (\"true\")\r\n                }\r\n                else {\r\n                  return (\"false\")\r\n                }\r\n              }\r\n              default {\r\n                return (\"(\" + type + \")\")\r\n              }\r\n            }\r\n          }\r\n          else {\r\n            return (\"\")\r\n          }\r\n        }\r\n      }\r\n    }\r\n  ","$":{"name":"ProcessTextCommand","parameters":"section, data","type":"string"}},{"_":"\r\n    if (not IsRegexMatch(\"[^\\\\w\\\\s]\", section, \"tp_punctuation_check\")) {\r\n      section = section + \"()\"\r\n    }\r\n    return (ToString(eval(section)))\r\n  ","$":{"name":"ProcessTextCommand_Eval","parameters":"section, data","type":"string"}},{"_":"\r\n    command = Mid(section, 8)\r\n    colon = Instr(command, \":\")\r\n    if (colon = 0) {\r\n      return (\"@@@open@@@either \" + command + \"@@@close@@@\")\r\n    }\r\n    text = Mid(command, colon + 1)\r\n    colon2 = Instr(colon + 1, command, \"|\")\r\n    if (colon2 = 0) {\r\n      text2 = \"\"\r\n    }\r\n    else {\r\n      text2 = Mid(command, colon2 + 1)\r\n      text = Replace(text, \"|\" + text2, \"\")\r\n    }\r\n    condition = Left(command, colon - 1)\r\n    if (not game.text_processor_this = null) {\r\n      condition = Replace(condition, \"this\", game.text_processor_this.name)\r\n    }\r\n    result = eval(condition)\r\n    if (result) {\r\n      return (ProcessTextSection(text, data))\r\n    }\r\n    else {\r\n      if (text2 = \"\") {\r\n        return (\"\")\r\n      }\r\n      else {\r\n        return (ProcessTextSection(text2, data))\r\n      }\r\n    }\r\n  ","$":{"name":"ProcessTextCommand_Either","parameters":"section, data","type":"string"}},{"_":"\r\n    len = 9\r\n    if (flag) {\r\n      len = 6\r\n    }\r\n    command = Mid(section, len)\r\n    colon = Instr(command, \":\")\r\n    if (colon = 0) {\r\n      return (\"@@@open@@@\" + section + \"@@@close@@@\")\r\n    }\r\n    else {\r\n      text = Mid(command, colon + 1)\r\n      condition = Left(command, colon - 1)\r\n      if (not game.text_processor_this = null) {\r\n        condition = Replace(condition, \"this\", game.text_processor_this.name)\r\n      }\r\n      object = Eval(condition)\r\n      if (object = null) {\r\n        return (\"@@@open@@@\" + section + \"@@@close@@@\")\r\n      }\r\n      if (object.parent = game.pov.parent and flag) {\r\n        return (ProcessTextSection(text, data))\r\n      }\r\n      else if (not object.parent = game.pov.parent and not flag) {\r\n        return (ProcessTextSection(text, data))\r\n      }\r\n      else {\r\n        return (\"\")\r\n      }\r\n    }\r\n  ","$":{"name":"ProcessTextCommand_Here","parameters":"section, data, flag","type":"string"}},{"_":"\r\n    command = Mid(section, 4)\r\n    colon = Instr(command, \":\")\r\n    if (colon = 0) {\r\n      return (\"@@@open@@@if \" + command + \"@@@close@@@\")\r\n    }\r\n    else {\r\n      text = Mid(command, colon + 1)\r\n      condition = Left(command, colon - 1)\r\n      if (not game.text_processor_this = null) {\r\n        condition = Replace(condition, \"this\", game.text_processor_this.name)\r\n      }\r\n      operator = Instr(condition, \"<=\")\r\n      if (operator <> 0) {\r\n        operatorlength = 2\r\n      }\r\n      if (operator = 0) {\r\n        operator = Instr(condition, \">=\")\r\n        if (operator <> 0) {\r\n          operatorlength = 2\r\n        }\r\n      }\r\n      if (operator = 0) {\r\n        operator = Instr(condition, \"<>\")\r\n        if (operator <> 0) {\r\n          operatorlength = 2\r\n        }\r\n      }\r\n      if (operator = 0) {\r\n        operator = Instr(condition, \"<\")\r\n        if (operator <> 0) {\r\n          operatorlength = 1\r\n        }\r\n      }\r\n      if (operator = 0) {\r\n        operator = Instr(condition, \">\")\r\n        if (operator <> 0) {\r\n          operatorlength = 1\r\n        }\r\n      }\r\n      if (operator = 0) {\r\n        operator = Instr(condition, \"=\")\r\n        if (operator <> 0) {\r\n          operatorlength = 1\r\n        }\r\n      }\r\n      if (operator = 0) {\r\n        checkfor = true\r\n        if (StartsWith(condition, \"not \")) {\r\n          checkfor = false\r\n          condition = Mid(condition, 5)\r\n        }\r\n        dot = Instr(condition, \".\")\r\n        if (dot = 0) {\r\n          result = GetBoolean(game, condition)\r\n        }\r\n        else {\r\n          objectname = Left(condition, dot - 1)\r\n          attributename = Mid(condition, dot + 1)\r\n          object = GetObject(objectname)\r\n          if (object = null) {\r\n            result = false\r\n          }\r\n          else {\r\n            result = GetBoolean(object, attributename)\r\n          }\r\n        }\r\n        if (result = checkfor) {\r\n          return (ProcessTextSection(text, data))\r\n        }\r\n        else {\r\n          return (\"\")\r\n        }\r\n      }\r\n      else {\r\n        lhs = Left(condition, operator - 1)\r\n        rhs = Mid(condition, operator + operatorlength)\r\n        op = Mid(condition, operator, operatorlength)\r\n        dot = Instr(lhs, \".\")\r\n        if (dot = 0) {\r\n          objectname = \"\"\r\n          attributename = \"\"\r\n          if (HasInt(game, lhs)) {\r\n            objectname = \"game\"\r\n            attributename = lhs\r\n          }\r\n          else {\r\n            return (\"@@@open@@@if \" + command + \"@@@close@@@\")\r\n          }\r\n        }\r\n        else {\r\n          objectname = Left(lhs, dot - 1)\r\n          attributename = Mid(lhs, dot + 1)\r\n        }\r\n        object = GetObject(objectname)\r\n        if (object = null) {\r\n          return (\"@@@open@@@if \" + command + \"@@@close@@@\")\r\n        }\r\n        else if (not HasAttribute(object, attributename)) {\r\n          return (\"@@@open@@@if \" + command + \"@@@close@@@\")\r\n        }\r\n        else {\r\n          value = GetAttribute(object, attributename)\r\n          if (TypeOf(value) = \"object\") {\r\n            value = value.name\r\n          }\r\n          if (op = \"=\") {\r\n            if (ToString(value) = rhs) {\r\n              return (ProcessTextSection(text, data))\r\n            }\r\n            else {\r\n              return (\"\")\r\n            }\r\n          }\r\n          else if (op = \"<>\") {\r\n            if (not ToString(value) = rhs) {\r\n              return (ProcessTextSection(text, data))\r\n            }\r\n            else {\r\n              return (\"\")\r\n            }\r\n          }\r\n          else if (op = \">\") {\r\n            if (ToDouble(ToString(value)) > ToDouble(rhs)) {\r\n              return (ProcessTextSection(text, data))\r\n            }\r\n            else {\r\n              return (\"\")\r\n            }\r\n          }\r\n          else if (op = \"<\") {\r\n            if (ToDouble(ToString(value)) < ToDouble(rhs)) {\r\n              return (ProcessTextSection(text, data))\r\n            }\r\n            else {\r\n              return (\"\")\r\n            }\r\n          }\r\n          else if (op = \">=\") {\r\n            if (ToDouble(ToString(value)) >= ToDouble(rhs)) {\r\n              return (ProcessTextSection(text, data))\r\n            }\r\n            else {\r\n              return (\"\")\r\n            }\r\n          }\r\n          else if (op = \"<=\") {\r\n            if (ToDouble(ToString(value)) <= ToDouble(rhs)) {\r\n              return (ProcessTextSection(text, data))\r\n            }\r\n            else {\r\n              return (\"\")\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  ","$":{"name":"ProcessTextCommand_If","parameters":"section, data","type":"string"}},{"_":"\r\n    return (ProcessTextSection(\"<\" + html + \">\" + section + \"</\" + html + \">\", data))\r\n  ","$":{"name":"ProcessTextCommand_Format","parameters":"section, data, html","type":"string"}},{"_":"\r\n    ary = Split(section, \":\")\r\n    c = StringListItem(ary, 0)\r\n    list remove (ary, c)\r\n    s = Join (ary, \":\")\r\n    return (ProcessTextSection(\"<span style=\\\"color:\" + c + \";\\\">\" + s + \"</span>\", data))\r\n  ","$":{"name":"ProcessTextCommand_Colour","parameters":"section, data","type":"string"}},{"_":"\r\n    ary = Split(section, \":\")\r\n    c = StringListItem(ary, 0)\r\n    list remove (ary, c)\r\n    s = Join (ary, \":\")\r\n    return (ProcessTextSection(\"<span style=\\\"background-color:\" + c + \";\\\">\" + s + \"</span>\", data))\r\n  ","$":{"name":"ProcessTextCommand_Background","parameters":"section, data","type":"string"}},{"_":"\r\n    ary = Split(section, \":\")\r\n    s1 = StringListItem(ary, 0)\r\n    list remove (ary, s1)\r\n    s2 = Join (ary, \":\")\r\n    id = JSSafe(s1) + GetRandomInt(0, 999999999)\r\n    link = game.defaultlinkforeground\r\n    if (HasString(game, \"altlinkforeground\")) {\r\n      link = game.altlinkforeground\r\n    }\r\n    s = \"<span  style=\\\"cursor:pointer;color:\" + link + \";\\\" onclick=\\\"$('#\" + id + \"').css('display', 'block');\\\">\" + s1 + \"</span><div id=\\\"\" + id + \"\\\" class=\\\"w3-theme-border\\\" style=\\\"position:fixed;z-index:9999;display:none;cursor:pointer;left:50px;top:40%;width:40%;background-color:\" + game.defaultbackground + \";border:2px solid \" + game.defaultforeground + \";color:\" + link + \";border-radius:5px;padding:5px;\\\" onclick=\\\"$('#\" + id + \"').css('display', 'none');\\\"><p>\"\r\n    s = s + s2 + \"</p></div>\"\r\n    return (ProcessTextSection(s, data))\r\n  ","$":{"name":"ProcessTextCommand_Popup","parameters":"section, data","type":"string"}},{"_":"\r\n    objectname = Mid(section, 8)\r\n    text = \"\"\r\n    colon = Instr(objectname, \":\")\r\n    if (colon > 0) {\r\n      text = Mid(objectname, colon + 1)\r\n      objectname = Left(objectname, colon - 1)\r\n    }\r\n    if (not game.text_processor_this = null) {\r\n      objectname = Replace(objectname, \"this\", game.text_processor_this.name)\r\n    }\r\n    object = GetObject(objectname)\r\n    if (object = null) {\r\n      return (\"@@@open@@@\" + ProcessTextSection(section, data) + \"@@@close@@@\")\r\n    }\r\n    else {\r\n      if (LengthOf(text) = 0) {\r\n        text = SafeXML(GetDisplayAlias(object))\r\n      }\r\n      if (game.enablehyperlinks) {\r\n        linkid = ProcessTextCommand_GetNextLinkId()\r\n        colour = \"\"\r\n        if (HasString(object, \"linkcolour\") and GetUIOption(\"UseGameColours\") = \"true\") {\r\n          colour = object.linkcolour\r\n        }\r\n        else {\r\n          colour = GetLinkTextColour()\r\n        }\r\n        style = GetCurrentTextFormat(colour)\r\n        return (\"<a id=\\\"\" + linkid + \"\\\" style=\\\"\" + style + \"\\\" class=\\\"cmdlink elementmenu\\\" data-elementid=\\\"\" + object.name + \"\\\">\" + text + \"</a>\")\r\n      }\r\n      else {\r\n        return (text)\r\n      }\r\n    }\r\n  ","$":{"name":"ProcessTextCommand_Object","parameters":"section, data","type":"string"}},{"_":"\r\n    if (not HasInt(game, \"lastlinkid\")) {\r\n      game.lastlinkid = 0\r\n    }\r\n    game.lastlinkid = game.lastlinkid + 1\r\n    return (\"verblink\" + game.lastlinkid)\r\n  ","$":{"name":"ProcessTextCommand_GetNextLinkId","type":"string"}},{"_":"\r\n    text = command\r\n    colon = Instr(command, \":\")\r\n    if (colon > 0) {\r\n      text = Mid(command, colon + 1)\r\n      command = Left(command, colon - 1)\r\n    }\r\n    style = GetCurrentLinkTextFormat()\r\n    candidates = NewObjectList()\r\n    foreach (cmd, ScopeCommands()) {\r\n      if (IsRegexMatch(cmd.pattern, command, cmd.name)) {\r\n        list add (candidates, cmd)\r\n      }\r\n    }\r\n    elementid = \"\"\r\n    if (ListCount(candidates) = 1) {\r\n      cmd = ObjectListItem(candidates, 0)\r\n      elementid = cmd.name\r\n    }\r\n    linkid = ProcessTextCommand_GetNextLinkId()\r\n    dataattrs = \"\"\r\n    if (game.deactivatecommandlinks) {\r\n      dataattrs = dataattrs + \"data-deactivateonclick=\\\"true\\\" \"\r\n    }\r\n    dataattrs = dataattrs + \"data-command=\\\"\" + command + \"\\\"\"\r\n    return (\"<a id=\\\"\" + linkid + \"\\\" style=\\\"\" + style + \"\\\" class=\\\"cmdlink commandlink\\\" data-elementid=\\\"\" + elementid + \"\\\" \" + dataattrs + \">\" + ProcessTextSection(text, data) + \"</a>\")\r\n  ","$":{"name":"ProcessTextCommand_Command","parameters":"command, data","type":"string"}},{"_":"\r\n    exitname = Mid(section, 6)\r\n    exit = GetObject(exitname)\r\n    if (exit = null) {\r\n      return (\"@@@open@@@\" + ProcessTextSection(section, data) + \"@@@close@@@\")\r\n    }\r\n    else {\r\n      verbs = GetDisplayVerbs(exit)\r\n      alias = GetDisplayAlias(exit)\r\n      command = LCase(StringListItem(verbs, 0)) + \" \" + alias\r\n      style = GetCurrentLinkTextFormat()\r\n      return (\"<a style=\\\"\" + style + \"\\\" class=\\\"cmdlink exitlink\\\" data-elementid=\\\"\" + exit.name + \"\\\" data-command=\\\"\" + command + \"\\\">\" + alias + \"</a>\")\r\n    }\r\n  ","$":{"name":"ProcessTextCommand_Exit","parameters":"section, data","type":"string"}},{"_":"\r\n    if (not HasAttribute(game, \"textprocessor_seen\")) {\r\n      game.textprocessor_seen = NewDictionary()\r\n    }\r\n    fulltext = StringDictionaryItem(data, \"fulltext\")\r\n    if (not DictionaryContains(game.textprocessor_seen, fulltext)) {\r\n      onceSectionsInThisText = NewList()\r\n      dictionary add (game.textprocessor_seen, fulltext, onceSectionsInThisText)\r\n    }\r\n    else {\r\n      onceSectionsInThisText = DictionaryItem(game.textprocessor_seen, fulltext)\r\n    }\r\n    if (not ListContains(onceSectionsInThisText, section)) {\r\n      list add (onceSectionsInThisText, section)\r\n      return (ProcessTextSection(Mid(section, 6), data))\r\n    }\r\n    else {\r\n      return (\"\")\r\n    }\r\n  ","$":{"name":"ProcessTextCommand_Once","parameters":"section, data","type":"string"}},{"_":"\r\n    if (not HasAttribute(game, \"textprocessor_seen\")) {\r\n      game.textprocessor_seen = NewDictionary()\r\n    }\r\n    fulltext = StringDictionaryItem(data, \"fulltext\")\r\n    if (not DictionaryContains(game.textprocessor_seen, fulltext)) {\r\n      onceSectionsInThisText = NewList()\r\n      dictionary add (game.textprocessor_seen, fulltext, onceSectionsInThisText)\r\n    }\r\n    else {\r\n      onceSectionsInThisText = DictionaryItem(game.textprocessor_seen, fulltext)\r\n    }\r\n    if (not ListContains(onceSectionsInThisText, section)) {\r\n      list add (onceSectionsInThisText, section)\r\n      return (\"\")\r\n    }\r\n    else {\r\n      return (ProcessTextSection(Mid(section, 10), data))\r\n    }\r\n  ","$":{"name":"ProcessTextCommand_NotFirst","parameters":"section, data","type":"string"}},{"_":"\r\n    elements = Mid(section, 8)\r\n    elementslist = Tsplit(elements)\r\n    index = GetRandomInt(0, ListCount(elementslist) - 1)\r\n    return (ProcessTextSection(ListItem(elementslist, index), data))\r\n  ","$":{"name":"ProcessTextCommand_Random","parameters":"section, data","type":"string"}},{"_":"\r\n    itemlist = NewStringList()\r\n    sections = 0\r\n    startpos = 1\r\n    for (i, 1, LengthOf(splittext)) {\r\n      if (Mid(splittext, i, 1) = \"{\") {\r\n          sections = sections + 1\r\n        }\r\n        if (Mid(splittext, i, 1) = \"}\") {\r\n        sections = sections - 1\r\n      }\r\n      if (Mid(splittext, i, 1) = \":\" and 0 >= sections) {\r\n        item = Mid(splittext, startpos, i - startpos)\r\n        list add (itemlist, item)\r\n        startpos = i + 1\r\n      }\r\n    }\r\n    item = Mid(splittext, startpos)\r\n    list add (itemlist, item)\r\n    return (itemlist)\r\n  ","$":{"name":"Tsplit","parameters":"splittext","type":"stringlist"}},{"_":"\r\n    objectname = Mid(section, 8)\r\n    if (not game.text_processor_this = null) {\r\n      objectname = Replace(objectname, \"this\", game.text_processor_this.name)\r\n    }\r\n    object = GetObject(objectname)\r\n    if (object = null) {\r\n      return (\"@@@open@@@\" + ProcessTextSection(section, data) + \"@@@close@@@\")\r\n    }\r\n    else {\r\n      count = ListCount(object.alt)\r\n      if (count > 0) {\r\n        return (ListItem(object.alt, GetRandomInt(0, count - 1)))\r\n      }\r\n      else {\r\n        return (\"\")\r\n      }\r\n    }\r\n  ","$":{"name":"ProcessTextCommand_RandomAlias","parameters":"section, data","type":"string"}},{"_":"\r\n    filename = Mid(section, 5)\r\n    return (\"<img src=\\\"\" + GetFileURL(filename) + \"\\\" />\")\r\n  ","$":{"name":"ProcessTextCommand_Img","parameters":"section, data","type":"string"}},{"_":"\r\n    if (HasAttribute(game, section)) {\r\n      return (ToString(GetAttribute(game, section)))\r\n    }\r\n    else {\r\n      return (\"0\")\r\n    }\r\n  ","$":{"name":"ProcessTextCommand_Counter","parameters":"section, data","type":"string"}},{"_":"\r\n    elements = Mid(section, 8)\r\n    elementslist = Split(elements, \":\")\r\n    objectandatt = StringListItem (elementslist, 0)\r\n    list remove (elementslist, objectandatt)\r\n    objectandattlist = Split(objectandatt, \".\")\r\n    if (not ListCount (objectandattlist) = 2) {\r\n      return (\"@@@open@@@\" + ProcessTextSection(section, data) + \"@@@close@@@\")\r\n    }\r\n    else {\r\n      objectname = StringListItem(objectandattlist, 0)\r\n      if (not game.text_processor_this = null) {\r\n        objectname = Replace(objectname, \"this\", game.text_processor_this.name)\r\n      }\r\n      object = GetObject(objectname)\r\n      if (object = null) {\r\n        return (\"@@@open@@@\" + ProcessTextSection(section, data) + \"@@@close@@@\")\r\n      }\r\n      else if (not HasInt (object, StringListItem(objectandattlist, 1))) {\r\n        return (\"@@@open@@@\" + ProcessTextSection(section, data) + \"@@@close@@@\")\r\n      }\r\n      else {\r\n        if (Instr(elements, \"|\") > 0) {\r\n          elementslist = Split(Join(elementslist, \":\"), \"|\")\r\n        }\r\n        index = GetInt(object, StringListItem(objectandattlist, 1))\r\n        if ((0 > index) or (index >= Listcount(elementslist))) {\r\n          return (\"@@@open@@@\" + ProcessTextSection(section, data) + \"@@@close@@@\")\r\n        }\r\n        else {\r\n          return (ProcessTextSection(ListItem(elementslist, index), data))\r\n        }\r\n      }\r\n    }\r\n  ","$":{"name":"ProcessTextCommand_Select","parameters":"section, data","type":"string"}},{"_":"\r\n    request (SetPanelContents, \"<img src=\\\"\" + GetFileURL(filename) + \"\\\" onload=\\\"setPanelHeight()\\\"/>\")\r\n    game.panelcontents = filename\r\n  ","$":{"name":"SetFramePicture","parameters":"filename"}},{"_":"\r\n    request (SetPanelContents, \"\")\r\n    game.panelcontents = null\r\n  ","$":{"name":"ClearFramePicture"}},{"_":"\r\n    request (ClearScreen, \"\")\r\n  ","$":{"name":"ClearScreen"}},{"_":"\r\n    request (Foreground, colour)\r\n    game.defaultforeground = colour\r\n  ","$":{"name":"SetForegroundColour","parameters":"colour"}},{"_":"\r\n    request (Background, colour)\r\n    game.defaultbackground = colour\r\n  ","$":{"name":"SetBackgroundColour","parameters":"colour"}},{"_":"\r\n    request (LinkForeground, colour)\r\n    game.defaultlinkforeground = colour\r\n  ","$":{"name":"SetLinkForegroundColour","parameters":"colour"}},{"_":"\r\n    game.defaultfont = font\r\n    game.defaultwebfont = \"\"\r\n  ","$":{"name":"SetFontName","parameters":"font"}},{"_":"\r\n    AddExternalStylesheet (\"https://fonts.googleapis.com/css?family=\" + Replace(font, \" \", \"+\"))\r\n    game.defaultwebfont = font\r\n  ","$":{"name":"SetWebFontName","parameters":"font"}},{"_":"\r\n    if (game.externalstylesheets = null) {\r\n      game.externalstylesheets = NewStringList()\r\n    }\r\n    if (not ListContains(game.externalstylesheets, stylesheet)) {\r\n      list add (game.externalstylesheets, stylesheet)\r\n      JS.addExternalStylesheet (stylesheet)\r\n    }\r\n  ","$":{"name":"AddExternalStylesheet","parameters":"stylesheet"}},{"_":"\r\n    game.defaultfontsize = size\r\n  ","$":{"name":"SetFontSize","parameters":"size"}},{"_":"\r\n    SetAlignment (\"center\")\r\n    msg (text)\r\n    SetAlignment (\"left\")\r\n  ","$":{"name":"PrintCentered","parameters":"text"}},{"_":"\r\n    JS.AddYouTube (id)\r\n  ","$":{"name":"ShowYouTube","parameters":"id"}},{"_":"\r\n    JS.AddVimeo (id)\r\n  ","$":{"name":"ShowVimeo","parameters":"id"}},{"_":"\r\n    request (Wait, \"\")\r\n  ","$":{"name":"WaitForKeyPress"}},{"_":"\r\n    pos = Instr(url, \"://\")\r\n    if (pos > 0) {\r\n      url = Mid(url, pos + 3)\r\n    }\r\n    if (https) {\r\n      url = \"https://\" + url\r\n    }\r\n    else {\r\n      url = \"http://\" + url\r\n    }\r\n    msg (\"<a style=\\\"\" + GetCurrentLinkTextFormat() + \"\\\" href=\\\"\" + url + \"\\\">\" + text + \"</a>\")\r\n  ","$":{"name":"DisplayHttpLink","parameters":"text, url, https"}},{"_":"\r\n    if (Instr(url, \"mailto:\") = 0) {\r\n      url = \"mailto:\" + url\r\n    }\r\n    msg (\"<a style=\\\"\" + GetCurrentLinkTextFormat() + \"\\\" href=\\\"\" + url + \"\\\">\" + text + \"</a>\")\r\n  ","$":{"name":"DisplayMailtoLink","parameters":"text, url"}},{"_":"\r\n    return (\"{command:\" + cmd + \":\" + text + \"}\")\r\n  ","$":{"name":"CommandLink","parameters":"cmd, text","type":"string"}},{"_":"\r\n    request (Log, text)\r\n  ","$":{"name":"Log","parameters":"text"}},{"_":"\r\n    JS.SetBackgroundImage (GetFileURL(filename))\r\n    game.backgroundimage = filename\r\n  ","$":{"name":"SetBackgroundImage","parameters":"filename"}},{"_":"\r\n    JS.SetBackgroundOpacity (opacity)\r\n    game.backgroundopacity = opacity\r\n    game.setbackgroundopacity = true\r\n  ","$":{"name":"SetBackgroundOpacity","parameters":"opacity"}},{"_":"\r\n    if (numbers) {\r\n      result = \"<ol>\"\r\n    }\r\n    else {\r\n      result = \"<ul>\"\r\n    }\r\n    foreach (item, list) {\r\n      result = result + \"<li>\" + item + \"</li>\"\r\n    }\r\n    if (numbers) {\r\n      result = result + \"</ol>\"\r\n    }\r\n    else {\r\n      result = result + \"</ul>\"\r\n    }\r\n    msg (result)\r\n  ","$":{"name":"DisplayList","parameters":"list, numbers"}},{"_":"\r\n    JS.createNewDiv (align)\r\n  ","$":{"name":"SetAlignment","parameters":"align"}},{"_":"\r\n    if (game.defaultwebfont = null) {\r\n      return (game.defaultfont)\r\n    }\r\n    else {\r\n      if (game.defaultwebfont = \"\") {\r\n        return (game.defaultfont)\r\n      }\r\n      else {\r\n        return (\"'\" + game.defaultwebfont + \"', \" + game.defaultfont)\r\n      }\r\n    }\r\n  ","$":{"name":"GetCurrentFontFamily","type":"string"}},{"_":"\r\n    if (ListCount (list) = 0) {\r\n      return (nothing)\r\n    }\r\n    else {\r\n      result = \"\"\r\n      count = 0\r\n      listLength = ListCount(list)\r\n      foreach (item, list) {\r\n        if (TypeOf(item) = \"object\") {\r\n          result = result + GetDisplayName(item)\r\n        }\r\n        else {\r\n          result = result + item\r\n        }\r\n        count = count + 1\r\n        if (count = listLength - 1) {\r\n          if (not IsRegexMatch(\"^\\\\W\", lastjoiner)) {\r\n            result = result + \" \"\r\n          }\r\n          result = result + lastjoiner + \" \"\r\n        }\r\n        else if (count < listLength) {\r\n          result = result + joiner + \" \"\r\n        }\r\n      }\r\n      return (Trim (result))\r\n    }\r\n  ","$":{"name":"FormatList","parameters":"list, joiner, lastjoiner, nothing","type":"string"}},{"_":"\r\n    game.command_successful = True\r\n    text = \"\"\r\n    for (x, 1, number) {\r\n      text = text+ \"&nbsp;\"\r\n    }\r\n    return (text)\r\n  ","$":{"name":"Spaces","parameters":"number","type":"string"}},{"_":"\r\n    if (not TypeOf(n) = \"int\") {\r\n      error (\"ToRoman can only handle ints\")\r\n    }\r\n    arabic = Split(\"1000;900;500;400;100;90;50;40;10;9;5;4;1\", \";\")\r\n    roman = Split(\"M;CM;D;CD;C;XC;L;XL;X;IX;V;IV;I\", \";\")\r\n    result = \"\"\r\n    for (i, 0, 12) {\r\n      a = ToInt(StringListItem(arabic, i))\r\n      r = StringListItem(roman, i)\r\n      while (n >= a) {\r\n        result = result + r\r\n        n = n - a\r\n      }\r\n    }\r\n    return (result)\r\n  ","$":{"name":"ToRoman","parameters":"n","type":"string"}},{"_":"\r\n    JS.Grid_SetScale (scale)\r\n  ","$":{"name":"Grid_SetScale","parameters":"scale"}},{"_":"\r\n    if (room.parent <> null) {\r\n      if (room.grid_parent_offset_auto) {\r\n        room.grid_parent_offset_x = (room.parent.grid_width - room.grid_width) /2.0\r\n        room.grid_parent_offset_y = (room.parent.grid_length - room.grid_length) /2.0\r\n      }\r\n      Grid_SetGridCoordinateForPlayer (playerobject, room.parent, \"x\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"x\") - room.grid_parent_offset_x)\r\n      Grid_SetGridCoordinateForPlayer (playerobject, room.parent, \"y\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"y\") - room.grid_parent_offset_y)\r\n      Grid_SetGridCoordinateForPlayer (playerobject, room.parent, \"z\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"z\"))\r\n      room.parent.grid_render = true\r\n      Grid_CalculateMapCoordinates (room.parent, playerobject)\r\n    }\r\n    // go through all exits in room, set x,y co-ordinates for the rooms they point to\r\n    foreach (exit, AllExits()) {\r\n      if (exit.parent = room and not GetBoolean(exit, \"lookonly\")) {\r\n        if (DoesInherit(exit, \"northdirection\")) {\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit, \"x\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"x\") + room.grid_width/2.0 + exit.grid_offset_x)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit, \"y\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"y\") + exit.grid_offset_y)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit.to, \"x\", Grid_GetGridCoordinateForPlayer(playerobject, exit, \"x\") - exit.to.grid_width/2.0)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit.to, \"y\", (Grid_GetGridCoordinateForPlayer(playerobject, exit, \"y\") - exit.to.grid_length) - exit.grid_length)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit.to, \"z\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"z\"))\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit, \"end_x\", Grid_GetGridCoordinateForPlayer(playerobject, exit, \"x\"))\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit, \"end_y\", Grid_GetGridCoordinateForPlayer(playerobject, exit, \"y\") - exit.grid_length)\r\n          exit.grid_render = true\r\n          exit.to.grid_render = true\r\n        }\r\n        else if (DoesInherit(exit, \"eastdirection\")) {\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit, \"x\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"x\") + room.grid_width + exit.grid_offset_x)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit, \"y\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"y\") + room.grid_length/2.0 + exit.grid_offset_y)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit.to, \"x\", Grid_GetGridCoordinateForPlayer(playerobject, exit, \"x\") + exit.grid_length)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit.to, \"y\", Grid_GetGridCoordinateForPlayer(playerobject, exit, \"y\") - exit.to.grid_length/2.0)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit.to, \"z\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"z\"))\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit, \"end_x\", Grid_GetGridCoordinateForPlayer(playerobject, exit, \"x\") + exit.grid_length)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit, \"end_y\", Grid_GetGridCoordinateForPlayer(playerobject, exit, \"y\"))\r\n          exit.grid_render = true\r\n          exit.to.grid_render = true\r\n        }\r\n        else if (DoesInherit(exit, \"southdirection\")) {\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit, \"x\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"x\") + room.grid_width/2.0 + exit.grid_offset_x)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit, \"y\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"y\") + room.grid_length + exit.grid_offset_y)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit.to, \"x\", Grid_GetGridCoordinateForPlayer(playerobject, exit, \"x\") - exit.to.grid_width/2.0)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit.to, \"y\", Grid_GetGridCoordinateForPlayer(playerobject, exit, \"y\") + exit.grid_length)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit.to, \"z\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"z\"))\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit, \"end_x\", Grid_GetGridCoordinateForPlayer(playerobject, exit, \"x\"))\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit, \"end_y\", Grid_GetGridCoordinateForPlayer(playerobject, exit, \"y\") + exit.grid_length)\r\n          exit.grid_render = true\r\n          exit.to.grid_render = true\r\n        }\r\n        else if (DoesInherit(exit, \"westdirection\")) {\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit, \"x\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"x\") + exit.grid_offset_x)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit, \"y\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"y\") + room.grid_length/2.0 + exit.grid_offset_y)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit.to, \"x\", (Grid_GetGridCoordinateForPlayer(playerobject, exit, \"x\") - exit.to.grid_width) - exit.grid_length)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit.to, \"y\", Grid_GetGridCoordinateForPlayer(playerobject, exit, \"y\") - exit.to.grid_length/2.0)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit.to, \"z\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"z\"))\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit, \"end_x\", Grid_GetGridCoordinateForPlayer(playerobject, exit, \"x\") - exit.grid_length)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit, \"end_y\", Grid_GetGridCoordinateForPlayer(playerobject, exit, \"y\"))\r\n          exit.grid_render = true\r\n          exit.to.grid_render = true\r\n        }\r\n        else if (DoesInherit(exit, \"northwestdirection\")) {\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit, \"x\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"x\") + exit.grid_offset_x)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit, \"y\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"y\") + exit.grid_offset_y)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit.to, \"x\", (Grid_GetGridCoordinateForPlayer(playerobject, exit, \"x\") - exit.to.grid_width) - exit.grid_length)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit.to, \"y\", (Grid_GetGridCoordinateForPlayer(playerobject, exit, \"y\") - exit.to.grid_length) - exit.grid_length)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit.to, \"z\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"z\"))\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit, \"end_x\", Grid_GetGridCoordinateForPlayer(playerobject, exit, \"x\") - exit.grid_length)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit, \"end_y\", Grid_GetGridCoordinateForPlayer(playerobject, exit, \"y\") - exit.grid_length)\r\n          exit.grid_render = true\r\n          exit.to.grid_render = true\r\n        }\r\n        else if (DoesInherit(exit, \"northeastdirection\")) {\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit, \"x\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"x\") + room.grid_width + exit.grid_offset_x)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit, \"y\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"y\") + exit.grid_offset_y)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit.to, \"x\", Grid_GetGridCoordinateForPlayer(playerobject, exit, \"x\") + exit.grid_length)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit.to, \"y\", (Grid_GetGridCoordinateForPlayer(playerobject, exit, \"y\") - exit.to.grid_length) - exit.grid_length)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit.to, \"z\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"z\"))\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit, \"end_x\", Grid_GetGridCoordinateForPlayer(playerobject, exit, \"x\") + exit.grid_length)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit, \"end_y\", Grid_GetGridCoordinateForPlayer(playerobject, exit, \"y\") - exit.grid_length)\r\n          exit.grid_render = true\r\n          exit.to.grid_render = true\r\n        }\r\n        else if (DoesInherit(exit, \"southwestdirection\")) {\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit, \"x\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"x\") + exit.grid_offset_x)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit, \"y\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"y\") + room.grid_length + exit.grid_offset_y)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit.to, \"x\", (Grid_GetGridCoordinateForPlayer(playerobject, exit, \"x\") - exit.to.grid_width) - exit.grid_length)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit.to, \"y\", Grid_GetGridCoordinateForPlayer(playerobject, exit, \"y\") + exit.grid_length)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit.to, \"z\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"z\"))\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit, \"end_x\", Grid_GetGridCoordinateForPlayer(playerobject, exit, \"x\") - exit.grid_length)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit, \"end_y\", Grid_GetGridCoordinateForPlayer(playerobject, exit, \"y\") + exit.grid_length)\r\n          exit.grid_render = true\r\n          exit.to.grid_render = true\r\n        }\r\n        else if (DoesInherit(exit, \"southeastdirection\")) {\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit, \"x\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"x\") + room.grid_width + exit.grid_offset_x)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit, \"y\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"y\") + room.grid_length + exit.grid_offset_y)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit.to, \"x\", Grid_GetGridCoordinateForPlayer(playerobject, exit, \"x\") + exit.grid_length)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit.to, \"y\", Grid_GetGridCoordinateForPlayer(playerobject, exit, \"y\") + exit.grid_length)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit.to, \"z\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"z\"))\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit, \"end_x\", Grid_GetGridCoordinateForPlayer(playerobject, exit, \"x\") + exit.grid_length)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit, \"end_y\", Grid_GetGridCoordinateForPlayer(playerobject, exit, \"y\") + exit.grid_length)\r\n          exit.grid_render = true\r\n          exit.to.grid_render = true\r\n        }\r\n        else if (DoesInherit(exit, \"updirection\")) {\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit.to, \"x\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"x\") + room.grid_width/2.0 - exit.to.grid_width/2.0 + exit.grid_offset_x)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit.to, \"y\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"y\") + room.grid_length/2.0 - exit.to.grid_length/2.0 + exit.grid_offset_y)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit.to, \"z\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"z\") + exit.grid_length)\r\n          exit.grid_render = false\r\n          exit.to.grid_render = true\r\n        }\r\n        else if (DoesInherit(exit, \"downdirection\")) {\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit.to, \"x\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"x\") + room.grid_width/2.0 - exit.to.grid_width/2.0 + exit.grid_offset_x)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit.to, \"y\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"y\") + room.grid_length/2.0 - exit.to.grid_length/2.0 + exit.grid_offset_y)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit.to, \"z\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"z\") - exit.grid_length)\r\n          exit.grid_render = false\r\n          exit.to.grid_render = true\r\n        }\r\n        else if (DoesInherit(exit, \"indirection\") or DoesInherit(exit, \"outdirection\")) {\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit.to, \"x\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"x\") + room.grid_width/2.0 - exit.to.grid_width/2.0 + exit.grid_offset_x)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit.to, \"y\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"y\") + room.grid_length/2.0 - exit.to.grid_length/2.0 + exit.grid_offset_y)\r\n          Grid_SetGridCoordinateForPlayer (playerobject, exit.to, \"z\", Grid_GetGridCoordinateForPlayer(playerobject, room, \"z\"))\r\n          exit.grid_render = false\r\n          exit.to.grid_render = true\r\n        }\r\n      }\r\n    }\r\n  ","$":{"name":"Grid_CalculateMapCoordinates","parameters":"room, playerobject"}},{"_":"\r\n    if (room.grid_render) {\r\n      Grid_DrawRoom (room, false, game.pov)\r\n      player_x = Grid_GetGridCoordinateForPlayer(game.pov, room, \"x\") + room.grid_width/2.0\r\n      player_y = Grid_GetGridCoordinateForPlayer(game.pov, room, \"y\") + room.grid_length/2.0\r\n      player_z = Grid_GetGridCoordinateForPlayer(game.pov, room, \"z\")\r\n      // Grid_DrawPlayer(x, y, z, radius, border, borderWidth, fill)\r\n      JS.Grid_DrawPlayer (player_x, player_y, player_z, 5, \"black\", 2, \"yellow\")\r\n    }\r\n  ","$":{"name":"Grid_DrawPlayerInRoom","parameters":"room"}},{"_":"\r\n    if (room.grid_render) {\r\n      if (redraw or not Grid_GetRoomBooleanForPlayer(playerobject, room, \"grid_isdrawn\")) {\r\n        if (room.parent <> null) {\r\n          Grid_DrawRoom (room.parent, redraw, playerobject)\r\n        }\r\n        JS.Grid_DrawBox (Grid_GetGridCoordinateForPlayer(game.pov, room, \"x\"), Grid_GetGridCoordinateForPlayer(game.pov, room, \"y\"), Grid_GetGridCoordinateForPlayer(game.pov, room, \"z\"), room.grid_width, room.grid_length, room.grid_border, room.grid_borderwidth, room.grid_fill, room.grid_bordersides)\r\n        if (LengthOf(room.grid_label) > 0) {\r\n          label_x = Grid_GetGridCoordinateForPlayer(game.pov, room, \"x\") + room.grid_width/2.0\r\n          label_y = (Grid_GetGridCoordinateForPlayer(game.pov, room, \"y\") + room.grid_length/2.0) - 0.5\r\n          JS.Grid_DrawLabel (label_x, label_y, Grid_GetGridCoordinateForPlayer(game.pov, room, \"z\"), room.grid_label, room.grid_label_colour)\r\n        }\r\n        foreach (exit, AllExits()) {\r\n          if (exit.grid_render and exit.parent = room and exit.grid_length > 0) {\r\n            Grid_DrawLine (Grid_GetGridCoordinateForPlayer(game.pov, exit, \"x\"), Grid_GetGridCoordinateForPlayer(game.pov, exit, \"y\"), Grid_GetGridCoordinateForPlayer(game.pov, exit, \"end_x\"), Grid_GetGridCoordinateForPlayer(game.pov, exit, \"end_y\"), game.mapexitcolour, game.mapexitwidth)\r\n          }\r\n        }\r\n        Grid_SetRoomBooleanForPlayer (playerobject, room, \"grid_isdrawn\", true)\r\n      }\r\n    }\r\n  ","$":{"name":"Grid_DrawRoom","parameters":"room, redraw, playerobject"}},{"_":"\r\n    if (visible) {\r\n      JS.Grid_ShowCustomLayer (true)\r\n    }\r\n    else {\r\n      JS.Grid_ShowCustomLayer (false)\r\n    }\r\n  ","$":{"name":"Grid_ShowCustomLayer","parameters":"visible"}},{"_":"\r\n    JS.Grid_ClearCustomLayer ()\r\n  ","$":{"name":"Grid_ClearCustomLayer"}},{"_":"\r\n    JS.Grid_DrawLine (x1, y1, x2, y2, border, borderWidth)\r\n  ","$":{"name":"Grid_DrawLine","parameters":"x1, y1, x2, y2, border, borderWidth"}},{"_":"\r\n    JS.Grid_DrawArrow (id, x1, y1, x2, y2, border, borderWidth)\r\n  ","$":{"name":"Grid_DrawArrow","parameters":"id, x1, y1, x2, y2, border, borderWidth"}},{"_":"\r\n    JS.Grid_DrawGridLines (x1, y1, x2, y2, border)\r\n  ","$":{"name":"Grid_DrawGridLines","parameters":"x1, y1, x2, y2, border"}},{"_":"\r\n    JS.Grid_SetCentre (x, y)\r\n  ","$":{"name":"Grid_SetCentre","parameters":"x, y"}},{"_":"\r\n    JS.Grid_DrawSquare (id, x, y, width, height, text, fill)\r\n  ","$":{"name":"Grid_DrawSquare","parameters":"id, x, y, width, height, text, fill"}},{"_":"\r\n    JS.Grid_LoadSvg (data, id)\r\n  ","$":{"name":"Grid_LoadSvg","parameters":"data, id"}},{"_":"\r\n    JS.Grid_DrawSvg (id, symbolid, x, y, width, height)\r\n  ","$":{"name":"Grid_DrawSvg","parameters":"id, symbolid, x, y, width, height"}},{"_":"\r\n    JS.Grid_DrawImage (id, url, x, y, width, height)\r\n  ","$":{"name":"Grid_DrawImage","parameters":"id, url, x, y, width, height"}},{"_":"\r\n    JS.Grid_AddNewShapePoint (x, y)\r\n  ","$":{"name":"Grid_AddNewShapePoint","parameters":"x, y"}},{"_":"\r\n    JS.Grid_DrawShape (id, border, fill, opacity)\r\n  ","$":{"name":"Grid_DrawShape","parameters":"id, border, fill, opacity"}},{"_":"\r\n    parameters = Split(parameterstring, \";\")\r\n    x = ToInt(StringListItem(parameters, 0))\r\n    y = ToInt(StringListItem(parameters, 1))\r\n    GridSquareClick (x, y)\r\n  ","$":{"name":"JS_GridSquareClick","parameters":"parameterstring"}},{"_":"\r\n    // Copy this function into your game to handle grid square clicks\r\n  ","$":{"name":"GridSquareClick","parameters":"x, y"}},{"_":"\r\n    foreach (object, AllObjects()) {\r\n      if (Grid_GetRoomBooleanForPlayer(game.pov, object, \"grid_isdrawn\")) {\r\n        Grid_DrawRoom (object, true, game.pov)\r\n      }\r\n    }\r\n  ","$":{"name":"Grid_Redraw"}},{"_":"\r\n    coordinates = Grid_GetPlayerCoordinatesForRoom(playerobject, room)\r\n    if (DictionaryContains(coordinates, coordinate)) {\r\n      dictionary remove (coordinates, coordinate)\r\n    }\r\n    dictionary add (coordinates, coordinate, value * 1.0)\r\n  ","$":{"name":"Grid_SetGridCoordinateForPlayer","parameters":"playerobject, room, coordinate, value"}},{"_":"\r\n    coordinates = Grid_GetPlayerCoordinatesForRoom(playerobject, room)\r\n    return (DictionaryItem(coordinates, coordinate))\r\n  ","$":{"name":"Grid_GetGridCoordinateForPlayer","parameters":"playerobject, room, coordinate","type":"double"}},{"_":"\r\n    datadictionary = Grid_GetPlayerCoordinatesForRoom(playerobject, room)\r\n    if (DictionaryContains(datadictionary, coordinate)) {\r\n      dictionary remove (datadictionary, coordinate)\r\n    }\r\n    dictionary add (datadictionary, coordinate, value)\r\n  ","$":{"name":"Grid_SetRoomBooleanForPlayer","parameters":"playerobject, room, coordinate, value"}},{"_":"\r\n    coordinatedata = Grid_GetPlayerCoordinateDictionary(playerobject)\r\n    if (not DictionaryContains(coordinatedata, room.name)) {\r\n      return (false)\r\n    }\r\n    else {\r\n      datadictionary = Grid_GetPlayerCoordinatesForRoom(playerobject, room)\r\n      if (DictionaryContains(datadictionary, attribute)) {\r\n        return (DictionaryItem(datadictionary, attribute))\r\n      }\r\n      else {\r\n        return (false)\r\n      }\r\n    }\r\n  ","$":{"name":"Grid_GetRoomBooleanForPlayer","parameters":"playerobject, room, attribute","type":"boolean"}},{"_":"\r\n    if (HasAttribute(playerobject, \"grid_coordinates_delegate\")) {\r\n      return (Grid_GetPlayerCoordinateDictionary(playerobject.grid_coordinates_delegate))\r\n    }\r\n    else {\r\n      if (not HasAttribute(playerobject, \"grid_coordinates\")) {\r\n        playerobject.grid_coordinates = NewDictionary()\r\n        Grid_SetGridCoordinateForPlayer (playerobject, playerobject.parent, \"x\", 0)\r\n        Grid_SetGridCoordinateForPlayer (playerobject, playerobject.parent, \"y\", 0)\r\n        Grid_SetGridCoordinateForPlayer (playerobject, playerobject.parent, \"z\", 0)\r\n        playerobject.parent.grid_render = true\r\n        Grid_CalculateMapCoordinates (playerobject.parent, playerobject)\r\n      }\r\n      return (playerobject.grid_coordinates)\r\n    }\r\n  ","$":{"name":"Grid_GetPlayerCoordinateDictionary","parameters":"playerobject","type":"dictionary"}},{"_":"\r\n    coordinatedata = Grid_GetPlayerCoordinateDictionary(playerobject)\r\n    if (not DictionaryContains(coordinatedata, room.name)) {\r\n      dictionary add (coordinatedata, room.name, NewDictionary())\r\n    }\r\n    return (DictionaryItem(coordinatedata, room.name))\r\n  ","$":{"name":"Grid_GetPlayerCoordinatesForRoom","parameters":"playerobject, room","type":"dictionary"}},{"_":"\r\n    coordinateowner = GetCoordinateOwner(game.pov)\r\n    foreach (obj, GetDirectChildren(game.pov.parent)) {\r\n      if (obj <> game.pov and HasAttribute(obj, \"grid_coordinates\")) {\r\n        objcoordinateowner = GetCoordinateOwner(obj)\r\n        if (coordinateowner <> objcoordinateowner) {\r\n          MapPOVCoordinates (objcoordinateowner, coordinateowner)\r\n        }\r\n      }\r\n    }\r\n  ","$":{"name":"MergePOVCoordinates"}},{"_":"\r\n    if (HasAttribute(playerobject, \"grid_coordinates_delegate\")) {\r\n      return (GetCoordinateOwner(playerobject.grid_coordinates_delegate))\r\n    }\r\n    else {\r\n      return (playerobject)\r\n    }\r\n  ","$":{"name":"GetCoordinateOwner","parameters":"playerobject","type":"object"}},{"_":"\r\n    sourcecoordinates = Grid_GetPlayerCoordinateDictionary(source)\r\n    targetcoordinates = Grid_GetPlayerCoordinateDictionary(target)\r\n    xoffset = Grid_GetGridCoordinateForPlayer(target, game.pov.parent, \"x\") - Grid_GetGridCoordinateForPlayer(source, game.pov.parent, \"x\")\r\n    yoffset = Grid_GetGridCoordinateForPlayer(target, game.pov.parent, \"y\") - Grid_GetGridCoordinateForPlayer(source, game.pov.parent, \"y\")\r\n    zoffset = Grid_GetGridCoordinateForPlayer(target, game.pov.parent, \"z\") - Grid_GetGridCoordinateForPlayer(source, game.pov.parent, \"z\")\r\n    foreach (roomname, sourcecoordinates) {\r\n      coordinatedata = DictionaryItem(sourcecoordinates, roomname)\r\n      if (not DictionaryContains(targetcoordinates, roomname)) {\r\n        newroomdata = NewDictionary()\r\n        dictionary add (targetcoordinates, roomname, newroomdata)\r\n        MapPOVCoordinate (coordinatedata, newroomdata, \"x\", xoffset)\r\n        MapPOVCoordinate (coordinatedata, newroomdata, \"y\", yoffset)\r\n        MapPOVCoordinate (coordinatedata, newroomdata, \"z\", zoffset)\r\n        MapPOVCoordinate (coordinatedata, newroomdata, \"end_x\", xoffset)\r\n        MapPOVCoordinate (coordinatedata, newroomdata, \"end_y\", yoffset)\r\n      }\r\n      else {\r\n        newroomdata = DictionaryItem(targetcoordinates, roomname)\r\n      }\r\n      if (DictionaryContains(coordinatedata, \"grid_isdrawn\")) {\r\n        if (DictionaryContains(newroomdata, \"grid_isdrawn\")) {\r\n          dictionary remove (newroomdata, \"grid_isdrawn\")\r\n        }\r\n        dictionary add (newroomdata, \"grid_isdrawn\", DictionaryItem(coordinatedata, \"grid_isdrawn\"))\r\n      }\r\n    }\r\n    source.grid_coordinates_delegate = target\r\n    Grid_Redraw\r\n    Grid_DrawPlayerInRoom (game.pov.parent)\r\n  ","$":{"name":"MapPOVCoordinates","parameters":"source, target"}},{"_":"\r\n    if (DictionaryContains(sourcedata, name)) {\r\n      value = DictionaryItem(sourcedata, name)\r\n      dictionary add (targetdata, name, value + offset)\r\n    }\r\n  ","$":{"name":"MapPOVCoordinate","parameters":"sourcedata, targetdata, name, offset"}},{"_":"\r\n    if (TypeOf(dice) = \"int\") {\r\n      return (dice)\r\n    }\r\n    p1 = Instr(dice, \"d\")\r\n    p2 = Instr(dice, \"+\")\r\n    p4 = Instr(dice, \"-\")\r\n    p3 = LengthOf(dice)\r\n    if (p1 = 0) {\r\n      if (IsInt(dice)) {\r\n        return (ToInt(dice))\r\n      }\r\n      error (\"Invalid dice type: \" + dice)\r\n    }\r\n    number_str = Mid(dice, 1, p1 - 1)\r\n    if (LengthOf(number_str) = 0) {\r\n      number = 1\r\n    }\r\n    else {\r\n      number = ToInt(number_str)\r\n    }\r\n    if (p2 > 0) {\r\n      sides = ToInt(Mid(dice, p1 + 1, p2 - p1 - 1))\r\n      total = ToInt(Mid(dice, p2 + 1, p3 - p2))\r\n    }\r\n    else if (p4 > 0) {\r\n      sides = ToInt(Mid(dice, p1 + 1, p4 - p1 - 1))\r\n      total = -ToInt(Mid(dice, p4 + 1, p3 - p2))\r\n    }\r\n    else {\r\n      sides = ToInt(Mid(dice, p1 + 1, p3 - p1))\r\n      total = 0\r\n    }\r\n    for (i, 1, number) {\r\n      total = total + GetRandomInt(1, sides)\r\n    }\r\n    return (total)\r\n  ","$":{"name":"DiceRoll","parameters":"dice","type":"int"}},{"_":"\r\n    n = ListCount(lst)\r\n    if (n = 0) {\r\n      return (null)\r\n    }\r\n    index = GetRandomInt(0, n - 1)\r\n    return (ObjectListItem(lst, index))\r\n  ","$":{"name":"PickOneObject","parameters":"lst","type":"object"}},{"_":"\r\n    if (TypeOf(lst) = \"string\") {\r\n      lst = Split(lst, \";\")\r\n    }\r\n    n = ListCount(lst)\r\n    if (n = 0) {\r\n      return (\"\")\r\n    }\r\n    index = GetRandomInt(0, n - 1)\r\n    return (StringListItem(lst, index))\r\n  ","$":{"name":"PickOneString","parameters":"lst","type":"string"}},{"_":"\r\n    return (PickOneObject(GetDirectChildren(obj)))\r\n  ","$":{"name":"PickOneChild","parameters":"obj","type":"object"}},{"_":"\r\n    l = NewObjectList()\r\n    foreach (o, GetDirectChildren(room)) {\r\n      if (DoesInherit(o, typename)) {\r\n        list add (l, o)\r\n      }\r\n    }\r\n    return (PickOneObject(l))\r\n  ","$":{"name":"PickOneChildOfType","parameters":"room, typename","type":"object"}},{"_":"\r\n    return (PickOneObject(ScopeExitsForRoom (room)))\r\n  ","$":{"name":"PickOneExit","parameters":"room","type":"object"}},{"_":"\r\n    return (PickOneObject(ScopeUnlockedExitsForRoom (room)))\r\n  ","$":{"name":"PickOneUnlockedExit","parameters":"room","type":"object"}},{"_":"\r\n    TextFX_Typewriter_Internal (text, speed, GetCurrentFontFamily(), game.defaultforeground, game.defaultfontsize)\r\n  ","$":{"name":"TextFX_Typewriter","parameters":"text, speed"}},{"_":"\r\n    JS.TextFX.Typewriter (text, speed, font, color, size)\r\n  ","$":{"name":"TextFX_Typewriter_Internal","parameters":"text, speed, font, color, size"}},{"_":"\r\n    TextFX_Unscramble_Internal (text, speed, reveal, GetCurrentFontFamily(), game.defaultforeground, game.defaultfontsize)\r\n  ","$":{"name":"TextFX_Unscramble","parameters":"text, speed, reveal"}},{"_":"\r\n    JS.TextFX.Unscramble (text, speed, reveal, font, color, size)\r\n  ","$":{"name":"TextFX_Unscramble_Internal","parameters":"text, speed, reveal, font, color, size"}},{"_":"\r\n    // Is this possible?\r\n    if (not HasAttribute(object,\"worn\") or not HasAttribute(object,\"wear_slots\")) {\r\n      // No, not a garment\r\n      msg (DynamicTemplate(\"WearUnsuccessful\", object))\r\n      return (false)\r\n    }\r\n    if (object.parent = game.pov and object.worn = true) {\r\n      // No, already worn\r\n      msg (DynamicTemplate(\"AlreadyWearing\", object))\r\n      return (false)\r\n    }\r\n    if (not ListContains(ScopeInventory(), object)) {\r\n      // No, not held\r\n      msg (DynamicTemplate(\"CannotWearIfNotHeld\", object))\r\n      return (false)\r\n    }\r\n    // Are other worn garments in the way?\r\n    obj = _GetOuterForGarment(game.pov, object)\r\n    if (not obj = null) {\r\n      if (obj.wear_layer > object.wear_layer or obj.wear_layer = 0 or object.wear_layer = 0) {\r\n        msg (DynamicTemplate(\"CannotWearOver\", obj))\r\n        return (false)\r\n      }\r\n      if (obj.wear_layer = object.wear_layer) {\r\n        msg (DynamicTemplate(\"CannotWearWith\", obj))\r\n        return (false)\r\n      }\r\n    }\r\n    if (not TestGarment(object)) {\r\n      return (false)\r\n    }\r\n    WearGarment (object)\r\n    if (object.wearmsg = null) {\r\n      P (DynamicTemplate(\"WearSuccessful\",object))\r\n    }\r\n    else {\r\n      P (object.wearmsg)\r\n    }\r\n    // do after\r\n    if (HasScript(object, \"onafterwear\")) {\r\n      do (object, \"onafterwear\")\r\n    }\r\n    else if (HasString(object, \"onafterwear\")) {\r\n      P (object.onafterwear)\r\n    }\r\n    AfterWear\r\n    return (true)\r\n  ","$":{"name":"_DoWear","parameters":"object","type":"boolean"}},{"_":"\r\n    if (GetBoolean(object, \"multistate\")) {\r\n      object.multistate_status = 1\r\n    }\r\n    else {\r\n      object.multistate_status = 0\r\n    }\r\n    if (object.alias = null) {\r\n      object.alias = object.name\r\n    }\r\n    if (object.listalias = null) {\r\n      object.listalias = object.alias\r\n    }\r\n    if (object.original_alias = null) {\r\n      object.original_drop = object.drop\r\n      object.original_alias = object.alias\r\n      object.original_listalias = object.listalias\r\n      object.original_bonusatts = object.bonusatts\r\n      object.original_wearslots = object.wear_slots\r\n      object.display = GetDisplayAlias(object)\r\n    }\r\n    object.parent = _GetWornClothingLocation()\r\n    object.worn = True\r\n    object.drop = false\r\n    _SetGarmentAlias (object)\r\n    _SetMultistate (object)\r\n    SetVerbs\r\n    SetBonuses (object, true)\r\n    if (HasInt(game.pov, \"maxobjects\")) {\r\n      game.pov.maxobjects = game.pov.maxobjects + 1\r\n    }\r\n    // Do error checking now so item can be put on even if multistate is going to fail\r\n    if (GetBoolean(object, \"multistate\")) {\r\n      if (not HasAttribute(object, \"multistate_descriptors\")) {\r\n        error (\"No descriptors for multistate clothing: \" + object.name)\r\n      }\r\n      if (not HasAttribute(object, \"multistate_verbs\")) {\r\n        error (\"No verbs for multistate clothing: \" + object.name)\r\n      }\r\n      if (not HasAttribute(object, \"multistate_wearslots\")) {\r\n        error (\"No wearslots for multistate clothing: \" + object.name)\r\n      }\r\n      statecount = ListCount(object.multistate_descriptors)\r\n      if (not statecount = ListCount(object.multistate_verbs)) {\r\n        error (\"Mismatch in lists for multistate clothing: \" + object.name)\r\n      }\r\n      if (not statecount = ListCount(object.multistate_wearslots)) {\r\n        error (\"Mismatch in lists for multistate clothing: \" + object.name)\r\n      }\r\n      object.original_wearslots = object.wear_slots\r\n    }\r\n  ","$":{"name":"WearGarment","parameters":"object"}},{"_":"\r\n    if (not ListContains(GetAllChildObjects(game.pov), object)) {\r\n      msg (DynamicTemplate(\"CannotRemoveIfNotHeld\", object))\r\n      return (false)\r\n    }\r\n    if (not GetBoolean(object, \"worn\")) {\r\n      msg (DynamicTemplate(\"CannotRemoveIfNotWearing\", object))\r\n      return (false)\r\n    }\r\n    if (not GetBoolean(object, \"removeable\")) {\r\n      if (HasString(object, \"notremoveablemessage\")) {\r\n        msg (object.notremoveablemessage)\r\n      }\r\n      else {\r\n        msg (DynamicTemplate(\"NotRemovable\", object))\r\n      }\r\n      return (false)\r\n    }\r\n    if (HasInt(game.pov, \"maxobjects\")) {\r\n      if (ListCount(GetAllChildObjects(game.pov)) >= game.pov.maxobjects) {\r\n        msg (DynamicTemplate(\"MaxObjectsInInventory\", object))\r\n        return (false)\r\n      }\r\n    }\r\n    obj = _GetOuterForGarment(game.pov, object)\r\n    if (not obj = null) {\r\n      if (obj.wear_layer > object.wear_layer) {\r\n        msg (DynamicTemplate(\"RemoveFirst\", obj))\r\n        return (false)\r\n      }\r\n    }\r\n    if (not TestRemove(object)) {\r\n      return (false)\r\n    }\r\n    RemoveGarment (object)\r\n    if (object.removemsg = null) {\r\n      P (DynamicTemplate(\"RemoveSuccessful\",object))\r\n    }\r\n    else {\r\n      P (object.removemsg)\r\n    }\r\n    // do after\r\n    if (HasScript(object, \"onafterremove\")) {\r\n      do (object, \"onafterremove\")\r\n    }\r\n    else if (HasString(object, \"onafterremove\")) {\r\n      P (object.onafterremove)\r\n    }\r\n    AfterRemove\r\n    return (true)\r\n  ","$":{"name":"_DoRemove","parameters":"object","type":"boolean"}},{"_":"\r\n    SetBonuses (object, false)\r\n    object.worn = false\r\n    object.drop = object.original_drop\r\n    object.alias = object.original_alias\r\n    object.multistate_status = 0\r\n    if (HasString(object, \"listalias\")) {\r\n      if (StartsWith(object.listalias, \"<span style=\\\"color:blue\\\">\")) {\r\n        object.listalias = null\r\n        do (object, \"colourmylistalias\")\r\n      }\r\n      else {\r\n        object.listalias = object.original_listalias\r\n      }\r\n    }\r\n    object.parent = game.pov\r\n    if (HasInt(game.pov, \"maxobjects\")) {\r\n      game.pov.maxobjects = game.pov.maxobjects - 1\r\n    }\r\n    SetVerbs\r\n  ","$":{"name":"RemoveGarment","parameters":"object"}},{"_":"\r\n    sl = NewStringList()\r\n    foreach (o, AllObjects()) {\r\n      if (HasAttribute(o, \"wear_slots\")) {\r\n        foreach (s, o.wear_slots) {\r\n          if (not ListContains(sl, s)) {\r\n            list add (sl, s)\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return (sl)\r\n  ","$":{"name":"Slots","type":"stringlist"}},{"_":"\r\n    if (not GetBoolean(obj, \"usedefaultprefix\")) {\r\n      if (obj.prefix = null) {\r\n        prefix = \"\"\r\n      }\r\n      else {\r\n        prefix = obj.prefix\r\n      }\r\n    }\r\n    else {\r\n      prefix = GetDefaultPrefix(obj)\r\n    }\r\n    if (LengthOf(prefix) > 0) {\r\n      prefix = prefix + \" \"\r\n    }\r\n    if (HasString(obj, \"original_alias\")) {\r\n      result = prefix + obj.original_alias\r\n    }\r\n    else {\r\n      result = prefix + obj.alias\r\n    }\r\n    if (not GetBoolean(obj, \"usedefaultprefix\") and HasString(obj, \"suffix\")) {\r\n      if (LengthOf(obj.suffix) > 0) {\r\n        result = result + \" \" + obj.suffix\r\n      }\r\n    }\r\n    return (result)\r\n  ","$":{"name":"GetDisplayGarment","parameters":"obj","type":"string"}},{"_":"\r\n    if (object.multistate_status = 0) {\r\n      return (\" (worn)\")\r\n    }\r\n    s = StringListItem(object.multistate_descriptors, object.multistate_status - 1)\r\n    if (s = \"*\") {\r\n      return (\" (worn)\")\r\n    }\r\n    return (\" (worn \" + s + \")\")\r\n  ","$":{"name":"GetDescriptor","parameters":"object","type":"string"}},{"_":"\r\n    if (state < 1) {\r\n      error (\"Attempt to set state to \" + state + \" for \" + object.name)\r\n    }\r\n    if (state > ListCount(object.multistate_descriptors)) {\r\n      error (\"Attempt to set state to \" + state + \" for \" + object.name + \" (max \" + ListCount(object.multistate_descriptors) + \")\")\r\n    }\r\n    if (not object.multistate_status = state) {\r\n      SetBonuses (object, false)\r\n      object.multistate_status = state\r\n      _SetGarmentAlias (object)\r\n      _SetMultistate (object)\r\n      SetBonuses (object, true)\r\n      SetVerbs\r\n    }\r\n  ","$":{"name":"SetMultistate","parameters":"object, state"}},{"_":"\r\n    garment = null\r\n    foreach (o, _GetList(char, slot)) {\r\n      if (garment = null) {\r\n        garment = o\r\n      }\r\n      else if (o.wear_layer > garment.wear_layer) {\r\n        garment = o\r\n      }\r\n    }\r\n    return (garment)\r\n  ","$":{"name":"GetOuterFor","parameters":"char, slot","type":"object"}},{"_":"\r\n    return (_GetList(char, null))\r\n  ","$":{"name":"ListWornFor","parameters":"char","type":"objectlist"}},{"_":"\r\n    ol = newObjectList()\r\n    foreach (s, Slots()) {\r\n      o = GetOuterFor(char, s)\r\n      if (not o = null and not ListContains(ol, o)) {\r\n        list add (ol, o)\r\n      }\r\n    }\r\n    return (ol)\r\n  ","$":{"name":"ListVisibleFor","parameters":"char","type":"objectlist"}},{"_":"\r\n    total = 2 * _GetSlotArmour(char, \"head\") + 3 * _GetSlotArmour(char, \"torso\")\r\n    foreach (s, Split(\"feet|legs|shoulders|arms|hands\", \"|\")) {\r\n      total = total + _GetSlotArmour(char, s)\r\n    }\r\n    return (total)\r\n  ","$":{"name":"GetArmourFor","parameters":"char","type":"int"}},{"_":"\r\n    return (GetOuterFor(game.pov, slot))\r\n  ","$":{"name":"GetOuter","parameters":"slot","type":"object"}},{"_":"\r\n    return (GetArmourFor(game.pov))\r\n  ","$":{"name":"GetArmour","type":"int"}},{"_":"\r\n    foreach (o, GetAllChildObjects(game.pov)) {\r\n      if (DoesInherit(o, \"wearable\")) {\r\n        if (HasAttribute(o, \"wear_slots\") and HasInt(o, \"wear_layer\")) {\r\n          _SetVerbsForGarment (o)\r\n        }\r\n        if (not HasString(o, \"alias\")) {\r\n          o.alias = o.name\r\n        }\r\n        if (not HasString(o, \"listalias\")) {\r\n          o.listalias = o.alias\r\n        }\r\n      }\r\n    }\r\n  ","$":{"name":"SetVerbs"}},{"_":"\r\n    count = 0\r\n    foreach (o, GetAllChildObjects(game.pov)) {\r\n      if (GetBoolean(o, \"worn\")) {\r\n        count = count + 1\r\n      }\r\n    }\r\n    return (count)\r\n  ","$":{"name":"WornCount","type":"int"}},{"_":"\r\n    l = NewStringList()\r\n    foreach (obj, ListWornFor(game.pov)) {\r\n      list add (l, GetDisplayGarment(obj))\r\n    }\r\n    return (FormatList(l, \",\", \"and\", \"nothing\"))\r\n  ","$":{"name":"ListClothes","type":"string"}},{"_":"\r\n    if (HasString(garment, \"bonusatts\")) {\r\n      foreach (att, Split(garment.bonusatts, \";\")) {\r\n        bonus = 1\r\n        plusarray = Split(att, \"+\")\r\n        minusarray = Split(att, \"-\")\r\n        if (ListCount(plusarray) = 2) {\r\n          att = StringListitem(plusarray, 0)\r\n          if (not IsInt(StringListitem(plusarray, 1))) {\r\n            error (\"Bonus attribute for \" + garment.name + \" not properly formatted: \" + garment.bonusatts)\r\n          }\r\n          bonus = ToInt(StringListitem(plusarray, 1))\r\n        }\r\n        if (ListCount(minusarray) = 2) {\r\n          att = StringListitem(minusarray, 0)\r\n          if (not IsInt(StringListitem(minusarray, 1))) {\r\n            error (\"Negative bonus attribute for \" + garment.name + \" not properly formatted: \" + garment.bonusatts)\r\n          }\r\n          bonus = -ToInt(StringListitem(minusarray, 1))\r\n        }\r\n        if (not wearflag) {\r\n          bonus = -bonus\r\n        }\r\n        bonus = ClothingBonusMultiplier() * bonus\r\n        n = GetInt(game.pov, att) + bonus\r\n        set (player, att, n)\r\n      }\r\n    }\r\n  ","$":{"name":"SetBonuses","parameters":"garment, wearflag"}},{"_":"\r\n    SetListAlias (object, alias, alias)\r\n  ","$":{"name":"SetAlias","parameters":"object, alias"}},{"_":"\r\n    object.alias = alias\r\n    object.listalias = listalias\r\n    if (Equal(object.worn, true)) {\r\n      object.original_alias = object.alias\r\n      object.original_listalias = object.listalias\r\n      object.display = GetDisplayAlias(object)\r\n      _SetGarmentAlias (object)\r\n    }\r\n  ","$":{"name":"SetListAlias","parameters":"object, alias, listalias"}},{"_":"\r\n    if (GetBoolean(object, \"multistate\")) {\r\n      ws = StringListItem(object.multistate_wearslots, object.multistate_status - 1)\r\n      if (ws = \"*\") {\r\n        object.wear_slots = object.original_wearslots\r\n      }\r\n      else {\r\n        object.wear_slots = Split(ws, \";\")\r\n      }\r\n      wv = StringListItem(object.multistate_verbs, object.multistate_status - 1)\r\n      if (wv = \"*\") {\r\n        object.wornverbs = null\r\n      }\r\n      else {\r\n        object.wornverbs = wv\r\n      }\r\n      ba = StringListItem(object.multistate_bonusatts, object.multistate_status - 1)\r\n      if (ba = \"*\") {\r\n        object.bonusatts = object.original_bonusatts\r\n      }\r\n      else {\r\n        object.bonusatts = ba\r\n      }\r\n    }\r\n  ","$":{"name":"_SetMultistate","parameters":"object"}},{"_":"\r\n    ext = GetDescriptor(object)\r\n    object.alias = object.display + ext\r\n    if (HasString(object, \"listalias\")) {\r\n      if (StartsWith(object.listalias, \"<span style=\\\"color:blue\\\">\")) {\r\n        object.listalias = null\r\n        do (object, \"colourmylistalias\")\r\n      }\r\n      else {\r\n        object.listalias = object.original_listalias + ext\r\n      }\r\n    }\r\n  ","$":{"name":"_SetGarmentAlias","parameters":"object"}},{"_":"\r\n    foreach (o, GetDirectChildren(game.pov)) {\r\n      if (GetBoolean(o, \"wornclothinglocation\")) {\r\n        return (o)\r\n      }\r\n    }\r\n    return (game.pov)\r\n  ","$":{"name":"_GetWornClothingLocation","type":"object"}},{"_":"\r\n    foreach (slot, garment.wear_slots) {\r\n      obj = GetOuterFor(char, slot)\r\n      if (not obj = null and not obj = garment) {\r\n        return (obj)\r\n      }\r\n    }\r\n    return (null)\r\n  ","$":{"name":"_GetOuterForGarment","parameters":"char, garment","type":"object"}},{"_":"\r\n    garment.inventoryverbs = list\r\n    if (not s = null) {\r\n      if (not s = \"\") {\r\n        foreach (s2, Split(s, \";\")) {\r\n          list add (garment.inventoryverbs, s2)\r\n        }\r\n      }\r\n    }\r\n  ","$":{"name":"_SetVerbList","parameters":"garment, list, s"}},{"_":"\r\n    outer = _GetOuterForGarment(game.pov, garment)\r\n    if (not garment.worn) {\r\n      if (outer = null) {\r\n        _SetVerbList (garment, Split(\"Look at;Drop;Wear\", \";\"), garment.invverbs)\r\n      }\r\n      else if (outer.wear_layer < garment.wear_layer) {\r\n        _SetVerbList (garment, Split(\"Look at;Drop;Wear\", \";\"), garment.invverbs)\r\n      }\r\n      else {\r\n        _SetVerbList (garment, Split(\"Look at;Drop\", \";\"), garment.invverbs)\r\n      }\r\n    }\r\n    else {\r\n      if (outer = null) {\r\n        if (garment.removeable) {\r\n          _SetVerbList (garment, Split(\"Look at;Remove\", \";\"), garment.wornverbs)\r\n        }\r\n        else {\r\n          _SetVerbList (garment, Split(\"Look at\", \";\"), garment.wornverbs)\r\n        }\r\n      }\r\n      else if (outer.wear_layer < garment.wear_layer) {\r\n        if (garment.removeable) {\r\n          _SetVerbList (garment, Split(\"Look at;Remove\", \";\"), garment.wornverbs)\r\n        }\r\n        else {\r\n          _SetVerbList (garment, Split(\"Look at\", \";\"), garment.wornverbs)\r\n        }\r\n      }\r\n      else {\r\n        garment.inventoryverbs = Split(\"Look at\", \";\")\r\n      }\r\n    }\r\n  ","$":{"name":"_SetVerbsForGarment","parameters":"garment"}},{"_":"\r\n    garments = NewObjectList()\r\n    foreach (o, GetAllChildObjects(char)) {\r\n      if (HasAttribute(o, \"wear_slots\") and HasInt(o, \"wear_layer\") and GetBoolean(o, \"worn\")) {\r\n        if (ListContains(o.wear_slots, slot) or slot = null) {\r\n          list add (garments, o)\r\n        }\r\n      }\r\n    }\r\n    return (garments)\r\n  ","$":{"name":"_GetList","parameters":"char, slot","type":"objectlist"}},{"_":"\r\n    total = 0\r\n    max = 0\r\n    foreach (o, _GetList(char, slot)) {\r\n      total = total + o.armour\r\n      if (o.armour > max) {\r\n        max = o.armour\r\n      }\r\n    }\r\n    return (total + max)\r\n  ","$":{"name":"_GetSlotArmour","parameters":"char, slot","type":"int"}},{"_":"\r\n    return (1)\r\n  ","$":{"name":"ClothingBonusMultiplier","type":"int"}},{"$":{"name":"AfterRemove"}},{"$":{"name":"AfterWear"}},{"_":"\r\n    msg (s)\r\n  ","$":{"name":"P","parameters":"s"}},{"$":{"name":"UpdateArmour"}},{"_":"\r\n    return (true)\r\n  ","$":{"name":"TestGarment","parameters":"object","type":"boolean"}},{"_":"\r\n    return (true)\r\n  ","$":{"name":"TestRemove","parameters":"object","type":"boolean"}},{"_":"\r\n    if (game.setcustomwidth) {\r\n      JS.setGameWidth (game.customwidth)\r\n    }\r\n    if (game.setcustompadding) {\r\n      JS.setGamePadding (game.custompaddingtop, game.custompaddingbottom, game.custompaddingleft, game.custompaddingright)\r\n    }\r\n    if (game.externalstylesheets <> null) {\r\n      foreach (stylesheet, game.externalstylesheets) {\r\n        JS.addExternalStylesheet (stylesheet)\r\n      }\r\n    }\r\n    if (game.setbackgroundopacity) {\r\n      SetBackgroundOpacity (game.backgroundopacity)\r\n    }\r\n    request (Background, game.defaultbackground)\r\n    request (Foreground, game.defaultforeground)\r\n    request (LinkForeground, game.defaultlinkforeground)\r\n    if (LengthOf(game.backgroundimage) > 0) {\r\n      SetBackgroundImage (game.backgroundimage)\r\n    }\r\n    request (SetCompassDirections, Join(game.compassdirections, \";\"))\r\n    request (SetInterfaceString, \"InventoryLabel=Inventory\")\r\n    request (SetInterfaceString, \"StatusLabel=Status\")\r\n    request (SetInterfaceString, \"PlacesObjectsLabel=Places and Objects\")\r\n    request (SetInterfaceString, \"CompassLabel=Compass\")\r\n    request (SetInterfaceString, \"InButtonLabel=in\")\r\n    request (SetInterfaceString, \"OutButtonLabel=out\")\r\n    request (SetInterfaceString, \"EmptyListLabel=(empty)\")\r\n    request (SetInterfaceString, \"NothingSelectedLabel=(nothing selected)\")\r\n    request (SetInterfaceString, \"TypeHereLabel=Type here...\")\r\n    request (SetInterfaceString, \"ContinueLabel=Continue...\")\r\n    JS.SetMenuBackground (game.menubackground)\r\n    JS.SetMenuForeground (game.menuforeground)\r\n    JS.SetMenuHoverBackground (game.menuhoverbackground)\r\n    JS.SetMenuHoverForeground (game.menuhoverforeground)\r\n    JS.SetMenuFontName (game.menufont)\r\n    JS.SetMenuFontSize (game.menufontsize + \"pt\")\r\n    if (not game.underlinehyperlinks) {\r\n      JS.TurnOffHyperlinksUnderline ()\r\n    }\r\n    ResetCommandBarFormat\r\n    if (game.showcommandbar) {\r\n      request (Show, \"Command\")\r\n    }\r\n    else {\r\n      request (Hide, \"Command\")\r\n    }\r\n    if (HasString(game, \"panelcontents\")) {\r\n      SetFramePicture (game.panelcontents)\r\n    }\r\n    if (game.gridmap) {\r\n      JS.ShowGrid (game.mapsize)\r\n      Grid_SetScale (game.mapscale)\r\n      if (game.pov <> null) {\r\n        if (game.pov.parent <> null) {\r\n          Grid_Redraw\r\n          Grid_DrawPlayerInRoom (game.pov.parent)\r\n        }\r\n      }\r\n    }\r\n    // Added by the Pixie\r\n    // Note that panesVisible in playercore.js must be updated too\r\n    // This line will get the save confirmation to appear in the right font and colour\r\n    JS.setCss (\"body\", \"color:\" + game.defaultforeground + \";font-family:\" + game.defaultfont + \";font-size:\" + game.defaultfontsize + \"pt;\")\r\n    // various new options\r\n    if (HasString(game, \"bordercolour\")) {\r\n      JS.setCss (\"#gameBorder\", \"border-left:1px solid \" + game.bordercolour + \";border-right:1px solid \" + game.bordercolour)\r\n    }\r\n    if (not game.classiclocation) {\r\n      JS.setCss (\"#status\", \"background-image:none\")\r\n      if (HasString(game, \"customlocationcolour\")) {\r\n        JS.setCss (\"#status\", \"background-color:\" + game.customlocationcolour)\r\n      }\r\n      else {\r\n        JS.setCss (\"#status\", \"background:transparent\")\r\n      }\r\n      if (HasString(game, \"customlocationtextcolour\")) {\r\n        JS.setCss (\"#status\", \"color:\" + game.customlocationtextcolour)\r\n      }\r\n      if (HasString(game, \"customlocationbordercolour\")) {\r\n        JS.setCss (\"#status\", \"border:1px solid \" + game.customlocationbordercolour)\r\n      }\r\n      else {\r\n        JS.setCss (\"#status\", \"border:none\")\r\n      }\r\n    }\r\n    request (Show, \"Location\")\r\n    if (game.showlocation) {\r\n      JS.setCss (\"#status\", \"display:block\")\r\n    }\r\n    else {\r\n      JS.setCss (\"#status\", \"display:none\")\r\n    }\r\n    if (HasString(game, \"marginscolour\")) {\r\n      JS.setCss (\"body\", \"background-color:\" + game.marginscolour)\r\n    }\r\n    if (game.turnoffsavebutton) {\r\n      JS.setCss (\"#controlButtons\", \"display:none\")\r\n    }\r\n    if (game.turnoffcompass) {\r\n      JS.setCss (\"#compassLabel\", \"display:none;\")\r\n      JS.setCss (\"#compassAccordion\", \"display:none;\")\r\n    }\r\n    if (game.turnoffinventory) {\r\n      JS.setCss (\"#inventoryLabel\", \"display:none\")\r\n      JS.setCss (\"#inventoryAccordion\", \"display:none\")\r\n    }\r\n    if (game.turnoffplacesandobjects) {\r\n      JS.setCss (\"#placesObjectsLabel\", \"display:none\")\r\n      JS.setCss (\"#placesObjectsAccordion\", \"display:none\")\r\n    }\r\n    if (game.statusandcompassattop) {\r\n      JS.eval (\"$('#commandPane').insertBefore('#inventoryLabel')\")\r\n      JS.eval (\"$('#customStatusPane').insertBefore('#inventoryLabel')\")\r\n      JS.eval (\"$('#statusVarsLabel').insertBefore('#inventoryLabel')\")\r\n      JS.eval (\"$('#statusVarsAccordion').insertBefore('#inventoryLabel')\")\r\n      JS.eval (\"$('#compassLabel').insertBefore('#inventoryLabel')\")\r\n      JS.eval (\"$('#compassAccordion').insertBefore('#inventoryLabel')\")\r\n    }\r\n    if (game.showpanes and game.commandpane) {\r\n      JS.setCss (\"#commandPane\", \"display:block\")\r\n    }\r\n    if (game.showpanes and game.customstatuspane) {\r\n      JS.setCss (\"#customStatusPane\", \"display:block\")\r\n    }\r\n    if (game.colourblend) {\r\n      JS.colourBlend (game.colourblendtop, game.colourblendbottom)\r\n    }\r\n    if (game.borderlesscursor) {\r\n      JS.addScript (\"<style>#txtCommand { outline:none; border:none; margin:0; padding:0; width:100px; background-color:transparent;}</style>\")\r\n      JS.setCss (\"#txtCommandDiv\", \"color:\" + game.defaultforeground)\r\n      JS.eval (\"$('#txtCommandPrompt').html('\" + game.commandcursor + \"')\")\r\n      request (SetInterfaceString, \"TypeHereLabel=\")\r\n    }\r\n    else if (game.shadowbox) {\r\n      JS.addScript (\"<style>#txtCommand { outline:none; border:none; margin:2px; padding:7px; width:100 px;box-shadow: 0px 0px 15px 5px #888;}</style>\")\r\n    }\r\n    if (game.panestheme = \"Midnight\") {\r\n      JS.setPanes (\"white\", \"midnightblue\", \"midnightblue\", \"skyblue\")\r\n    }\r\n    if (game.panestheme = \"Nature\") {\r\n      JS.setPanes (\"#A1C935\", \"#254117\", \"#306754\", \"#A1C935\", \"green\")\r\n    }\r\n    if (game.panestheme = \"Parchment\") {\r\n      JS.setPanes (\"#493D26\", \"#FAEBD7\", \"#FAEBD7\", \"#493D26\", \"#C88141\")\r\n    }\r\n    if (game.panestheme = \"Vanilla\") {\r\n      JS.setPanes (\"black\", \"white\")\r\n    }\r\n    if (game.panestheme = \"Black\") {\r\n      JS.setPanes (\"orange\", \"black\", \"black\", \"orange\")\r\n    }\r\n    if (game.panestheme = \"Blood\") {\r\n      JS.setPanes (\"orange\", \"#800000\", \"#800000\", \"orange\", \"yellow\")\r\n    }\r\n    if (game.panestheme = \"Tranquil\") {\r\n      JS.setPanes (\"midnightblue\", \"skyblue\", \"white\", \"midnightblue\", \"blue\")\r\n    }\r\n    if (game.respondtogridclicks) {\r\n      JS.respondToGridClicks (true)\r\n    }\r\n    //\r\n    // -----------------------------------------------------------------------\r\n    // This is in the original, but must come last\r\n    if (not game.showborder) {\r\n      JS.hideBorder ()\r\n    }\r\n    if (game.showpanes) {\r\n      request (Show, \"Panes\")\r\n    }\r\n    else {\r\n      request (Hide, \"Panes\")\r\n    }\r\n    JS.getDivCount ()\r\n    if (not game.pov = null) {\r\n      JS.updateLocation (CapFirst(GetDisplayName(game.pov.parent)))\r\n    }\r\n    InitUserInterface\r\n    if (HasScript(game, \"inituserinterface\")) {\r\n      do (game, \"inituserinterface\")\r\n    }\r\n  ","$":{"name":"InitInterface"}},{"$":{"name":"InitUserInterface"}},{"_":"\r\n    StartTurnOutputSection\r\n    if (game.showtitle) {\r\n      JS.StartOutputSection (\"title\")\r\n      PrintCentered (\"<span style=\\\"font-size:260%\\\">\" + game.gamename + \"</span>\")\r\n      if (game.subtitle <> null) {\r\n        if (LengthOf(game.subtitle) > 0) {\r\n          PrintCentered (\"<span style=\\\"font-size:130%\\\">\" + game.subtitle + \"</span>\")\r\n        }\r\n      }\r\n      if (game.author <> null) {\r\n        if (LengthOf(game.author) > 0) {\r\n          PrintCentered (\"<br/><span style=\\\"font-size:140%\\\">by \" + game.author + \"</span>\")\r\n        }\r\n      }\r\n      msg (\"<div style=\\\"margin-top:20px\\\"></div>\")\r\n      JS.EndOutputSection (\"title\")\r\n    }\r\n    if (game.pov = null) {\r\n      playerObject = GetObject(\"player\")\r\n      if (playerObject = null) {\r\n        if (ListCount(AllObjects()) > 0) {\r\n          firstRoom = ObjectListItem(AllObjects(), 0)\r\n        }\r\n        else {\r\n          create (\"room\")\r\n          firstRoom = room\r\n        }\r\n        create (\"player\")\r\n        player.parent = firstRoom\r\n      }\r\n      game.pov = player\r\n    }\r\n    else {\r\n      InitPOV (null, game.pov)\r\n    }\r\n    InitStatusAttributes\r\n    UpdateStatusAttributes\r\n    InitVerbsList\r\n    if (HasScript(game, \"start\")) {\r\n      do (game, \"start\")\r\n    }\r\n    foreach (obj, AllObjects()) {\r\n      if (HasScript(obj, \"_initialise_\")) {\r\n        do (obj, \"_initialise_\")\r\n      }\r\n    }\r\n    UpdateStatusAttributes\r\n    UpdateObjectLinks\r\n    on ready {\r\n      if (game.gridmap) {\r\n        Grid_DrawPlayerInRoom (game.pov.parent)\r\n      }\r\n      if (game.displayroomdescriptiononstart) {\r\n        OnEnterRoom (null)\r\n      }\r\n      UpdateStatusAttributes\r\n      UpdateObjectLinks\r\n    }\r\n  ","$":{"name":"StartGame"}},{"_":"\r\n    game.verbattributes = NewStringList()\r\n    game.verbattributeslookup = NewObjectDictionary()\r\n    foreach (cmd, AllCommands()) {\r\n      if (HasString(cmd, \"property\")) {\r\n        list add (game.verbattributes, cmd.property)\r\n        dictionary add (game.verbattributeslookup, cmd.property, cmd)\r\n      }\r\n    }\r\n  ","$":{"name":"InitVerbsList"}},{"_":"\r\n    if (Contains(game.pov, object)) {\r\n      baselist = object.inventoryverbs\r\n    }\r\n    else {\r\n      baselist = object.displayverbs\r\n    }\r\n    if (not game.autodisplayverbs or GetBoolean(object, \"usestandardverblist\") or not HasAttribute(game, \"verbattributes\")) {\r\n      return (baselist)\r\n    }\r\n    else {\r\n      if (HasAttribute(object, \"generatedverbslist\")) {\r\n        verbs = object.generatedverbslist\r\n      }\r\n      else {\r\n        verbs = NewStringList()\r\n        foreach (attr, GetAttributeNames(object, false)) {\r\n          if (ListContains(game.verbattributes, attr)) {\r\n            cmd = ObjectDictionaryItem(game.verbattributeslookup, attr)\r\n            if (HasString(cmd, \"displayverb\")) {\r\n              displayverb = CapFirst(cmd.displayverb)\r\n            }\r\n            else {\r\n              displayverb = CapFirst(attr)\r\n            }\r\n            if (not ListContains(baselist, displayverb)) {\r\n              list add (verbs, displayverb)\r\n            }\r\n          }\r\n        }\r\n        object.generatedverbslist = verbs\r\n      }\r\n      if (GetBoolean(object, \"useindividualverblist\")) {\r\n        return (verbs)\r\n      }\r\n      else {\r\n        return (ListCombine(baselist, verbs))\r\n      }\r\n    }\r\n  ","$":{"name":"GetDisplayVerbs","parameters":"object","type":"stringlist"}},{"_":"\r\n    if (oldPOV <> null) {\r\n      oldPOV.alias = oldPOV.external_alias\r\n      oldPOV.alt = oldPOV.external_alt\r\n      oldPOV.look = oldPOV.external_look\r\n      oldPOV.gender = oldPOV.external_gender\r\n      oldPOV.article = oldPOV.external_article\r\n    }\r\n    newPOV.external_alias = newPOV.alias\r\n    newPOV.external_alt = newPOV.alt\r\n    newPOV.external_look = newPOV.look\r\n    newPOV.external_gender = newPOV.gender\r\n    newPOV.external_article = newPOV.article\r\n    if (not GetBoolean(newPOV, \"pov_used\")) {\r\n      if (newPOV.alt = null) {\r\n        newPOV.pov_alt = newPOV.pov_alt\r\n      }\r\n      else {\r\n        newPOV.pov_alt = ListCombine(newPOV.alt, newPOV.pov_alt)\r\n      }\r\n      if (newPOV.alias <> null) {\r\n        list add (newPOV.pov_alt, newPOV.alias)\r\n      }\r\n      if (game.showmoney and not HasInt(newPOV, \"money\")) {\r\n        newPOV.money = 0\r\n      }\r\n      if (game.showhealth) {\r\n        newPOV.health = 100\r\n        newPOV.changedhealth => {\r\n          if (this.health > 100) {\r\n            this.health = 100\r\n          }\r\n          else if (this.health = 0) {\r\n            if (HasScript(game, \"onhealthzero\")) {\r\n              do (game, \"onhealthzero\")\r\n            }\r\n          }\r\n          else if (this.health < 0) {\r\n            this.health = 0\r\n            // changedhealth will be called again so the onhealthzero script will run\r\n          }\r\n        }\r\n      }\r\n      newPOV.pov_used = true\r\n    }\r\n    newPOV.alias = newPOV.pov_alias\r\n    newPOV.alt = newPOV.pov_alt\r\n    newPOV.look = newPOV.pov_look\r\n    newPOV.gender = newPOV.pov_gender\r\n    newPOV.article = newPOV.pov_article\r\n  ","$":{"name":"InitPOV","parameters":"oldPOV, newPOV"}},{"_":"\r\n    RunTurnScripts\r\n    UpdateStatusAttributes\r\n    CheckDarkness\r\n    UpdateObjectLinks\r\n  ","$":{"name":"FinishTurn"}},{"_":"\r\n    if (GetBoolean(Jonny, \"van_fixed\")) {\r\n      msg (\"Jonny jumps into the driver seat and says, \\\"Where to then Boss?\\\" (Just type name of the location you want Jon to drive you to).\")\r\n      get input {\r\n        switch (LCase(result)) {\r\n          case (\"vernon\",\"mill\",\"vernon mill\",\"rehearsal rooms\",\"rehearsal room\",\"rehearsal\",\"outside vernon mill\",\"outside vernon mill rehearsal rooms\") {\r\n            if (game.pov.parent = Outside Vernon Mill Rehearsal Rooms) {\r\n              msg (\"<br/>\\\"Er, are you fucking high boss?\\\" says Jonny, \\\"We're already there man!\\\"\")\r\n            }\r\n            else {\r\n              msg (\"<br/>\\\"Right you are boss!\\\", Jonny floors the accelerator and the van hurtles down the road at breakneck speed, eventually screeching to a halt outside Vernon Mill Rehearsal Rooms.<br/><br/>\")\r\n              MoveObject (Van, Outside Vernon Mill Rehearsal Rooms)\r\n              MoveObject (player, Outside Vernon Mill Rehearsal Rooms)\r\n            }\r\n          }\r\n          case (\"scrap yard\",\"scrap\",\"jackson's\",\"jacksons scrap yard\", \"outside scarp yard\", \"outside jacksons scrap yard\", \"outside jacksons\") {\r\n            if (game.pov.parent = Outside Scrap Yard) {\r\n              msg (\"<br/>\\\"Er, are you fucking high boss?\\\" says Jonny, \\\"We're already there man!\\\"\")\r\n            }\r\n            else {\r\n              msg (\"<br/>\\\"Right you are boss!\\\", Jonny floors the accelerator and the van hurtles down the road at breakneck speed, eventually screeching to a halt outside Jackson's Scrap Yard.<br/><br/>\")\r\n              MoveObject (Van, Outside Scrap Yard)\r\n              MoveObject (player, Outside Scrap Yard)\r\n            }\r\n          }\r\n          case (\"ed case's house\",\"ed cases house\",\"ed case\",\"outside ed case's house\",\"outside ed cases house\",\"eds house\",\"ed kayce's house\",\"ed kayces house\",\"ed kayce\") {\r\n            if (game.pov.parent = Outside Ed Cases House) {\r\n              msg (\"<br/>\\\"Er, are you fucking high boss?\\\" says Jonny, \\\"We're already there man!\\\"\")\r\n            }\r\n            else {\r\n              msg (\"<br/>\\\"Right you are boss!\\\", Jonny floors the accelerator and the van hurtles down the road at breakneck speed, eventually screeching to a halt outside Ed Case's house.<br/><br/>\")\r\n              MoveObject (Van, Outside Ed Cases House)\r\n              MoveObject (player, Outside Ed Cases House)\r\n            }\r\n          }\r\n          case (\"trinity lane\",\"trinity\") {\r\n            if (game.pov.parent = Trinity Lane) {\r\n              msg (\"<br/>\\\"Er, are you fucking high boss?\\\" says Jonny, \\\"We're already there man!\\\"\")\r\n            }\r\n            else {\r\n              msg (\"<br/>\\\"Right you are boss!\\\", Jonny floors the accelerator and the van hurtles down the road at breakneck speed, eventually screeching to a halt in Trinity Lane.<br/><br/>\")\r\n              MoveObject (Van, Trinity Lane)\r\n              MoveObject (player, Trinity Lane)\r\n            }\r\n          }\r\n          case (\"town square\") {\r\n            if (game.pov.parent = Town Square) {\r\n              msg (\"<br/>\\\"Er, are you fucking high boss?\\\" says Jonny, \\\"We're already there man!\\\"\")\r\n            }\r\n            else {\r\n              msg (\"<br/>\\\"Right you are boss!\\\", Jonny floors the accelerator and the van hurtles down the road at breakneck speed, eventually screeching to a halt in the Town Square.<br/><br/>\")\r\n              MoveObject (Van, Town Square)\r\n              MoveObject (player, Town Square)\r\n            }\r\n          }\r\n          case (\"greasy spoon cafe\",\"greasy spoon café\",\"outside greasy spoon cafe\",\"greasy spoon\") {\r\n            if (game.pov.parent = Outside Greasy Spoon Café) {\r\n              msg (\"<br/>\\\"Er, are you fucking high boss?\\\" says Jonny, \\\"We're already there man!\\\"\")\r\n            }\r\n            else {\r\n              msg (\"<br/>\\\"Right you are boss!\\\", Jonny floors the accelerator and the van hurtles down the road at breakneck speed, eventually screeching to a halt outside the Greasy Spoon Café.<br/><br/>\")\r\n              MoveObject (Van, Outside Greasy Spoon Café)\r\n              MoveObject (player, Outside Greasy Spoon Café)\r\n            }\r\n          }\r\n          case (\"outside mac attack's house\",\"outside mac's house\",\"outside macs house\",\"mac's house\",\"macs house\",\"mac attack's house\") {\r\n            if (game.pov.parent = Outside Macs House) {\r\n              msg (\"<br/>\\\"Er, are you fucking high boss?\\\" says Jonny, \\\"We're already there man!\\\"\")\r\n            }\r\n            else {\r\n              msg (\"<br/>\\\"Right you are boss!\\\", Jonny floors the accelerator and the van hurtles down the road at breakneck speed, eventually screeching to a halt outside Mac Attack's house.<br/><br/>\")\r\n              MoveObject (Van, Outside Macs House)\r\n              MoveObject (player, Outside Macs House)\r\n            }\r\n          }\r\n          case (\"brunswick street\") {\r\n            if (game.pov.parent = Brunswick Street) {\r\n              msg (\"<br/>\\\"Er, are you fucking high boss?\\\" says Jonny, \\\"We're already there man!\\\"\")\r\n            }\r\n            else {\r\n              msg (\"<br/>\\\"Right you are boss!\\\", Jonny floors the accelerator and the van hurtles down the road at breakneck speed, eventually screeching to a halt on Brunswick Street.<br/><br/>\")\r\n              MoveObject (Van, Brunswick Street)\r\n              MoveObject (player, Brunswick Street)\r\n            }\r\n          }\r\n          case (\"blackfriars road\",\"blackfriar's road\") {\r\n            if (game.pov.parent = Blackfriars Road) {\r\n              msg (\"<br/>\\\"Er, are you fucking high boss?\\\" says Jonny, \\\"We're already there man!\\\"\")\r\n            }\r\n            else {\r\n              msg (\"<br/>\\\"Right you are boss!\\\", Jonny floors the accelerator and the van hurtles down the road at breakneck speed, eventually screeching to a halt on Blackfriars Road.<br/><br/>\")\r\n              MoveObject (Van, Blackfriars Road)\r\n              MoveObject (player, Blackfriars Road)\r\n            }\r\n          }\r\n          case (\"spider's house\",\"spiders house\",\"outside spiders house\",\"outside spider's house\") {\r\n            if (game.pov.parent = Outside Spiders House) {\r\n              msg (\"<br/>\\\"Er, are you fucking high boss?\\\" says Jonny, \\\"We're already there man!\\\"\")\r\n            }\r\n            else {\r\n              msg (\"<br/>\\\"Right you are boss!\\\", Jonny floors the accelerator and the van hurtles down the road at breakneck speed, eventually screeching to a halt outside Spider's house.<br/><br/>\")\r\n              MoveObject (Van, Outside Spiders House)\r\n              MoveObject (player, Outside Spiders House)\r\n            }\r\n          }\r\n          case (\"jons lockup\",\"jon's lock up\",\"jons lock up\",\"lock up\") {\r\n            if (game.pov.parent = Jons Lockup) {\r\n              msg (\"<br/>\\\"Er, are you fucking high boss?\\\" says Jonny, \\\"We're already there man!\\\"\")\r\n            }\r\n            else {\r\n              msg (\"<br/>\\\"Right you are boss!\\\", Jonny floors the accelerator and the van hurtles down the road at breakneck speed, eventually screeching to a halt at Jon's lockup garage.<br/><br/>\")\r\n              MoveObject (Van, Jons Lockup)\r\n              MoveObject (player, Jons Lockup)\r\n            }\r\n          }\r\n          case (\"mikes house\",\"mike's house\",\"outside mike's house\",\"outside mikes house\",\"mike e. smith's house\",\"mike e. smiths house\",\"outside mike e. smith's house\",\"outside mike e. smiths house\") {\r\n            if (game.pov.parent = Outside mikes house) {\r\n              msg (\"<br/>\\\"Er, are you fucking high boss?\\\" says Jonny, \\\"We're already there man!\\\"\")\r\n            }\r\n            else {\r\n              msg (\"<br/>\\\"Right you are boss!\\\", Jonny floors the accelerator and the van hurtles down the road at breakneck speed, eventually screeching to a halt outside Mike E. Smith's house.<br/><br/>\")\r\n              MoveObject (Van, Outside mikes house)\r\n              MoveObject (player, Outside mikes house)\r\n            }\r\n          }\r\n          case (\"broughton lane\") {\r\n            if (game.pov.parent = Broughton Lane) {\r\n              msg (\"<br/>\\\"Er, are you fucking high boss?\\\" says Jonny, \\\"We're already there man!\\\"\")\r\n            }\r\n            else {\r\n              msg (\"<br/>\\\"Right you are boss!\\\", Jonny floors the accelerator and the van hurtles down the road at breakneck speed, eventually screeching to a halt on Broughton Lane.<br/><br/>\")\r\n              MoveObject (Van, Broughton Lane)\r\n              MoveObject (player, Broughton Lane)\r\n            }\r\n          }\r\n          case (\"pmt music supplies\",\"pmt music\",\"music supplies\",\"pmt\",\"buzz stop guitar workshop\",\"buzz stop\") {\r\n            if (game.pov.parent = Outside PMT Music Supplies) {\r\n              msg (\"<br/>\\\"Er, are you fucking high boss?\\\" says Jonny, \\\"We're already there man!\\\"\")\r\n            }\r\n            else {\r\n              msg (\"<br/>\\\"Right you are boss!\\\", Johnny floors the accelerator and the van hurtles down the road at breakneck speed, eventually screeching to a halt Outside PMY Music Supplies.<br/><br/>\")\r\n              MoveObject (Van, Outside PMT Music Supplies)\r\n              MoveObject (player, Outside PMT Music Supplies)\r\n            }\r\n          }\r\n          case (\"discovery record store\",\"record store\",\"record shop\",\"outside record store\",\"outside discovery record store\") {\r\n            if (game.pov.parent = Outside Discovery Record Store) {\r\n              msg (\"<br/>\\\"Er, are you fucking high boss?\\\" says Jonny, \\\"We're already there man!\\\"\")\r\n            }\r\n            else {\r\n              msg (\"<br/>\\\"Right you are boss!\\\", Jonny floors the accelerator and the van hurtles down the road at breakneck speed, eventually screeching to a halt outside Discovery Record Store.<br/><br/>\")\r\n              MoveObject (Van, Outside Discovery Record Store)\r\n              MoveObject (player, Outside Discovery Record Store)\r\n            }\r\n          }\r\n          case (\"junk store\",\"junk 'n' disorderly second-hand store\",\"junk n disorderly\",\"secondhand store\", \"second-hand store\",\"junk shop\") {\r\n            if (game.pov.parent = Outside Junk Shop) {\r\n              msg (\"<br/>\\\"Er, are you fucking high boss?\\\" says Jonny, \\\"We're already there man!\\\"\")\r\n            }\r\n            else {\r\n              msg (\"<br/>\\\"Right you are boss!\\\", Jonny floors the accelerator and the van hurtles down the road at breakneck speed, eventually screeching to a halt Outside Junk 'n' Disorderly Secondhand Emporium.<br/><br/>\")\r\n              MoveObject (Van, Outside Junk Shop)\r\n              MoveObject (player, Outside Junk Shop)\r\n            }\r\n          }\r\n          case (\"oxford road\") {\r\n            if (game.pov.parent = Oxford Road) {\r\n              msg (\"<br/>\\\"Er, are you fucking high boss?\\\" says Jonny, \\\"We're already there man!\\\"\")\r\n            }\r\n            else {\r\n              msg (\"<br/>\\\"Right you are boss!\\\", Johnny floors the accelerator and the van hurtles down the road at breakneck speed, eventually screeching to a halt on Oxford Road.<br/><br/>\")\r\n              MoveObject (Van, Oxford Road)\r\n              MoveObject (player, Oxford Road)\r\n            }\r\n          }\r\n          case (\"no smoke inn\",\"smoke inn\", \"outside no smoke inn\") {\r\n            if (game.pov.parent = Outside No Smoke Inn) {\r\n              msg (\"<br/>\\\"Er, are you fucking high boss?\\\" says Jonny, \\\"We're already there man!\\\"\")\r\n            }\r\n            else {\r\n              msg (\"<br/>\\\"Right you are boss!\\\", Jonny floors the accelerator and the van hurtles down the road at breakneck speed, eventually screeching to a halt outside the No Smoke Inn.<br/><br/>\")\r\n              MoveObject (Van, Outside No Smoke Inn)\r\n              MoveObject (player, Outside No Smoke Inn)\r\n            }\r\n          }\r\n          case (\"blackfriars inn\",\"blackfriar's inn\",\"outside blackfriars inn\", \"outside blackfriar's inn\",\"Blackfriars\") {\r\n            if (game.pov.parent = Outside Blackfriars Inn) {\r\n              msg (\"<br/>\\\"Er, are you fucking high boss?\\\" says Jonny, \\\"We're already there man!\\\"\")\r\n            }\r\n            else {\r\n              msg (\"<br/>\\\"Right you are boss!\\\", Jonny floors the accelerator and the van hurtles down the road at breakneck speed, eventually screeching to a halt outside the Blackfriars Inn.<br/><br/>\")\r\n              MoveObject (Van, Outside Blackfriars Inn)\r\n              MoveObject (player, Outside Blackfriars Inn)\r\n            }\r\n          }\r\n          case (\"kfc\",\"outside kfc\",\"kfc drivethrough\") {\r\n            DriveThruKFC\r\n          }\r\n          case (\"outside warehouse\",\"warehouse\",\"cluck off warehouse\",\"chicken warehouse\") {\r\n            if (game.pov.parent = Outside Warehouse) {\r\n              msg (\"<br/>\\\"Er, are you fucking high boss?\\\" says Jonny, \\\"We're already there man!\\\"\")\r\n            }\r\n            else {\r\n              if (GetBoolean(Outside Warehouse, \"visited\")) {\r\n                msg (\"<br/>\\\"Right you are boss!\\\", Jonny floors the accelerator and the van hurtles down the road at breakneck speed, eventually screeching to a halt Outside the Cluck You! Warehouse.<br/><br/>\")\r\n                MoveObject (Van, Outside Warehouse)\r\n                MoveObject (player, Outside Warehouse)\r\n              }\r\n              else {\r\n                msg (\"<br/>\\\"Sorry Boss, I don't know where fuck that is!\\\"\")\r\n              }\r\n            }\r\n          }\r\n          default {\r\n            msg (\"\\\"Sorry boss,\\\" says Jonny, \\\"I don't know where the fuck that is.\\\"\")\r\n          }\r\n        }\r\n      }\r\n    }\r\n    else {\r\n      msg (\"Clearing a space amongst the empty cans of diet coke, coffee cups, fag ends and oily rags you jump into the driver's seat. Jonny says, \\\"It's no good boss, it needs a new alternator\\\". You sigh, and get out again.\")\r\n    }\r\n  ","$":{"name":"PickDestination"}},{"_":"\r\n    result = \"\"\r\n    count = 0\r\n    list = GetDirectChildren(parent)\r\n    if (CheckDarkness()) {\r\n      list = RemoveDarkObjects(list)\r\n    }\r\n    listLength = ListCount(list)\r\n    foreach (item, list) {\r\n      if (LengthOf(result) = 0) {\r\n        result = preList + \" \"\r\n      }\r\n      result = result + GetDisplayNameLink(item, \"object\")\r\n      if (CanSeeThrough(item)) {\r\n        result = result + FormatObjectList(\" (\" + item.contentsprefix, item, preFinal, \")\")\r\n      }\r\n      count = count + 1\r\n      if (count = listLength - 1) {\r\n        result = result + \" \" + preFinal + \" \"\r\n      }\r\n      else if (count < listLength) {\r\n        result = result + \", \"\r\n      }\r\n      else {\r\n        result = result + postList\r\n      }\r\n    }\r\n    return (result)\r\n  ","$":{"name":"FormatVapeList","parameters":"preList, parent, preFinal, postList","type":"string"}},{"_":"\r\n    if (not HasAttribute(buttons, \"flavors_to_mix\")) {\r\n      buttons.flavors_to_mix = NewStringList()\r\n    }\r\n    list add (buttons.flavors_to_mix, flavor)\r\n    if (ListCount(buttons.flavors_to_mix)>3) {\r\n      removing = buttons.flavors_to_mix[0]\r\n      msg (removing + \" is no longer selected.\")\r\n      list remove (buttons.flavors_to_mix, removing)\r\n    }\r\n  ","$":{"name":"SelectFlavor","parameters":"flavor"}},{"_":"\r\n    if (HasAttribute(buttons,\"flavors_to_mix\")) {\r\n      if (ListCount(buttons.flavors_to_mix)=3) {\r\n        tube = CloneObject(vape_cartridge)\r\n        foreach (flavor, buttons.flavors_to_mix) {\r\n          o = GetObject(flavor)\r\n          newClone = CloneObjectAndMove(o,tube)\r\n        }\r\n        tube.flavors = buttons.flavors_to_mix\r\n        buttons.flavors_to_mix = null\r\n        tube.alias = \"vape cartridge\"\r\n        desc = \"A mixture of \" + FormatList(tube.flavors,\",\",\"and\",\".\")\r\n        tube.look = desc\r\n        MoveObject (tube, tray)\r\n        msg (\"You hear the cartridge fall into the tray.\")\r\n        CheckVape (tube, Split(\"Strawberry Explosion;Baked Beans on Toast;French Fries with Mayonnaise\",\";\"))\r\n      }\r\n      else {\r\n        msg (\"<br/>You must select three flavors before the machine can do its job.\")\r\n      }\r\n    }\r\n    else {\r\n      msg (\"<br/>You must select three flavors before the machine can do its job.\")\r\n    }\r\n  ","$":{"name":"DoVendVape"}},{"_":"\r\n    match = false\r\n    list = NewStringList()\r\n    foreach (flavor, flavors) {\r\n      if (ListContains(tube.flavors,flavor)) {\r\n        list add (list, flavor)\r\n      }\r\n    }\r\n    if (ListCount(list)=3) {\r\n      match = true\r\n    }\r\n    if (match) {\r\n      tube.correct_mix = true\r\n    }\r\n  ","$":{"name":"CheckVape","parameters":"tube, flavors"}},{"_":"\r\n    if (GetBoolean(Tony Def, \"hungry\")) {\r\n      if (Contains (Van,Box of Chicken)) {\r\n        msg (\"<br/><br/>You are in KFC Drivethrough. <br/><br/><br/>Jonny drives up to the window and talks to the server, she sends a couple of staff members out to unload the chicken from the van.<br/><br/> \\\"Go park up and I'll send someone out with your order when it's ready\\\" she says.<br/><br/> \\\"Righto!\\\" says Jonny and you park up.<br/><br/> A few minutes later a staff member delivers a huge order of chicken to your van. Jonny manages to refrain from eating all of it. <br/><br/>\")\r\n        RemoveObject (Box of Chicken)\r\n        AddToInventory (KFC takeaway)\r\n        MoveObject (Van, Outside KFC)\r\n        MoveObject (player, Outside KFC)\r\n        SetObjectFlagOn (Outside KFC, \"chick_delivered\")\r\n      }\r\n      else {\r\n        firsttime {\r\n          msg (\"<br/><br/>You are in KFC Drivethrough.<br/><br/>You can see Jonny Columba and a Van.<br/><br/>Jonny drives you up to the order window. He speaks to the server, she says, \\\"Sorry, we're out of chicken, drinks only. There's been a delay with the delivery, flooding on the M6.\\\"<br/><br/>\\\"My god!\\\" says Jonny, \\\"have you phoned the police?\\\"<br/><br/>The server laughs, and then realises that Jonny is deadly serious. \\\"Look,\\\" she says, \\\"if you're that desperate you can go any pick up a few boxes from the warehouse yourselves and bring them here, we've just had a call that the M6 is open again, here take this order form.\\\" <br/><br/>She explains to Jonny where to find the warehouse. You drive out.<br/><br/>\\\"Right,\\\" says Jonny, \\\"no time to lose!\\\"<br/><br/> He steps heavily on the gas pedal and you hurtle two junctions up the M6, aquaplaning most of the way.<br/><br/><bold> Press any key to continue </bold><br/><br/>\")\r\n          wait {\r\n            msg (\"<br/>You are on the M6 motorway<br/><br/>You can see Jonny Columba and a Van<br/><br/> \\\"It's just like water skiing!\\\" says Jonny, \\\"Didn't know you'd ever done that,\\\" you reply, \\\"I haven't, \\\" says Jon.<br/><br/>After a terror filled ten minutes you arrive outside the warehouse and step out of the van.<br/><br/>\")\r\n            MoveObject (player, Outside Warehouse)\r\n            MoveObject (Van, Outside Warehouse)\r\n          }\r\n        }\r\n        otherwise {\r\n          if (GetBoolean(Outside KFC, \"chick_delivered\")) {\r\n            msg (\"<br/>You contemplate entering the KFC drive through again but think better of it for now. Surely Jon will have a heart attack if he eats any more.\")\r\n          }\r\n          else {\r\n            msg (\"<br/>\\\"Right you are boss!\\\" Jonny drives up to the order window and the server says, \\\"We're still waiting for a delivery, like I told you before if you are desperate then go to the chicken warehouse and pick some up for us.\\\" Jonny drives out again.<br/><br/>\")\r\n          }\r\n        }\r\n      }\r\n    }\r\n    else {\r\n      firsttime {\r\n        msg (\"<br/>You are in KFC Drivethrough<br/><br/>\\\"Top idea Boss!\\\" says Jonny gleefully as he drives you up to the order window,<br/><br/> \\\"What do you want? he says.<br/><br/> \\\"Just a diet coke\\\" you reply, \\\"we've long since had breakfast, you hungry again?!\\\"<br/><br/> \\\"Always got room for the colonel's best!\\\" says Jon.<br/><br/> Jonny orders a huge family bucket of chicken, fries and sweetcorn, \\\"they've only got pepsi boss?\\\",<br/><br/> \\\"Forget it then\\\" you reply.<br/><br/>You park up and watch in silent horror as Jonny shovels the chicken into his mouth with both hands, ripping the pieces apart with a look of primeval joy in his face. Soon he's finished, and on your orders steps out of the van to get rid of the rubbish. You step out too,<br/>\")\r\n        MoveObject (Van, Outside KFC)\r\n        MoveObject (player, Outside KFC)\r\n      }\r\n      otherwise {\r\n        msg (\"You contemplate entering the KFC drive through again but think better of it for now. Surely Jon will have a heart attack if he eats any more.\")\r\n      }\r\n    }\r\n  ","$":{"name":"DriveThruKFC"}},{"_":"\r\n    if (HasString(object, \"listchildrenprefix\")) {\r\n      listprefix = object.listchildrenprefix\r\n    }\r\n    else {\r\n      listprefix = DynamicTemplate(\"ObjectContains\", object)\r\n    }\r\n    if (ListCount(GetDirectChildren(object))>0) {\r\n      o = GetDirectChildren(object)[0]\r\n      msg (\"  It contains \" + GetDisplayName(o) + \".\")\r\n    }\r\n  ","$":{"name":"ListSocketContents","parameters":"object"}}]}}
```